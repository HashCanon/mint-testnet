const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-ZmbC0une.js","assets/index-CNhgDwF_.js","assets/index-C09vCpyB.css","assets/index.es-Bl5n3DQD.js","assets/events-DQ172AOg.js","assets/basic-JQqsByr6.js","assets/index-DBxQXZ3j.js","assets/w3m-modal-CcxKND6S.js"])))=>i.map(i=>d[i]);
import{q as sf,T as rf,U as nf,r as of,w as af,t as cf,_ as Oa,u as $n,v as Yc}from"./index-CNhgDwF_.js";import{h as Tn,s as oo,i as Cc,j as lf,k as uf,l as hf,m as df,n as pf,o as Zc,I as bi,p as nt,q as j,u as Tt,C as ff,v as Ct,x as gf,y as Ki,z as $a,A as Dh,B as gr,D as wn,E as Lh,F as ht,G as mf,J as xt,K as tr,L as vi,O as Ic,M as qt,N as wf,P as Ac,Q as Nc,R as yo,S as _c,T as Xc,U as yf,V as bf,W as Gr,X as Bh,Y as ms,Z as ns,_ as Mh,$ as As,a0 as Qt}from"./index.es-Bl5n3DQD.js";function Qc(t,e={}){const{key:s="fallback",name:r="Fallback",rank:i=!1,shouldThrow:n=vf,retryCount:o,retryDelay:a}=e;return({chain:c,pollingInterval:l=4e3,timeout:u,...h})=>{let d=t,f=()=>{};const m=sf({key:s,name:r,async request({method:g,params:p}){let w;const y=async(C=0)=>{const O=d[C]({...h,chain:c,retryCount:0,timeout:u});try{const T=await O.request({method:g,params:p});return f({method:g,params:p,response:T,transport:O,status:"success"}),T}catch(T){if(f({error:T,method:g,params:p,transport:O,status:"error"}),n(T)||C===d.length-1||(w??=d.slice(C+1).some(P=>{const{include:N,exclude:$}=P({chain:c}).config.methods||{};return N?N.includes(g):$?!$.includes(g):!0}),!w))throw T;return y(C+1)}};return y()},retryCount:o,retryDelay:a,type:"fallback"},{onResponse:g=>f=g,transports:d.map(g=>g({chain:c,retryCount:0}))});if(i){const g=typeof i=="object"?i:{};Ef({chain:c,interval:g.interval??l,onTransports:p=>d=p,ping:g.ping,sampleCount:g.sampleCount,timeout:g.timeout,transports:d,weights:g.weights})}return m}}function vf(t){return!!("code"in t&&typeof t.code=="number"&&(t.code===rf.code||t.code===nf.code||of.nodeMessage.test(t.message)||t.code===5e3))}function Ef({chain:t,interval:e=4e3,onTransports:s,ping:r,sampleCount:i=10,timeout:n=1e3,transports:o,weights:a={}}){const{stability:c=.7,latency:l=.3}=a,u=[],h=async()=>{const d=await Promise.all(o.map(async g=>{const p=g({chain:t,retryCount:0,timeout:n}),w=Date.now();let y,C;try{await(r?r({transport:p}):p.request({method:"net_listening"})),C=1}catch{C=0}finally{y=Date.now()}return{latency:y-w,success:C}}));u.push(d),u.length>i&&u.shift();const f=Math.max(...u.map(g=>Math.max(...g.map(({latency:p})=>p)))),m=o.map((g,p)=>{const w=u.map(P=>P[p].latency),C=1-w.reduce((P,N)=>P+N,0)/w.length/f,O=u.map(P=>P[p].success),T=O.reduce((P,N)=>P+N,0)/O.length;return T===0?[0,p]:[l*C+c*T,p]}).sort((g,p)=>p[0]-g[0]);s(m.map(([,g])=>o[g])),await af(e),h()};h()}var el={};const K={WC_NAME_SUFFIX:".reown.id",WC_NAME_SUFFIX_LEGACY:".wcn.id",BLOCKCHAIN_API_RPC_URL:"https://rpc.walletconnect.org",PULSE_API_URL:"https://pulse.walletconnect.org",W3M_API_URL:"https://api.web3modal.org",CONNECTOR_ID:{WALLET_CONNECT:"walletConnect",INJECTED:"injected",WALLET_STANDARD:"announced",COINBASE:"coinbaseWallet",COINBASE_SDK:"coinbaseWalletSDK",SAFE:"safe",LEDGER:"ledger",OKX:"okx",EIP6963:"eip6963",AUTH:"ID_AUTH"},CONNECTOR_NAMES:{AUTH:"Auth"},AUTH_CONNECTOR_SUPPORTED_CHAINS:["eip155","solana"],LIMITS:{PENDING_TRANSACTIONS:99},CHAIN:{EVM:"eip155",SOLANA:"solana",POLKADOT:"polkadot",BITCOIN:"bip122"},CHAIN_NAME_MAP:{eip155:"EVM Networks",solana:"Solana",polkadot:"Polkadot",bip122:"Bitcoin",cosmos:"Cosmos"},ADAPTER_TYPES:{BITCOIN:"bitcoin",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5"},USDT_CONTRACT_ADDRESSES:["0xdac17f958d2ee523a2206206994597c13d831ec7","0xc2132d05d31c914a87c6611c10748aeb04b58e8f","0x9702230a8ea53601f5cd2dc00fdbc13d4df4a8c7","0x919C1c267BC06a7039e03fcc2eF738525769109c","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e","0x55d398326f99059fF775485246999027B3197955","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9"],HTTP_STATUS_CODES:{SERVICE_UNAVAILABLE:503,FORBIDDEN:403},UNSUPPORTED_NETWORK_NAME:"Unknown Network",SECURE_SITE_SDK_ORIGIN:(typeof process<"u"&&typeof el<"u"?el.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org"},jh={caipNetworkIdToNumber(t){return t?Number(t.split(":")[1]):void 0},parseEvmChainId(t){return typeof t=="string"?this.caipNetworkIdToNumber(t):t},getNetworksByNamespace(t,e){return t?.filter(s=>s.chainNamespace===e)||[]},getFirstNetworkByNamespace(t,e){return this.getNetworksByNamespace(t,e)[0]},getNetworkNameByCaipNetworkId(t,e){if(!e)return;const s=t.find(i=>i.caipNetworkId===e);if(s)return s.name;const[r]=e.split(":");return K.CHAIN_NAME_MAP?.[r]||void 0}};var Cf=20,If=1,ar=1e6,tl=1e6,Af=-7,Nf=21,_f=!1,yn="[big.js] ",mr=yn+"Invalid ",bo=mr+"decimal places",Sf=mr+"rounding mode",qh=yn+"Division by zero",Ee={},as=void 0,Pf=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function Fh(){function t(e){var s=this;if(!(s instanceof t))return e===as?Fh():new t(e);if(e instanceof t)s.s=e.s,s.e=e.e,s.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(mr+"value");e=e===0&&1/e<0?"-0":String(e)}Of(s,e)}s.constructor=t}return t.prototype=Ee,t.DP=Cf,t.RM=If,t.NE=Af,t.PE=Nf,t.strict=_f,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function Of(t,e){var s,r,i;if(!Pf.test(e))throw Error(mr+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(s=e.indexOf("."))>-1&&(e=e.replace(".","")),(r=e.search(/e/i))>0?(s<0&&(s=r),s+=+e.slice(r+1),e=e.substring(0,r)):s<0&&(s=e.length),i=e.length,r=0;r<i&&e.charAt(r)=="0";)++r;if(r==i)t.c=[t.e=0];else{for(;i>0&&e.charAt(--i)=="0";);for(t.e=s-r-1,t.c=[],s=0;r<=i;)t.c[s++]=+e.charAt(r++)}return t}function wr(t,e,s,r){var i=t.c;if(s===as&&(s=t.constructor.RM),s!==0&&s!==1&&s!==2&&s!==3)throw Error(Sf);if(e<1)r=s===3&&(r||!!i[0])||e===0&&(s===1&&i[0]>=5||s===2&&(i[0]>5||i[0]===5&&(r||i[1]!==as))),i.length=1,r?(t.e=t.e-e+1,i[0]=1):i[0]=t.e=0;else if(e<i.length){if(r=s===1&&i[e]>=5||s===2&&(i[e]>5||i[e]===5&&(r||i[e+1]!==as||i[e-1]&1))||s===3&&(r||!!i[0]),i.length=e,r){for(;++i[--e]>9;)if(i[e]=0,e===0){++t.e,i.unshift(1);break}}for(e=i.length;!i[--e];)i.pop()}return t}function yr(t,e,s){var r=t.e,i=t.c.join(""),n=i.length;if(e)i=i.charAt(0)+(n>1?"."+i.slice(1):"")+(r<0?"e":"e+")+r;else if(r<0){for(;++r;)i="0"+i;i="0."+i}else if(r>0)if(++r>n)for(r-=n;r--;)i+="0";else r<n&&(i=i.slice(0,r)+"."+i.slice(r));else n>1&&(i=i.charAt(0)+"."+i.slice(1));return t.s<0&&s?"-"+i:i}Ee.abs=function(){var t=new this.constructor(this);return t.s=1,t};Ee.cmp=function(t){var e,s=this,r=s.c,i=(t=new s.constructor(t)).c,n=s.s,o=t.s,a=s.e,c=t.e;if(!r[0]||!i[0])return r[0]?n:i[0]?-o:0;if(n!=o)return n;if(e=n<0,a!=c)return a>c^e?1:-1;for(o=(a=r.length)<(c=i.length)?a:c,n=-1;++n<o;)if(r[n]!=i[n])return r[n]>i[n]^e?1:-1;return a==c?0:a>c^e?1:-1};Ee.div=function(t){var e=this,s=e.constructor,r=e.c,i=(t=new s(t)).c,n=e.s==t.s?1:-1,o=s.DP;if(o!==~~o||o<0||o>ar)throw Error(bo);if(!i[0])throw Error(qh);if(!r[0])return t.s=n,t.c=[t.e=0],t;var a,c,l,u,h,d=i.slice(),f=a=i.length,m=r.length,g=r.slice(0,a),p=g.length,w=t,y=w.c=[],C=0,O=o+(w.e=e.e-t.e)+1;for(w.s=n,n=O<0?0:O,d.unshift(0);p++<a;)g.push(0);do{for(l=0;l<10;l++){if(a!=(p=g.length))u=a>p?1:-1;else for(h=-1,u=0;++h<a;)if(i[h]!=g[h]){u=i[h]>g[h]?1:-1;break}if(u<0){for(c=p==a?i:d;p;){if(g[--p]<c[p]){for(h=p;h&&!g[--h];)g[h]=9;--g[h],g[p]+=10}g[p]-=c[p]}for(;!g[0];)g.shift()}else break}y[C++]=u?l:++l,g[0]&&u?g[p]=r[f]||0:g=[r[f]]}while((f++<m||g[0]!==as)&&n--);return!y[0]&&C!=1&&(y.shift(),w.e--,O--),C>O&&wr(w,O,s.RM,g[0]!==as),w};Ee.eq=function(t){return this.cmp(t)===0};Ee.gt=function(t){return this.cmp(t)>0};Ee.gte=function(t){return this.cmp(t)>-1};Ee.lt=function(t){return this.cmp(t)<0};Ee.lte=function(t){return this.cmp(t)<1};Ee.minus=Ee.sub=function(t){var e,s,r,i,n=this,o=n.constructor,a=n.s,c=(t=new o(t)).s;if(a!=c)return t.s=-c,n.plus(t);var l=n.c.slice(),u=n.e,h=t.c,d=t.e;if(!l[0]||!h[0])return h[0]?t.s=-c:l[0]?t=new o(n):t.s=1,t;if(a=u-d){for((i=a<0)?(a=-a,r=l):(d=u,r=h),r.reverse(),c=a;c--;)r.push(0);r.reverse()}else for(s=((i=l.length<h.length)?l:h).length,a=c=0;c<s;c++)if(l[c]!=h[c]){i=l[c]<h[c];break}if(i&&(r=l,l=h,h=r,t.s=-t.s),(c=(s=h.length)-(e=l.length))>0)for(;c--;)l[e++]=0;for(c=e;s>a;){if(l[--s]<h[s]){for(e=s;e&&!l[--e];)l[e]=9;--l[e],l[s]+=10}l[s]-=h[s]}for(;l[--c]===0;)l.pop();for(;l[0]===0;)l.shift(),--d;return l[0]||(t.s=1,l=[d=0]),t.c=l,t.e=d,t};Ee.mod=function(t){var e,s=this,r=s.constructor,i=s.s,n=(t=new r(t)).s;if(!t.c[0])throw Error(qh);return s.s=t.s=1,e=t.cmp(s)==1,s.s=i,t.s=n,e?new r(s):(i=r.DP,n=r.RM,r.DP=r.RM=0,s=s.div(t),r.DP=i,r.RM=n,this.minus(s.times(t)))};Ee.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t};Ee.plus=Ee.add=function(t){var e,s,r,i=this,n=i.constructor;if(t=new n(t),i.s!=t.s)return t.s=-t.s,i.minus(t);var o=i.e,a=i.c,c=t.e,l=t.c;if(!a[0]||!l[0])return l[0]||(a[0]?t=new n(i):t.s=i.s),t;if(a=a.slice(),e=o-c){for(e>0?(c=o,r=l):(e=-e,r=a),r.reverse();e--;)r.push(0);r.reverse()}for(a.length-l.length<0&&(r=l,l=a,a=r),e=l.length,s=0;e;a[e]%=10)s=(a[--e]=a[e]+l[e]+s)/10|0;for(s&&(a.unshift(s),++c),e=a.length;a[--e]===0;)a.pop();return t.c=a,t.e=c,t};Ee.pow=function(t){var e=this,s=new e.constructor("1"),r=s,i=t<0;if(t!==~~t||t<-tl||t>tl)throw Error(mr+"exponent");for(i&&(t=-t);t&1&&(r=r.times(e)),t>>=1,!!t;)e=e.times(e);return i?s.div(r):r};Ee.prec=function(t,e){if(t!==~~t||t<1||t>ar)throw Error(mr+"precision");return wr(new this.constructor(this),t,e)};Ee.round=function(t,e){if(t===as)t=0;else if(t!==~~t||t<-ar||t>ar)throw Error(bo);return wr(new this.constructor(this),t+this.e+1,e)};Ee.sqrt=function(){var t,e,s,r=this,i=r.constructor,n=r.s,o=r.e,a=new i("0.5");if(!r.c[0])return new i(r);if(n<0)throw Error(yn+"No square root");n=Math.sqrt(+yr(r,!0,!0)),n===0||n===1/0?(e=r.c.join(""),e.length+o&1||(e+="0"),n=Math.sqrt(e),o=((o+1)/2|0)-(o<0||o&1),t=new i((n==1/0?"5e":(n=n.toExponential()).slice(0,n.indexOf("e")+1))+o)):t=new i(n+""),o=t.e+(i.DP+=4);do s=t,t=a.times(s.plus(r.div(s)));while(s.c.slice(0,o).join("")!==t.c.slice(0,o).join(""));return wr(t,(i.DP-=4)+t.e+1,i.RM)};Ee.times=Ee.mul=function(t){var e,s=this,r=s.constructor,i=s.c,n=(t=new r(t)).c,o=i.length,a=n.length,c=s.e,l=t.e;if(t.s=s.s==t.s?1:-1,!i[0]||!n[0])return t.c=[t.e=0],t;for(t.e=c+l,o<a&&(e=i,i=n,n=e,l=o,o=a,a=l),e=new Array(l=o+a);l--;)e[l]=0;for(c=a;c--;){for(a=0,l=o+c;l>c;)a=e[l]+n[c]*i[l-c-1]+a,e[l--]=a%10,a=a/10|0;e[l]=a}for(a?++t.e:e.shift(),c=e.length;!e[--c];)e.pop();return t.c=e,t};Ee.toExponential=function(t,e){var s=this,r=s.c[0];if(t!==as){if(t!==~~t||t<0||t>ar)throw Error(bo);for(s=wr(new s.constructor(s),++t,e);s.c.length<t;)s.c.push(0)}return yr(s,!0,!!r)};Ee.toFixed=function(t,e){var s=this,r=s.c[0];if(t!==as){if(t!==~~t||t<0||t>ar)throw Error(bo);for(s=wr(new s.constructor(s),t+s.e+1,e),t=t+s.e+1;s.c.length<t;)s.c.push(0)}return yr(s,!1,!!r)};Ee[Symbol.for("nodejs.util.inspect.custom")]=Ee.toJSON=Ee.toString=function(){var t=this,e=t.constructor;return yr(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])};Ee.toNumber=function(){var t=+yr(this,!0,!0);if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error(yn+"Imprecise conversion");return t};Ee.toPrecision=function(t,e){var s=this,r=s.constructor,i=s.c[0];if(t!==as){if(t!==~~t||t<1||t>ar)throw Error(mr+"precision");for(s=wr(new r(s),t,e);s.c.length<t;)s.c.push(0)}return yr(s,t<=s.e||s.e<=r.NE||s.e>=r.PE,!!i)};Ee.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error(yn+"valueOf disallowed");return yr(t,t.e<=e.NE||t.e>=e.PE,!0)};var Pi=Fh();const $f={bigNumber(t){return t?new Pi(t):new Pi(0)},multiply(t,e){if(t===void 0||e===void 0)return new Pi(0);const s=new Pi(t),r=new Pi(e);return s.times(r)},formatNumberToLocalString(t,e=2){return t===void 0?"0.00":typeof t=="number"?t.toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e}):parseFloat(t).toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e})},parseLocalStringToNumber(t){return t===void 0?0:parseFloat(t.replace(/,/gu,""))}},Tf=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],kf=[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],xf=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],Rf={getERC20Abi:t=>K.USDT_CONTRACT_ADDRESSES.includes(t)?xf:Tf,getSwapAbi:()=>kf},Ns={validateCaipAddress(t){if(t.split(":")?.length!==3)throw new Error("Invalid CAIP Address");return t},parseCaipAddress(t){const e=t.split(":");if(e.length!==3)throw new Error(`Invalid CAIP-10 address: ${t}`);const[s,r,i]=e;if(!s||!r||!i)throw new Error(`Invalid CAIP-10 address: ${t}`);return{chainNamespace:s,chainId:r,address:i}},parseCaipNetworkId(t){const e=t.split(":");if(e.length!==2)throw new Error(`Invalid CAIP-2 network id: ${t}`);const[s,r]=e;if(!s||!r)throw new Error(`Invalid CAIP-2 network id: ${t}`);return{chainNamespace:s,chainId:r}}},re={WALLET_ID:"@appkit/wallet_id",WALLET_NAME:"@appkit/wallet_name",SOLANA_WALLET:"@appkit/solana_wallet",SOLANA_CAIP_CHAIN:"@appkit/solana_caip_chain",ACTIVE_CAIP_NETWORK_ID:"@appkit/active_caip_network_id",CONNECTED_SOCIAL:"@appkit/connected_social",CONNECTED_SOCIAL_USERNAME:"@appkit-wallet/SOCIAL_USERNAME",RECENT_WALLETS:"@appkit/recent_wallets",DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",ACTIVE_NAMESPACE:"@appkit/active_namespace",CONNECTED_NAMESPACES:"@appkit/connected_namespaces",CONNECTION_STATUS:"@appkit/connection_status",SIWX_AUTH_TOKEN:"@appkit/siwx-auth-token",SIWX_NONCE_TOKEN:"@appkit/siwx-nonce-token",TELEGRAM_SOCIAL_PROVIDER:"@appkit/social_provider",NATIVE_BALANCE_CACHE:"@appkit/native_balance_cache",PORTFOLIO_CACHE:"@appkit/portfolio_cache",ENS_CACHE:"@appkit/ens_cache",IDENTITY_CACHE:"@appkit/identity_cache",PREFERRED_ACCOUNT_TYPES:"@appkit/preferred_account_types",CONNECTIONS:"@appkit/connections"};function Bo(t){if(!t)throw new Error("Namespace is required for CONNECTED_CONNECTOR_ID");return`@appkit/${t}:connected_connector_id`}const se={setItem(t,e){ji()&&e!==void 0&&localStorage.setItem(t,e)},getItem(t){if(ji())return localStorage.getItem(t)||void 0},removeItem(t){ji()&&localStorage.removeItem(t)},clear(){ji()&&localStorage.clear()}};function ji(){return typeof window<"u"&&typeof localStorage<"u"}function Us(t,e){return e==="light"?{"--w3m-accent":t?.["--w3m-accent"]||"hsla(231, 100%, 70%, 1)","--w3m-background":"#fff"}:{"--w3m-accent":t?.["--w3m-accent"]||"hsla(230, 100%, 67%, 1)","--w3m-background":"#121313"}}const Uf=Symbol(),sl=Object.getPrototypeOf,Ta=new WeakMap,Df=t=>t&&(Ta.has(t)?Ta.get(t):sl(t)===Object.prototype||sl(t)===Array.prototype),Lf=t=>Df(t)&&t[Uf]||null,rl=(t,e=!0)=>{Ta.set(t,e)},ao={},Mo=t=>typeof t=="object"&&t!==null,xs=new WeakMap,qi=new WeakSet,Bf=(t=Object.is,e=(l,u)=>new Proxy(l,u),s=l=>Mo(l)&&!qi.has(l)&&(Array.isArray(l)||!(Symbol.iterator in l))&&!(l instanceof WeakMap)&&!(l instanceof WeakSet)&&!(l instanceof Error)&&!(l instanceof Number)&&!(l instanceof Date)&&!(l instanceof String)&&!(l instanceof RegExp)&&!(l instanceof ArrayBuffer),r=l=>{switch(l.status){case"fulfilled":return l.value;case"rejected":throw l.reason;default:throw l}},i=new WeakMap,n=(l,u,h=r)=>{const d=i.get(l);if(d?.[0]===u)return d[1];const f=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l));return rl(f,!0),i.set(l,[u,f]),Reflect.ownKeys(l).forEach(m=>{if(Object.getOwnPropertyDescriptor(f,m))return;const g=Reflect.get(l,m),{enumerable:p}=Reflect.getOwnPropertyDescriptor(l,m),w={value:g,enumerable:p,configurable:!0};if(qi.has(g))rl(g,!1);else if(g instanceof Promise)delete w.value,w.get=()=>h(g);else if(xs.has(g)){const[y,C]=xs.get(g);w.value=n(y,C(),h)}Object.defineProperty(f,m,w)}),Object.preventExtensions(f)},o=new WeakMap,a=[1,1],c=l=>{if(!Mo(l))throw new Error("object required");const u=o.get(l);if(u)return u;let h=a[0];const d=new Set,f=(v,k=++a[0])=>{h!==k&&(h=k,d.forEach(S=>S(v,k)))};let m=a[1];const g=(v=++a[1])=>(m!==v&&!d.size&&(m=v,w.forEach(([k])=>{const S=k[1](v);S>h&&(h=S)})),h),p=v=>(k,S)=>{const R=[...k];R[1]=[v,...R[1]],f(R,S)},w=new Map,y=(v,k)=>{if((ao?"production":void 0)!=="production"&&w.has(v))throw new Error("prop listener already exists");if(d.size){const S=k[3](p(v));w.set(v,[k,S])}else w.set(v,[k])},C=v=>{var k;const S=w.get(v);S&&(w.delete(v),(k=S[1])==null||k.call(S))},O=v=>(d.add(v),d.size===1&&w.forEach(([S,R],L)=>{if((ao?"production":void 0)!=="production"&&R)throw new Error("remove already exists");const E=S[3](p(L));w.set(L,[S,E])}),()=>{d.delete(v),d.size===0&&w.forEach(([S,R],L)=>{R&&(R(),w.set(L,[S]))})}),T=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l)),N=e(T,{deleteProperty(v,k){const S=Reflect.get(v,k);C(k);const R=Reflect.deleteProperty(v,k);return R&&f(["delete",[k],S]),R},set(v,k,S,R){const L=Reflect.has(v,k),E=Reflect.get(v,k,R);if(L&&(t(E,S)||o.has(S)&&t(E,o.get(S))))return!0;C(k),Mo(S)&&(S=Lf(S)||S);let A=S;if(S instanceof Promise)S.then(I=>{S.status="fulfilled",S.value=I,f(["resolve",[k],I])}).catch(I=>{S.status="rejected",S.reason=I,f(["reject",[k],I])});else{!xs.has(S)&&s(S)&&(A=c(S));const I=!qi.has(A)&&xs.get(A);I&&y(k,I)}return Reflect.set(v,k,A,R),f(["set",[k],S,E]),!0}});o.set(l,N);const $=[T,g,n,O];return xs.set(N,$),Reflect.ownKeys(l).forEach(v=>{const k=Object.getOwnPropertyDescriptor(l,v);"value"in k&&(N[v]=l[v],delete k.value,delete k.writable),Object.defineProperty(T,v,k)}),N})=>[c,xs,qi,t,e,s,r,i,n,o,a],[Mf]=Bf();function ke(t={}){return Mf(t)}function ot(t,e,s){const r=xs.get(t);(ao?"production":void 0)!=="production"&&!r&&console.warn("Please use proxy object");let i;const n=[],o=r[3];let a=!1;const l=o(u=>{n.push(u),i||(i=Promise.resolve().then(()=>{i=void 0,a&&e(n.splice(0))}))});return a=!0,()=>{a=!1,l()}}function nn(t,e){const s=xs.get(t);(ao?"production":void 0)!=="production"&&!s&&console.warn("Please use proxy object");const[r,i,n]=s;return n(r,i(),e)}function cr(t){return qi.add(t),t}function at(t,e,s,r){let i=t[e];return ot(t,()=>{const n=t[e];Object.is(i,n)||s(i=n)})}function jf(t){const e=ke({data:Array.from([]),has(s){return this.data.some(r=>r[0]===s)},set(s,r){const i=this.data.find(n=>n[0]===s);return i?i[1]=r:this.data.push([s,r]),this},get(s){var r;return(r=this.data.find(i=>i[0]===s))==null?void 0:r[1]},delete(s){const r=this.data.findIndex(i=>i[0]===s);return r===-1?!1:(this.data.splice(r,1),!0)},clear(){this.data.splice(0)},get size(){return this.data.length},toJSON(){return new Map(this.data)},forEach(s){this.data.forEach(r=>{s(r[1],r[0],this)})},keys(){return this.data.map(s=>s[0]).values()},values(){return this.data.map(s=>s[1]).values()},entries(){return new Map(this.data).entries()},get[Symbol.toStringTag](){return"Map"},[Symbol.iterator](){return this.entries()}});return Object.defineProperties(e,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(e),e}const zh=[{label:"Coinbase",name:"coinbase",feeRange:"1-2%",url:"",supportedChains:["eip155"]},{label:"Meld.io",name:"meld",feeRange:"1-2%",url:"https://meldcrypto.com",supportedChains:["eip155","solana"]}],qf="WXETMuFUQmqqybHuRkSgxv:25B8LJHSfpG6LVjR2ytU5Cwh7Z4Sch2ocoU",Se={FOUR_MINUTES_MS:24e4,TEN_SEC_MS:1e4,ONE_SEC_MS:1e3,BALANCE_SUPPORTED_CHAINS:["eip155","solana"],NAMES_SUPPORTED_CHAIN_NAMESPACES:["eip155"],NATIVE_TOKEN_ADDRESS:{eip155:"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",solana:"So11111111111111111111111111111111111111111",polkadot:"0x",bip122:"0x",cosmos:"0x"},CONVERT_SLIPPAGE_TOLERANCE:1,CONNECT_LABELS:{MOBILE:"Open and continue in the wallet app"},SEND_SUPPORTED_NAMESPACES:["eip155","solana"],DEFAULT_REMOTE_FEATURES:{swaps:["1inch"],onramp:["coinbase","meld"],email:!0,socials:["google","x","discord","farcaster","github","apple","facebook"],activity:!0,reownBranding:!0},DEFAULT_REMOTE_FEATURES_DISABLED:{email:!1,socials:!1,swaps:!1,onramp:!1,activity:!1,reownBranding:!1},DEFAULT_FEATURES:{receive:!0,send:!0,emailShowWallets:!0,connectorTypeOrder:["walletConnect","recent","injected","featured","custom","external","recommended"],analytics:!0,allWallets:!0,legalCheckbox:!1,smartSessions:!1,collapseWallets:!1,walletFeaturesOrder:["onramp","swaps","receive","send"],connectMethodsOrder:void 0,pay:!1},DEFAULT_ACCOUNT_TYPES:{bip122:"payment",eip155:"smartAccount",polkadot:"eoa",solana:"eoa"},ADAPTER_TYPES:{UNIVERSAL:"universal"}},H={cacheExpiry:{portfolio:3e4,nativeBalance:3e4,ens:3e5,identity:3e5},isCacheExpired(t,e){return Date.now()-t>e},getActiveNetworkProps(){const t=H.getActiveNamespace(),e=H.getActiveCaipNetworkId(),s=e?e.split(":")[1]:void 0,r=s?isNaN(Number(s))?s:Number(s):void 0;return{namespace:t,caipNetworkId:e,chainId:r}},setWalletConnectDeepLink({name:t,href:e}){try{se.setItem(re.DEEPLINK_CHOICE,JSON.stringify({href:e,name:t}))}catch{console.info("Unable to set WalletConnect deep link")}},getWalletConnectDeepLink(){try{const t=se.getItem(re.DEEPLINK_CHOICE);if(t)return JSON.parse(t)}catch{console.info("Unable to get WalletConnect deep link")}},deleteWalletConnectDeepLink(){try{se.removeItem(re.DEEPLINK_CHOICE)}catch{console.info("Unable to delete WalletConnect deep link")}},setActiveNamespace(t){try{se.setItem(re.ACTIVE_NAMESPACE,t)}catch{console.info("Unable to set active namespace")}},setActiveCaipNetworkId(t){try{se.setItem(re.ACTIVE_CAIP_NETWORK_ID,t),H.setActiveNamespace(t.split(":")[0])}catch{console.info("Unable to set active caip network id")}},getActiveCaipNetworkId(){try{return se.getItem(re.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to get active caip network id");return}},deleteActiveCaipNetworkId(){try{se.removeItem(re.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to delete active caip network id")}},deleteConnectedConnectorId(t){try{const e=Bo(t);se.removeItem(e)}catch{console.info("Unable to delete connected connector id")}},setAppKitRecent(t){try{const e=H.getRecentWallets();e.find(r=>r.id===t.id)||(e.unshift(t),e.length>2&&e.pop(),se.setItem(re.RECENT_WALLETS,JSON.stringify(e)))}catch{console.info("Unable to set AppKit recent")}},getRecentWallets(){try{const t=se.getItem(re.RECENT_WALLETS);return t?JSON.parse(t):[]}catch{console.info("Unable to get AppKit recent")}return[]},setConnectedConnectorId(t,e){try{const s=Bo(t);se.setItem(s,e)}catch{console.info("Unable to set Connected Connector Id")}},getActiveNamespace(){try{return se.getItem(re.ACTIVE_NAMESPACE)}catch{console.info("Unable to get active namespace")}},getConnectedConnectorId(t){if(t)try{const e=Bo(t);return se.getItem(e)}catch{console.info("Unable to get connected connector id in namespace ",t)}},setConnectedSocialProvider(t){try{se.setItem(re.CONNECTED_SOCIAL,t)}catch{console.info("Unable to set connected social provider")}},getConnectedSocialProvider(){try{return se.getItem(re.CONNECTED_SOCIAL)}catch{console.info("Unable to get connected social provider")}},deleteConnectedSocialProvider(){try{se.removeItem(re.CONNECTED_SOCIAL)}catch{console.info("Unable to delete connected social provider")}},getConnectedSocialUsername(){try{return se.getItem(re.CONNECTED_SOCIAL_USERNAME)}catch{console.info("Unable to get connected social username")}},getStoredActiveCaipNetworkId(){return se.getItem(re.ACTIVE_CAIP_NETWORK_ID)?.split(":")?.[1]},setConnectionStatus(t){try{se.setItem(re.CONNECTION_STATUS,t)}catch{console.info("Unable to set connection status")}},getConnectionStatus(){try{return se.getItem(re.CONNECTION_STATUS)}catch{return}},getConnectedNamespaces(){try{const t=se.getItem(re.CONNECTED_NAMESPACES);return t?.length?t.split(","):[]}catch{return[]}},setConnectedNamespaces(t){try{const e=Array.from(new Set(t));se.setItem(re.CONNECTED_NAMESPACES,e.join(","))}catch{console.info("Unable to set namespaces in storage")}},addConnectedNamespace(t){try{const e=H.getConnectedNamespaces();e.includes(t)||(e.push(t),H.setConnectedNamespaces(e))}catch{console.info("Unable to add connected namespace")}},removeConnectedNamespace(t){try{const e=H.getConnectedNamespaces(),s=e.indexOf(t);s>-1&&(e.splice(s,1),H.setConnectedNamespaces(e))}catch{console.info("Unable to remove connected namespace")}},getTelegramSocialProvider(){try{return se.getItem(re.TELEGRAM_SOCIAL_PROVIDER)}catch{return console.info("Unable to get telegram social provider"),null}},setTelegramSocialProvider(t){try{se.setItem(re.TELEGRAM_SOCIAL_PROVIDER,t)}catch{console.info("Unable to set telegram social provider")}},removeTelegramSocialProvider(){try{se.removeItem(re.TELEGRAM_SOCIAL_PROVIDER)}catch{console.info("Unable to remove telegram social provider")}},getBalanceCache(){let t={};try{const e=se.getItem(re.PORTFOLIO_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromBalanceCache(t){try{const e=H.getBalanceCache();se.setItem(re.PORTFOLIO_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getBalanceCacheForCaipAddress(t){try{const s=H.getBalanceCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.portfolio))return s.balance;H.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateBalanceCache(t){try{const e=H.getBalanceCache();e[t.caipAddress]=t,se.setItem(re.PORTFOLIO_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getNativeBalanceCache(){let t={};try{const e=se.getItem(re.NATIVE_BALANCE_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromNativeBalanceCache(t){try{const e=H.getBalanceCache();se.setItem(re.NATIVE_BALANCE_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getNativeBalanceCacheForCaipAddress(t){try{const s=H.getNativeBalanceCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.nativeBalance))return s;console.info("Discarding cache for address",t),H.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateNativeBalanceCache(t){try{const e=H.getNativeBalanceCache();e[t.caipAddress]=t,se.setItem(re.NATIVE_BALANCE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getEnsCache(){let t={};try{const e=se.getItem(re.ENS_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get ens name cache")}return t},getEnsFromCacheForAddress(t){try{const s=H.getEnsCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.ens))return s.ens;H.removeEnsFromCache(t)}catch{console.info("Unable to get ens name from cache",t)}},updateEnsCache(t){try{const e=H.getEnsCache();e[t.address]=t,se.setItem(re.ENS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ens name cache",t)}},removeEnsFromCache(t){try{const e=H.getEnsCache();se.setItem(re.ENS_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove ens name from cache",t)}},getIdentityCache(){let t={};try{const e=se.getItem(re.IDENTITY_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get identity cache")}return t},getIdentityFromCacheForAddress(t){try{const s=H.getIdentityCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.identity))return s.identity;H.removeIdentityFromCache(t)}catch{console.info("Unable to get identity from cache",t)}},updateIdentityCache(t){try{const e=H.getIdentityCache();e[t.address]={identity:t.identity,timestamp:t.timestamp},se.setItem(re.IDENTITY_CACHE,JSON.stringify(e))}catch{console.info("Unable to update identity cache",t)}},removeIdentityFromCache(t){try{const e=H.getIdentityCache();se.setItem(re.IDENTITY_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove identity from cache",t)}},clearAddressCache(){try{se.removeItem(re.PORTFOLIO_CACHE),se.removeItem(re.NATIVE_BALANCE_CACHE),se.removeItem(re.ENS_CACHE),se.removeItem(re.IDENTITY_CACHE)}catch{console.info("Unable to clear address cache")}},setPreferredAccountTypes(t){try{se.setItem(re.PREFERRED_ACCOUNT_TYPES,JSON.stringify(t))}catch{console.info("Unable to set preferred account types",t)}},getPreferredAccountTypes(){try{const t=se.getItem(re.PREFERRED_ACCOUNT_TYPES);return t?JSON.parse(t):{}}catch{console.info("Unable to get preferred account types")}return{}},setConnections(t,e){try{const s={...H.getConnections(),[e]:t};se.setItem(re.CONNECTIONS,JSON.stringify(s))}catch(s){console.error("Unable to sync connections to storage",s)}},getConnections(){try{const t=se.getItem(re.CONNECTIONS);return t?JSON.parse(t):{}}catch(t){return console.error("Unable to get connections from storage",t),{}}}},te={isMobile(){return this.isClient()?!!(typeof window?.matchMedia=="function"&&window?.matchMedia("(pointer:coarse)")?.matches||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},checkCaipNetwork(t,e=""){return t?.caipNetworkId.toLocaleLowerCase().includes(e.toLowerCase())},isAndroid(){if(!this.isMobile())return!1;const t=window?.navigator.userAgent.toLowerCase();return te.isMobile()&&t.includes("android")},isIos(){if(!this.isMobile())return!1;const t=window?.navigator.userAgent.toLowerCase();return t.includes("iphone")||t.includes("ipad")},isSafari(){return this.isClient()?(window?.navigator.userAgent.toLowerCase()).includes("safari"):!1},isClient(){return typeof window<"u"},isPairingExpired(t){return t?t-Date.now()<=Se.TEN_SEC_MS:!0},isAllowedRetry(t,e=Se.ONE_SEC_MS){return Date.now()-t>=e},copyToClopboard(t){navigator.clipboard.writeText(t)},isIframe(){try{return window?.self!==window?.top}catch{return!1}},isSafeApp(){if(te.isClient()&&window.self!==window.top)try{const t=window?.location?.ancestorOrigins?.[0],e="https://app.safe.global";if(t){const s=new URL(t),r=new URL(e);return s.hostname===r.hostname}}catch{return!1}return!1},getPairingExpiry(){return Date.now()+Se.FOUR_MINUTES_MS},getNetworkId(t){return t?.split(":")[1]},getPlainAddress(t){return t?.split(":")[2]},async wait(t){return new Promise(e=>{setTimeout(e,t)})},debounce(t,e=500){let s;return(...r)=>{function i(){t(...r)}s&&clearTimeout(s),s=setTimeout(i,e)}},isHttpUrl(t){return t.startsWith("http://")||t.startsWith("https://")},formatNativeUrl(t,e,s=null){if(te.isHttpUrl(t))return this.formatUniversalUrl(t,e);let r=t,i=s;r.includes("://")||(r=t.replaceAll("/","").replaceAll(":",""),r=`${r}://`),r.endsWith("/")||(r=`${r}/`),i&&!i?.endsWith("/")&&(i=`${i}/`),this.isTelegram()&&this.isAndroid()&&(e=encodeURIComponent(e));const n=encodeURIComponent(e);return{redirect:`${r}wc?uri=${n}`,redirectUniversalLink:i?`${i}wc?uri=${n}`:void 0,href:r}},formatUniversalUrl(t,e){if(!te.isHttpUrl(t))return this.formatNativeUrl(t,e);let s=t;s.endsWith("/")||(s=`${s}/`);const r=encodeURIComponent(e);return{redirect:`${s}wc?uri=${r}`,href:s}},getOpenTargetForPlatform(t){return t==="popupWindow"?t:this.isTelegram()?H.getTelegramSocialProvider()?"_top":"_blank":t},openHref(t,e,s){window?.open(t,this.getOpenTargetForPlatform(e),s||"noreferrer noopener")},returnOpenHref(t,e,s){return window?.open(t,this.getOpenTargetForPlatform(e),s||"noreferrer noopener")},isTelegram(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)},isPWA(){if(typeof window>"u")return!1;const t=window.matchMedia?.("(display-mode: standalone)")?.matches,e=window?.navigator?.standalone;return!!(t||e)},async preloadImage(t){const e=new Promise((s,r)=>{const i=new Image;i.onload=s,i.onerror=r,i.crossOrigin="anonymous",i.src=t});return Promise.race([e,te.wait(2e3)])},formatBalance(t,e){let s="0.000";if(typeof t=="string"){const r=Number(t);if(r){const i=Math.floor(r*1e3)/1e3;i&&(s=i.toString())}}return`${s}${e?` ${e}`:""}`},formatBalance2(t,e){let s;if(t==="0")s="0";else if(typeof t=="string"){const r=Number(t);r&&(s=r.toString().match(/^-?\d+(?:\.\d{0,3})?/u)?.[0])}return{value:s??"0",rest:s==="0"?"000":"",symbol:e}},getApiUrl(){return K.W3M_API_URL},getBlockchainApiUrl(){return K.BLOCKCHAIN_API_RPC_URL},getAnalyticsUrl(){return K.PULSE_API_URL},getUUID(){return crypto?.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})},parseError(t){return typeof t=="string"?t:typeof t?.issues?.[0]?.message=="string"?t.issues[0].message:t instanceof Error?t.message:"Unknown error"},sortRequestedNetworks(t,e=[]){const s={};return e&&t&&(t.forEach((r,i)=>{s[r]=i}),e.sort((r,i)=>{const n=s[r.id],o=s[i.id];return n!==void 0&&o!==void 0?n-o:n!==void 0?-1:o!==void 0?1:0})),e},calculateBalance(t){let e=0;for(const s of t)e+=s.value??0;return e},formatTokenBalance(t){const e=t.toFixed(2),[s,r]=e.split(".");return{dollars:s,pennies:r}},isAddress(t,e="eip155"){switch(e){case"eip155":if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)){if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)||/^(?:0x)?[0-9A-F]{40}$/iu.test(t))return!0}else return!1;return!1;case"solana":return/[1-9A-HJ-NP-Za-km-z]{32,44}$/iu.test(t);default:return!1}},uniqueBy(t,e){const s=new Set;return t.filter(r=>{const i=r[e];return s.has(i)?!1:(s.add(i),!0)})},generateSdkVersion(t,e,s){const i=t.length===0?Se.ADAPTER_TYPES.UNIVERSAL:t.map(n=>n.adapterType).join(",");return`${e}-${i}-${s}`},createAccount(t,e,s,r,i){return{namespace:t,address:e,type:s,publicKey:r,path:i}},isCaipAddress(t){if(typeof t!="string")return!1;const e=t.split(":"),s=e[0];return e.filter(Boolean).length===3&&s in K.CHAIN_NAME_MAP},isMac(){const t=window?.navigator.userAgent.toLowerCase();return t.includes("macintosh")&&!t.includes("safari")},formatTelegramSocialLoginUrl(t){const e=`--${encodeURIComponent(window?.location.href)}`,s="state=";if(new URL(t).host==="auth.magic.link"){const i="provider_authorization_url=",n=t.substring(t.indexOf(i)+i.length),o=this.injectIntoUrl(decodeURIComponent(n),s,e);return t.replace(n,encodeURIComponent(o))}return this.injectIntoUrl(t,s,e)},injectIntoUrl(t,e,s){const r=t.indexOf(e);if(r===-1)throw new Error(`${e} parameter not found in the URL: ${t}`);const i=t.indexOf("&",r),n=e.length,o=i!==-1?i:t.length,a=t.substring(0,r+n),c=t.substring(r+n,o),l=t.substring(i),u=c+s;return a+u+l}};async function Oi(...t){const e=await fetch(...t);if(!e.ok)throw new Error(`HTTP status code: ${e.status}`,{cause:e});return e}class bn{constructor({baseUrl:e,clientId:s}){this.baseUrl=e,this.clientId=s}async get({headers:e,signal:s,cache:r,...i}){const n=this.createUrl(i);return(await Oi(n,{method:"GET",headers:e,signal:s,cache:r})).json()}async getBlob({headers:e,signal:s,...r}){const i=this.createUrl(r);return(await Oi(i,{method:"GET",headers:e,signal:s})).blob()}async post({body:e,headers:s,signal:r,...i}){const n=this.createUrl(i);return(await Oi(n,{method:"POST",headers:s,body:e?JSON.stringify(e):void 0,signal:r})).json()}async put({body:e,headers:s,signal:r,...i}){const n=this.createUrl(i);return(await Oi(n,{method:"PUT",headers:s,body:e?JSON.stringify(e):void 0,signal:r})).json()}async delete({body:e,headers:s,signal:r,...i}){const n=this.createUrl(i);return(await Oi(n,{method:"DELETE",headers:s,body:e?JSON.stringify(e):void 0,signal:r})).json()}createUrl({path:e,params:s}){const r=new URL(e,this.baseUrl);return s&&Object.entries(s).forEach(([i,n])=>{n&&r.searchParams.append(i,n)}),this.clientId&&r.searchParams.append("clientId",this.clientId),r}}const Ff={getFeatureValue(t,e){const s=e?.[t];return s===void 0?Se.DEFAULT_FEATURES[t]:s},filterSocialsByPlatform(t){if(!t||!t.length)return t;if(te.isTelegram()){if(te.isIos())return t.filter(e=>e!=="google");if(te.isMac())return t.filter(e=>e!=="x");if(te.isAndroid())return t.filter(e=>!["facebook","x"].includes(e))}return t}},Y=ke({features:Se.DEFAULT_FEATURES,projectId:"",sdkType:"appkit",sdkVersion:"html-wagmi-undefined",defaultAccountTypes:Se.DEFAULT_ACCOUNT_TYPES,enableNetworkSwitch:!0,experimental_preferUniversalLinks:!1,remoteFeatures:{}}),B={state:Y,subscribeKey(t,e){return at(Y,t,e)},setOptions(t){Object.assign(Y,t)},setRemoteFeatures(t){if(!t)return;const e={...Y.remoteFeatures,...t};Y.remoteFeatures=e,Y.remoteFeatures?.socials&&(Y.remoteFeatures.socials=Ff.filterSocialsByPlatform(Y.remoteFeatures.socials))},setFeatures(t){if(!t)return;Y.features||(Y.features=Se.DEFAULT_FEATURES);const e={...Y.features,...t};Y.features=e},setProjectId(t){Y.projectId=t},setCustomRpcUrls(t){Y.customRpcUrls=t},setAllWallets(t){Y.allWallets=t},setIncludeWalletIds(t){Y.includeWalletIds=t},setExcludeWalletIds(t){Y.excludeWalletIds=t},setFeaturedWalletIds(t){Y.featuredWalletIds=t},setTokens(t){Y.tokens=t},setTermsConditionsUrl(t){Y.termsConditionsUrl=t},setPrivacyPolicyUrl(t){Y.privacyPolicyUrl=t},setCustomWallets(t){Y.customWallets=t},setIsSiweEnabled(t){Y.isSiweEnabled=t},setIsUniversalProvider(t){Y.isUniversalProvider=t},setSdkVersion(t){Y.sdkVersion=t},setMetadata(t){Y.metadata=t},setDisableAppend(t){Y.disableAppend=t},setEIP6963Enabled(t){Y.enableEIP6963=t},setDebug(t){Y.debug=t},setEnableWalletConnect(t){Y.enableWalletConnect=t},setEnableWalletGuide(t){Y.enableWalletGuide=t},setEnableAuthLogger(t){Y.enableAuthLogger=t},setEnableWallets(t){Y.enableWallets=t},setPreferUniversalLinks(t){Y.experimental_preferUniversalLinks=t},setHasMultipleAddresses(t){Y.hasMultipleAddresses=t},setSIWX(t){Y.siwx=t},setConnectMethodsOrder(t){Y.features={...Y.features,connectMethodsOrder:t}},setWalletFeaturesOrder(t){Y.features={...Y.features,walletFeaturesOrder:t}},setSocialsOrder(t){Y.remoteFeatures={...Y.remoteFeatures,socials:t}},setCollapseWallets(t){Y.features={...Y.features,collapseWallets:t}},setEnableEmbedded(t){Y.enableEmbedded=t},setAllowUnsupportedChain(t){Y.allowUnsupportedChain=t},setManualWCControl(t){Y.manualWCControl=t},setEnableNetworkSwitch(t){Y.enableNetworkSwitch=t},setDefaultAccountTypes(t={}){Object.entries(t).forEach(([e,s])=>{s&&(Y.defaultAccountTypes[e]=s)})},setUniversalProviderConfigOverride(t){Y.universalProviderConfigOverride=t},getUniversalProviderConfigOverride(){return Y.universalProviderConfigOverride},getSnapshot(){return nn(Y)}},zf=Object.freeze({enabled:!0,events:[]}),Wf=new bn({baseUrl:te.getAnalyticsUrl(),clientId:null}),Hf=5,Vf=60*1e3,_s=ke({...zf}),Kf={state:_s,subscribeKey(t,e){return at(_s,t,e)},async sendError(t,e){if(!_s.enabled)return;const s=Date.now();if(_s.events.filter(n=>{const o=new Date(n.properties.timestamp||"").getTime();return s-o<Vf}).length>=Hf)return;const i={type:"error",event:e,properties:{errorType:t.name,errorMessage:t.message,stackTrace:t.stack,timestamp:new Date().toISOString()}};_s.events.push(i);try{if(typeof window>"u")return;const{projectId:n,sdkType:o,sdkVersion:a}=B.state;await Wf.post({path:"/e",params:{projectId:n,st:o,sv:a||"html-wagmi-4.2.2"},body:{eventId:te.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:new Date().toISOString(),props:{type:"error",event:e,errorType:t.name,errorMessage:t.message,stackTrace:t.stack}}})}catch{}},enable(){_s.enabled=!0},disable(){_s.enabled=!1},clearEvents(){_s.events=[]}};class ri extends Error{constructor(e,s,r){super(e),this.name="AppKitError",this.category=s,this.originalError=r,Object.setPrototypeOf(this,ri.prototype);let i=!1;if(r instanceof Error&&typeof r.stack=="string"&&r.stack){const n=r.stack,o=n.indexOf(`
`);if(o>-1){const a=n.substring(o+1);this.stack=`${this.name}: ${this.message}
${a}`,i=!0}}i||(Error.captureStackTrace?Error.captureStackTrace(this,ri):this.stack||(this.stack=`${this.name}: ${this.message}`))}}function il(t,e){const s=t instanceof ri?t:new ri(t instanceof Error?t.message:String(t),e,t);throw Kf.sendError(s,s.category),s}function Rt(t,e="INTERNAL_SDK_ERROR"){const s={};return Object.keys(t).forEach(r=>{const i=t[r];if(typeof i=="function"){let n=i;i.constructor.name==="AsyncFunction"?n=async(...o)=>{try{return await i(...o)}catch(a){return il(a,e)}}:n=(...o)=>{try{return i(...o)}catch(a){return il(a,e)}},s[r]=n}else s[r]=i}),s}const os={PHANTOM:{id:"a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393",url:"https://phantom.app"},SOLFLARE:{id:"1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79",url:"https://solflare.com"},COINBASE:{id:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",url:"https://go.cb-w.com"}},Gf={handleMobileDeeplinkRedirect(t,e){const s=window.location.href,r=encodeURIComponent(s);if(t===os.PHANTOM.id&&!("phantom"in window)){const i=s.startsWith("https")?"https":"http",n=s.split("/")[2],o=encodeURIComponent(`${i}://${n}`);window.location.href=`${os.PHANTOM.url}/ul/browse/${r}?ref=${o}`}t===os.SOLFLARE.id&&!("solflare"in window)&&(window.location.href=`${os.SOLFLARE.url}/ul/v1/browse/${r}?ref=${r}`),e===K.CHAIN.SOLANA&&t===os.COINBASE.id&&!("coinbaseSolana"in window)&&(window.location.href=`${os.COINBASE.url}/dapp?cb_url=${r}`)}},It=ke({walletImages:{},networkImages:{},chainImages:{},connectorImages:{},tokenImages:{},currencyImages:{}}),Jf={state:It,subscribeNetworkImages(t){return ot(It.networkImages,()=>t(It.networkImages))},subscribeKey(t,e){return at(It,t,e)},subscribe(t){return ot(It,()=>t(It))},setWalletImage(t,e){It.walletImages[t]=e},setNetworkImage(t,e){It.networkImages[t]=e},setChainImage(t,e){It.chainImages[t]=e},setConnectorImage(t,e){It.connectorImages={...It.connectorImages,[t]:e}},setTokenImage(t,e){It.tokenImages[t]=e},setCurrencyImage(t,e){It.currencyImages[t]=e}},Yt=Rt(Jf),Yf={eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"a1b58899-f671-4276-6a5e-56ca5bd59700",polkadot:"",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00",cosmos:""},jo=ke({networkImagePromises:{}}),Wh={async fetchWalletImage(t){if(t)return await J._fetchWalletImage(t),this.getWalletImageById(t)},async fetchNetworkImage(t){if(!t)return;const e=this.getNetworkImageById(t);return e||(jo.networkImagePromises[t]||(jo.networkImagePromises[t]=J._fetchNetworkImage(t)),await jo.networkImagePromises[t],this.getNetworkImageById(t))},getWalletImageById(t){if(t)return Yt.state.walletImages[t]},getWalletImage(t){if(t?.image_url)return t?.image_url;if(t?.image_id)return Yt.state.walletImages[t.image_id]},getNetworkImage(t){if(t?.assets?.imageUrl)return t?.assets?.imageUrl;if(t?.assets?.imageId)return Yt.state.networkImages[t.assets.imageId]},getNetworkImageById(t){if(t)return Yt.state.networkImages[t]},getConnectorImage(t){if(t?.imageUrl)return t.imageUrl;if(t?.imageId)return Yt.state.connectorImages[t.imageId]},getChainImage(t){return Yt.state.networkImages[Yf[t]]}},Ss=ke({message:"",variant:"info",open:!1}),Zf={state:Ss,subscribeKey(t,e){return at(Ss,t,e)},open(t,e){const{debug:s}=B.state,{shortMessage:r,longMessage:i}=t;s&&(Ss.message=r,Ss.variant=e,Ss.open=!0),i&&console.error(typeof i=="function"?i():i)},close(){Ss.open=!1,Ss.message="",Ss.variant="info"}},Ys=Rt(Zf),Xf=te.getAnalyticsUrl(),Qf=new bn({baseUrl:Xf,clientId:null}),eg=["MODAL_CREATED"],hs=ke({timestamp:Date.now(),reportedErrors:{},data:{type:"track",event:"MODAL_CREATED"}}),Ue={state:hs,subscribe(t){return ot(hs,()=>t(hs))},getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:s}=B.state;return{projectId:t,st:e,sv:s||"html-wagmi-4.2.2"}},async _sendAnalyticsEvent(t){try{const e=V.state.address;if(eg.includes(t.data.event)||typeof window>"u")return;await Qf.post({path:"/e",params:Ue.getSdkProperties(),body:{eventId:te.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:t.timestamp,props:{...t.data,address:e}}}),hs.reportedErrors.FORBIDDEN=!1}catch(e){e instanceof Error&&e.cause instanceof Response&&e.cause.status===K.HTTP_STATUS_CODES.FORBIDDEN&&!hs.reportedErrors.FORBIDDEN&&(Ys.open({shortMessage:"Invalid App Configuration",longMessage:`Origin ${ji()?window.origin:"uknown"} not found on Allowlist - update configuration on cloud.reown.com`},"error"),hs.reportedErrors.FORBIDDEN=!0)}},sendEvent(t){hs.timestamp=Date.now(),hs.data=t,B.state.features?.analytics&&Ue._sendAnalyticsEvent(hs)}},tg=te.getApiUrl(),dt=new bn({baseUrl:tg,clientId:null}),sg=40,nl=4,rg=20,ie=ke({promises:{},page:1,count:0,featured:[],allFeatured:[],recommended:[],allRecommended:[],wallets:[],filteredWallets:[],search:[],isAnalyticsEnabled:!1,excludedWallets:[],isFetchingRecommendedWallets:!1}),J={state:ie,subscribeKey(t,e){return at(ie,t,e)},_getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:s}=B.state;return{projectId:t,st:e||"appkit",sv:s||"html-wagmi-4.2.2"}},_filterOutExtensions(t){return B.state.isUniversalProvider?t.filter(e=>!!(e.mobile_link||e.desktop_link||e.webapp_link)):t},async _fetchWalletImage(t){const e=`${dt.baseUrl}/getWalletImage/${t}`,s=await dt.getBlob({path:e,params:J._getSdkProperties()});Yt.setWalletImage(t,URL.createObjectURL(s))},async _fetchNetworkImage(t){const e=`${dt.baseUrl}/public/getAssetImage/${t}`,s=await dt.getBlob({path:e,params:J._getSdkProperties()});Yt.setNetworkImage(t,URL.createObjectURL(s))},async _fetchConnectorImage(t){const e=`${dt.baseUrl}/public/getAssetImage/${t}`,s=await dt.getBlob({path:e,params:J._getSdkProperties()});Yt.setConnectorImage(t,URL.createObjectURL(s))},async _fetchCurrencyImage(t){const e=`${dt.baseUrl}/public/getCurrencyImage/${t}`,s=await dt.getBlob({path:e,params:J._getSdkProperties()});Yt.setCurrencyImage(t,URL.createObjectURL(s))},async _fetchTokenImage(t){const e=`${dt.baseUrl}/public/getTokenImage/${t}`,s=await dt.getBlob({path:e,params:J._getSdkProperties()});Yt.setTokenImage(t,URL.createObjectURL(s))},_filterWalletsByPlatform(t){return te.isMobile()?t?.filter(s=>s.mobile_link||s.id===os.COINBASE.id?!0:b.state.activeChain==="solana"&&(s.id===os.SOLFLARE.id||s.id===os.PHANTOM.id)):t},async fetchProjectConfig(){return(await dt.get({path:"/appkit/v1/config",params:J._getSdkProperties()})).features},async fetchAllowedOrigins(){try{const{allowedOrigins:t}=await dt.get({path:"/projects/v1/origins",params:J._getSdkProperties()});return t}catch{return[]}},async fetchNetworkImages(){const e=b.getAllRequestedCaipNetworks()?.map(({assets:s})=>s?.imageId).filter(Boolean).filter(s=>!Wh.getNetworkImageById(s));e&&await Promise.allSettled(e.map(s=>J._fetchNetworkImage(s)))},async fetchConnectorImages(){const{connectors:t}=W.state,e=t.map(({imageId:s})=>s).filter(Boolean);await Promise.allSettled(e.map(s=>J._fetchConnectorImage(s)))},async fetchCurrencyImages(t=[]){await Promise.allSettled(t.map(e=>J._fetchCurrencyImage(e)))},async fetchTokenImages(t=[]){await Promise.allSettled(t.map(e=>J._fetchTokenImage(e)))},async fetchWallets(t){const e=t.exclude??[];J._getSdkProperties().sv.startsWith("html-core-")&&e.push(...Object.values(os).map(n=>n.id));const r=await dt.get({path:"/getWallets",params:{...J._getSdkProperties(),...t,page:String(t.page),entries:String(t.entries),include:t.include?.join(","),exclude:e.join(",")}});return{data:J._filterWalletsByPlatform(r?.data)||[],count:r?.count}},async fetchFeaturedWallets(){const{featuredWalletIds:t}=B.state;if(t?.length){const e={...J._getSdkProperties(),page:1,entries:t?.length??nl,include:t},{data:s}=await J.fetchWallets(e),r=[...s].sort((n,o)=>t.indexOf(n.id)-t.indexOf(o.id)),i=r.map(n=>n.image_id).filter(Boolean);await Promise.allSettled(i.map(n=>J._fetchWalletImage(n))),ie.featured=r,ie.allFeatured=r}},async fetchRecommendedWallets(){try{ie.isFetchingRecommendedWallets=!0;const{includeWalletIds:t,excludeWalletIds:e,featuredWalletIds:s}=B.state,r=[...e??[],...s??[]].filter(Boolean),i=b.getRequestedCaipNetworkIds().join(","),n={page:1,entries:nl,include:t,exclude:r,chains:i},{data:o,count:a}=await J.fetchWallets(n),c=H.getRecentWallets(),l=o.map(h=>h.image_id).filter(Boolean),u=c.map(h=>h.image_id).filter(Boolean);await Promise.allSettled([...l,...u].map(h=>J._fetchWalletImage(h))),ie.recommended=o,ie.allRecommended=o,ie.count=a??0}catch{}finally{ie.isFetchingRecommendedWallets=!1}},async fetchWalletsByPage({page:t}){const{includeWalletIds:e,excludeWalletIds:s,featuredWalletIds:r}=B.state,i=b.getRequestedCaipNetworkIds().join(","),n=[...ie.recommended.map(({id:u})=>u),...s??[],...r??[]].filter(Boolean),o={page:t,entries:sg,include:e,exclude:n,chains:i},{data:a,count:c}=await J.fetchWallets(o),l=a.slice(0,rg).map(u=>u.image_id).filter(Boolean);await Promise.allSettled(l.map(u=>J._fetchWalletImage(u))),ie.wallets=te.uniqueBy([...ie.wallets,...J._filterOutExtensions(a)],"id").filter(u=>u.chains?.some(h=>i.includes(h))),ie.count=c>ie.count?c:ie.count,ie.page=t},async initializeExcludedWallets({ids:t}){const e={page:1,entries:t.length,include:t},{data:s}=await J.fetchWallets(e);s&&s.forEach(r=>{ie.excludedWallets.push({rdns:r.rdns,name:r.name})})},async searchWallet({search:t,badge:e}){const{includeWalletIds:s,excludeWalletIds:r}=B.state,i=b.getRequestedCaipNetworkIds().join(",");ie.search=[];const n={page:1,entries:100,search:t?.trim(),badge_type:e,include:s,exclude:r,chains:i},{data:o}=await J.fetchWallets(n);Ue.sendEvent({type:"track",event:"SEARCH_WALLET",properties:{badge:e??"",search:t??""}});const a=o.map(c=>c.image_id).filter(Boolean);await Promise.allSettled([...a.map(c=>J._fetchWalletImage(c)),te.wait(300)]),ie.search=J._filterOutExtensions(o)},initPromise(t,e){const s=ie.promises[t];return s||(ie.promises[t]=e())},prefetch({fetchConnectorImages:t=!0,fetchFeaturedWallets:e=!0,fetchRecommendedWallets:s=!0,fetchNetworkImages:r=!0}={}){const i=[t&&J.initPromise("connectorImages",J.fetchConnectorImages),e&&J.initPromise("featuredWallets",J.fetchFeaturedWallets),s&&J.initPromise("recommendedWallets",J.fetchRecommendedWallets),r&&J.initPromise("networkImages",J.fetchNetworkImages)].filter(Boolean);return Promise.allSettled(i)},prefetchAnalyticsConfig(){B.state.features?.analytics&&J.fetchAnalyticsConfig()},async fetchAnalyticsConfig(){try{const{isAnalyticsEnabled:t}=await dt.get({path:"/getAnalyticsConfig",params:J._getSdkProperties()});B.setFeatures({analytics:t})}catch{B.setFeatures({analytics:!1})}},filterByNamespaces(t){if(!t?.length){ie.featured=ie.allFeatured,ie.recommended=ie.allRecommended;return}const e=b.getRequestedCaipNetworkIds().join(",");ie.featured=ie.allFeatured.filter(s=>s.chains?.some(r=>e.includes(r))),ie.recommended=ie.allRecommended.filter(s=>s.chains?.some(r=>e.includes(r))),ie.filteredWallets=ie.wallets.filter(s=>s.chains?.some(r=>e.includes(r)))},clearFilterByNamespaces(){ie.filteredWallets=[]},setFilterByNamespace(t){if(!t){ie.featured=ie.allFeatured,ie.recommended=ie.allRecommended;return}const e=b.getRequestedCaipNetworkIds().join(",");ie.featured=ie.allFeatured.filter(s=>s.chains?.some(r=>e.includes(r))),ie.recommended=ie.allRecommended.filter(s=>s.chains?.some(r=>e.includes(r))),ie.filteredWallets=ie.wallets.filter(s=>s.chains?.some(r=>e.includes(r)))}},Ce=ke({view:"Connect",history:["Connect"],transactionStack:[]}),ig={state:Ce,subscribeKey(t,e){return at(Ce,t,e)},pushTransactionStack(t){Ce.transactionStack.push(t)},popTransactionStack(t){const e=Ce.transactionStack.pop();if(!e)return;const{onSuccess:s,onError:r,onCancel:i}=e;switch(t){case"success":s?.();break;case"error":r?.(),ne.goBack();break;case"cancel":i?.(),ne.goBack();break}},push(t,e){t!==Ce.view&&(Ce.view=t,Ce.history.push(t),Ce.data=e)},reset(t,e){Ce.view=t,Ce.history=[t],Ce.data=e},replace(t,e){Ce.history.at(-1)===t||(Ce.view=t,Ce.history[Ce.history.length-1]=t,Ce.data=e)},goBack(){const t=b.state.activeCaipAddress,e=ne.state.view==="ConnectingFarcaster",s=!t&&e;if(Ce.history.length>1){Ce.history.pop();const[r]=Ce.history.slice(-1);r&&(t&&r==="Connect"?Ce.view="Account":Ce.view=r)}else Je.close();Ce.data?.wallet&&(Ce.data.wallet=void 0),setTimeout(()=>{if(s){V.setFarcasterUrl(void 0,b.state.activeChain);const r=W.getAuthConnector();r?.provider?.reload();const i=nn(B.state);r?.provider?.syncDappData?.({metadata:i.metadata,sdkVersion:i.sdkVersion,projectId:i.projectId,sdkType:i.sdkType})}},100)},goBackToIndex(t){if(Ce.history.length>1){Ce.history=Ce.history.slice(0,t+1);const[e]=Ce.history.slice(-1);e&&(Ce.view=e)}},goBackOrCloseModal(){ne.state.history.length>1?ne.goBack():Je.close()}},ne=Rt(ig),ds=ke({themeMode:"dark",themeVariables:{},w3mThemeVariables:void 0}),ka={state:ds,subscribe(t){return ot(ds,()=>t(ds))},setThemeMode(t){ds.themeMode=t;try{const e=W.getAuthConnector();if(e){const s=ka.getSnapshot().themeVariables;e.provider.syncTheme({themeMode:t,themeVariables:s,w3mThemeVariables:Us(s,t)})}}catch{console.info("Unable to sync theme to auth connector")}},setThemeVariables(t){ds.themeVariables={...ds.themeVariables,...t};try{const e=W.getAuthConnector();if(e){const s=ka.getSnapshot().themeVariables;e.provider.syncTheme({themeVariables:s,w3mThemeVariables:Us(ds.themeVariables,ds.themeMode)})}}catch{console.info("Unable to sync theme to auth connector")}},getSnapshot(){return nn(ds)}},_t=Rt(ka),Hh={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0},pe=ke({allConnectors:[],connectors:[],activeConnector:void 0,filterByNamespace:void 0,activeConnectorIds:{...Hh},filterByNamespaceMap:{eip155:!0,solana:!0,polkadot:!0,bip122:!0,cosmos:!0}}),ng={state:pe,subscribe(t){return ot(pe,()=>{t(pe)})},subscribeKey(t,e){return at(pe,t,e)},initialize(t){t.forEach(e=>{const s=H.getConnectedConnectorId(e);s&&W.setConnectorId(s,e)})},setActiveConnector(t){t&&(pe.activeConnector=cr(t))},setConnectors(t){t.filter(i=>!pe.allConnectors.some(n=>n.id===i.id&&W.getConnectorName(n.name)===W.getConnectorName(i.name)&&n.chain===i.chain)).forEach(i=>{i.type!=="MULTI_CHAIN"&&pe.allConnectors.push(cr(i))});const s=W.getEnabledNamespaces(),r=W.getEnabledConnectors(s);pe.connectors=W.mergeMultiChainConnectors(r)},filterByNamespaces(t){Object.keys(pe.filterByNamespaceMap).forEach(e=>{pe.filterByNamespaceMap[e]=!1}),t.forEach(e=>{pe.filterByNamespaceMap[e]=!0}),W.updateConnectorsForEnabledNamespaces()},filterByNamespace(t,e){pe.filterByNamespaceMap[t]=e,W.updateConnectorsForEnabledNamespaces()},updateConnectorsForEnabledNamespaces(){const t=W.getEnabledNamespaces(),e=W.getEnabledConnectors(t),s=W.areAllNamespacesEnabled();pe.connectors=W.mergeMultiChainConnectors(e),s?J.clearFilterByNamespaces():J.filterByNamespaces(t)},getEnabledNamespaces(){return Object.entries(pe.filterByNamespaceMap).filter(([t,e])=>e).map(([t])=>t)},getEnabledConnectors(t){return pe.allConnectors.filter(e=>t.includes(e.chain))},areAllNamespacesEnabled(){return Object.values(pe.filterByNamespaceMap).every(t=>t)},mergeMultiChainConnectors(t){const e=W.generateConnectorMapByName(t),s=[];return e.forEach(r=>{const i=r[0],n=i?.id===K.CONNECTOR_ID.AUTH;r.length>1&&i?s.push({name:i.name,imageUrl:i.imageUrl,imageId:i.imageId,connectors:[...r],type:n?"AUTH":"MULTI_CHAIN",chain:"eip155",id:i?.id||""}):i&&s.push(i)}),s},generateConnectorMapByName(t){const e=new Map;return t.forEach(s=>{const{name:r}=s,i=W.getConnectorName(r);if(!i)return;const n=e.get(i)||[];n.find(a=>a.chain===s.chain)||n.push(s),e.set(i,n)}),e},getConnectorName(t){return t&&({"Trust Wallet":"Trust"}[t]||t)},getUniqueConnectorsByName(t){const e=[];return t.forEach(s=>{e.find(r=>r.chain===s.chain)||e.push(s)}),e},addConnector(t){if(t.id===K.CONNECTOR_ID.AUTH){const e=t,s=nn(B.state),r=_t.getSnapshot().themeMode,i=_t.getSnapshot().themeVariables;e?.provider?.syncDappData?.({metadata:s.metadata,sdkVersion:s.sdkVersion,projectId:s.projectId,sdkType:s.sdkType}),e?.provider?.syncTheme({themeMode:r,themeVariables:i,w3mThemeVariables:Us(i,r)}),W.setConnectors([t])}else W.setConnectors([t])},getAuthConnector(t){const e=t||b.state.activeChain,s=pe.connectors.find(r=>r.id===K.CONNECTOR_ID.AUTH);if(s)return s?.connectors?.length?s.connectors.find(i=>i.chain===e):s},getAnnouncedConnectorRdns(){return pe.connectors.filter(t=>t.type==="ANNOUNCED").map(t=>t.info?.rdns)},getConnectorById(t){return pe.allConnectors.find(e=>e.id===t)},getConnector(t,e){return pe.allConnectors.filter(r=>r.chain===b.state.activeChain).find(r=>r.explorerId===t||r.info?.rdns===e)},syncIfAuthConnector(t){if(t.id!=="ID_AUTH")return;const e=t,s=nn(B.state),r=_t.getSnapshot().themeMode,i=_t.getSnapshot().themeVariables;e?.provider?.syncDappData?.({metadata:s.metadata,sdkVersion:s.sdkVersion,sdkType:s.sdkType,projectId:s.projectId}),e.provider.syncTheme({themeMode:r,themeVariables:i,w3mThemeVariables:Us(i,r)})},getConnectorsByNamespace(t){const e=pe.allConnectors.filter(s=>s.chain===t);return W.mergeMultiChainConnectors(e)},selectWalletConnector(t){const e=W.getConnector(t.id,t.rdns),s=b.state.activeChain;Gf.handleMobileDeeplinkRedirect(e?.explorerId||t.id,s),e?ne.push("ConnectingExternal",{connector:e}):ne.push("ConnectingWalletConnect",{wallet:t})},getConnectors(t){return t?W.getConnectorsByNamespace(t):W.mergeMultiChainConnectors(pe.allConnectors)},setFilterByNamespace(t){pe.filterByNamespace=t,pe.connectors=W.getConnectors(t),J.setFilterByNamespace(t)},setConnectorId(t,e){t&&(pe.activeConnectorIds={...pe.activeConnectorIds,[e]:t},H.setConnectedConnectorId(e,t))},removeConnectorId(t){pe.activeConnectorIds={...pe.activeConnectorIds,[t]:void 0},H.deleteConnectedConnectorId(t)},getConnectorId(t){if(t)return pe.activeConnectorIds[t]},isConnected(t){return t?!!pe.activeConnectorIds[t]:Object.values(pe.activeConnectorIds).some(e=>!!e)},resetConnectorIds(){pe.activeConnectorIds={...Hh}}},W=Rt(ng),Gi={ACCOUNT_TYPES:{SMART_ACCOUNT:"smartAccount"}},Js=Object.freeze({message:"",variant:"success",svg:void 0,open:!1,autoClose:!0}),Me=ke({...Js}),og={state:Me,subscribeKey(t,e){return at(Me,t,e)},showLoading(t,e={}){this._showMessage({message:t,variant:"loading",...e})},showSuccess(t){this._showMessage({message:t,variant:"success"})},showSvg(t,e){this._showMessage({message:t,svg:e})},showError(t){const e=te.parseError(t);this._showMessage({message:e,variant:"error"})},hide(){Me.message=Js.message,Me.variant=Js.variant,Me.svg=Js.svg,Me.open=Js.open,Me.autoClose=Js.autoClose},_showMessage({message:t,svg:e,variant:s="success",autoClose:r=Js.autoClose}){Me.open?(Me.open=!1,setTimeout(()=>{Me.message=t,Me.variant=s,Me.svg=e,Me.open=!0,Me.autoClose=r},150)):(Me.message=t,Me.variant=s,Me.svg=e,Me.open=!0,Me.autoClose=r)}},Zt=og,Pe=ke({transactions:[],coinbaseTransactions:{},transactionsByYear:{},lastNetworkInView:void 0,loading:!1,empty:!1,next:void 0}),ag={state:Pe,subscribe(t){return ot(Pe,()=>t(Pe))},setLastNetworkInView(t){Pe.lastNetworkInView=t},async fetchTransactions(t,e){if(!t)throw new Error("Transactions can't be fetched without an accountAddress");Pe.loading=!0;try{const s=await Q.fetchTransactions({account:t,cursor:Pe.next,onramp:e,cache:e==="coinbase"?"no-cache":void 0,chainId:b.state.activeCaipNetwork?.caipNetworkId}),r=Fi.filterSpamTransactions(s.data),i=Fi.filterByConnectedChain(r),n=[...Pe.transactions,...i];Pe.loading=!1,e==="coinbase"?Pe.coinbaseTransactions=Fi.groupTransactionsByYearAndMonth(Pe.coinbaseTransactions,s.data):(Pe.transactions=n,Pe.transactionsByYear=Fi.groupTransactionsByYearAndMonth(Pe.transactionsByYear,i)),Pe.empty=n.length===0,Pe.next=s.next?s.next:void 0}catch{const r=b.state.activeChain;Ue.sendEvent({type:"track",event:"ERROR_FETCH_TRANSACTIONS",properties:{address:t,projectId:B.state.projectId,cursor:Pe.next,isSmartAccount:V.state.preferredAccountTypes?.[r]===Gi.ACCOUNT_TYPES.SMART_ACCOUNT}}),Zt.showError("Failed to fetch transactions"),Pe.loading=!1,Pe.empty=!0,Pe.next=void 0}},groupTransactionsByYearAndMonth(t={},e=[]){const s=t;return e.forEach(r=>{const i=new Date(r.metadata.minedAt).getFullYear(),n=new Date(r.metadata.minedAt).getMonth(),o=s[i]??{},c=(o[n]??[]).filter(l=>l.id!==r.id);s[i]={...o,[n]:[...c,r].sort((l,u)=>new Date(u.metadata.minedAt).getTime()-new Date(l.metadata.minedAt).getTime())}}),s},filterSpamTransactions(t){return t.filter(e=>!e.transfers.every(r=>r.nft_info?.flags.is_spam===!0))},filterByConnectedChain(t){const e=b.state.activeCaipNetwork?.caipNetworkId;return t.filter(r=>r.metadata.chain===e)},clearCursor(){Pe.next=void 0},resetTransactions(){Pe.transactions=[],Pe.transactionsByYear={},Pe.lastNetworkInView=void 0,Pe.loading=!1,Pe.empty=!1,Pe.next=void 0}},Fi=Rt(ag,"API_ERROR"),$e=ke({connections:new Map,wcError:!1,buffering:!1,status:"disconnected"});let Hs;const cg={state:$e,subscribeKey(t,e){return at($e,t,e)},_getClient(){return $e._client},setClient(t){$e._client=cr(t)},async connectWalletConnect(){if(te.isTelegram()||te.isSafari()&&te.isIos()){if(Hs){await Hs,Hs=void 0;return}if(!te.isPairingExpired($e?.wcPairingExpiry)){const t=$e.wcUri;$e.wcUri=t;return}Hs=ee._getClient()?.connectWalletConnect?.().catch(()=>{}),ee.state.status="connecting",await Hs,Hs=void 0,$e.wcPairingExpiry=void 0,ee.state.status="connected"}else await ee._getClient()?.connectWalletConnect?.()},async connectExternal(t,e,s=!0){await ee._getClient()?.connectExternal?.(t),s&&b.setActiveNamespace(e)},async reconnectExternal(t){await ee._getClient()?.reconnectExternal?.(t);const e=t.chain||b.state.activeChain;e&&W.setConnectorId(t.id,e)},async setPreferredAccountType(t,e){Je.setLoading(!0,b.state.activeChain);const s=W.getAuthConnector();s&&(V.setPreferredAccountType(t,e),await s.provider.setPreferredAccount(t),H.setPreferredAccountTypes(V.state.preferredAccountTypes??{[e]:t}),await ee.reconnectExternal(s),Je.setLoading(!1,b.state.activeChain),Ue.sendEvent({type:"track",event:"SET_PREFERRED_ACCOUNT_TYPE",properties:{accountType:t,network:b.state.activeCaipNetwork?.caipNetworkId||""}}))},async signMessage(t){return ee._getClient()?.signMessage(t)},parseUnits(t,e){return ee._getClient()?.parseUnits(t,e)},formatUnits(t,e){return ee._getClient()?.formatUnits(t,e)},async sendTransaction(t){return ee._getClient()?.sendTransaction(t)},async getCapabilities(t){return ee._getClient()?.getCapabilities(t)},async grantPermissions(t){return ee._getClient()?.grantPermissions(t)},async walletGetAssets(t){return ee._getClient()?.walletGetAssets(t)??{}},async estimateGas(t){return ee._getClient()?.estimateGas(t)},async writeContract(t){return ee._getClient()?.writeContract(t)},async getEnsAddress(t){return ee._getClient()?.getEnsAddress(t)},async getEnsAvatar(t){return ee._getClient()?.getEnsAvatar(t)},checkInstalled(t){return ee._getClient()?.checkInstalled?.(t)||!1},resetWcConnection(){$e.wcUri=void 0,$e.wcPairingExpiry=void 0,$e.wcLinking=void 0,$e.recentWallet=void 0,$e.status="disconnected",Fi.resetTransactions(),H.deleteWalletConnectDeepLink()},resetUri(){$e.wcUri=void 0,$e.wcPairingExpiry=void 0,Hs=void 0},finalizeWcConnection(){const{wcLinking:t,recentWallet:e}=ee.state;t&&H.setWalletConnectDeepLink(t),e&&H.setAppKitRecent(e),Ue.sendEvent({type:"track",event:"CONNECT_SUCCESS",properties:{method:t?"mobile":"qrcode",name:ne.state.data?.wallet?.name||"Unknown"}})},setWcBasic(t){$e.wcBasic=t},setUri(t){$e.wcUri=t,$e.wcPairingExpiry=te.getPairingExpiry()},setWcLinking(t){$e.wcLinking=t},setWcError(t){$e.wcError=t,$e.buffering=!1},setRecentWallet(t){$e.recentWallet=t},setBuffering(t){$e.buffering=t},setStatus(t){$e.status=t},async disconnect(t){try{await ee._getClient()?.disconnect(t)}catch(e){throw new ri("Failed to disconnect","INTERNAL_SDK_ERROR",e)}},setConnections(t,e){$e.connections.set(e,t)},switchAccount({connection:t,address:e,namespace:s}){if(W.state.activeConnectorIds[s]===t.connectorId){const n=b.state.activeCaipNetwork;if(n){const o=`${s}:${n.id}:${e}`;V.setCaipAddress(o,s)}else console.warn(`No current network found for namespace "${s}"`)}else{const n=W.getConnector(t.connectorId);n?ee.connectExternal(n,s):console.warn(`No connector found for namespace "${s}"`)}}},ee=Rt(cg),Cr=ke({loading:!1,open:!1,selectedNetworkId:void 0,activeChain:void 0,initialized:!1}),Ls={state:Cr,subscribe(t){return ot(Cr,()=>t(Cr))},subscribeOpen(t){return at(Cr,"open",t)},set(t){Object.assign(Cr,{...Cr,...t})}},qo={createBalance(t,e){const s={name:t.metadata.name||"",symbol:t.metadata.symbol||"",decimals:t.metadata.decimals||0,value:t.metadata.value||0,price:t.metadata.price||0,iconUrl:t.metadata.iconUrl||""};return{name:s.name,symbol:s.symbol,chainId:e,address:t.address==="native"?void 0:this.convertAddressToCAIP10Address(t.address,e),value:s.value,price:s.price,quantity:{decimals:s.decimals.toString(),numeric:this.convertHexToBalance({hex:t.balance,decimals:s.decimals})},iconUrl:s.iconUrl}},convertHexToBalance({hex:t,decimals:e}){return cf(BigInt(t),e)},convertAddressToCAIP10Address(t,e){return`${e}:${t}`},createCAIP2ChainId(t,e){return`${e}:${parseInt(t,16)}`},getChainIdHexFromCAIP2ChainId(t){const e=t.split(":");if(e.length<2||!e[1])return"0x0";const s=e[1],r=parseInt(s,10);return isNaN(r)?"0x0":`0x${r.toString(16)}`},isWalletGetAssetsResponse(t){return typeof t!="object"||t===null?!1:Object.values(t).every(e=>Array.isArray(e)&&e.every(s=>this.isValidAsset(s)))},isValidAsset(t){return typeof t=="object"&&t!==null&&typeof t.address=="string"&&typeof t.balance=="string"&&(t.type==="ERC20"||t.type==="NATIVE")&&typeof t.metadata=="object"&&t.metadata!==null&&typeof t.metadata.name=="string"&&typeof t.metadata.symbol=="string"&&typeof t.metadata.decimals=="number"&&typeof t.metadata.price=="number"&&typeof t.metadata.iconUrl=="string"}},ol={async getMyTokensWithBalance(t){const e=V.state.address,s=b.state.activeCaipNetwork;if(!e||!s)return[];if(s.chainNamespace==="eip155"){const i=await this.getEIP155Balances(e,s);if(i)return this.filterLowQualityTokens(i)}const r=await Q.getBalance(e,s.caipNetworkId,t);return this.filterLowQualityTokens(r.balances)},async getEIP155Balances(t,e){try{const s=qo.getChainIdHexFromCAIP2ChainId(e.caipNetworkId);if(!(await ee.getCapabilities(t))?.[s]?.assetDiscovery?.supported)return null;const i=await ee.walletGetAssets({account:t,chainFilter:[s]});return qo.isWalletGetAssetsResponse(i)?(i[s]||[]).map(o=>qo.createBalance(o,e.caipNetworkId)):null}catch{return null}},filterLowQualityTokens(t){return t.filter(e=>e.quantity.decimals!=="0")},mapBalancesToSwapTokens(t){return t?.map(e=>({...e,address:e?.address?e.address:b.getActiveNetworkTokenAddress(),decimals:parseInt(e.quantity.decimals,10),logoUri:e.iconUrl,eip2612:!1}))||[]}},ve=ke({tokenBalances:[],loading:!1}),lg={state:ve,subscribe(t){return ot(ve,()=>t(ve))},subscribeKey(t,e){return at(ve,t,e)},setToken(t){t&&(ve.token=cr(t))},setTokenAmount(t){ve.sendTokenAmount=t},setReceiverAddress(t){ve.receiverAddress=t},setReceiverProfileImageUrl(t){ve.receiverProfileImageUrl=t},setReceiverProfileName(t){ve.receiverProfileName=t},setNetworkBalanceInUsd(t){ve.networkBalanceInUSD=t},setLoading(t){ve.loading=t},async sendToken(){try{switch(ye.setLoading(!0),b.state.activeCaipNetwork?.chainNamespace){case"eip155":await ye.sendEvmToken();return;case"solana":await ye.sendSolanaToken();return;default:throw new Error("Unsupported chain")}}finally{ye.setLoading(!1)}},async sendEvmToken(){const t=b.state.activeChain,e=V.state.preferredAccountTypes?.[t];if(!ye.state.sendTokenAmount||!ye.state.receiverAddress)throw new Error("An amount and receiver address are required");if(!ye.state.token)throw new Error("A token is required");ye.state.token?.address?(Ue.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===Gi.ACCOUNT_TYPES.SMART_ACCOUNT,token:ye.state.token.address,amount:ye.state.sendTokenAmount,network:b.state.activeCaipNetwork?.caipNetworkId||""}}),await ye.sendERC20Token({receiverAddress:ye.state.receiverAddress,tokenAddress:ye.state.token.address,sendTokenAmount:ye.state.sendTokenAmount,decimals:ye.state.token.quantity.decimals})):(Ue.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===Gi.ACCOUNT_TYPES.SMART_ACCOUNT,token:ye.state.token.symbol||"",amount:ye.state.sendTokenAmount,network:b.state.activeCaipNetwork?.caipNetworkId||""}}),await ye.sendNativeToken({receiverAddress:ye.state.receiverAddress,sendTokenAmount:ye.state.sendTokenAmount,decimals:ye.state.token.quantity.decimals}))},async fetchTokenBalance(t){ve.loading=!0;const e=b.state.activeCaipNetwork?.caipNetworkId,s=b.state.activeCaipNetwork?.chainNamespace,r=b.state.activeCaipAddress,i=r?te.getPlainAddress(r):void 0;if(ve.lastRetry&&!te.isAllowedRetry(ve.lastRetry,30*Se.ONE_SEC_MS))return ve.loading=!1,[];try{if(i&&e&&s){const n=await ol.getMyTokensWithBalance();return ve.tokenBalances=n,ve.lastRetry=void 0,n}}catch(n){ve.lastRetry=Date.now(),t?.(n),Zt.showError("Token Balance Unavailable")}finally{ve.loading=!1}return[]},fetchNetworkBalance(){if(ve.tokenBalances.length===0)return;const t=ol.mapBalancesToSwapTokens(ve.tokenBalances);if(!t)return;const e=t.find(s=>s.address===b.getActiveNetworkTokenAddress());e&&(ve.networkBalanceInUSD=e?$f.multiply(e.quantity.numeric,e.price).toString():"0")},async sendNativeToken(t){ne.pushTransactionStack({});const e=t.receiverAddress,s=V.state.address,r=ee.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals));await ee.sendTransaction({chainNamespace:"eip155",to:e,address:s,data:"0x",value:r??BigInt(0)}),Ue.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:V.state.preferredAccountTypes?.eip155===Gi.ACCOUNT_TYPES.SMART_ACCOUNT,token:ye.state.token?.symbol||"",amount:t.sendTokenAmount,network:b.state.activeCaipNetwork?.caipNetworkId||""}}),ee._getClient()?.updateBalance("eip155"),ye.resetSend()},async sendERC20Token(t){ne.pushTransactionStack({onSuccess(){ne.replace("Account")}});const e=ee.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals));if(V.state.address&&t.sendTokenAmount&&t.receiverAddress&&t.tokenAddress){const s=te.getPlainAddress(t.tokenAddress);await ee.writeContract({fromAddress:V.state.address,tokenAddress:s,args:[t.receiverAddress,e??BigInt(0)],method:"transfer",abi:Rf.getERC20Abi(s),chainNamespace:"eip155"}),ye.resetSend()}},async sendSolanaToken(){if(!ye.state.sendTokenAmount||!ye.state.receiverAddress)throw new Error("An amount and receiver address are required");ne.pushTransactionStack({onSuccess(){ne.replace("Account")}}),await ee.sendTransaction({chainNamespace:"solana",to:ye.state.receiverAddress,value:ye.state.sendTokenAmount}),ee._getClient()?.updateBalance("solana"),ye.resetSend()},resetSend(){ve.token=void 0,ve.sendTokenAmount=void 0,ve.receiverAddress=void 0,ve.receiverProfileImageUrl=void 0,ve.receiverProfileName=void 0,ve.loading=!1,ve.tokenBalances=[]}},ye=Rt(lg),Fo={currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,allAccounts:[],user:void 0},kn={caipNetwork:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]},z=ke({chains:jf(),activeCaipAddress:void 0,activeChain:void 0,activeCaipNetwork:void 0,noAdapters:!1,universalAdapter:{networkControllerClient:void 0,connectionControllerClient:void 0},isSwitchingNamespace:!1}),ug={state:z,subscribe(t){return ot(z,()=>{t(z)})},subscribeKey(t,e){return at(z,t,e)},subscribeChainProp(t,e,s){let r;return ot(z.chains,()=>{const i=s||z.activeChain;if(i){const n=z.chains.get(i)?.[t];r!==n&&(r=n,e(n))}})},initialize(t,e,s){const{chainId:r,namespace:i}=H.getActiveNetworkProps(),n=e?.find(u=>u.id.toString()===r?.toString()),a=t.find(u=>u?.namespace===i)||t?.[0],c=t.map(u=>u.namespace).filter(u=>u!==void 0),l=B.state.enableEmbedded?new Set([...c]):new Set([...e?.map(u=>u.chainNamespace)??[]]);(t?.length===0||!a)&&(z.noAdapters=!0),z.noAdapters||(z.activeChain=a?.namespace,z.activeCaipNetwork=n,b.setChainNetworkData(a?.namespace,{caipNetwork:n}),z.activeChain&&Ls.set({activeChain:a?.namespace})),l.forEach(u=>{const h=e?.filter(d=>d.chainNamespace===u);b.state.chains.set(u,{namespace:u,networkState:ke({...kn,caipNetwork:h?.[0]}),accountState:ke(Fo),caipNetworks:h??[],...s}),b.setRequestedCaipNetworks(h??[],u)})},removeAdapter(t){if(z.activeChain===t){const e=Array.from(z.chains.entries()).find(([s])=>s!==t);if(e){const s=e[1]?.caipNetworks?.[0];s&&b.setActiveCaipNetwork(s)}}z.chains.delete(t)},addAdapter(t,{networkControllerClient:e,connectionControllerClient:s},r){z.chains.set(t.namespace,{namespace:t.namespace,networkState:{...kn,caipNetwork:r[0]},accountState:Fo,caipNetworks:r,connectionControllerClient:s,networkControllerClient:e}),b.setRequestedCaipNetworks(r?.filter(i=>i.chainNamespace===t.namespace)??[],t.namespace)},addNetwork(t){const e=z.chains.get(t.chainNamespace);if(e){const s=[...e.caipNetworks||[]];e.caipNetworks?.find(r=>r.id===t.id)||s.push(t),z.chains.set(t.chainNamespace,{...e,caipNetworks:s}),b.setRequestedCaipNetworks(s,t.chainNamespace),W.filterByNamespace(t.chainNamespace,!0)}},removeNetwork(t,e){const s=z.chains.get(t);if(s){const r=z.activeCaipNetwork?.id===e,i=[...s.caipNetworks?.filter(n=>n.id!==e)||[]];r&&s?.caipNetworks?.[0]&&b.setActiveCaipNetwork(s.caipNetworks[0]),z.chains.set(t,{...s,caipNetworks:i}),b.setRequestedCaipNetworks(i||[],t),i.length===0&&W.filterByNamespace(t,!1)}},setAdapterNetworkState(t,e){const s=z.chains.get(t);s&&(s.networkState={...s.networkState||kn,...e},z.chains.set(t,s))},setChainAccountData(t,e,s=!0){if(!t)throw new Error("Chain is required to update chain account data");const r=z.chains.get(t);if(r){const i={...r.accountState||Fo,...e};z.chains.set(t,{...r,accountState:i}),(z.chains.size===1||z.activeChain===t)&&(e.caipAddress&&(z.activeCaipAddress=e.caipAddress),V.replaceState(i))}},setChainNetworkData(t,e){if(!t)return;const s=z.chains.get(t);if(s){const r={...s.networkState||kn,...e};z.chains.set(t,{...s,networkState:r})}},setAccountProp(t,e,s,r=!0){b.setChainAccountData(s,{[t]:e},r),t==="status"&&e==="disconnected"&&s&&W.removeConnectorId(s)},setActiveNamespace(t){z.activeChain=t;const e=t?z.chains.get(t):void 0,s=e?.networkState?.caipNetwork;s?.id&&t&&(z.activeCaipAddress=e?.accountState?.caipAddress,z.activeCaipNetwork=s,b.setChainNetworkData(t,{caipNetwork:s}),H.setActiveCaipNetworkId(s?.caipNetworkId),Ls.set({activeChain:t,selectedNetworkId:s?.caipNetworkId}))},setActiveCaipNetwork(t){if(!t)return;z.activeChain!==t.chainNamespace&&b.setIsSwitchingNamespace(!0);const e=z.chains.get(t.chainNamespace);z.activeChain=t.chainNamespace,z.activeCaipNetwork=t,b.setChainNetworkData(t.chainNamespace,{caipNetwork:t}),e?.accountState?.address?z.activeCaipAddress=`${t.chainNamespace}:${t.id}:${e?.accountState?.address}`:z.activeCaipAddress=void 0,b.setAccountProp("caipAddress",z.activeCaipAddress,t.chainNamespace),e&&V.replaceState(e.accountState),ye.resetSend(),Ls.set({activeChain:z.activeChain,selectedNetworkId:z.activeCaipNetwork?.caipNetworkId}),H.setActiveCaipNetworkId(t.caipNetworkId),!b.checkIfSupportedNetwork(t.chainNamespace)&&B.state.enableNetworkSwitch&&!B.state.allowUnsupportedChain&&!ee.state.wcBasic&&b.showUnsupportedChainUI()},addCaipNetwork(t){if(!t)return;const e=z.chains.get(t.chainNamespace);e&&e?.caipNetworks?.push(t)},async switchActiveNamespace(t){if(!t)return;const e=t!==b.state.activeChain,s=b.getNetworkData(t)?.caipNetwork,r=b.getCaipNetworkByNamespace(t,s?.id);e&&r&&await b.switchActiveNetwork(r)},async switchActiveNetwork(t){const s=!b.state.chains.get(b.state.activeChain)?.caipNetworks?.some(i=>i.id===z.activeCaipNetwork?.id),r=b.getNetworkControllerClient(t.chainNamespace);if(r){try{await r.switchCaipNetwork(t),s&&Je.close()}catch{ne.goBack()}Ue.sendEvent({type:"track",event:"SWITCH_NETWORK",properties:{network:t.caipNetworkId}})}},getNetworkControllerClient(t){const e=t||z.activeChain,s=z.chains.get(e);if(!s)throw new Error("Chain adapter not found");if(!s.networkControllerClient)throw new Error("NetworkController client not set");return s.networkControllerClient},getConnectionControllerClient(t){const e=t||z.activeChain;if(!e)throw new Error("Chain is required to get connection controller client");const s=z.chains.get(e);if(!s?.connectionControllerClient)throw new Error("ConnectionController client not set");return s.connectionControllerClient},getAccountProp(t,e){let s=z.activeChain;if(e&&(s=e),!s)return;const r=z.chains.get(s)?.accountState;if(r)return r[t]},getNetworkProp(t,e){const s=z.chains.get(e)?.networkState;if(s)return s[t]},getRequestedCaipNetworks(t){const e=z.chains.get(t),{approvedCaipNetworkIds:s=[],requestedCaipNetworks:r=[]}=e?.networkState||{};return te.sortRequestedNetworks(s,r)},getAllRequestedCaipNetworks(){const t=[];return z.chains.forEach(e=>{const s=b.getRequestedCaipNetworks(e.namespace);t.push(...s)}),t},setRequestedCaipNetworks(t,e){b.setAdapterNetworkState(e,{requestedCaipNetworks:t});const r=b.getAllRequestedCaipNetworks().map(n=>n.chainNamespace),i=Array.from(new Set(r));W.filterByNamespaces(i)},getAllApprovedCaipNetworkIds(){const t=[];return z.chains.forEach(e=>{const s=b.getApprovedCaipNetworkIds(e.namespace);t.push(...s)}),t},getActiveCaipNetwork(){return z.activeCaipNetwork},getActiveCaipAddress(){return z.activeCaipAddress},getApprovedCaipNetworkIds(t){return z.chains.get(t)?.networkState?.approvedCaipNetworkIds||[]},async setApprovedCaipNetworksData(t){const s=await b.getNetworkControllerClient()?.getApprovedCaipNetworksData();b.setAdapterNetworkState(t,{approvedCaipNetworkIds:s?.approvedCaipNetworkIds,supportsAllNetworks:s?.supportsAllNetworks})},checkIfSupportedNetwork(t,e){const s=e||z.activeCaipNetwork,r=b.getRequestedCaipNetworks(t);return r.length?r?.some(i=>i.id===s?.id):!0},checkIfSupportedChainId(t){return z.activeChain?b.getRequestedCaipNetworks(z.activeChain)?.some(s=>s.id===t):!0},setSmartAccountEnabledNetworks(t,e){b.setAdapterNetworkState(e,{smartAccountEnabledNetworks:t})},checkIfSmartAccountEnabled(){const t=jh.caipNetworkIdToNumber(z.activeCaipNetwork?.caipNetworkId),e=z.activeChain;return!e||!t?!1:!!b.getNetworkProp("smartAccountEnabledNetworks",e)?.includes(Number(t))},getActiveNetworkTokenAddress(){const t=z.activeCaipNetwork?.chainNamespace||"eip155",e=z.activeCaipNetwork?.id||1,s=Se.NATIVE_TOKEN_ADDRESS[t];return`${t}:${e}:${s}`},showUnsupportedChainUI(){Je.open({view:"UnsupportedChain"})},checkIfNamesSupported(){const t=z.activeCaipNetwork;return!!(t?.chainNamespace&&Se.NAMES_SUPPORTED_CHAIN_NAMESPACES.includes(t.chainNamespace))},resetNetwork(t){b.setAdapterNetworkState(t,{approvedCaipNetworkIds:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]})},resetAccount(t){const e=t;if(!e)throw new Error("Chain is required to set account prop");z.activeCaipAddress=void 0,b.setChainAccountData(e,{smartAccountDeployed:!1,currentTab:0,caipAddress:void 0,address:void 0,balance:void 0,balanceSymbol:void 0,profileName:void 0,profileImage:void 0,addressExplorerUrl:void 0,tokenBalance:[],connectedWalletInfo:void 0,preferredAccountTypes:void 0,socialProvider:void 0,socialWindow:void 0,farcasterUrl:void 0,allAccounts:[],user:void 0,status:"disconnected"}),W.removeConnectorId(e)},setIsSwitchingNamespace(t){z.isSwitchingNamespace=t},getFirstCaipNetworkSupportsAuthConnector(){const t=[];let e;if(z.chains.forEach(s=>{K.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(r=>r===s.namespace)&&s.namespace&&t.push(s.namespace)}),t.length>0){const s=t[0];return e=s?z.chains.get(s)?.caipNetworks?.[0]:void 0,e}},getAccountData(t){return t?b.state.chains.get(t)?.accountState:V.state},getNetworkData(t){const e=t||z.activeChain;if(e)return b.state.chains.get(e)?.networkState},getCaipNetworkByNamespace(t,e){if(!t)return;const s=b.state.chains.get(t),r=s?.caipNetworks?.find(i=>i.id===e);return r||s?.networkState?.caipNetwork||s?.caipNetworks?.[0]},getRequestedCaipNetworkIds(){const t=W.state.filterByNamespace;return(t?[z.chains.get(t)]:Array.from(z.chains.values())).flatMap(s=>s?.caipNetworks||[]).map(s=>s.caipNetworkId)},getCaipNetworks(t){return t?b.getRequestedCaipNetworks(t):b.getAllRequestedCaipNetworks()}},b=Rt(ug),hg={purchaseCurrencies:[{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"Ether",symbol:"ETH",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]}],paymentCurrencies:[{id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},{id:"EUR",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]}]},Vh=te.getBlockchainApiUrl(),pt=ke({clientId:null,api:new bn({baseUrl:Vh,clientId:null}),supportedChains:{http:[],ws:[]}}),Q={state:pt,async get(t){const{st:e,sv:s}=Q.getSdkProperties(),r=B.state.projectId,i={...t.params||{},st:e,sv:s,projectId:r};return pt.api.get({...t,params:i})},getSdkProperties(){const{sdkType:t,sdkVersion:e}=B.state;return{st:t||"unknown",sv:e||"unknown"}},async isNetworkSupported(t){if(!t)return!1;try{pt.supportedChains.http.length||await Q.getSupportedNetworks()}catch{return!1}return pt.supportedChains.http.includes(t)},async getSupportedNetworks(){try{const t=await Q.get({path:"v1/supported-chains"});return pt.supportedChains=t,t}catch{return pt.supportedChains}},async fetchIdentity({address:t,caipNetworkId:e}){if(!await Q.isNetworkSupported(e))return{avatar:"",name:""};const r=H.getIdentityFromCacheForAddress(t);if(r)return r;const i=await Q.get({path:`/v1/identity/${t}`,params:{sender:b.state.activeCaipAddress?te.getPlainAddress(b.state.activeCaipAddress):void 0}});return H.updateIdentityCache({address:t,identity:i,timestamp:Date.now()}),i},async fetchTransactions({account:t,cursor:e,onramp:s,signal:r,cache:i,chainId:n}){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?Q.get({path:`/v1/account/${t}/history`,params:{cursor:e,onramp:s,chainId:n},signal:r,cache:i}):{data:[],next:void 0}},async fetchSwapQuote({amount:t,userAddress:e,from:s,to:r,gasPrice:i}){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?Q.get({path:"/v1/convert/quotes",headers:{"Content-Type":"application/json"},params:{amount:t,userAddress:e,from:s,to:r,gasPrice:i}}):{quotes:[]}},async fetchSwapTokens({chainId:t}){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?Q.get({path:"/v1/convert/tokens",params:{chainId:t}}):{tokens:[]}},async fetchTokenPrice({addresses:t}){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?pt.api.post({path:"/v1/fungible/price",body:{currency:"usd",addresses:t,projectId:B.state.projectId},headers:{"Content-Type":"application/json"}}):{fungibles:[]}},async fetchSwapAllowance({tokenAddress:t,userAddress:e}){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?Q.get({path:"/v1/convert/allowance",params:{tokenAddress:t,userAddress:e},headers:{"Content-Type":"application/json"}}):{allowance:"0"}},async fetchGasPrice({chainId:t}){const{st:e,sv:s}=Q.getSdkProperties();if(!await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId))throw new Error("Network not supported for Gas Price");return Q.get({path:"/v1/convert/gas-price",headers:{"Content-Type":"application/json"},params:{chainId:t,st:e,sv:s}})},async generateSwapCalldata({amount:t,from:e,to:s,userAddress:r,disableEstimate:i}){if(!await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId))throw new Error("Network not supported for Swaps");return pt.api.post({path:"/v1/convert/build-transaction",headers:{"Content-Type":"application/json"},body:{amount:t,eip155:{slippage:Se.CONVERT_SLIPPAGE_TOLERANCE},projectId:B.state.projectId,from:e,to:s,userAddress:r,disableEstimate:i}})},async generateApproveCalldata({from:t,to:e,userAddress:s}){const{st:r,sv:i}=Q.getSdkProperties();if(!await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId))throw new Error("Network not supported for Swaps");return Q.get({path:"/v1/convert/build-approve",headers:{"Content-Type":"application/json"},params:{userAddress:s,from:t,to:e,st:r,sv:i}})},async getBalance(t,e,s){const{st:r,sv:i}=Q.getSdkProperties();if(!await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId))return Zt.showError("Token Balance Unavailable"),{balances:[]};const o=`${e}:${t}`,a=H.getBalanceCacheForCaipAddress(o);if(a)return a;const c=await Q.get({path:`/v1/account/${t}/balance`,params:{currency:"usd",chainId:e,forceUpdate:s,st:r,sv:i}});return H.updateBalanceCache({caipAddress:o,balance:c,timestamp:Date.now()}),c},async lookupEnsName(t){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?Q.get({path:`/v1/profile/account/${t}`,params:{apiVersion:"2"}}):{addresses:{},attributes:[]}},async reverseLookupEnsName({address:t}){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?Q.get({path:`/v1/profile/reverse/${t}`,params:{sender:V.state.address,apiVersion:"2"}}):[]},async getEnsNameSuggestions(t){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?Q.get({path:`/v1/profile/suggestions/${t}`,params:{zone:"reown.id"}}):{suggestions:[]}},async registerEnsName({coinType:t,address:e,message:s,signature:r}){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?pt.api.post({path:"/v1/profile/account",body:{coin_type:t,address:e,message:s,signature:r},headers:{"Content-Type":"application/json"}}):{success:!1}},async generateOnRampURL({destinationWallets:t,partnerUserId:e,defaultNetwork:s,purchaseAmount:r,paymentAmount:i}){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?(await pt.api.post({path:"/v1/generators/onrampurl",params:{projectId:B.state.projectId},body:{destinationWallets:t,defaultNetwork:s,partnerUserId:e,defaultExperience:"buy",presetCryptoAmount:r,presetFiatAmount:i}})).url:""},async getOnrampOptions(){if(!await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId))return{paymentCurrencies:[],purchaseCurrencies:[]};try{return await Q.get({path:"/v1/onramp/options"})}catch{return hg}},async getOnrampQuote({purchaseCurrency:t,paymentCurrency:e,amount:s,network:r}){try{return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?await pt.api.post({path:"/v1/onramp/quote",params:{projectId:B.state.projectId},body:{purchaseCurrency:t,paymentCurrency:e,amount:s,network:r}}):null}catch{return{coinbaseFee:{amount:s,currency:e.id},networkFee:{amount:s,currency:e.id},paymentSubtotal:{amount:s,currency:e.id},paymentTotal:{amount:s,currency:e.id},purchaseAmount:{amount:s,currency:e.id},quoteId:"mocked-quote-id"}}},async getSmartSessions(t){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?Q.get({path:`/v1/sessions/${t}`}):[]},async revokeSmartSession(t,e,s){return await Q.isNetworkSupported(b.state.activeCaipNetwork?.caipNetworkId)?pt.api.post({path:`/v1/sessions/${t}/revoke`,params:{projectId:B.state.projectId},body:{pci:e,signature:s}}):{success:!1}},setClientId(t){pt.clientId=t,pt.api=new bn({baseUrl:Vh,clientId:t})}},Ut=ke({currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,allAccounts:[]}),dg={state:Ut,replaceState(t){t&&Object.assign(Ut,cr(t))},subscribe(t){return b.subscribeChainProp("accountState",e=>{if(e)return t(e)})},subscribeKey(t,e,s){let r;return b.subscribeChainProp("accountState",i=>{if(i){const n=i[t];r!==n&&(r=n,e(n))}},s)},setStatus(t,e){b.setAccountProp("status",t,e)},getCaipAddress(t){return b.getAccountProp("caipAddress",t)},setCaipAddress(t,e){const s=t?te.getPlainAddress(t):void 0;e===b.state.activeChain&&(b.state.activeCaipAddress=t),b.setAccountProp("caipAddress",t,e),b.setAccountProp("address",s,e)},setBalance(t,e,s){b.setAccountProp("balance",t,s),b.setAccountProp("balanceSymbol",e,s)},setProfileName(t,e){b.setAccountProp("profileName",t,e)},setProfileImage(t,e){b.setAccountProp("profileImage",t,e)},setUser(t,e){b.setAccountProp("user",t,e)},setAddressExplorerUrl(t,e){b.setAccountProp("addressExplorerUrl",t,e)},setSmartAccountDeployed(t,e){b.setAccountProp("smartAccountDeployed",t,e)},setCurrentTab(t){b.setAccountProp("currentTab",t,b.state.activeChain)},setTokenBalance(t,e){t&&b.setAccountProp("tokenBalance",t,e)},setShouldUpdateToAddress(t,e){b.setAccountProp("shouldUpdateToAddress",t,e)},setAllAccounts(t,e){b.setAccountProp("allAccounts",t,e)},addAddressLabel(t,e,s){const r=b.getAccountProp("addressLabels",s)||new Map;r.set(t,e),b.setAccountProp("addressLabels",r,s)},removeAddressLabel(t,e){const s=b.getAccountProp("addressLabels",e)||new Map;s.delete(t),b.setAccountProp("addressLabels",s,e)},setConnectedWalletInfo(t,e){b.setAccountProp("connectedWalletInfo",t,e,!1)},setPreferredAccountType(t,e){b.setAccountProp("preferredAccountTypes",{...Ut.preferredAccountTypes,[e]:t},e)},setPreferredAccountTypes(t){Ut.preferredAccountTypes=t},setSocialProvider(t,e){t&&b.setAccountProp("socialProvider",t,e)},setSocialWindow(t,e){b.setAccountProp("socialWindow",t?cr(t):void 0,e)},setFarcasterUrl(t,e){b.setAccountProp("farcasterUrl",t,e)},async fetchTokenBalance(t){Ut.balanceLoading=!0;const e=b.state.activeCaipNetwork?.caipNetworkId,s=b.state.activeCaipNetwork?.chainNamespace,r=b.state.activeCaipAddress,i=r?te.getPlainAddress(r):void 0;if(Ut.lastRetry&&!te.isAllowedRetry(Ut.lastRetry,30*Se.ONE_SEC_MS))return Ut.balanceLoading=!1,[];try{if(i&&e&&s){const o=(await Q.getBalance(i,e)).balances.filter(a=>a.quantity.decimals!=="0");return V.setTokenBalance(o,s),Ut.lastRetry=void 0,Ut.balanceLoading=!1,o}}catch(n){Ut.lastRetry=Date.now(),t?.(n),Zt.showError("Token Balance Unavailable")}finally{Ut.balanceLoading=!1}return[]},resetAccount(t){b.resetAccount(t)}},V=Rt(dg),pg={onSwitchNetwork({network:t,ignoreSwitchConfirmation:e=!1}){const s=b.state.activeCaipNetwork,r=ne.state.data;if(t.id===s?.id)return;const n=V.getCaipAddress(b.state.activeChain),o=t.chainNamespace!==b.state.activeChain,a=V.getCaipAddress(t.chainNamespace),l=W.getConnectorId(b.state.activeChain)===K.CONNECTOR_ID.AUTH,u=K.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(h=>h===t.chainNamespace);e||l&&u?ne.push("SwitchNetwork",{...r,network:t}):n&&o&&!a?ne.push("SwitchActiveChain",{switchToChain:t.chainNamespace,navigateTo:"Connect",navigateWithReplace:!0,network:t}):ne.push("SwitchNetwork",{...r,network:t})}},ft=ke({loading:!1,loadingNamespaceMap:new Map,open:!1,shake:!1,namespace:void 0}),fg={state:ft,subscribe(t){return ot(ft,()=>t(ft))},subscribeKey(t,e){return at(ft,t,e)},async open(t){const e=V.state.status==="connected",s=t?.namespace,r=b.state.activeChain,i=s&&s!==r,n=b.getAccountData(t?.namespace)?.caipAddress;if(ee.state.wcBasic?J.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1}):await J.prefetch({fetchConnectorImages:!e,fetchFeaturedWallets:!e,fetchRecommendedWallets:!e}),W.setFilterByNamespace(t?.namespace),Je.setLoading(!0,s),s&&i){const o=b.getNetworkData(s)?.caipNetwork||b.getRequestedCaipNetworks(s)[0];o&&pg.onSwitchNetwork({network:o,ignoreSwitchConfirmation:!0})}else{const o=b.state.noAdapters;B.state.manualWCControl||o&&!n?te.isMobile()?ne.reset("AllWallets"):ne.reset("ConnectingWalletConnectBasic"):t?.view?ne.reset(t.view,t.data):n?ne.reset("Account"):ne.reset("Connect")}ft.open=!0,Ls.set({open:!0}),Ue.sendEvent({type:"track",event:"MODAL_OPEN",properties:{connected:!!n}})},close(){const t=B.state.enableEmbedded,e=!!b.state.activeCaipAddress;ft.open&&Ue.sendEvent({type:"track",event:"MODAL_CLOSE",properties:{connected:e}}),ft.open=!1,ne.reset("Connect"),Je.clearLoading(),t?e?ne.replace("Account"):ne.push("Connect"):Ls.set({open:!1}),ee.resetUri()},setLoading(t,e){e&&ft.loadingNamespaceMap.set(e,t),ft.loading=t,Ls.set({loading:t})},clearLoading(){ft.loadingNamespaceMap.clear(),ft.loading=!1},shake(){ft.shake||(ft.shake=!0,setTimeout(()=>{ft.shake=!1},500))}},Je=Rt(fg),Ji={id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},xa={id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},gg={providers:zh,selectedProvider:null,error:null,purchaseCurrency:Ji,paymentCurrency:xa,purchaseCurrencies:[Ji],paymentCurrencies:[],quotesLoading:!1},de=ke(gg),mg={state:de,subscribe(t){return ot(de,()=>t(de))},subscribeKey(t,e){return at(de,t,e)},setSelectedProvider(t){if(t&&t.name==="meld"){const e=b.state.activeChain===K.CHAIN.SOLANA?"SOL":"USDC",s=V.state.address??"",r=new URL(t.url);r.searchParams.append("publicKey",qf),r.searchParams.append("destinationCurrencyCode",e),r.searchParams.append("walletAddress",s),r.searchParams.append("externalCustomerId",B.state.projectId),de.selectedProvider={...t,url:r.toString()}}else de.selectedProvider=t},setOnrampProviders(t){if(Array.isArray(t)&&t.every(e=>typeof e=="string")){const e=t,s=zh.filter(r=>e.includes(r.name));de.providers=s}else de.providers=[]},setPurchaseCurrency(t){de.purchaseCurrency=t},setPaymentCurrency(t){de.paymentCurrency=t},setPurchaseAmount(t){Ra.state.purchaseAmount=t},setPaymentAmount(t){Ra.state.paymentAmount=t},async getAvailableCurrencies(){const t=await Q.getOnrampOptions();de.purchaseCurrencies=t.purchaseCurrencies,de.paymentCurrencies=t.paymentCurrencies,de.paymentCurrency=t.paymentCurrencies[0]||xa,de.purchaseCurrency=t.purchaseCurrencies[0]||Ji,await J.fetchCurrencyImages(t.paymentCurrencies.map(e=>e.id)),await J.fetchTokenImages(t.purchaseCurrencies.map(e=>e.symbol))},async getQuote(){de.quotesLoading=!0;try{const t=await Q.getOnrampQuote({purchaseCurrency:de.purchaseCurrency,paymentCurrency:de.paymentCurrency,amount:de.paymentAmount?.toString()||"0",network:de.purchaseCurrency?.symbol});return de.quotesLoading=!1,de.purchaseAmount=Number(t?.purchaseAmount.amount),t}catch(t){return de.error=t.message,de.quotesLoading=!1,null}finally{de.quotesLoading=!1}},resetState(){de.selectedProvider=null,de.error=null,de.purchaseCurrency=Ji,de.paymentCurrency=xa,de.purchaseCurrencies=[Ji],de.paymentCurrencies=[],de.paymentAmount=void 0,de.purchaseAmount=void 0,de.quotesLoading=!1}},Ra=Rt(mg),al=2147483648,wg={convertEVMChainIdToCoinType(t){if(t>=al)throw new Error("Invalid chainId");return(al|t)>>>0}},Dt=ke({suggestions:[],loading:!1}),yg={state:Dt,subscribe(t){return ot(Dt,()=>t(Dt))},subscribeKey(t,e){return at(Dt,t,e)},async resolveName(t){try{return await Q.lookupEnsName(t)}catch(e){const s=e;throw new Error(s?.reasons?.[0]?.description||"Error resolving name")}},async isNameRegistered(t){try{return await Q.lookupEnsName(t),!0}catch{return!1}},async getSuggestions(t){try{Dt.loading=!0,Dt.suggestions=[];const e=await Q.getEnsNameSuggestions(t);return Dt.suggestions=e.suggestions.map(s=>({...s,name:s.name}))||[],Dt.suggestions}catch(e){const s=Yi.parseEnsApiError(e,"Error fetching name suggestions");throw new Error(s)}finally{Dt.loading=!1}},async getNamesForAddress(t){try{if(!b.state.activeCaipNetwork)return[];const s=H.getEnsFromCacheForAddress(t);if(s)return s;const r=await Q.reverseLookupEnsName({address:t});return H.updateEnsCache({address:t,ens:r,timestamp:Date.now()}),r}catch(e){const s=Yi.parseEnsApiError(e,"Error fetching names for address");throw new Error(s)}},async registerName(t){const e=b.state.activeCaipNetwork;if(!e)throw new Error("Network not found");const s=V.state.address,r=W.getAuthConnector();if(!s||!r)throw new Error("Address or auth connector not found");Dt.loading=!0;try{const i=JSON.stringify({name:t,attributes:{},timestamp:Math.floor(Date.now()/1e3)});ne.pushTransactionStack({onCancel(){ne.replace("RegisterAccountName")}});const n=await ee.signMessage(i);Dt.loading=!1;const o=e.id;if(!o)throw new Error("Network not found");const a=wg.convertEVMChainIdToCoinType(Number(o));await Q.registerEnsName({coinType:a,address:s,signature:n,message:i}),V.setProfileName(t,e.chainNamespace),ne.replace("RegisterAccountNameSuccess")}catch(i){const n=Yi.parseEnsApiError(i,`Error registering name ${t}`);throw ne.replace("RegisterAccountName"),new Error(n)}finally{Dt.loading=!1}},validateName(t){return/^[a-zA-Z0-9-]{4,}$/u.test(t)},parseEnsApiError(t,e){return t?.reasons?.[0]?.description||e}},Yi=Rt(yg);function bg(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function ze(t,...e){try{return bg(t(...e))}catch(s){return Promise.reject(s)}}function vg(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Eg(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Yn(t){if(vg(t))return String(t);if(Eg(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Yn(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Ua="base64:";function Cg(t){return typeof t=="string"?t:Ua+Ng(t)}function Ig(t){return typeof t!="string"||!t.startsWith(Ua)?t:Ag(t.slice(Ua.length))}function Ag(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Ng(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function yt(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function _g(...t){return yt(t.join(":"))}function xn(t){return t=yt(t),t?t+":":""}function Sg(t,e){if(e===void 0)return!0;let s=0,r=t.indexOf(":");for(;r>-1;)s++,r=t.indexOf(":",r+1);return s<=e}function Pg(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const Og="memory",$g=()=>{const t=new Map;return{name:Og,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,s){t.set(e,s)},setItemRaw(e,s){t.set(e,s)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Tg(t={}){const e={mounts:{"":t.driver||$g()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},s=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},r=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(l,u)=>{if(e.watching){u=yt(u);for(const h of e.watchListeners)h(l,u)}},n=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await cl(e.mounts[l],i,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const d=new Map,f=m=>{let g=d.get(m.base);return g||(g={driver:m.driver,base:m.base,items:[]},d.set(m.base,g)),g};for(const m of l){const g=typeof m=="string",p=yt(g?m:m.key),w=g?void 0:m.value,y=g||!m.options?u:{...u,...m.options},C=s(p);f(C).items.push({key:p,value:w,relativeKey:C.relativeKey,options:y})}return Promise.all([...d.values()].map(m=>h(m))).then(m=>m.flat())},c={hasItem(l,u={}){l=yt(l);const{relativeKey:h,driver:d}=s(l);return ze(d.hasItem,h,u)},getItem(l,u={}){l=yt(l);const{relativeKey:h,driver:d}=s(l);return ze(d.getItem,h,u).then(f=>Tn(f))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?ze(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),u).then(d=>d.map(f=>({key:_g(h.base,f.key),value:Tn(f.value)}))):Promise.all(h.items.map(d=>ze(h.driver.getItem,d.relativeKey,d.options).then(f=>({key:d.key,value:Tn(f)})))))},getItemRaw(l,u={}){l=yt(l);const{relativeKey:h,driver:d}=s(l);return d.getItemRaw?ze(d.getItemRaw,h,u):ze(d.getItem,h,u).then(f=>Ig(f))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=yt(l);const{relativeKey:d,driver:f}=s(l);f.setItem&&(await ze(f.setItem,d,Yn(u),h),f.watch||i("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return ze(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:Yn(d.value),options:d.options})),u);h.driver.setItem&&await Promise.all(h.items.map(d=>ze(h.driver.setItem,d.relativeKey,Yn(d.value),d.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=yt(l);const{relativeKey:d,driver:f}=s(l);if(f.setItemRaw)await ze(f.setItemRaw,d,u,h);else if(f.setItem)await ze(f.setItem,d,Cg(u),h);else return;f.watch||i("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=yt(l);const{relativeKey:h,driver:d}=s(l);d.removeItem&&(await ze(d.removeItem,h,u),(u.removeMeta||u.removeMata)&&await ze(d.removeItem,h+"$",u),d.watch||i("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=yt(l);const{relativeKey:h,driver:d}=s(l),f=Object.create(null);if(d.getMeta&&Object.assign(f,await ze(d.getMeta,h,u)),!u.nativeOnly){const m=await ze(d.getItem,h+"$",u).then(g=>Tn(g));m&&typeof m=="object"&&(typeof m.atime=="string"&&(m.atime=new Date(m.atime)),typeof m.mtime=="string"&&(m.mtime=new Date(m.mtime)),Object.assign(f,m))}return f},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){l=xn(l);const h=r(l,!0);let d=[];const f=[];let m=!0;for(const p of h){p.driver.flags?.maxDepth||(m=!1);const w=await ze(p.driver.getKeys,p.relativeBase,u);for(const y of w){const C=p.mountpoint+yt(y);d.some(O=>C.startsWith(O))||f.push(C)}d=[p.mountpoint,...d.filter(y=>!y.startsWith(p.mountpoint))]}const g=u.maxDepth!==void 0&&!m;return f.filter(p=>(!g||Sg(p,u.maxDepth))&&Pg(p,l))},async clear(l,u={}){l=xn(l),await Promise.all(r(l,!1).map(async h=>{if(h.driver.clear)return ze(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const d=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(d.map(f=>h.driver.removeItem(f,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>ll(l)))},async watch(l){return await n(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=xn(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(cl(u,i,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){l=xn(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&(e.unwatch[l]?.(),delete e.unwatch[l]),u&&await ll(e.mounts[l]),e.mountpoints=e.mountpoints.filter(h=>h!==l),delete e.mounts[l])},getMount(l=""){l=yt(l)+":";const u=s(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=yt(l),r(l,u.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function cl(t,e,s){return t.watch?t.watch((r,i)=>e(r,s+i)):()=>{}}async function ll(t){typeof t.dispose=="function"&&await ze(t.dispose)}const kg="idb-keyval";var xg=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",s=i=>e+i;let r;return t.dbName&&t.storeName&&(r=lf(t.dbName,t.storeName)),{name:kg,options:t,async hasItem(i){return!(typeof await Zc(s(i),r)>"u")},async getItem(i){return await Zc(s(i),r)??null},setItem(i,n){return pf(s(i),n,r)},removeItem(i){return df(s(i),r)},getKeys(){return hf(r)},clear(){return uf(r)}}};const Rg="WALLET_CONNECT_V2_INDEXED_DB",Ug="keyvaluestorage";let Dg=class{constructor(){this.indexedDb=Tg({driver:xg({dbName:Rg,storeName:Ug})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const s=await this.indexedDb.getItem(e);if(s!==null)return s}async setItem(e,s){await this.indexedDb.setItem(e,Cc(s))}async removeItem(e){await this.indexedDb.removeItem(e)}};var zo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Zn={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(s){return this.hasOwnProperty(s)?String(this[s]):null},t.prototype.setItem=function(s,r){this[s]=String(r)},t.prototype.removeItem=function(s){delete this[s]},t.prototype.clear=function(){const s=this;Object.keys(s).forEach(function(r){s[r]=void 0,delete s[r]})},t.prototype.key=function(s){return s=s||0,Object.keys(this)[s]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof zo<"u"&&zo.localStorage?Zn.exports=zo.localStorage:typeof window<"u"&&window.localStorage?Zn.exports=window.localStorage:Zn.exports=new e})();function Lg(t){var e;return[t[0],oo((e=t[1])!=null?e:"")]}let Bg=class{constructor(){this.localStorage=Zn.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Lg)}async getItem(e){const s=this.localStorage.getItem(e);if(s!==null)return oo(s)}async setItem(e,s){this.localStorage.setItem(e,Cc(s))}async removeItem(e){this.localStorage.removeItem(e)}};const Mg="wc_storage_version",ul=1,jg=async(t,e,s)=>{const r=Mg,i=await e.getItem(r);if(i&&i>=ul){s(e);return}const n=await t.getKeys();if(!n.length){s(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(r,ul),s(e),qg(t,o)},qg=async(t,e)=>{e.length&&e.forEach(async s=>{await t.removeItem(s)})};let Fg=class{constructor(){this.initialized=!1,this.setInitialized=s=>{this.storage=s,this.initialized=!0};const e=new Bg;this.storage=e;try{const s=new Dg;jg(e,s,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,s){return await this.initialize(),this.storage.setItem(e,s)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const s=setInterval(()=>{this.initialized&&(clearInterval(s),e())},20)})}};var zg=Object.defineProperty,Wg=(t,e,s)=>e in t?zg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,hl=(t,e,s)=>Wg(t,typeof e!="symbol"?e+"":e,s);let Hg=class extends bi{constructor(e){super(),this.opts=e,hl(this,"protocol","wc"),hl(this,"version",2)}};var Vg=Object.defineProperty,Kg=(t,e,s)=>e in t?Vg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Gg=(t,e,s)=>Kg(t,e+"",s);let Jg=class extends bi{constructor(e,s){super(),this.core=e,this.logger=s,Gg(this,"records",new Map)}},Yg=class{constructor(e,s){this.logger=e,this.core=s}},Zg=class extends bi{constructor(e,s){super(),this.relayer=e,this.logger=s}},Xg=class extends bi{constructor(e){super()}},Qg=class{constructor(e,s,r,i){this.core=e,this.logger=s,this.name=r}},em=class extends bi{constructor(e,s){super(),this.relayer=e,this.logger=s}},tm=class extends bi{constructor(e,s){super(),this.core=e,this.logger=s}},sm=class{constructor(e,s,r){this.core=e,this.logger=s,this.store=r}},rm=class{constructor(e,s){this.projectId=e,this.logger=s}},im=class{constructor(e,s,r){this.core=e,this.logger=s,this.telemetryEnabled=r}};function co(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function nm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function vo(t,...e){if(!nm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function fS(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");co(t.outputLen),co(t.blockLen)}function dl(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function om(t,e){vo(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}const Rn=BigInt(2**32-1),pl=BigInt(32);function am(t,e=!1){return e?{h:Number(t&Rn),l:Number(t>>pl&Rn)}:{h:Number(t>>pl&Rn)|0,l:Number(t&Rn)|0}}function cm(t,e=!1){let s=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:n,l:o}=am(t[i],e);[s[i],r[i]]=[n,o]}return[s,r]}const lm=(t,e,s)=>t<<s|e>>>32-s,um=(t,e,s)=>e<<s|t>>>32-s,hm=(t,e,s)=>e<<s-32|t>>>64-s,dm=(t,e,s)=>t<<s-32|e>>>64-s,Ir=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function pm(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function gS(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function mS(t,e){return t<<32-e|t>>>e}const fl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function fm(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function gl(t){for(let e=0;e<t.length;e++)t[e]=fm(t[e])}function gm(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Kh(t){return typeof t=="string"&&(t=gm(t)),vo(t),t}function wS(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];vo(i),e+=i.length}const s=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const n=t[r];s.set(n,i),i+=n.length}return s}class mm{clone(){return this._cloneInto()}}function wm(t){const e=r=>t().update(Kh(r)).digest(),s=t();return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=()=>t(),e}function yS(t=32){if(Ir&&typeof Ir.getRandomValues=="function")return Ir.getRandomValues(new Uint8Array(t));if(Ir&&typeof Ir.randomBytes=="function")return Ir.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const Gh=[],Jh=[],Yh=[],ym=BigInt(0),$i=BigInt(1),bm=BigInt(2),vm=BigInt(7),Em=BigInt(256),Cm=BigInt(113);for(let t=0,e=$i,s=1,r=0;t<24;t++){[s,r]=[r,(2*s+3*r)%5],Gh.push(2*(5*r+s)),Jh.push((t+1)*(t+2)/2%64);let i=ym;for(let n=0;n<7;n++)e=(e<<$i^(e>>vm)*Cm)%Em,e&bm&&(i^=$i<<($i<<BigInt(n))-$i);Yh.push(i)}const[Im,Am]=cm(Yh,!0),ml=(t,e,s)=>s>32?hm(t,e,s):lm(t,e,s),wl=(t,e,s)=>s>32?dm(t,e,s):um(t,e,s);function Nm(t,e=24){const s=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)s[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=s[c],u=s[c+1],h=ml(l,u,1)^s[a],d=wl(l,u,1)^s[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let i=t[2],n=t[3];for(let o=0;o<24;o++){const a=Jh[o],c=ml(i,n,a),l=wl(i,n,a),u=Gh[o];i=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)s[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~s[(a+2)%10]&s[(a+4)%10]}t[0]^=Im[r],t[1]^=Am[r]}s.fill(0)}class Sc extends mm{constructor(e,s,r,i=!1,n=24){if(super(),this.blockLen=e,this.suffix=s,this.outputLen=r,this.enableXOF=i,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,co(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=pm(this.state)}keccak(){fl||gl(this.state32),Nm(this.state32,this.rounds),fl||gl(this.state32),this.posOut=0,this.pos=0}update(e){dl(this);const{blockLen:s,state:r}=this;e=Kh(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(s-this.pos,i-n);for(let a=0;a<o;a++)r[this.pos++]^=e[n++];this.pos===s&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:s,pos:r,blockLen:i}=this;e[r]^=s,(s&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){dl(this,!1),vo(e),this.finish();const s=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,n-i);e.set(s.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return co(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(om(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:s,suffix:r,outputLen:i,rounds:n,enableXOF:o}=this;return e||(e=new Sc(s,r,i,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const _m=(t,e,s)=>wm(()=>new Sc(e,t,s)),Sm=_m(1,136,256/8);var Pm={};const Om="ReactNative",Xt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},$m="js";function lo(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function br(){return!Tt.getDocument()&&!!Tt.getNavigator()&&navigator.product===Om}function Tm(){return br()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function km(){return br()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function vn(){return!lo()&&!!Tt.getNavigator()&&!!Tt.getDocument()}function Eo(){return br()?Xt.reactNative:lo()?Xt.node:vn()?Xt.browser:Xt.unknown}function yl(){var t;try{return br()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function xm(t,e){const s=new URLSearchParams(t);for(const r of Object.keys(e).sort())if(e.hasOwnProperty(r)){const i=e[r];i!==void 0&&s.set(r,i)}return s.toString()}function Rm(){return Dh.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Um(){if(Eo()===Xt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:s,Version:r}=global.Platform;return[s,r].join("-")}const t=gf();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Dm(){var t;const e=Eo();return e===Xt.browser?[e,((t=Tt.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function Zh(t,e,s){const r=Um(),i=Dm();return[[t,e].join("-"),[$m,s].join("-"),r,i].join("/")}function Lm({protocol:t,version:e,relayUrl:s,sdkVersion:r,auth:i,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=s.split("?"),u=Zh(t,e,r),h={auth:i,ua:u,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=xm(l[1]||"",h);return l[0]+"?"+d}function Da(t){return Object.fromEntries(t.entries())}function La(t){return new Map(Object.entries(t))}function Bm(t=j.FIVE_MINUTES,e){const s=j.toMiliseconds(t||j.FIVE_MINUTES);let r,i,n,o;return{resolve:a=>{n&&r&&(clearTimeout(n),r(a),o=Promise.resolve(a))},reject:a=>{n&&i&&(clearTimeout(n),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},s),r=a,i=c})}}function Ds(t,e,s){return new Promise(async(r,i)=>{const n=setTimeout(()=>i(new Error(s)),e);try{const o=await t;r(o)}catch(o){i(o)}clearTimeout(n)})}function Xh(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Mm(t){return Xh("topic",t)}function jm(t){return Xh("id",t)}function qm(t){const[e,s]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof s=="string")r.topic=s;else if(e==="id"&&Number.isInteger(Number(s)))r.id=Number(s);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${s}`);return r}function Zi(t,e){return j.fromMiliseconds(Date.now()+j.toMiliseconds(t))}function bl(t){return Date.now()>=j.toMiliseconds(t)}function Wo(t,e){return`${t}${e?`:${e}`:""}`}function vl(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Qh(){return typeof process<"u"&&Pm.IS_VITEST==="true"}function ed(t){return Buffer.from(t,"base64").toString("utf-8")}function Fm(t){return new Promise(e=>setTimeout(e,t))}function on(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function zm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function En(t,...e){if(!zm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Pc(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");on(t.outputLen),on(t.blockLen)}function ii(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function td(t,e){En(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}const Un=BigInt(2**32-1),El=BigInt(32);function Wm(t,e=!1){return e?{h:Number(t&Un),l:Number(t>>El&Un)}:{h:Number(t>>El&Un)|0,l:Number(t&Un)|0}}function Hm(t,e=!1){let s=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:n,l:o}=Wm(t[i],e);[s[i],r[i]]=[n,o]}return[s,r]}const Vm=(t,e,s)=>t<<s|e>>>32-s,Km=(t,e,s)=>e<<s|t>>>32-s,Gm=(t,e,s)=>e<<s-32|t>>>64-s,Jm=(t,e,s)=>t<<s-32|e>>>64-s,Ar=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ym(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ho(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function es(t,e){return t<<32-e|t>>>e}const Cl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Zm(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Il(t){for(let e=0;e<t.length;e++)t[e]=Zm(t[e])}function Xm(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function ni(t){return typeof t=="string"&&(t=Xm(t)),En(t),t}function Qm(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];En(i),e+=i.length}const s=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const n=t[r];s.set(n,i),i+=n.length}return s}let Oc=class{clone(){return this._cloneInto()}};function sd(t){const e=r=>t().update(ni(r)).digest(),s=t();return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=()=>t(),e}function Ei(t=32){if(Ar&&typeof Ar.getRandomValues=="function")return Ar.getRandomValues(new Uint8Array(t));if(Ar&&typeof Ar.randomBytes=="function")return Ar.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const rd=[],id=[],nd=[],ew=BigInt(0),Ti=BigInt(1),tw=BigInt(2),sw=BigInt(7),rw=BigInt(256),iw=BigInt(113);for(let t=0,e=Ti,s=1,r=0;t<24;t++){[s,r]=[r,(2*s+3*r)%5],rd.push(2*(5*r+s)),id.push((t+1)*(t+2)/2%64);let i=ew;for(let n=0;n<7;n++)e=(e<<Ti^(e>>sw)*iw)%rw,e&tw&&(i^=Ti<<(Ti<<BigInt(n))-Ti);nd.push(i)}const[nw,ow]=Hm(nd,!0),Al=(t,e,s)=>s>32?Gm(t,e,s):Vm(t,e,s),Nl=(t,e,s)=>s>32?Jm(t,e,s):Km(t,e,s);function aw(t,e=24){const s=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)s[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=s[c],u=s[c+1],h=Al(l,u,1)^s[a],d=Nl(l,u,1)^s[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let i=t[2],n=t[3];for(let o=0;o<24;o++){const a=id[o],c=Al(i,n,a),l=Nl(i,n,a),u=rd[o];i=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)s[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~s[(a+2)%10]&s[(a+4)%10]}t[0]^=nw[r],t[1]^=ow[r]}s.fill(0)}let cw=class od extends Oc{constructor(e,s,r,i=!1,n=24){if(super(),this.blockLen=e,this.suffix=s,this.outputLen=r,this.enableXOF=i,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,on(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Ym(this.state)}keccak(){Cl||Il(this.state32),aw(this.state32,this.rounds),Cl||Il(this.state32),this.posOut=0,this.pos=0}update(e){ii(this);const{blockLen:s,state:r}=this;e=ni(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(s-this.pos,i-n);for(let a=0;a<o;a++)r[this.pos++]^=e[n++];this.pos===s&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:s,pos:r,blockLen:i}=this;e[r]^=s,(s&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){ii(this,!1),En(e),this.finish();const s=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,n-i);e.set(s.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return on(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(td(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:s,suffix:r,outputLen:i,rounds:n,enableXOF:o}=this;return e||(e=new od(s,r,i,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const lw=(t,e,s)=>sd(()=>new cw(e,t,s));lw(1,136,256/8);function Vo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ad(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ot(t,...e){if(!ad(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function _l(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function uw(t,e){Ot(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}function Sl(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const Bs=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),hw=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),dw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!dw)throw new Error("Non little-endian hardware is not supported");function pw(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Ba(t){if(typeof t=="string")t=pw(t);else if(ad(t))t=Ma(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function fw(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function gw(t,e){if(t.length!==e.length)return!1;let s=0;for(let r=0;r<t.length;r++)s|=t[r]^e[r];return s===0}const mw=(t,e)=>{function s(r,...i){if(Ot(r),t.nonceLength!==void 0){const l=i[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?Ot(l):Ot(l,t.nonceLength)}const n=t.tagLength;n&&i[1]!==void 0&&Ot(i[1]);const o=e(r,...i),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Ot(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ot(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Ot(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(s,t),s};function Pl(t,e,s=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(s&&!ww(e))throw new Error("invalid output, must be aligned");return e}function Ol(t,e,s,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,r);const i=BigInt(32),n=BigInt(4294967295),o=Number(s>>i&n),a=Number(s&n);t.setUint32(e+4,o,r),t.setUint32(e+0,a,r)}function ww(t){return t.byteOffset%4===0}function Ma(t){return Uint8Array.from(t)}function oi(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const cd=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),yw=cd("expand 16-byte k"),bw=cd("expand 32-byte k"),vw=Bs(yw),Ew=Bs(bw);function fe(t,e){return t<<e|t>>>32-e}function ja(t){return t.byteOffset%4===0}const Dn=64,Cw=16,ld=2**32-1,$l=new Uint32Array;function Iw(t,e,s,r,i,n,o,a){const c=i.length,l=new Uint8Array(Dn),u=Bs(l),h=ja(i)&&ja(n),d=h?Bs(i):$l,f=h?Bs(n):$l;for(let m=0;m<c;o++){if(t(e,s,r,u,o,a),o>=ld)throw new Error("arx: counter overflow");const g=Math.min(Dn,c-m);if(h&&g===Dn){const p=m/4;if(m%4!==0)throw new Error("arx: invalid block position");for(let w=0,y;w<Cw;w++)y=p+w,f[y]=d[y]^u[w];m+=Dn;continue}for(let p=0,w;p<g;p++)w=m+p,n[w]=i[w]^l[p];m+=g}}function Aw(t,e){const{allowShortKeys:s,extendNonceFn:r,counterLength:i,counterRight:n,rounds:o}=fw({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Vo(i),Vo(o),Sl(n),Sl(s),(a,c,l,u,h=0)=>{Ot(a),Ot(c),Ot(l);const d=l.length;if(u===void 0&&(u=new Uint8Array(d)),Ot(u),Vo(h),h<0||h>=ld)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const f=[];let m=a.length,g,p;if(m===32)f.push(g=Ma(a)),p=Ew;else if(m===16&&s)g=new Uint8Array(32),g.set(a),g.set(a,16),p=vw,f.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${m}`);ja(c)||f.push(c=Ma(c));const w=Bs(g);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(p,w,Bs(c.subarray(0,16)),w),c=c.subarray(16)}const y=16-i;if(y!==c.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){const O=new Uint8Array(12);O.set(c,n?0:12-c.length),c=O,f.push(c)}const C=Bs(c);return Iw(t,p,w,C,l,u,h,o),oi(...f),u}}const Qe=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let Nw=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Ba(e),Ot(e,32);const s=Qe(e,0),r=Qe(e,2),i=Qe(e,4),n=Qe(e,6),o=Qe(e,8),a=Qe(e,10),c=Qe(e,12),l=Qe(e,14);this.r[0]=s&8191,this.r[1]=(s>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Qe(e,16+2*u)}process(e,s,r=!1){const i=r?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],f=o[6],m=o[7],g=o[8],p=o[9],w=Qe(e,s+0),y=Qe(e,s+2),C=Qe(e,s+4),O=Qe(e,s+6),T=Qe(e,s+8),P=Qe(e,s+10),N=Qe(e,s+12),$=Qe(e,s+14);let v=n[0]+(w&8191),k=n[1]+((w>>>13|y<<3)&8191),S=n[2]+((y>>>10|C<<6)&8191),R=n[3]+((C>>>7|O<<9)&8191),L=n[4]+((O>>>4|T<<12)&8191),E=n[5]+(T>>>1&8191),A=n[6]+((T>>>14|P<<2)&8191),I=n[7]+((P>>>11|N<<5)&8191),x=n[8]+((N>>>8|$<<8)&8191),U=n[9]+($>>>5|i),_=0,M=_+v*a+k*(5*p)+S*(5*g)+R*(5*m)+L*(5*f);_=M>>>13,M&=8191,M+=E*(5*d)+A*(5*h)+I*(5*u)+x*(5*l)+U*(5*c),_+=M>>>13,M&=8191;let q=_+v*c+k*a+S*(5*p)+R*(5*g)+L*(5*m);_=q>>>13,q&=8191,q+=E*(5*f)+A*(5*d)+I*(5*h)+x*(5*u)+U*(5*l),_+=q>>>13,q&=8191;let F=_+v*l+k*c+S*a+R*(5*p)+L*(5*g);_=F>>>13,F&=8191,F+=E*(5*m)+A*(5*f)+I*(5*d)+x*(5*h)+U*(5*u),_+=F>>>13,F&=8191;let X=_+v*u+k*l+S*c+R*a+L*(5*p);_=X>>>13,X&=8191,X+=E*(5*g)+A*(5*m)+I*(5*f)+x*(5*d)+U*(5*h),_+=X>>>13,X&=8191;let G=_+v*h+k*u+S*l+R*c+L*a;_=G>>>13,G&=8191,G+=E*(5*p)+A*(5*g)+I*(5*m)+x*(5*f)+U*(5*d),_+=G>>>13,G&=8191;let oe=_+v*d+k*h+S*u+R*l+L*c;_=oe>>>13,oe&=8191,oe+=E*a+A*(5*p)+I*(5*g)+x*(5*m)+U*(5*f),_+=oe>>>13,oe&=8191;let le=_+v*f+k*d+S*h+R*u+L*l;_=le>>>13,le&=8191,le+=E*c+A*a+I*(5*p)+x*(5*g)+U*(5*m),_+=le>>>13,le&=8191;let Ie=_+v*m+k*f+S*d+R*h+L*u;_=Ie>>>13,Ie&=8191,Ie+=E*l+A*c+I*a+x*(5*p)+U*(5*g),_+=Ie>>>13,Ie&=8191;let ue=_+v*g+k*m+S*f+R*d+L*h;_=ue>>>13,ue&=8191,ue+=E*u+A*l+I*c+x*a+U*(5*p),_+=ue>>>13,ue&=8191;let he=_+v*p+k*g+S*m+R*f+L*d;_=he>>>13,he&=8191,he+=E*h+A*u+I*l+x*c+U*a,_+=he>>>13,he&=8191,_=(_<<2)+_|0,_=_+M|0,M=_&8191,_=_>>>13,q+=_,n[0]=M,n[1]=q,n[2]=F,n[3]=X,n[4]=G,n[5]=oe,n[6]=le,n[7]=Ie,n[8]=ue,n[9]=he}finalize(){const{h:e,pad:s}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let n=(i^1)-1;for(let a=0;a<10;a++)r[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+s[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+s[a]|0)+(o>>>16)|0,e[a]=o&65535;oi(r)}update(e){_l(this);const{buffer:s,blockLen:r}=this;e=Ba(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(r-this.pos,i-n);if(o===r){for(;r<=i-n;n+=r)this.process(e,n);continue}s.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===r&&(this.process(s,0,!1),this.pos=0)}return this}destroy(){oi(this.h,this.r,this.buffer,this.pad)}digestInto(e){_l(this),uw(e,this),this.finished=!0;const{buffer:s,h:r}=this;let{pos:i}=this;if(i){for(s[i++]=1;i<16;i++)s[i]=0;this.process(s,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=r[o]>>>0,e[n++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const r=e.slice(0,s);return this.destroy(),r}};function _w(t){const e=(r,i)=>t(i).update(Ba(r)).digest(),s=t(new Uint8Array(32));return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=r=>t(r),e}const Sw=_w(t=>new Nw(t));function Pw(t,e,s,r,i,n=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],d=e[2],f=e[3],m=e[4],g=e[5],p=e[6],w=e[7],y=i,C=s[0],O=s[1],T=s[2],P=o,N=a,$=c,v=l,k=u,S=h,R=d,L=f,E=m,A=g,I=p,x=w,U=y,_=C,M=O,q=T;for(let X=0;X<n;X+=2)P=P+k|0,U=fe(U^P,16),E=E+U|0,k=fe(k^E,12),P=P+k|0,U=fe(U^P,8),E=E+U|0,k=fe(k^E,7),N=N+S|0,_=fe(_^N,16),A=A+_|0,S=fe(S^A,12),N=N+S|0,_=fe(_^N,8),A=A+_|0,S=fe(S^A,7),$=$+R|0,M=fe(M^$,16),I=I+M|0,R=fe(R^I,12),$=$+R|0,M=fe(M^$,8),I=I+M|0,R=fe(R^I,7),v=v+L|0,q=fe(q^v,16),x=x+q|0,L=fe(L^x,12),v=v+L|0,q=fe(q^v,8),x=x+q|0,L=fe(L^x,7),P=P+S|0,q=fe(q^P,16),I=I+q|0,S=fe(S^I,12),P=P+S|0,q=fe(q^P,8),I=I+q|0,S=fe(S^I,7),N=N+R|0,U=fe(U^N,16),x=x+U|0,R=fe(R^x,12),N=N+R|0,U=fe(U^N,8),x=x+U|0,R=fe(R^x,7),$=$+L|0,_=fe(_^$,16),E=E+_|0,L=fe(L^E,12),$=$+L|0,_=fe(_^$,8),E=E+_|0,L=fe(L^E,7),v=v+k|0,M=fe(M^v,16),A=A+M|0,k=fe(k^A,12),v=v+k|0,M=fe(M^v,8),A=A+M|0,k=fe(k^A,7);let F=0;r[F++]=o+P|0,r[F++]=a+N|0,r[F++]=c+$|0,r[F++]=l+v|0,r[F++]=u+k|0,r[F++]=h+S|0,r[F++]=d+R|0,r[F++]=f+L|0,r[F++]=m+E|0,r[F++]=g+A|0,r[F++]=p+I|0,r[F++]=w+x|0,r[F++]=y+U|0,r[F++]=C+_|0,r[F++]=O+M|0,r[F++]=T+q|0}const Ow=Aw(Pw,{counterRight:!1,counterLength:4,allowShortKeys:!1}),$w=new Uint8Array(16),Tl=(t,e)=>{t.update(e);const s=e.length%16;s&&t.update($w.subarray(s))},Tw=new Uint8Array(32);function kl(t,e,s,r,i){const n=t(e,s,Tw),o=Sw.create(n);i&&Tl(o,i),Tl(o,r);const a=new Uint8Array(16),c=hw(a);Ol(c,0,BigInt(i?i.length:0),!0),Ol(c,8,BigInt(r.length),!0),o.update(a);const l=o.digest();return oi(n,a),l}const kw=t=>(e,s,r)=>({encrypt(i,n){const o=i.length;n=Pl(o+16,n,!1),n.set(i);const a=n.subarray(0,-16);t(e,s,a,a,1);const c=kl(t,e,s,a,r);return n.set(c,o),oi(c),n},decrypt(i,n){n=Pl(i.length-16,n,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=kl(t,e,s,o,r);if(!gw(a,c))throw new Error("invalid tag");return n.set(i.subarray(0,-16)),t(e,s,n,n,1),oi(c),n}}),ud=mw({blockSize:64,nonceLength:12,tagLength:16},kw(Ow));let hd=class extends Oc{constructor(e,s){super(),this.finished=!1,this.destroyed=!1,Pc(e);const r=ni(s);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,n=new Uint8Array(i);n.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return ii(this),this.iHash.update(e),this}digestInto(e){ii(this),En(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:s,iHash:r,finished:i,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=s._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Co=(t,e,s)=>new hd(t,e).update(s).digest();Co.create=(t,e)=>new hd(t,e);function xw(t,e,s){return Pc(t),s===void 0&&(s=new Uint8Array(t.outputLen)),Co(t,ni(s),ni(e))}const Ko=new Uint8Array([0]),xl=new Uint8Array;function Rw(t,e,s,r=32){if(Pc(t),on(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);s===void 0&&(s=xl);const n=new Uint8Array(i*t.outputLen),o=Co.create(t,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<i;l++)Ko[0]=l+1,a.update(l===0?xl:c).update(s).update(Ko).digestInto(c),n.set(c,t.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Ko.fill(0),n.slice(0,r)}const Uw=(t,e,s,r,i)=>Rw(t,xw(t,e,s),r,i);function Dw(t,e,s,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,r);const i=BigInt(32),n=BigInt(4294967295),o=Number(s>>i&n),a=Number(s&n),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function Lw(t,e,s){return t&e^~t&s}function Bw(t,e,s){return t&e^t&s^e&s}let Mw=class extends Oc{constructor(e,s,r,i){super(),this.blockLen=e,this.outputLen=s,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ho(this.buffer)}update(e){ii(this);const{view:s,buffer:r,blockLen:i}=this;e=ni(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(i-this.pos,n-o);if(a===i){const c=Ho(e);for(;i<=n-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(s,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ii(this),td(e,this),this.finished=!0;const{buffer:s,view:r,blockLen:i,isLE:n}=this;let{pos:o}=this;s[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)s[h]=0;Dw(r,i-8,BigInt(this.length*8),n),this.process(r,0);const a=Ho(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const r=e.slice(0,s);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:s,buffer:r,length:i,finished:n,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=n,e.destroyed=o,i%s&&e.buffer.set(r),e}};const jw=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ps=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Os=new Uint32Array(64);let qw=class extends Mw{constructor(){super(64,32,8,!1),this.A=Ps[0]|0,this.B=Ps[1]|0,this.C=Ps[2]|0,this.D=Ps[3]|0,this.E=Ps[4]|0,this.F=Ps[5]|0,this.G=Ps[6]|0,this.H=Ps[7]|0}get(){const{A:e,B:s,C:r,D:i,E:n,F:o,G:a,H:c}=this;return[e,s,r,i,n,o,a,c]}set(e,s,r,i,n,o,a,c){this.A=e|0,this.B=s|0,this.C=r|0,this.D=i|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,s){for(let h=0;h<16;h++,s+=4)Os[h]=e.getUint32(s,!1);for(let h=16;h<64;h++){const d=Os[h-15],f=Os[h-2],m=es(d,7)^es(d,18)^d>>>3,g=es(f,17)^es(f,19)^f>>>10;Os[h]=g+Os[h-7]+m+Os[h-16]|0}let{A:r,B:i,C:n,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=es(a,6)^es(a,11)^es(a,25),f=u+d+Lw(a,c,l)+jw[h]+Os[h]|0,m=(es(r,2)^es(r,13)^es(r,22))+Bw(r,i,n)|0;u=l,l=c,c=a,a=o+f|0,o=n,n=i,i=r,r=f+m|0}r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,n,o,a,c,l,u)}roundClean(){Os.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Cn=sd(()=>new qw);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Io=BigInt(0),Ao=BigInt(1),Fw=BigInt(2);function lr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function In(t){if(!lr(t))throw new Error("Uint8Array expected")}function ai(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const zw=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ci(t){In(t);let e="";for(let s=0;s<t.length;s++)e+=zw[t[s]];return e}function Jr(t){const e=t.toString(16);return e.length&1?"0"+e:e}function $c(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Io:BigInt("0x"+t)}const ps={_0:48,_9:57,A:65,F:70,a:97,f:102};function Rl(t){if(t>=ps._0&&t<=ps._9)return t-ps._0;if(t>=ps.A&&t<=ps.F)return t-(ps.A-10);if(t>=ps.a&&t<=ps.f)return t-(ps.a-10)}function li(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,s=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(s);for(let i=0,n=0;i<s;i++,n+=2){const o=Rl(t.charCodeAt(n)),a=Rl(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}r[i]=o*16+a}return r}function ir(t){return $c(ci(t))}function an(t){return In(t),$c(ci(Uint8Array.from(t).reverse()))}function ui(t,e){return li(t.toString(16).padStart(e*2,"0"))}function No(t,e){return ui(t,e).reverse()}function Ww(t){return li(Jr(t))}function St(t,e,s){let r;if(typeof e=="string")try{r=li(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(lr(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof s=="number"&&i!==s)throw new Error(t+" of length "+s+" expected, got "+i);return r}function cn(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];In(i),e+=i.length}const s=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const n=t[r];s.set(n,i),i+=n.length}return s}function Hw(t,e){if(t.length!==e.length)return!1;let s=0;for(let r=0;r<t.length;r++)s|=t[r]^e[r];return s===0}function Vw(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const Go=t=>typeof t=="bigint"&&Io<=t;function _o(t,e,s){return Go(t)&&Go(e)&&Go(s)&&e<=t&&t<s}function Cs(t,e,s,r){if(!_o(e,s,r))throw new Error("expected valid "+t+": "+s+" <= n < "+r+", got "+e)}function dd(t){let e;for(e=0;t>Io;t>>=Ao,e+=1);return e}function Kw(t,e){return t>>BigInt(e)&Ao}function Gw(t,e,s){return t|(s?Ao:Io)<<BigInt(e)}const Tc=t=>(Fw<<BigInt(t-1))-Ao,Jo=t=>new Uint8Array(t),Ul=t=>Uint8Array.from(t);function pd(t,e,s){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof s!="function")throw new Error("hmacFn must be a function");let r=Jo(t),i=Jo(t),n=0;const o=()=>{r.fill(1),i.fill(0),n=0},a=(...u)=>s(i,r,...u),c=(u=Jo())=>{i=a(Ul([0]),u),r=a(),u.length!==0&&(i=a(Ul([1]),u),r=a())},l=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const h=[];for(;u<e;){r=a();const d=r.slice();h.push(d),u+=r.length}return cn(...h)};return(u,h)=>{o(),c(u);let d;for(;!(d=h(l()));)c();return o(),d}}const Jw={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||lr(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ci(t,e,s={}){const r=(i,n,o)=>{const a=Jw[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+n+", got "+c)};for(const[i,n]of Object.entries(e))r(i,n,!1);for(const[i,n]of Object.entries(s))r(i,n,!0);return t}const Yw=()=>{throw new Error("not implemented")};function qa(t){const e=new WeakMap;return(s,...r)=>{const i=e.get(s);if(i!==void 0)return i;const n=t(s,...r);return e.set(s,n),n}}var Zw=Object.freeze({__proto__:null,isBytes:lr,abytes:In,abool:ai,bytesToHex:ci,numberToHexUnpadded:Jr,hexToNumber:$c,hexToBytes:li,bytesToNumberBE:ir,bytesToNumberLE:an,numberToBytesBE:ui,numberToBytesLE:No,numberToVarBytesBE:Ww,ensureBytes:St,concatBytes:cn,equalBytes:Hw,utf8ToBytes:Vw,inRange:_o,aInRange:Cs,bitLen:dd,bitGet:Kw,bitSet:Gw,bitMask:Tc,createHmacDrbg:pd,validateObject:Ci,notImplemented:Yw,memoized:qa});const Ye=BigInt(0),De=BigInt(1),Zs=BigInt(2),Xw=BigInt(3),Fa=BigInt(4),Dl=BigInt(5),Ll=BigInt(8);function bt(t,e){const s=t%e;return s>=Ye?s:e+s}function fd(t,e,s){if(e<Ye)throw new Error("invalid exponent, negatives unsupported");if(s<=Ye)throw new Error("invalid modulus");if(s===De)return Ye;let r=De;for(;e>Ye;)e&De&&(r=r*t%s),t=t*t%s,e>>=De;return r}function Gt(t,e,s){let r=t;for(;e-- >Ye;)r*=r,r%=s;return r}function za(t,e){if(t===Ye)throw new Error("invert: expected non-zero number");if(e<=Ye)throw new Error("invert: expected positive modulus, got "+e);let s=bt(t,e),r=e,i=Ye,n=De;for(;s!==Ye;){const o=r/s,a=r%s,c=i-n*o;r=s,s=a,i=n,n=c}if(r!==De)throw new Error("invert: does not exist");return bt(i,e)}function Qw(t){const e=(t-De)/Zs;let s,r,i;for(s=t-De,r=0;s%Zs===Ye;s/=Zs,r++);for(i=Zs;i<t&&fd(i,e,t)!==t-De;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(t+De)/Fa;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(s+De)/Zs;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,l=o.pow(o.mul(o.ONE,i),s),u=o.pow(a,n),h=o.pow(a,s);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let m=o.sqr(h);d<c&&!o.eql(m,o.ONE);d++)m=o.sqr(m);const f=o.pow(l,De<<BigInt(c-d-1));l=o.sqr(f),u=o.mul(u,f),h=o.mul(h,l),c=d}return u}}function ey(t){if(t%Fa===Xw){const e=(t+De)/Fa;return function(s,r){const i=s.pow(r,e);if(!s.eql(s.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%Ll===Dl){const e=(t-Dl)/Ll;return function(s,r){const i=s.mul(r,Zs),n=s.pow(i,e),o=s.mul(r,n),a=s.mul(s.mul(o,Zs),n),c=s.mul(o,s.sub(a,s.ONE));if(!s.eql(s.sqr(c),r))throw new Error("Cannot find square root");return c}}return Qw(t)}const ty=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sy(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},s=ty.reduce((r,i)=>(r[i]="function",r),e);return Ci(t,s)}function ry(t,e,s){if(s<Ye)throw new Error("invalid exponent, negatives unsupported");if(s===Ye)return t.ONE;if(s===De)return e;let r=t.ONE,i=e;for(;s>Ye;)s&De&&(r=t.mul(r,i)),i=t.sqr(i),s>>=De;return r}function iy(t,e){const s=new Array(e.length),r=e.reduce((n,o,a)=>t.is0(o)?n:(s[a]=n,t.mul(n,o)),t.ONE),i=t.inv(r);return e.reduceRight((n,o,a)=>t.is0(o)?n:(s[a]=t.mul(n,s[a]),t.mul(n,o)),i),s}function gd(t,e){const s=e!==void 0?e:t.toString(2).length,r=Math.ceil(s/8);return{nBitLength:s,nByteLength:r}}function md(t,e,s=!1,r={}){if(t<=Ye)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:n}=gd(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:s,BITS:i,BYTES:n,MASK:Tc(i),ZERO:Ye,ONE:De,create:c=>bt(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ye<=c&&c<t},is0:c=>c===Ye,isOdd:c=>(c&De)===De,neg:c=>bt(-c,t),eql:(c,l)=>c===l,sqr:c=>bt(c*c,t),add:(c,l)=>bt(c+l,t),sub:(c,l)=>bt(c-l,t),mul:(c,l)=>bt(c*l,t),pow:(c,l)=>ry(a,c,l),div:(c,l)=>bt(c*za(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>za(c,t),sqrt:r.sqrt||(c=>(o||(o=ey(t)),o(a,c))),invertBatch:c=>iy(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>s?No(c,n):ui(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return s?an(c):ir(c)}});return Object.freeze(a)}function wd(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function yd(t){const e=wd(t);return e+Math.ceil(e/2)}function ny(t,e,s=!1){const r=t.length,i=wd(e),n=yd(e);if(r<16||r<n||r>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+r);const o=s?an(t):ir(t),a=bt(o,e-De)+De;return s?No(a,i):ui(a,i)}const Bl=BigInt(0),Ln=BigInt(1);function Yo(t,e){const s=e.negate();return t?s:e}function bd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Zo(t,e){bd(t,e);const s=Math.ceil(e/t)+1,r=2**(t-1);return{windows:s,windowSize:r}}function oy(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((s,r)=>{if(!(s instanceof e))throw new Error("invalid point at index "+r)})}function ay(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((s,r)=>{if(!e.isValid(s))throw new Error("invalid scalar at index "+r)})}const Xo=new WeakMap,vd=new WeakMap;function Qo(t){return vd.get(t)||1}function cy(t,e){return{constTimeNegate:Yo,hasPrecomputes(s){return Qo(s)!==1},unsafeLadder(s,r,i=t.ZERO){let n=s;for(;r>Bl;)r&Ln&&(i=i.add(n)),n=n.double(),r>>=Ln;return i},precomputeWindow(s,r){const{windows:i,windowSize:n}=Zo(r,e),o=[];let a=s,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(s,r,i){const{windows:n,windowSize:o}=Zo(s,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**s-1),u=2**s,h=BigInt(s);for(let d=0;d<n;d++){const f=d*o;let m=Number(i&l);i>>=h,m>o&&(m-=u,i+=Ln);const g=f,p=f+Math.abs(m)-1,w=d%2!==0,y=m<0;m===0?c=c.add(Yo(w,r[g])):a=a.add(Yo(y,r[p]))}return{p:a,f:c}},wNAFUnsafe(s,r,i,n=t.ZERO){const{windows:o,windowSize:a}=Zo(s,e),c=BigInt(2**s-1),l=2**s,u=BigInt(s);for(let h=0;h<o;h++){const d=h*a;if(i===Bl)break;let f=Number(i&c);if(i>>=u,f>a&&(f-=l,i+=Ln),f===0)continue;let m=r[d+Math.abs(f)-1];f<0&&(m=m.negate()),n=n.add(m)}return n},getPrecomputes(s,r,i){let n=Xo.get(r);return n||(n=this.precomputeWindow(r,s),s!==1&&Xo.set(r,i(n))),n},wNAFCached(s,r,i){const n=Qo(s);return this.wNAF(n,this.getPrecomputes(n,s,i),r)},wNAFCachedUnsafe(s,r,i,n){const o=Qo(s);return o===1?this.unsafeLadder(s,r,n):this.wNAFUnsafe(o,this.getPrecomputes(o,s,i),r,n)},setWindowSize(s,r){bd(r,e),vd.set(s,r),Xo.delete(s)}}}function ly(t,e,s,r){if(oy(s,t),ay(r,e),s.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,n=dd(BigInt(s.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let u=i;for(let h=l;h>=0;h-=o){c.fill(i);for(let f=0;f<r.length;f++){const m=r[f],g=Number(m>>BigInt(h)&BigInt(a));c[g]=c[g].add(s[f])}let d=i;for(let f=c.length-1,m=i;f>0;f--)m=m.add(c[f]),d=d.add(m);if(u=u.add(d),h!==0)for(let f=0;f<o;f++)u=u.double()}return u}function Ed(t){return sy(t.Fp),Ci(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...gd(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Nr=BigInt(0),ea=BigInt(1);function uy(t){return Ci(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function hy(t){const e=uy(t),{P:s}=e,r=y=>bt(y,s),i=e.montgomeryBits,n=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(y=>y),c=e.powPminus2||(y=>fd(y,s-BigInt(2),s));function l(y,C,O){const T=r(y*(C-O));return C=r(C-T),O=r(O+T),[C,O]}const u=(e.a-BigInt(2))/BigInt(4);function h(y,C){Cs("u",y,Nr,s),Cs("scalar",C,Nr,s);const O=C,T=y;let P=ea,N=Nr,$=y,v=ea,k=Nr,S;for(let L=BigInt(i-1);L>=Nr;L--){const E=O>>L&ea;k^=E,S=l(k,P,$),P=S[0],$=S[1],S=l(k,N,v),N=S[0],v=S[1],k=E;const A=P+N,I=r(A*A),x=P-N,U=r(x*x),_=I-U,M=$+v,q=$-v,F=r(q*A),X=r(M*x),G=F+X,oe=F-X;$=r(G*G),v=r(T*r(oe*oe)),P=r(I*U),N=r(_*(I+r(u*_)))}S=l(k,P,$),P=S[0],$=S[1],S=l(k,N,v),N=S[0],v=S[1];const R=c(N);return r(P*R)}function d(y){return No(r(y),n)}function f(y){const C=St("u coordinate",y,n);return o===32&&(C[31]&=127),an(C)}function m(y){const C=St("scalar",y),O=C.length;if(O!==n&&O!==o){let T=""+n+" or "+o;throw new Error("invalid scalar, expected "+T+" bytes, got "+O)}return an(a(C))}function g(y,C){const O=f(C),T=m(y),P=h(O,T);if(P===Nr)throw new Error("invalid private or public key received");return d(P)}const p=d(e.Gu);function w(y){return g(y,p)}return{scalarMult:g,scalarMultBase:w,getSharedSecret:(y,C)=>g(y,C),getPublicKey:y=>w(y),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:p}}const Wa=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const dy=BigInt(1),Ml=BigInt(2),py=BigInt(3),fy=BigInt(5);BigInt(8);function gy(t){const e=BigInt(10),s=BigInt(20),r=BigInt(40),i=BigInt(80),n=Wa,o=t*t%n*t%n,a=Gt(o,Ml,n)*o%n,c=Gt(a,dy,n)*t%n,l=Gt(c,fy,n)*c%n,u=Gt(l,e,n)*l%n,h=Gt(u,s,n)*u%n,d=Gt(h,r,n)*h%n,f=Gt(d,i,n)*d%n,m=Gt(f,i,n)*d%n,g=Gt(m,e,n)*l%n;return{pow_p_5_8:Gt(g,Ml,n)*t%n,b2:o}}function my(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Ha=hy({P:Wa,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=Wa,{pow_p_5_8:s,b2:r}=gy(t);return bt(Gt(s,py,e)*r,e)},adjustScalarBytes:my,randomBytes:Ei});function jl(t){t.lowS!==void 0&&ai("lowS",t.lowS),t.prehash!==void 0&&ai("prehash",t.prehash)}function wy(t){const e=Ed(t);Ci(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:s,Fp:r,a:i}=e;if(s){if(!r.eql(i,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof s!="object"||typeof s.beta!="bigint"||typeof s.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:yy,hexToBytes:by}=Zw;let vy=class extends Error{constructor(e=""){super(e)}};const ys={Err:vy,_tlv:{encode:(t,e)=>{const{Err:s}=ys;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length&1)throw new s("tlv.encode: unpadded data");const r=e.length/2,i=Jr(r);if(i.length/2&128)throw new s("tlv.encode: long form length too big");const n=r>127?Jr(i.length/2|128):"";return Jr(t)+n+i+e},decode(t,e){const{Err:s}=ys;let r=0;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new s("tlv.decode: wrong tlv");const i=e[r++],n=!!(i&128);let o=0;if(!n)o=i;else{const c=i&127;if(!c)throw new s("tlv.decode(long): indefinite length not supported");if(c>4)throw new s("tlv.decode(long): byte length is too big");const l=e.subarray(r,r+c);if(l.length!==c)throw new s("tlv.decode: length bytes not complete");if(l[0]===0)throw new s("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(r+=c,o<128)throw new s("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new s("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=ys;if(t<vs)throw new e("integer: negative integers are not allowed");let s=Jr(t);if(Number.parseInt(s[0],16)&8&&(s="00"+s),s.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return s},decode(t){const{Err:e}=ys;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return yy(t)}},toSig(t){const{Err:e,_int:s,_tlv:r}=ys,i=typeof t=="string"?by(t):t;In(i);const{v:n,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,n),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:s.decode(a),s:s.decode(l)}},hexFromSig(t){const{_tlv:e,_int:s}=ys,r=e.encode(2,s.encode(t.r)),i=e.encode(2,s.encode(t.s)),n=r+i;return e.encode(48,n)}},vs=BigInt(0),We=BigInt(1);BigInt(2);const ql=BigInt(3);BigInt(4);function Ey(t){const e=wy(t),{Fp:s}=e,r=md(e.n,e.nBitLength),i=e.toBytes||((g,p,w)=>{const y=p.toAffine();return cn(Uint8Array.from([4]),s.toBytes(y.x),s.toBytes(y.y))}),n=e.fromBytes||(g=>{const p=g.subarray(1),w=s.fromBytes(p.subarray(0,s.BYTES)),y=s.fromBytes(p.subarray(s.BYTES,2*s.BYTES));return{x:w,y}});function o(g){const{a:p,b:w}=e,y=s.sqr(g),C=s.mul(y,g);return s.add(s.add(C,s.mul(g,p)),w)}if(!s.eql(s.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return _o(g,We,e.n)}function c(g){const{allowedPrivateKeyLengths:p,nByteLength:w,wrapPrivateKey:y,n:C}=e;if(p&&typeof g!="bigint"){if(lr(g)&&(g=ci(g)),typeof g!="string"||!p.includes(g.length))throw new Error("invalid private key");g=g.padStart(w*2,"0")}let O;try{O=typeof g=="bigint"?g:ir(St("private key",g,w))}catch{throw new Error("invalid private key, expected hex or "+w+" bytes, got "+typeof g)}return y&&(O=bt(O,C)),Cs("private key",O,We,C),O}function l(g){if(!(g instanceof d))throw new Error("ProjectivePoint expected")}const u=qa((g,p)=>{const{px:w,py:y,pz:C}=g;if(s.eql(C,s.ONE))return{x:w,y};const O=g.is0();p==null&&(p=O?s.ONE:s.inv(C));const T=s.mul(w,p),P=s.mul(y,p),N=s.mul(C,p);if(O)return{x:s.ZERO,y:s.ZERO};if(!s.eql(N,s.ONE))throw new Error("invZ was invalid");return{x:T,y:P}}),h=qa(g=>{if(g.is0()){if(e.allowInfinityPoint&&!s.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:p,y:w}=g.toAffine();if(!s.isValid(p)||!s.isValid(w))throw new Error("bad point: x or y not FE");const y=s.sqr(w),C=o(p);if(!s.eql(y,C))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(p,w,y){if(this.px=p,this.py=w,this.pz=y,p==null||!s.isValid(p))throw new Error("x required");if(w==null||!s.isValid(w))throw new Error("y required");if(y==null||!s.isValid(y))throw new Error("z required");Object.freeze(this)}static fromAffine(p){const{x:w,y}=p||{};if(!p||!s.isValid(w)||!s.isValid(y))throw new Error("invalid affine point");if(p instanceof d)throw new Error("projective point not allowed");const C=O=>s.eql(O,s.ZERO);return C(w)&&C(y)?d.ZERO:new d(w,y,s.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(p){const w=s.invertBatch(p.map(y=>y.pz));return p.map((y,C)=>y.toAffine(w[C])).map(d.fromAffine)}static fromHex(p){const w=d.fromAffine(n(St("pointHex",p)));return w.assertValidity(),w}static fromPrivateKey(p){return d.BASE.multiply(c(p))}static msm(p,w){return ly(d,r,p,w)}_setWindowSize(p){m.setWindowSize(this,p)}assertValidity(){h(this)}hasEvenY(){const{y:p}=this.toAffine();if(s.isOdd)return!s.isOdd(p);throw new Error("Field doesn't support isOdd")}equals(p){l(p);const{px:w,py:y,pz:C}=this,{px:O,py:T,pz:P}=p,N=s.eql(s.mul(w,P),s.mul(O,C)),$=s.eql(s.mul(y,P),s.mul(T,C));return N&&$}negate(){return new d(this.px,s.neg(this.py),this.pz)}double(){const{a:p,b:w}=e,y=s.mul(w,ql),{px:C,py:O,pz:T}=this;let P=s.ZERO,N=s.ZERO,$=s.ZERO,v=s.mul(C,C),k=s.mul(O,O),S=s.mul(T,T),R=s.mul(C,O);return R=s.add(R,R),$=s.mul(C,T),$=s.add($,$),P=s.mul(p,$),N=s.mul(y,S),N=s.add(P,N),P=s.sub(k,N),N=s.add(k,N),N=s.mul(P,N),P=s.mul(R,P),$=s.mul(y,$),S=s.mul(p,S),R=s.sub(v,S),R=s.mul(p,R),R=s.add(R,$),$=s.add(v,v),v=s.add($,v),v=s.add(v,S),v=s.mul(v,R),N=s.add(N,v),S=s.mul(O,T),S=s.add(S,S),v=s.mul(S,R),P=s.sub(P,v),$=s.mul(S,k),$=s.add($,$),$=s.add($,$),new d(P,N,$)}add(p){l(p);const{px:w,py:y,pz:C}=this,{px:O,py:T,pz:P}=p;let N=s.ZERO,$=s.ZERO,v=s.ZERO;const k=e.a,S=s.mul(e.b,ql);let R=s.mul(w,O),L=s.mul(y,T),E=s.mul(C,P),A=s.add(w,y),I=s.add(O,T);A=s.mul(A,I),I=s.add(R,L),A=s.sub(A,I),I=s.add(w,C);let x=s.add(O,P);return I=s.mul(I,x),x=s.add(R,E),I=s.sub(I,x),x=s.add(y,C),N=s.add(T,P),x=s.mul(x,N),N=s.add(L,E),x=s.sub(x,N),v=s.mul(k,I),N=s.mul(S,E),v=s.add(N,v),N=s.sub(L,v),v=s.add(L,v),$=s.mul(N,v),L=s.add(R,R),L=s.add(L,R),E=s.mul(k,E),I=s.mul(S,I),L=s.add(L,E),E=s.sub(R,E),E=s.mul(k,E),I=s.add(I,E),R=s.mul(L,I),$=s.add($,R),R=s.mul(x,I),N=s.mul(A,N),N=s.sub(N,R),R=s.mul(A,L),v=s.mul(x,v),v=s.add(v,R),new d(N,$,v)}subtract(p){return this.add(p.negate())}is0(){return this.equals(d.ZERO)}wNAF(p){return m.wNAFCached(this,p,d.normalizeZ)}multiplyUnsafe(p){const{endo:w,n:y}=e;Cs("scalar",p,vs,y);const C=d.ZERO;if(p===vs)return C;if(this.is0()||p===We)return this;if(!w||m.hasPrecomputes(this))return m.wNAFCachedUnsafe(this,p,d.normalizeZ);let{k1neg:O,k1:T,k2neg:P,k2:N}=w.splitScalar(p),$=C,v=C,k=this;for(;T>vs||N>vs;)T&We&&($=$.add(k)),N&We&&(v=v.add(k)),k=k.double(),T>>=We,N>>=We;return O&&($=$.negate()),P&&(v=v.negate()),v=new d(s.mul(v.px,w.beta),v.py,v.pz),$.add(v)}multiply(p){const{endo:w,n:y}=e;Cs("scalar",p,We,y);let C,O;if(w){const{k1neg:T,k1:P,k2neg:N,k2:$}=w.splitScalar(p);let{p:v,f:k}=this.wNAF(P),{p:S,f:R}=this.wNAF($);v=m.constTimeNegate(T,v),S=m.constTimeNegate(N,S),S=new d(s.mul(S.px,w.beta),S.py,S.pz),C=v.add(S),O=k.add(R)}else{const{p:T,f:P}=this.wNAF(p);C=T,O=P}return d.normalizeZ([C,O])[0]}multiplyAndAddUnsafe(p,w,y){const C=d.BASE,O=(P,N)=>N===vs||N===We||!P.equals(C)?P.multiplyUnsafe(N):P.multiply(N),T=O(this,w).add(O(p,y));return T.is0()?void 0:T}toAffine(p){return u(this,p)}isTorsionFree(){const{h:p,isTorsionFree:w}=e;if(p===We)return!0;if(w)return w(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:p,clearCofactor:w}=e;return p===We?this:w?w(d,this):this.multiplyUnsafe(e.h)}toRawBytes(p=!0){return ai("isCompressed",p),this.assertValidity(),i(d,this,p)}toHex(p=!0){return ai("isCompressed",p),ci(this.toRawBytes(p))}}d.BASE=new d(e.Gx,e.Gy,s.ONE),d.ZERO=new d(s.ZERO,s.ONE,s.ZERO);const f=e.nBitLength,m=cy(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function Cy(t){const e=Ed(t);return Ci(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Iy(t){const e=Cy(t),{Fp:s,n:r}=e,i=s.BYTES+1,n=2*s.BYTES+1;function o(E){return bt(E,r)}function a(E){return za(E,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:h}=Ey({...e,toBytes(E,A,I){const x=A.toAffine(),U=s.toBytes(x.x),_=cn;return ai("isCompressed",I),I?_(Uint8Array.from([A.hasEvenY()?2:3]),U):_(Uint8Array.from([4]),U,s.toBytes(x.y))},fromBytes(E){const A=E.length,I=E[0],x=E.subarray(1);if(A===i&&(I===2||I===3)){const U=ir(x);if(!_o(U,We,s.ORDER))throw new Error("Point is not on curve");const _=u(U);let M;try{M=s.sqrt(_)}catch(F){const X=F instanceof Error?": "+F.message:"";throw new Error("Point is not on curve"+X)}const q=(M&We)===We;return(I&1)===1!==q&&(M=s.neg(M)),{x:U,y:M}}else if(A===n&&I===4){const U=s.fromBytes(x.subarray(0,s.BYTES)),_=s.fromBytes(x.subarray(s.BYTES,2*s.BYTES));return{x:U,y:_}}else{const U=i,_=n;throw new Error("invalid Point, expected length of "+U+", or uncompressed "+_+", got "+A)}}}),d=E=>ci(ui(E,e.nByteLength));function f(E){const A=r>>We;return E>A}function m(E){return f(E)?o(-E):E}const g=(E,A,I)=>ir(E.slice(A,I));class p{constructor(A,I,x){this.r=A,this.s=I,this.recovery=x,this.assertValidity()}static fromCompact(A){const I=e.nByteLength;return A=St("compactSignature",A,I*2),new p(g(A,0,I),g(A,I,2*I))}static fromDER(A){const{r:I,s:x}=ys.toSig(St("DER",A));return new p(I,x)}assertValidity(){Cs("r",this.r,We,r),Cs("s",this.s,We,r)}addRecoveryBit(A){return new p(this.r,this.s,A)}recoverPublicKey(A){const{r:I,s:x,recovery:U}=this,_=P(St("msgHash",A));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const M=U===2||U===3?I+e.n:I;if(M>=s.ORDER)throw new Error("recovery id 2 or 3 invalid");const q=(U&1)===0?"02":"03",F=c.fromHex(q+d(M)),X=a(M),G=o(-_*X),oe=o(x*X),le=c.BASE.multiplyAndAddUnsafe(F,G,oe);if(!le)throw new Error("point at infinify");return le.assertValidity(),le}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new p(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return li(this.toDERHex())}toDERHex(){return ys.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return li(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const w={isValidPrivateKey(E){try{return l(E),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const E=yd(e.n);return ny(e.randomBytes(E),e.n)},precompute(E=8,A=c.BASE){return A._setWindowSize(E),A.multiply(BigInt(3)),A}};function y(E,A=!0){return c.fromPrivateKey(E).toRawBytes(A)}function C(E){const A=lr(E),I=typeof E=="string",x=(A||I)&&E.length;return A?x===i||x===n:I?x===2*i||x===2*n:E instanceof c}function O(E,A,I=!0){if(C(E))throw new Error("first arg must be private key");if(!C(A))throw new Error("second arg must be public key");return c.fromHex(A).multiply(l(E)).toRawBytes(I)}const T=e.bits2int||function(E){if(E.length>8192)throw new Error("input is too large");const A=ir(E),I=E.length*8-e.nBitLength;return I>0?A>>BigInt(I):A},P=e.bits2int_modN||function(E){return o(T(E))},N=Tc(e.nBitLength);function $(E){return Cs("num < 2^"+e.nBitLength,E,vs,N),ui(E,e.nByteLength)}function v(E,A,I=k){if(["recovered","canonical"].some(ue=>ue in I))throw new Error("sign() legacy options not supported");const{hash:x,randomBytes:U}=e;let{lowS:_,prehash:M,extraEntropy:q}=I;_==null&&(_=!0),E=St("msgHash",E),jl(I),M&&(E=St("prehashed msgHash",x(E)));const F=P(E),X=l(A),G=[$(X),$(F)];if(q!=null&&q!==!1){const ue=q===!0?U(s.BYTES):q;G.push(St("extraEntropy",ue))}const oe=cn(...G),le=F;function Ie(ue){const he=T(ue);if(!h(he))return;const zt=a(he),ct=c.BASE.multiply(he).toAffine(),je=o(ct.x);if(je===vs)return;const Xe=o(zt*o(le+je*X));if(Xe===vs)return;let us=(ct.x===je?0:2)|Number(ct.y&We),Ws=Xe;return _&&f(Xe)&&(Ws=m(Xe),us^=1),new p(je,Ws,us)}return{seed:oe,k2sig:Ie}}const k={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};function R(E,A,I=k){const{seed:x,k2sig:U}=v(E,A,I),_=e;return pd(_.hash.outputLen,_.nByteLength,_.hmac)(x,U)}c.BASE._setWindowSize(8);function L(E,A,I,x=S){const U=E;A=St("msgHash",A),I=St("publicKey",I);const{lowS:_,prehash:M,format:q}=x;if(jl(x),"strict"in x)throw new Error("options.strict was renamed to lowS");if(q!==void 0&&q!=="compact"&&q!=="der")throw new Error("format must be compact or der");const F=typeof U=="string"||lr(U),X=!F&&!q&&typeof U=="object"&&U!==null&&typeof U.r=="bigint"&&typeof U.s=="bigint";if(!F&&!X)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let G,oe;try{if(X&&(G=new p(U.r,U.s)),F){try{q!=="compact"&&(G=p.fromDER(U))}catch(Xe){if(!(Xe instanceof ys.Err))throw Xe}!G&&q!=="der"&&(G=p.fromCompact(U))}oe=c.fromHex(I)}catch{return!1}if(!G||_&&G.hasHighS())return!1;M&&(A=e.hash(A));const{r:le,s:Ie}=G,ue=P(A),he=a(Ie),zt=o(ue*he),ct=o(le*he),je=c.BASE.multiplyAndAddUnsafe(oe,zt,ct)?.toAffine();return je?o(je.x)===le:!1}return{CURVE:e,getPublicKey:y,getSharedSecret:O,sign:R,verify:L,ProjectivePoint:c,Signature:p,utils:w}}function Ay(t){return{hash:t,hmac:(e,...s)=>Co(t,e,Qm(...s)),randomBytes:Ei}}function Ny(t,e){const s=r=>Iy({...t,...Ay(r)});return{...s(e),create:s}}const Cd=md(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),_y=Cd.create(BigInt("-3")),Sy=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Py=Ny({a:_y,b:Sy,Fp:Cd,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Cn),Id="base10",ut="base16",nr="base64pad",kc="base64url",An="utf8",Ad=0,Ii=1,So=2,Oy=0,Fl=1,Xi=12,xc=32;function $y(){const t=Ha.utils.randomPrivateKey(),e=Ha.getPublicKey(t);return{privateKey:nt(t,ut),publicKey:nt(e,ut)}}function Va(){const t=Ei(xc);return nt(t,ut)}function Ty(t,e){const s=Ha.getSharedSecret(Ct(t,ut),Ct(e,ut)),r=Uw(Cn,s,void 0,void 0,xc);return nt(r,ut)}function ky(t){const e=Cn(Ct(t,ut));return nt(e,ut)}function Xn(t){const e=Cn(Ct(t,An));return nt(e,ut)}function Nd(t){return Ct(`${t}`,Id)}function ur(t){return Number(nt(t,Id))}function _d(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Sd(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),s=(4-e.length%4)%4;return e+"=".repeat(s)}function xy(t){const e=Nd(typeof t.type<"u"?t.type:Ad);if(ur(e)===Ii&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const s=typeof t.senderPublicKey<"u"?Ct(t.senderPublicKey,ut):void 0,r=typeof t.iv<"u"?Ct(t.iv,ut):Ei(Xi),i=Ct(t.symKey,ut),n=ud(i,r).encrypt(Ct(t.message,An)),o=Pd({type:e,sealed:n,iv:r,senderPublicKey:s});return t.encoding===kc?_d(o):o}function Ry(t){const e=Ct(t.symKey,ut),{sealed:s,iv:r}=ln({encoded:t.encoded,encoding:t.encoding}),i=ud(e,r).decrypt(s);if(i===null)throw new Error("Failed to decrypt");return nt(i,An)}function Uy(t,e){const s=Nd(So),r=Ei(Xi),i=Ct(t,An),n=Pd({type:s,sealed:i,iv:r});return e===kc?_d(n):n}function Dy(t,e){const{sealed:s}=ln({encoded:t,encoding:e});return nt(s,An)}function Pd(t){if(ur(t.type)===So)return nt(Ki([t.type,t.sealed]),nr);if(ur(t.type)===Ii){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return nt(Ki([t.type,t.senderPublicKey,t.iv,t.sealed]),nr)}return nt(Ki([t.type,t.iv,t.sealed]),nr)}function ln(t){const e=(t.encoding||nr)===kc?Sd(t.encoded):t.encoded,s=Ct(e,nr),r=s.slice(Oy,Fl),i=Fl;if(ur(r)===Ii){const c=i+xc,l=c+Xi,u=s.slice(i,c),h=s.slice(c,l),d=s.slice(l);return{type:r,sealed:d,iv:h,senderPublicKey:u}}if(ur(r)===So){const c=s.slice(i),l=Ei(Xi);return{type:r,sealed:c,iv:l}}const n=i+Xi,o=s.slice(i,n),a=s.slice(n);return{type:r,sealed:a,iv:o}}function Ly(t,e){const s=ln({encoded:t,encoding:e?.encoding});return Od({type:ur(s.type),senderPublicKey:typeof s.senderPublicKey<"u"?nt(s.senderPublicKey,ut):void 0,receiverPublicKey:e?.receiverPublicKey})}function Od(t){const e=t?.type||Ad;if(e===Ii){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function zl(t){return t.type===Ii&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Wl(t){return t.type===So}function By(t){const e=Buffer.from(t.x,"base64"),s=Buffer.from(t.y,"base64");return Ki([new Uint8Array([4]),e,s])}function My(t,e){const[s,r,i]=t.split("."),n=Buffer.from(Sd(i),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${s}.${r}`,l=Cn(c),u=By(e);if(!Py.verify(Ki([o,a]),l,u))throw new Error("Invalid signature");return $a(t).payload}const jy="irn";function uo(t){return t?.relay||{protocol:jy}}function zi(t){const e=ff[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function qy(t,e="-"){const s={},r="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(r)){const n=i.replace(r,""),o=t[i];s[n]=o}}),s}function Hl(t){if(!t.includes("wc:")){const l=ed(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),s=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),i=t.substring(e+1,s).split("@"),n=typeof s<"u"?t.substring(s):"",o=new URLSearchParams(n),a={};o.forEach((l,u)=>{a[u]=l});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:Fy(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:qy(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function Fy(t){return t.startsWith("//")?t.substring(2):t}function zy(t,e="-"){const s="relay",r={};return Object.keys(t).forEach(i=>{const n=i,o=s+e+n;t[n]&&(r[o]=t[n])}),r}function Vl(t){const e=new URLSearchParams,s=zy(t.relay);Object.keys(s).sort().forEach(i=>{e.set(i,s[i])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const r=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${r}`}const Wy={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Hy={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function be(t,e){const{message:s,code:r}=Hy[t];return{message:e?`${s} ${e}`:s,code:r}}function Wi(t,e){const{message:s,code:r}=Wy[t];return{message:e?`${s} ${e}`:s,code:r}}function Ka(t){return typeof t>"u"}function $d(t,e){return typeof t=="string"&&!!t.trim().length}function Vy(t){function e(s){try{return typeof new URL(s)<"u"}catch{return!1}}try{if($d(t,!1)){if(e(t))return!0;const s=ed(t);return e(s)}}catch{}return!1}function Ky(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function Gy(t){return t?.topic}function ta(t){return typeof t<"u"&&typeof t!==null}function Kl(){const t=Eo();return new Promise(e=>{switch(t){case Xt.browser:e(Jy());break;case Xt.reactNative:e(Yy());break;case Xt.node:e(Zy());break;default:e(!0)}})}function Jy(){return vn()&&navigator?.onLine}async function Yy(){return br()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function Zy(){return!0}function Xy(t){switch(Eo()){case Xt.browser:Qy(t);break;case Xt.reactNative:eb(t);break}}function Qy(t){!br()&&vn()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function eb(t){br()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function tb(){var t;return vn()&&Tt.getDocument()?((t=Tt.getDocument())==null?void 0:t.visibilityState)==="visible":!0}var sb={};const Td="wc",kd=2,Ga="core",ls=`${Td}@2:${Ga}:`,rb={logger:"error"},ib={database:":memory:"},nb="crypto",Gl="client_ed25519_seed",ob=j.ONE_DAY,ab="keychain",cb="0.3",lb="messages",ub="0.3",Jl=j.SIX_HOURS,hb="publisher",xd="irn",db="error",Rd="wss://relay.walletconnect.org",pb="relayer",Ke={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},fb="_subscription",Lt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},gb=.1,Ja="2.21.0",Te={link_mode:"link_mode",relay:"relay"},Qn={inbound:"inbound",outbound:"outbound"},mb="0.3",wb="WALLETCONNECT_CLIENT_ID",Yl="WALLETCONNECT_LINK_MODE_APPS",Nt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},yb="subscription",bb="0.3",vb="pairing",Eb="0.3",ki={wc_pairingDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:j.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:j.ONE_DAY,prompt:!1,tag:0},res:{ttl:j.ONE_DAY,prompt:!1,tag:0}}},Xs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Wt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Cb="history",Ib="0.3",Ab="expirer",jt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Nb="0.3",_b="verify-api",Sb="https://verify.walletconnect.com",Ud="https://verify.walletconnect.org",Qi=Ud,Pb=`${Qi}/v3`,Ob=[Sb,Ud],$b="echo",Tb="https://echo.walletconnect.com",is={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},ws={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Ht={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Vs={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Ks={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},xi={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},kb=.1,xb="event-client",Rb=86400,Ub="https://pulse.walletconnect.org/batch";function Db(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),r=0;r<s.length;r++)s[r]=255;for(var i=0;i<t.length;i++){var n=t.charAt(i),o=n.charCodeAt(0);if(s[o]!==255)throw new TypeError(n+" is ambiguous");s[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var g=0,p=0,w=0,y=m.length;w!==y&&m[w]===0;)w++,g++;for(var C=(y-w)*u+1>>>0,O=new Uint8Array(C);w!==y;){for(var T=m[w],P=0,N=C-1;(T!==0||P<p)&&N!==-1;N--,P++)T+=256*O[N]>>>0,O[N]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");p=P,w++}for(var $=C-p;$!==C&&O[$]===0;)$++;for(var v=c.repeat(g);$<C;++$)v+=t.charAt(O[$]);return v}function d(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var g=0;if(m[g]!==" "){for(var p=0,w=0;m[g]===c;)p++,g++;for(var y=(m.length-g)*l+1>>>0,C=new Uint8Array(y);m[g];){var O=s[m.charCodeAt(g)];if(O===255)return;for(var T=0,P=y-1;(O!==0||T<w)&&P!==-1;P--,T++)O+=a*C[P]>>>0,C[P]=O%256>>>0,O=O/256>>>0;if(O!==0)throw new Error("Non-zero carry");w=T,g++}if(m[g]!==" "){for(var N=y-w;N!==y&&C[N]===0;)N++;for(var $=new Uint8Array(p+(y-N)),v=p;N!==y;)$[v++]=C[N++];return $}}}function f(m){var g=d(m);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var Lb=Db,Bb=Lb;const Dd=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Mb=t=>new TextEncoder().encode(t),jb=t=>new TextDecoder().decode(t);let qb=class{constructor(e,s,r){this.name=e,this.prefix=s,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Fb=class{constructor(e,s,r){if(this.name=e,this.prefix=s,s.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ld(this,e)}},zb=class{constructor(e){this.decoders=e}or(e){return Ld(this,e)}decode(e){const s=e[0],r=this.decoders[s];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Ld=(t,e)=>new zb({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let Wb=class{constructor(e,s,r,i){this.name=e,this.prefix=s,this.baseEncode=r,this.baseDecode=i,this.encoder=new qb(e,s,r),this.decoder=new Fb(e,s,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Po=({name:t,prefix:e,encode:s,decode:r})=>new Wb(t,e,s,r),Nn=({prefix:t,name:e,alphabet:s})=>{const{encode:r,decode:i}=Bb(s,e);return Po({prefix:t,name:e,encode:r,decode:n=>Dd(i(n))})},Hb=(t,e,s,r)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*s/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=i[t[u]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<s|h,a+=s,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=s||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Vb=(t,e,s)=>{const r=e[e.length-1]==="=",i=(1<<s)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>s;)o-=s,n+=e[i&a>>o];if(o&&(n+=e[i&a<<s-o]),r)for(;n.length*s&7;)n+="=";return n},rt=({name:t,prefix:e,bitsPerChar:s,alphabet:r})=>Po({prefix:e,name:t,encode(i){return Vb(i,r,s)},decode(i){return Hb(i,r,s,t)}}),Kb=Po({prefix:"\0",name:"identity",encode:t=>jb(t),decode:t=>Mb(t)});var Gb=Object.freeze({__proto__:null,identity:Kb});const Jb=rt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Yb=Object.freeze({__proto__:null,base2:Jb});const Zb=rt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Xb=Object.freeze({__proto__:null,base8:Zb});const Qb=Nn({prefix:"9",name:"base10",alphabet:"0123456789"});var e0=Object.freeze({__proto__:null,base10:Qb});const t0=rt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),s0=rt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var r0=Object.freeze({__proto__:null,base16:t0,base16upper:s0});const i0=rt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),n0=rt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),o0=rt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),a0=rt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),c0=rt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),l0=rt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),u0=rt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),h0=rt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),d0=rt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var p0=Object.freeze({__proto__:null,base32:i0,base32upper:n0,base32pad:o0,base32padupper:a0,base32hex:c0,base32hexupper:l0,base32hexpad:u0,base32hexpadupper:h0,base32z:d0});const f0=Nn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),g0=Nn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var m0=Object.freeze({__proto__:null,base36:f0,base36upper:g0});const w0=Nn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),y0=Nn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var b0=Object.freeze({__proto__:null,base58btc:w0,base58flickr:y0});const v0=rt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),E0=rt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),C0=rt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),I0=rt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var A0=Object.freeze({__proto__:null,base64:v0,base64pad:E0,base64url:C0,base64urlpad:I0});const Bd=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),N0=Bd.reduce((t,e,s)=>(t[s]=e,t),[]),_0=Bd.reduce((t,e,s)=>(t[e.codePointAt(0)]=s,t),[]);function S0(t){return t.reduce((e,s)=>(e+=N0[s],e),"")}function P0(t){const e=[];for(const s of t){const r=_0[s.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${s}`);e.push(r)}return new Uint8Array(e)}const O0=Po({prefix:"🚀",name:"base256emoji",encode:S0,decode:P0});var $0=Object.freeze({__proto__:null,base256emoji:O0}),T0=Md,Zl=128,k0=-128,x0=Math.pow(2,31);function Md(t,e,s){e=e||[],s=s||0;for(var r=s;t>=x0;)e[s++]=t&255|Zl,t/=128;for(;t&k0;)e[s++]=t&255|Zl,t>>>=7;return e[s]=t|0,Md.bytes=s-r+1,e}var R0=Ya,U0=128,Xl=127;function Ya(t,r){var s=0,r=r||0,i=0,n=r,o,a=t.length;do{if(n>=a)throw Ya.bytes=0,new RangeError("Could not decode varint");o=t[n++],s+=i<28?(o&Xl)<<i:(o&Xl)*Math.pow(2,i),i+=7}while(o>=U0);return Ya.bytes=n-r,s}var D0=Math.pow(2,7),L0=Math.pow(2,14),B0=Math.pow(2,21),M0=Math.pow(2,28),j0=Math.pow(2,35),q0=Math.pow(2,42),F0=Math.pow(2,49),z0=Math.pow(2,56),W0=Math.pow(2,63),H0=function(t){return t<D0?1:t<L0?2:t<B0?3:t<M0?4:t<j0?5:t<q0?6:t<F0?7:t<z0?8:t<W0?9:10},V0={encode:T0,decode:R0,encodingLength:H0},jd=V0;const Ql=(t,e,s=0)=>(jd.encode(t,e,s),e),eu=t=>jd.encodingLength(t),Za=(t,e)=>{const s=e.byteLength,r=eu(t),i=r+eu(s),n=new Uint8Array(i+s);return Ql(t,n,0),Ql(s,n,r),n.set(e,i),new K0(t,s,e,n)};let K0=class{constructor(e,s,r,i){this.code=e,this.size=s,this.digest=r,this.bytes=i}};const qd=({name:t,code:e,encode:s})=>new G0(t,e,s);class G0{constructor(e,s,r){this.name=e,this.code=s,this.encode=r}digest(e){if(e instanceof Uint8Array){const s=this.encode(e);return s instanceof Uint8Array?Za(this.code,s):s.then(r=>Za(this.code,r))}else throw Error("Unknown type, must be binary type")}}const Fd=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),J0=qd({name:"sha2-256",code:18,encode:Fd("SHA-256")}),Y0=qd({name:"sha2-512",code:19,encode:Fd("SHA-512")});var Z0=Object.freeze({__proto__:null,sha256:J0,sha512:Y0});const zd=0,X0="identity",Wd=Dd,Q0=t=>Za(zd,Wd(t)),ev={code:zd,name:X0,encode:Wd,digest:Q0};var tv=Object.freeze({__proto__:null,identity:ev});new TextEncoder,new TextDecoder;const tu={...Gb,...Yb,...Xb,...e0,...r0,...p0,...m0,...b0,...A0,...$0};({...Z0,...tv});function sv(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Hd(t,e,s,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:s},decoder:{decode:r}}}const su=Hd("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),sa=Hd("ascii","a",t=>{let e="a";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},t=>{t=t.substring(1);const e=sv(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}),rv={utf8:su,"utf-8":su,hex:tu.base16,latin1:sa,ascii:sa,binary:sa,...tu};function iv(t,e="utf8"){const s=rv[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):s.decoder.decode(`${s.prefix}${t}`)}var nv=Object.defineProperty,ov=(t,e,s)=>e in t?nv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ts=(t,e,s)=>ov(t,typeof e!="symbol"?e+"":e,s);let av=class{constructor(e,s){this.core=e,this.logger=s,ts(this,"keychain",new Map),ts(this,"name",ab),ts(this,"version",cb),ts(this,"initialized",!1),ts(this,"storagePrefix",ls),ts(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),ts(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),ts(this,"set",async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()}),ts(this,"get",r=>{this.isInitialized();const i=this.keychain.get(r);if(typeof i>"u"){const{message:n}=be("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}),ts(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=ht(s,this.name)}get context(){return xt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Da(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?La(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var cv=Object.defineProperty,lv=(t,e,s)=>e in t?cv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,et=(t,e,s)=>lv(t,typeof e!="symbol"?e+"":e,s);let uv=class{constructor(e,s,r){this.core=e,this.logger=s,et(this,"name",nb),et(this,"keychain"),et(this,"randomSessionIdentifier",Va()),et(this,"initialized",!1),et(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),et(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),et(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),n=Xc(i);return yf(n.publicKey)}),et(this,"generateKeyPair",()=>{this.isInitialized();const i=$y();return this.setPrivateKey(i.publicKey,i.privateKey)}),et(this,"signJWT",async i=>{this.isInitialized();const n=await this.getClientSeed(),o=Xc(n),a=this.randomSessionIdentifier;return await bf(a,i,ob,o)}),et(this,"generateSharedKey",(i,n,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=Ty(a,n);return this.setSymKey(c,o)}),et(this,"setSymKey",async(i,n)=>{this.isInitialized();const o=n||ky(i);return await this.keychain.set(o,i),o}),et(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),et(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),et(this,"encode",async(i,n,o)=>{this.isInitialized();const a=Od(o),c=Cc(n);if(Wl(a))return Uy(c,o?.encoding);if(zl(a)){const d=a.senderPublicKey,f=a.receiverPublicKey;i=await this.generateSharedKey(d,f)}const l=this.getSymKey(i),{type:u,senderPublicKey:h}=a;return xy({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o?.encoding})}),et(this,"decode",async(i,n,o)=>{this.isInitialized();const a=Ly(n,o);if(Wl(a)){const c=Dy(n,o?.encoding);return oo(c)}if(zl(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;i=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(i),l=Ry({symKey:c,encoded:n,encoding:o?.encoding});return oo(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),et(this,"getPayloadType",(i,n=nr)=>{const o=ln({encoded:i,encoding:n});return ur(o.type)}),et(this,"getPayloadSenderPublicKey",(i,n=nr)=>{const o=ln({encoded:i,encoding:n});return o.senderPublicKey?nt(o.senderPublicKey,ut):void 0}),this.core=e,this.logger=ht(s,this.name),this.keychain=r||new av(this.core,this.logger)}get context(){return xt(this.logger)}async setPrivateKey(e,s){return await this.keychain.set(e,s),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Gl)}catch{e=Va(),await this.keychain.set(Gl,e)}return iv(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var hv=Object.defineProperty,dv=Object.defineProperties,pv=Object.getOwnPropertyDescriptors,ru=Object.getOwnPropertySymbols,fv=Object.prototype.hasOwnProperty,gv=Object.prototype.propertyIsEnumerable,Xa=(t,e,s)=>e in t?hv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,mv=(t,e)=>{for(var s in e||(e={}))fv.call(e,s)&&Xa(t,s,e[s]);if(ru)for(var s of ru(e))gv.call(e,s)&&Xa(t,s,e[s]);return t},wv=(t,e)=>dv(t,pv(e)),At=(t,e,s)=>Xa(t,typeof e!="symbol"?e+"":e,s);let yv=class extends Yg{constructor(e,s){super(e,s),this.logger=e,this.core=s,At(this,"messages",new Map),At(this,"messagesWithoutClientAck",new Map),At(this,"name",lb),At(this,"version",ub),At(this,"initialized",!1),At(this,"storagePrefix",ls),At(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),At(this,"set",async(r,i,n)=>{this.isInitialized();const o=Xn(i);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(r,a),n===Qn.inbound){const c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,wv(mv({},c),{[o]:i}))}return await this.persist(),o}),At(this,"get",r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i}),At(this,"getWithoutAck",r=>{this.isInitialized();const i={};for(const n of r){const o=this.messagesWithoutClientAck.get(n)||{};i[n]=Object.values(o)}return i}),At(this,"has",(r,i)=>{this.isInitialized();const n=this.get(r),o=Xn(i);return typeof n[o]<"u"}),At(this,"ack",async(r,i)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(r);if(typeof n>"u")return;const o=Xn(i);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,n),await this.persist()}),At(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=ht(e,this.name),this.core=s}get context(){return xt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Da(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Da(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?La(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?La(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var bv=Object.defineProperty,vv=Object.defineProperties,Ev=Object.getOwnPropertyDescriptors,iu=Object.getOwnPropertySymbols,Cv=Object.prototype.hasOwnProperty,Iv=Object.prototype.propertyIsEnumerable,Qa=(t,e,s)=>e in t?bv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Bn=(t,e)=>{for(var s in e||(e={}))Cv.call(e,s)&&Qa(t,s,e[s]);if(iu)for(var s of iu(e))Iv.call(e,s)&&Qa(t,s,e[s]);return t},ra=(t,e)=>vv(t,Ev(e)),Vt=(t,e,s)=>Qa(t,typeof e!="symbol"?e+"":e,s);class Av extends Zg{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,Vt(this,"events",new gr.EventEmitter),Vt(this,"name",hb),Vt(this,"queue",new Map),Vt(this,"publishTimeout",j.toMiliseconds(j.ONE_MINUTE)),Vt(this,"initialPublishTimeout",j.toMiliseconds(j.ONE_SECOND*15)),Vt(this,"needsTransportRestart",!1),Vt(this,"publish",async(r,i,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:n}});const a=n?.ttl||Jl,c=uo(n),l=n?.prompt||!1,u=n?.tag||0,h=n?.id||Gr().toString(),d={topic:r,message:i,opts:{ttl:a,relay:c,prompt:l,tag:u,id:h,attestation:n?.attestation,tvf:n?.tvf}},f=`Failed to publish payload, please try again. id:${h} tag:${u}`;try{const m=new Promise(async g=>{const p=({id:y})=>{d.opts.id===y&&(this.removeRequestFromQueue(y),this.relayer.events.removeListener(Ke.publish,p),g(d))};this.relayer.events.on(Ke.publish,p);const w=Ds(new Promise((y,C)=>{this.rpcPublish({topic:r,message:i,ttl:a,prompt:l,tag:u,id:h,attestation:n?.attestation,tvf:n?.tvf}).then(y).catch(O=>{this.logger.warn(O,O?.message),C(O)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${h} tag:${u}`);try{await w,this.events.removeListener(Ke.publish,p)}catch(y){this.queue.set(h,ra(Bn({},d),{attempt:1})),this.logger.warn(y,y?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:h,topic:r,message:i,opts:n}}),await Ds(m,this.publishTimeout,f)}catch(m){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(m),(o=n?.internal)!=null&&o.throwOnFailedPublish)throw m}finally{this.queue.delete(h)}}),Vt(this,"on",(r,i)=>{this.events.on(r,i)}),Vt(this,"once",(r,i)=>{this.events.once(r,i)}),Vt(this,"off",(r,i)=>{this.events.off(r,i)}),Vt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.relayer=e,this.logger=ht(s,this.name),this.registerEventListeners()}get context(){return xt(this.logger)}async rpcPublish(e){var s,r,i,n;const{topic:o,message:a,ttl:c=Jl,prompt:l,tag:u,id:h,attestation:d,tvf:f}=e,m={method:zi(uo().protocol).publish,params:Bn({topic:o,message:a,ttl:c,prompt:l,tag:u,attestation:d},f),id:h};Ka((s=m.params)==null?void 0:s.prompt)&&((r=m.params)==null||delete r.prompt),Ka((i=m.params)==null?void 0:i.tag)&&((n=m.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:m});const g=await this.relayer.request(m);return this.relayer.events.emit(Ke.publish,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,s)=>{const r=e.attempt+1;this.queue.set(s,ra(Bn({},e),{attempt:r}));const{topic:i,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${r}`),await this.rpcPublish(ra(Bn({},e),{topic:i,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(vi.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ke.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ke.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var Nv=Object.defineProperty,_v=(t,e,s)=>e in t?Nv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,_r=(t,e,s)=>_v(t,typeof e!="symbol"?e+"":e,s);class Sv{constructor(){_r(this,"map",new Map),_r(this,"set",(e,s)=>{const r=this.get(e);this.exists(e,s)||this.map.set(e,[...r,s])}),_r(this,"get",e=>this.map.get(e)||[]),_r(this,"exists",(e,s)=>this.get(e).includes(s)),_r(this,"delete",(e,s)=>{if(typeof s>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,s))return;const i=r.filter(n=>n!==s);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),_r(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var Pv=Object.defineProperty,Ov=Object.defineProperties,$v=Object.getOwnPropertyDescriptors,nu=Object.getOwnPropertySymbols,Tv=Object.prototype.hasOwnProperty,kv=Object.prototype.propertyIsEnumerable,ec=(t,e,s)=>e in t?Pv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ri=(t,e)=>{for(var s in e||(e={}))Tv.call(e,s)&&ec(t,s,e[s]);if(nu)for(var s of nu(e))kv.call(e,s)&&ec(t,s,e[s]);return t},ia=(t,e)=>Ov(t,$v(e)),Ae=(t,e,s)=>ec(t,typeof e!="symbol"?e+"":e,s);let xv=class extends em{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,Ae(this,"subscriptions",new Map),Ae(this,"topicMap",new Sv),Ae(this,"events",new gr.EventEmitter),Ae(this,"name",yb),Ae(this,"version",bb),Ae(this,"pending",new Map),Ae(this,"cached",[]),Ae(this,"initialized",!1),Ae(this,"storagePrefix",ls),Ae(this,"subscribeTimeout",j.toMiliseconds(j.ONE_MINUTE)),Ae(this,"initialSubscribeTimeout",j.toMiliseconds(j.ONE_SECOND*15)),Ae(this,"clientId"),Ae(this,"batchSubscribeTopicsLimit",500),Ae(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Ae(this,"subscribe",async(r,i)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{const n=uo(i),o={topic:r,relay:n,transportType:i?.transportType};this.pending.set(r,o);const a=await this.rpcSubscribe(r,n,i);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),Ae(this,"unsubscribe",async(r,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)}),Ae(this,"isSubscribed",r=>new Promise(i=>{i(this.topicMap.topics.includes(r))})),Ae(this,"isKnownTopic",r=>new Promise(i=>{i(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(n=>n.topic===r))})),Ae(this,"on",(r,i)=>{this.events.on(r,i)}),Ae(this,"once",(r,i)=>{this.events.once(r,i)}),Ae(this,"off",(r,i)=>{this.events.off(r,i)}),Ae(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),Ae(this,"start",async()=>{await this.onConnect()}),Ae(this,"stop",async()=>{await this.onDisconnect()}),Ae(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Ae(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}),Ae(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(vi.pulse,async()=>{await this.checkPending()}),this.events.on(Nt.created,async r=>{const i=Nt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(Nt.deleted,async r=>{const i=Nt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}),this.relayer=e,this.logger=ht(s,this.name),this.clientId=""}get context(){return xt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,s){let r=!1;try{r=this.getSubscription(e).topic===s}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,s){const r=this.topicMap.get(e);await Promise.all(r.map(async i=>await this.unsubscribeById(e,i,s)))}async unsubscribeById(e,s,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:r}});try{const i=uo(r);await this.restartToComplete({topic:e,id:s,relay:i}),await this.rpcUnsubscribe(e,s,i);const n=Wi("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,s,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,s,r){var i;(!r||r?.transportType===Te.relay)&&await this.restartToComplete({topic:e,id:e,relay:s});const n={method:zi(s.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const o=(i=r?.internal)==null?void 0:i.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if(r?.transportType===Te.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(u=>this.logger.warn(u))},j.toMiliseconds(j.ONE_SECOND)),a;const c=new Promise(async u=>{const h=d=>{d.topic===e&&(this.events.removeListener(Nt.created,h),u(d.id))};this.events.on(Nt.created,h);try{const d=await Ds(new Promise((f,m)=>{this.relayer.request(n).catch(g=>{this.logger.warn(g,g?.message),m(g)}).then(f)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Nt.created,h),u(d)}catch{}}),l=await Ds(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return l?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ke.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const s=e[0].relay,r={method:zi(s.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await Ds(new Promise(i=>{this.relayer.request(r).catch(n=>this.logger.warn(n)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Ke.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const s=e[0].relay,r={method:zi(s.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let i;try{i=await await Ds(new Promise((n,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Ke.connection_stalled)}return i}rpcUnsubscribe(e,s,r){const i={method:zi(r.protocol).unsubscribe,params:{topic:e,id:s}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,s){this.setSubscription(e,ia(Ri({},s),{id:e})),this.pending.delete(s.topic)}onBatchSubscribe(e){e.length&&e.forEach(s=>{this.setSubscription(s.id,Ri({},s)),this.pending.delete(s.topic)})}async onUnsubscribe(e,s,r){this.events.removeAllListeners(s),this.hasSubscription(s,e)&&this.deleteSubscription(s,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,s){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:s}),this.addSubscription(e,s)}addSubscription(e,s){this.subscriptions.set(e,Ri({},s)),this.topicMap.set(s.topic,e),this.events.emit(Nt.created,s)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const s=this.subscriptions.get(e);if(!s){const{message:r}=be("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return s}deleteSubscription(e,s){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:s});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Nt.deleted,ia(Ri({},r),{reason:s}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Nt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],s=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<s;r++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Nt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:s}=be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async s=>ia(Ri({},s),{id:await this.getSubscriptionId(s.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const s=await this.rpcBatchFetchMessages(e);s&&s.messages&&(await Fm(j.toMiliseconds(j.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(s.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Xn(e+await this.getClientId())}};var Rv=Object.defineProperty,ou=Object.getOwnPropertySymbols,Uv=Object.prototype.hasOwnProperty,Dv=Object.prototype.propertyIsEnumerable,tc=(t,e,s)=>e in t?Rv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,au=(t,e)=>{for(var s in e||(e={}))Uv.call(e,s)&&tc(t,s,e[s]);if(ou)for(var s of ou(e))Dv.call(e,s)&&tc(t,s,e[s]);return t},ge=(t,e,s)=>tc(t,typeof e!="symbol"?e+"":e,s);let Lv=class extends Xg{constructor(e){super(e),ge(this,"protocol","wc"),ge(this,"version",2),ge(this,"core"),ge(this,"logger"),ge(this,"events",new gr.EventEmitter),ge(this,"provider"),ge(this,"messages"),ge(this,"subscriber"),ge(this,"publisher"),ge(this,"name",pb),ge(this,"transportExplicitlyClosed",!1),ge(this,"initialized",!1),ge(this,"connectionAttemptInProgress",!1),ge(this,"relayUrl"),ge(this,"projectId"),ge(this,"packageName"),ge(this,"bundleId"),ge(this,"hasExperiencedNetworkDisruption",!1),ge(this,"pingTimeout"),ge(this,"heartBeatTimeout",j.toMiliseconds(j.THIRTY_SECONDS+j.FIVE_SECONDS)),ge(this,"reconnectTimeout"),ge(this,"connectPromise"),ge(this,"reconnectInProgress",!1),ge(this,"requestsInFlight",[]),ge(this,"connectTimeout",j.toMiliseconds(j.ONE_SECOND*15)),ge(this,"request",async s=>{var r,i;this.logger.debug("Publishing Request Payload");const n=s.id||Gr().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:s.method,topic:(r=s.params)==null?void 0:r.topic},"relayer.request - publishing...");const o=`${n}:${((i=s.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(s);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),ge(this,"resetPingTimeout",()=>{lo()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var s,r,i,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(i=(r=(s=this.provider)==null?void 0:s.connection)==null?void 0:r.socket)==null?void 0:i.terminate)==null||n.call(i)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),ge(this,"onPayloadHandler",s=>{this.onProviderPayload(s),this.resetPingTimeout()}),ge(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(Ke.connect)}),ge(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),ge(this,"onProviderErrorHandler",s=>{this.logger.fatal(`Fatal socket error: ${s.message}`),this.events.emit(Ke.error,s),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),ge(this,"registerProviderListeners",()=>{this.provider.on(Lt.payload,this.onPayloadHandler),this.provider.on(Lt.connect,this.onConnectHandler),this.provider.on(Lt.disconnect,this.onDisconnectHandler),this.provider.on(Lt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?ht(e.logger,this.name):Ic(wn({level:e.logger||db})),this.messages=new yv(this.logger,e.core),this.subscriber=new xv(this,this.logger),this.publisher=new Av(this,this.logger),this.relayUrl=e?.relayUrl||Rd,this.projectId=e.projectId,Tm()?this.packageName=yl():km()&&(this.bundleId=yl()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return xt(this.logger)}get connected(){var e,s,r;return((r=(s=(e=this.provider)==null?void 0:e.connection)==null?void 0:s.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,s,r;return((r=(s=(e=this.provider)==null?void 0:e.connection)==null?void 0:s.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,s,r){this.isInitialized(),await this.publisher.publish(e,s,r),await this.recordMessageEvent({topic:e,message:s,publishedAt:Date.now(),transportType:Te.relay},Qn.outbound)}async subscribe(e,s){var r,i,n;this.isInitialized(),(!(s!=null&&s.transportType)||s?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((r=s?.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(i=s?.internal)==null?void 0:i.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(Nt.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(Nt.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,au({internal:{throwOnFailedPublish:o}},s)).catch(d=>{o&&h(d)})||a,u()})]),a}async unsubscribe(e,s){this.isInitialized(),await this.subscriber.unsubscribe(e,s)}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Ds(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(s,r)=>{await this.connect(e).then(s).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Kl())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const s=e.sort((r,i)=>r.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${s.length} message events sorted`);for(const r of s)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${s.length} message events processed`)}async onLinkMessageEvent(e,s){const{topic:r}=e;if(!s.sessionExists){const i=Zi(j.FIVE_MINUTES),n={topic:r,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,n)}this.events.emit(Ke.message,e),await this.recordMessageEvent(e,Qn.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let s=1;for(;s<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${s}...`),await this.createProvider(),await new Promise(async(r,i)=>{const n=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Lt.disconnect,n),await Ds(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(Lt.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Lt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Lt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const i=r;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${s}`);break}await new Promise(r=>setTimeout(r,j.toMiliseconds(s*1))),s++}}startPingTimeout(){var e,s,r,i,n;if(lo())try{(s=(e=this.provider)==null?void 0:e.connection)!=null&&s.socket&&((n=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new qt(new wf(Lm({sdkVersion:Ja,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,s){const{topic:r,message:i}=e;await this.messages.set(r,i,s)}async shouldIgnoreMessageEvent(e){const{topic:s,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(s))return this.logger.warn(`Ignoring message for unknown topic ${s}`),!0;const i=this.messages.has(s,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ac(e)){if(!e.method.endsWith(fb))return;const s=e.params,{topic:r,message:i,publishedAt:n,attestation:o}=s.data,a={topic:r,message:i,publishedAt:n,transportType:Te.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(au({type:"event",event:s.id},a)),this.events.emit(s.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Nc(e)&&this.events.emit(Ke.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Qn.inbound),this.events.emit(Ke.message,e))}async acknowledgePayload(e){const s=yo(e.id,!0);await this.provider.connection.send(s)}unregisterProviderListeners(){this.provider.off(Lt.payload,this.onPayloadHandler),this.provider.off(Lt.connect,this.onConnectHandler),this.provider.off(Lt.disconnect,this.onDisconnectHandler),this.provider.off(Lt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Kl();Xy(async s=>{e!==s&&(e=s,s?await this.transportOpen().catch(r=>this.logger.error(r,r?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(vi.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&tb())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(s){this.logger.warn(s,s?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Ke.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},j.toMiliseconds(gb)))))}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function Bv(){}function cu(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function lu(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function uu(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Mv="[object RegExp]",jv="[object String]",qv="[object Number]",Fv="[object Boolean]",hu="[object Arguments]",zv="[object Symbol]",Wv="[object Date]",Hv="[object Map]",Vv="[object Set]",Kv="[object Array]",Gv="[object Function]",Jv="[object ArrayBuffer]",na="[object Object]",Yv="[object Error]",Zv="[object DataView]",Xv="[object Uint8Array]",Qv="[object Uint8ClampedArray]",eE="[object Uint16Array]",tE="[object Uint32Array]",sE="[object BigUint64Array]",rE="[object Int8Array]",iE="[object Int16Array]",nE="[object Int32Array]",oE="[object BigInt64Array]",aE="[object Float32Array]",cE="[object Float64Array]";function lE(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function uE(t,e,s){return Hi(t,e,void 0,void 0,void 0,void 0,s)}function Hi(t,e,s,r,i,n,o){const a=o(t,e,s,r,i,n);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return en(t,e,n,o)}return en(t,e,n,o)}function en(t,e,s,r){if(Object.is(t,e))return!0;let i=uu(t),n=uu(e);if(i===hu&&(i=na),n===hu&&(n=na),i!==n)return!1;switch(i){case jv:return t.toString()===e.toString();case qv:{const c=t.valueOf(),l=e.valueOf();return lE(c,l)}case Fv:case Wv:case zv:return Object.is(t.valueOf(),e.valueOf());case Mv:return t.source===e.source&&t.flags===e.flags;case Gv:return t===e}s=s??new Map;const o=s.get(t),a=s.get(e);if(o!=null&&a!=null)return o===e;s.set(t,e),s.set(e,t);try{switch(i){case Hv:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!Hi(l,e.get(c),c,t,e,s,r))return!1;return!0}case Vv:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],d=l.findIndex(f=>Hi(h,f,void 0,t,e,s,r));if(d===-1)return!1;l.splice(d,1)}return!0}case Kv:case Xv:case Qv:case eE:case tE:case sE:case rE:case iE:case nE:case oE:case aE:case cE:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Hi(t[c],e[c],c,t,e,s,r))return!1;return!0}case Jv:return t.byteLength!==e.byteLength?!1:en(new Uint8Array(t),new Uint8Array(e),s,r);case Zv:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:en(new Uint8Array(t),new Uint8Array(e),s,r);case Yv:return t.name===e.name&&t.message===e.message;case na:{if(!(en(t.constructor,e.constructor,s,r)||cu(t)&&cu(e)))return!1;const c=[...Object.keys(t),...lu(t)],l=[...Object.keys(e),...lu(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],d=t[h];if(!Object.hasOwn(e,h))return!1;const f=e[h];if(!Hi(d,f,h,t,e,s,r))return!1}return!0}default:return!1}}finally{s.delete(t),s.delete(e)}}function hE(t,e){return uE(t,e,Bv)}var dE=Object.defineProperty,du=Object.getOwnPropertySymbols,pE=Object.prototype.hasOwnProperty,fE=Object.prototype.propertyIsEnumerable,sc=(t,e,s)=>e in t?dE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,pu=(t,e)=>{for(var s in e||(e={}))pE.call(e,s)&&sc(t,s,e[s]);if(du)for(var s of du(e))fE.call(e,s)&&sc(t,s,e[s]);return t},gt=(t,e,s)=>sc(t,typeof e!="symbol"?e+"":e,s);let vr=class extends Qg{constructor(e,s,r,i=ls,n=void 0){super(e,s,r,i),this.core=e,this.logger=s,this.name=r,gt(this,"map",new Map),gt(this,"version",mb),gt(this,"cached",[]),gt(this,"initialized",!1),gt(this,"getKey"),gt(this,"storagePrefix",ls),gt(this,"recentlyDeleted",[]),gt(this,"recentlyDeletedLimit",200),gt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ka(o)?this.map.set(this.getKey(o),o):Ky(o)?this.map.set(o.id,o):Gy(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),gt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),gt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),gt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>hE(a[c],o[c]))):this.values)),gt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=pu(pu({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),gt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=ht(s,this.name),this.storagePrefix=i,this.getKey=n}get context(){return xt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const s=this.map.get(e);if(!s){if(this.recentlyDeleted.includes(e)){const{message:i}=be("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:r}=be("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return s}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:s}=be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var gE=Object.defineProperty,mE=(t,e,s)=>e in t?gE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ae=(t,e,s)=>mE(t,typeof e!="symbol"?e+"":e,s);let wE=class{constructor(e,s){this.core=e,this.logger=s,ae(this,"name",vb),ae(this,"version",Eb),ae(this,"events",new _c),ae(this,"pairings"),ae(this,"initialized",!1),ae(this,"storagePrefix",ls),ae(this,"ignoredPayloadTypes",[Ii]),ae(this,"registeredMethods",[]),ae(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ae(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),ae(this,"create",async r=>{this.isInitialized();const i=Va(),n=await this.core.crypto.setSymKey(i),o=Zi(j.FIVE_MINUTES),a={protocol:xd},c={topic:n,expiry:o,relay:a,active:!1,methods:r?.methods},l=Vl({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:a,expiryTimestamp:o,methods:r?.methods});return this.events.emit(Xs.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:r?.transportType}),{topic:n,uri:l}}),ae(this,"pair",async r=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:r?.uri,trace:[is.pairing_started]}});this.isValidPair(r,i);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:l}=Hl(r.uri);i.props.properties.topic=n,i.addTrace(is.pairing_uri_validation_success),i.addTrace(is.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(n)){if(u=this.pairings.get(n),i.addTrace(is.existing_pairing),u.active)throw i.setError(ws.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);i.addTrace(is.pairing_not_expired)}const h=c||Zi(j.FIVE_MINUTES),d={topic:n,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(n,h),await this.pairings.set(n,d),i.addTrace(is.store_new_pairing),r.activatePairing&&await this.activate({topic:n}),this.events.emit(Xs.create,d),i.addTrace(is.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),i.addTrace(is.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(ws.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(f){throw i.setError(ws.subscribe_pairing_topic_failure),f}return i.addTrace(is.subscribe_pairing_topic_success),d}),ae(this,"activate",async({topic:r})=>{this.isInitialized();const i=Zi(j.FIVE_MINUTES);this.core.expirer.set(r,i),await this.pairings.update(r,{active:!0,expiry:i})}),ae(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=r;if(this.pairings.keys.includes(i)){const n=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Bm();this.events.once(Wo("pairing_ping",n),({error:l})=>{l?c(l):a()}),await o()}}),ae(this,"updateExpiry",async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})}),ae(this,"updateMetadata",async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})}),ae(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ae(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",Wi("USER_DISCONNECTED")),await this.deletePairing(i))}),ae(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:i,relay:n,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(i);return Vl({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),ae(this,"sendRequest",async(r,i,n)=>{const o=tr(i,n),a=await this.core.crypto.encode(r,o),c=ki[i].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),ae(this,"sendResult",async(r,i,n)=>{const o=yo(r,n),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=ki[c].res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),ae(this,"sendError",async(r,i,n)=>{const o=Bh(r,n),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=ki[c]?ki[c].res:ki.unregistered_method.res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),ae(this,"deletePairing",async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,Wi("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])}),ae(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(i=>bl(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))}),ae(this,"onRelayEventRequest",async r=>{const{topic:i,payload:n}=r;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,n);default:return await this.onUnknownRpcMethodRequest(i,n)}}),ae(this,"onRelayEventResponse",async r=>{const{topic:i,payload:n}=r,o=(await this.core.history.get(i,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,n);default:return this.onUnknownRpcMethodResponse(o)}}),ae(this,"onPairingPingRequest",async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.events.emit(Xs.ping,{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.logger.error(o)}}),ae(this,"onPairingPingResponse",(r,i)=>{const{id:n}=i;setTimeout(()=>{ms(i)?this.events.emit(Wo("pairing_ping",n),{}):ns(i)&&this.events.emit(Wo("pairing_ping",n),{error:i.error})},500)}),ae(this,"onPairingDeleteRequest",async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(Xs.delete,{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.logger.error(o)}}),ae(this,"onUnknownRpcMethodRequest",async(r,i)=>{const{id:n,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=Wi("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,r,a),this.logger.error(a)}catch(a){await this.sendError(n,r,a),this.logger.error(a)}}),ae(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(Wi("WC_METHOD_UNSUPPORTED",r))}),ae(this,"isValidPair",(r,i)=>{var n;if(!ta(r)){const{message:a}=be("MISSING_OR_INVALID",`pair() params: ${r}`);throw i.setError(ws.malformed_pairing_uri),new Error(a)}if(!Vy(r.uri)){const{message:a}=be("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw i.setError(ws.malformed_pairing_uri),new Error(a)}const o=Hl(r?.uri);if(!((n=o?.relay)!=null&&n.protocol)){const{message:a}=be("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(ws.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=be("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(ws.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&j.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(ws.pairing_expired);const{message:a}=be("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ae(this,"isValidPing",async r=>{if(!ta(r)){const{message:n}=be("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidPairingTopic(i)}),ae(this,"isValidDisconnect",async r=>{if(!ta(r)){const{message:n}=be("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidPairingTopic(i)}),ae(this,"isValidPairingTopic",async r=>{if(!$d(r)){const{message:i}=be("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){const{message:i}=be("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(bl(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:i}=be("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}),this.core=e,this.logger=ht(s,this.name),this.pairings=new vr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return xt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ke.message,async e=>{const{topic:s,message:r,transportType:i}=e;if(this.pairings.keys.includes(s)&&i!==Te.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const n=await this.core.crypto.decode(s,r);Ac(n)?(this.core.history.set(s,n),await this.onRelayEventRequest({topic:s,payload:n})):Nc(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:s,payload:n}),this.core.history.delete(s,n.id)),await this.core.relayer.messages.ack(s,r)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(jt.expired,async e=>{const{topic:s}=qm(e.target);s&&this.pairings.keys.includes(s)&&(await this.deletePairing(s,!0),this.events.emit(Xs.expire,{topic:s}))})}};var yE=Object.defineProperty,bE=(t,e,s)=>e in t?yE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,tt=(t,e,s)=>bE(t,typeof e!="symbol"?e+"":e,s);let vE=class extends Jg{constructor(e,s){super(e,s),this.core=e,this.logger=s,tt(this,"records",new Map),tt(this,"events",new gr.EventEmitter),tt(this,"name",Cb),tt(this,"version",Ib),tt(this,"cached",[]),tt(this,"initialized",!1),tt(this,"storagePrefix",ls),tt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),tt(this,"set",(r,i,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:n}),this.records.has(i.id))return;const o={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:n,expiry:Zi(j.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Wt.created,o)}),tt(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=ns(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.persist(),this.events.emit(Wt.updated,i))}),tt(this,"get",async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i))),tt(this,"delete",(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(n=>{if(n.topic===r){if(typeof i<"u"&&n.id!==i)return;this.records.delete(n.id),this.events.emit(Wt.deleted,n)}}),this.persist()}),tt(this,"exists",async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1)),tt(this,"on",(r,i)=>{this.events.on(r,i)}),tt(this,"once",(r,i)=>{this.events.once(r,i)}),tt(this,"off",(r,i)=>{this.events.off(r,i)}),tt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=ht(s,this.name)}get context(){return xt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(s=>{if(typeof s.response<"u")return;const r={topic:s.topic,request:tr(s.request.method,s.request.params,s.id),chainId:s.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const s=this.records.get(e);if(!s){const{message:r}=be("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return s}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Wt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:s}=be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Wt.created,e=>{const s=Wt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.events.on(Wt.updated,e=>{const s=Wt.updated;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.events.on(Wt.deleted,e=>{const s=Wt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.core.heartbeat.on(vi.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(s=>{j.toMiliseconds(s.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${s.id}`),this.records.delete(s.id),this.events.emit(Wt.deleted,s,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var EE=Object.defineProperty,CE=(t,e,s)=>e in t?EE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,it=(t,e,s)=>CE(t,typeof e!="symbol"?e+"":e,s);let IE=class extends tm{constructor(e,s){super(e,s),this.core=e,this.logger=s,it(this,"expirations",new Map),it(this,"events",new gr.EventEmitter),it(this,"name",Ab),it(this,"version",Nb),it(this,"cached",[]),it(this,"initialized",!1),it(this,"storagePrefix",ls),it(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),it(this,"has",r=>{try{const i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}}),it(this,"set",(r,i)=>{this.isInitialized();const n=this.formatTarget(r),o={target:n,expiry:i};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(jt.created,{target:n,expiration:o})}),it(this,"get",r=>{this.isInitialized();const i=this.formatTarget(r);return this.getExpiration(i)}),it(this,"del",r=>{if(this.isInitialized(),this.has(r)){const i=this.formatTarget(r),n=this.getExpiration(i);this.expirations.delete(i),this.events.emit(jt.deleted,{target:i,expiration:n})}}),it(this,"on",(r,i)=>{this.events.on(r,i)}),it(this,"once",(r,i)=>{this.events.once(r,i)}),it(this,"off",(r,i)=>{this.events.off(r,i)}),it(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=ht(s,this.name)}get context(){return xt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Mm(e);if(typeof e=="number")return jm(e);const{message:s}=be("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(s)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(jt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:s}=be("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const s=this.expirations.get(e);if(!s){const{message:r}=be("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return s}checkExpiry(e,s){const{expiry:r}=s;j.toMiliseconds(r)-Date.now()<=0&&this.expire(e,s)}expire(e,s){this.expirations.delete(e),this.events.emit(jt.expired,{target:e,expiration:s})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,s)=>this.checkExpiry(s,e))}registerEventListeners(){this.core.heartbeat.on(vi.pulse,()=>this.checkExpirations()),this.events.on(jt.created,e=>{const s=jt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on(jt.expired,e=>{const s=jt.expired;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on(jt.deleted,e=>{const s=jt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=be("NOT_INITIALIZED",this.name);throw new Error(e)}}};var AE=Object.defineProperty,NE=(t,e,s)=>e in t?AE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Be=(t,e,s)=>NE(t,typeof e!="symbol"?e+"":e,s);let _E=class extends sm{constructor(e,s,r){super(e,s,r),this.core=e,this.logger=s,this.store=r,Be(this,"name",_b),Be(this,"abortController"),Be(this,"isDevEnv"),Be(this,"verifyUrlV3",Pb),Be(this,"storagePrefix",ls),Be(this,"version",kd),Be(this,"publicKey"),Be(this,"fetchPromise"),Be(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&j.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Be(this,"register",async i=>{if(!vn()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const l=Tt.getDocument(),u=this.startAbortTimer(j.ONE_SECOND*5),h=await new Promise((d,f)=>{const m=()=>{window.removeEventListener("message",p),l.body.removeChild(g),f("attestation aborted")};this.abortController.signal.addEventListener("abort",m);const g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",m,{signal:this.abortController.signal});const p=w=>{if(w.data&&typeof w.data=="string")try{const y=JSON.parse(w.data);if(y.type==="verify_attestation"){if($a(y.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",m),window.removeEventListener("message",p),d(y.attestation===null?"":y.attestation)}}catch(y){this.logger.warn(y)}};l.body.appendChild(g),window.addEventListener("message",p,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(l){this.logger.warn(l)}return""}),Be(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=i;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if($a(n).payload.id!==a)return;const l=await this.isValidJwtAttestation(n);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),Be(this,"fetchAttestation",async(i,n)=>{this.logger.debug(`resolving attestation: ${i} from url: ${n}`);const o=this.startAbortTimer(j.ONE_SECOND*5),a=await fetch(`${n}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Be(this,"getVerifyUrl",i=>{let n=i||Qi;return Ob.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Qi}`),n=Qi),n}),Be(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(j.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await n.json()}catch(i){this.logger.warn(i)}}),Be(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),Be(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Be(this,"isValidJwtAttestation",async i=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(i,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Be(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Be(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),Be(this,"validateAttestation",(i,n)=>{const o=My(i,n.publicKey),a={hasExpired:j.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=ht(s,this.name),this.abortController=new AbortController,this.isDevEnv=Qh(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return xt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),j.toMiliseconds(e))}};var SE=Object.defineProperty,PE=(t,e,s)=>e in t?SE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,fu=(t,e,s)=>PE(t,typeof e!="symbol"?e+"":e,s);let OE=class extends rm{constructor(e,s){super(e,s),this.projectId=e,this.logger=s,fu(this,"context",$b),fu(this,"registerDeviceToken",async r=>{const{clientId:i,token:n,notificationType:o,enableEncrypted:a=!1}=r,c=`${Tb}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:n,always_raw:a})})}),this.logger=ht(s,this.context)}};var $E=Object.defineProperty,gu=Object.getOwnPropertySymbols,TE=Object.prototype.hasOwnProperty,kE=Object.prototype.propertyIsEnumerable,rc=(t,e,s)=>e in t?$E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ui=(t,e)=>{for(var s in e||(e={}))TE.call(e,s)&&rc(t,s,e[s]);if(gu)for(var s of gu(e))kE.call(e,s)&&rc(t,s,e[s]);return t},qe=(t,e,s)=>rc(t,typeof e!="symbol"?e+"":e,s);class xE extends im{constructor(e,s,r=!0){super(e,s,r),this.core=e,this.logger=s,qe(this,"context",xb),qe(this,"storagePrefix",ls),qe(this,"storageVersion",kb),qe(this,"events",new Map),qe(this,"shouldPersist",!1),qe(this,"init",async()=>{if(!Qh())try{const i={eventId:vl(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Zh(this.core.relayer.protocol,this.core.relayer.version,Ja)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),qe(this,"createEvent",i=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=i,l=vl(),u=this.core.projectId||"",h=Date.now(),d=Ui({eventId:l,timestamp:h,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,d),this.shouldPersist=!0),d}),qe(this,"getEvent",i=>{const{eventId:n,topic:o}=i;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Ui(Ui({},a),this.setMethods(a.eventId))}),qe(this,"deleteEvent",i=>{const{eventId:n}=i;this.events.delete(n),this.shouldPersist=!0}),qe(this,"setEventListeners",()=>{this.core.heartbeat.on(vi.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{j.fromMiliseconds(Date.now())-j.fromMiliseconds(i.timestamp)>Rb&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),qe(this,"setMethods",i=>({addTrace:n=>this.addTrace(i,n),setError:n=>this.setError(i,n)})),qe(this,"addTrace",(i,n)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(n),this.events.set(i,o),this.shouldPersist=!0)}),qe(this,"setError",(i,n)=>{const o=this.events.get(i);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),qe(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),qe(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(n=>{this.events.set(n.eventId,Ui(Ui({},n),this.setMethods(n.eventId)))})}catch(i){this.logger.warn(i)}}),qe(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[n,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const n of i)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),qe(this,"sendEvent",async i=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Ub}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Ja}${n}`,{method:"POST",body:JSON.stringify(i)})}),qe(this,"getAppDomain",()=>Rm().url),this.logger=ht(s,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var RE=Object.defineProperty,mu=Object.getOwnPropertySymbols,UE=Object.prototype.hasOwnProperty,DE=Object.prototype.propertyIsEnumerable,ic=(t,e,s)=>e in t?RE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,wu=(t,e)=>{for(var s in e||(e={}))UE.call(e,s)&&ic(t,s,e[s]);if(mu)for(var s of mu(e))DE.call(e,s)&&ic(t,s,e[s]);return t},Oe=(t,e,s)=>ic(t,typeof e!="symbol"?e+"":e,s);let LE=class Vd extends Hg{constructor(e){var s;super(e),Oe(this,"protocol",Td),Oe(this,"version",kd),Oe(this,"name",Ga),Oe(this,"relayUrl"),Oe(this,"projectId"),Oe(this,"customStoragePrefix"),Oe(this,"events",new gr.EventEmitter),Oe(this,"logger"),Oe(this,"heartbeat"),Oe(this,"relayer"),Oe(this,"crypto"),Oe(this,"storage"),Oe(this,"history"),Oe(this,"expirer"),Oe(this,"pairing"),Oe(this,"verify"),Oe(this,"echoClient"),Oe(this,"linkModeSupportedApps"),Oe(this,"eventClient"),Oe(this,"initialized",!1),Oe(this,"logChunkController"),Oe(this,"on",(a,c)=>this.events.on(a,c)),Oe(this,"once",(a,c)=>this.events.once(a,c)),Oe(this,"off",(a,c)=>this.events.off(a,c)),Oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),Oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:Te.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Rd,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=wn({level:typeof e?.logger=="string"&&e.logger?e.logger:rb.logger,name:Ga}),{logger:n,chunkLoggerController:o}=Lh({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(s=this.logChunkController)!=null&&s.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=ht(n,this.name),this.heartbeat=new mf,this.crypto=new uv(this,this.logger,e?.keychain),this.history=new vE(this,this.logger),this.expirer=new IE(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Fg(wu(wu({},ib),e?.storageOptions)),this.relayer=new Lv({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new wE(this,this.logger),this.verify=new _E(this,this.logger,this.storage),this.echoClient=new OE(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new xE(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const s=new Vd(e);await s.initialize();const r=await s.crypto.getClientId();return await s.storage.setItem(wb,r),s}get context(){return xt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Yl,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Yl)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const s=`_walletConnectCore_${e}`,r=`${s}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[s]}catch(s){console.warn("Failed to get global WalletConnect core",s);return}}setGlobalCore(e){var s;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((s=e.opts)==null?void 0:s.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&sb.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const BE=LE,tn={getSIWX(){return B.state.siwx},async initializeIfEnabled(){const t=B.state.siwx,e=b.getActiveCaipAddress();if(!(t&&e))return;const[s,r,i]=e.split(":");if(b.checkIfSupportedNetwork(s))try{if((await t.getSessions(`${s}:${r}`,i)).length)return;await Je.open({view:"SIWXSignMessage"})}catch(n){console.error("SIWXUtil:initializeIfEnabled",n),Ue.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties()}),await ee._getClient()?.disconnect().catch(console.error),ne.reset("Connect"),Zt.showError("A problem occurred while trying initialize authentication")}},async requestSignMessage(){const t=B.state.siwx,e=te.getPlainAddress(b.getActiveCaipAddress()),s=b.getActiveCaipNetwork(),r=ee._getClient();if(!t)throw new Error("SIWX is not enabled");if(!e)throw new Error("No ActiveCaipAddress found");if(!s)throw new Error("No ActiveCaipNetwork or client found");if(!r)throw new Error("No ConnectionController client found");try{const i=await t.createMessage({chainId:s.caipNetworkId,accountAddress:e}),n=i.toString();W.getConnectorId(s.chainNamespace)===K.CONNECTOR_ID.AUTH&&ne.pushTransactionStack({});const a=await r.signMessage(n);await t.addSession({data:i,message:n,signature:a}),Je.close(),Ue.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(i){const n=this.getSIWXEventProperties();(!Je.state.open||ne.state.view==="ApproveTransaction")&&await Je.open({view:"SIWXSignMessage"}),n.isSmartAccount?Zt.showError("This application might not support Smart Accounts"):Zt.showError("Signature declined"),Ue.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:n}),console.error("SWIXUtil:requestSignMessage",i)}},async cancelSignMessage(){try{this.getSIWX()?.getRequired?.()?await ee.disconnect():Je.close(),ne.reset("Connect"),Ue.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(t){console.error("SIWXUtil:cancelSignMessage",t)}},async getSessions(){const t=B.state.siwx,e=te.getPlainAddress(b.getActiveCaipAddress()),s=b.getActiveCaipNetwork();return t&&e&&s?t.getSessions(s.caipNetworkId,e):[]},async isSIWXCloseDisabled(){const t=this.getSIWX();if(t){const e=ne.state.view==="ApproveTransaction",s=ne.state.view==="SIWXSignMessage";if(e||s)return t.getRequired?.()&&(await this.getSessions()).length===0}return!1},async universalProviderAuthenticate({universalProvider:t,chains:e,methods:s}){const r=tn.getSIWX(),i=new Set(e.map(a=>a.split(":")[0]));if(!r||i.size!==1||!i.has("eip155"))return!1;const n=await r.createMessage({chainId:b.getActiveCaipNetwork()?.caipNetworkId||"",accountAddress:""}),o=await t.authenticate({nonce:n.nonce,domain:n.domain,uri:n.uri,exp:n.expirationTime,iat:n.issuedAt,nbf:n.notBefore,requestId:n.requestId,version:n.version,resources:n.resources,statement:n.statement,chainId:n.chainId,methods:s,chains:[n.chainId,...e.filter(a=>a!==n.chainId)]});if(Zt.showLoading("Authenticating...",{autoClose:!1}),V.setConnectedWalletInfo({...o.session.peer.metadata,name:o.session.peer.metadata.name,icon:o.session.peer.metadata.icons?.[0],type:"WALLET_CONNECT"},Array.from(i)[0]),o?.auths?.length){const a=o.auths.map(c=>{const l=t.client.formatAuthMessage({request:c.p,iss:c.p.iss});return{data:{...c.p,accountAddress:c.p.iss.split(":").slice(-1).join(""),chainId:c.p.iss.split(":").slice(2,4).join(":"),uri:c.p.aud,version:c.p.version||n.version,expirationTime:c.p.exp,issuedAt:c.p.iat,notBefore:c.p.nbf},message:l,signature:c.s.s,cacao:c}});try{await r.setSessions(a),Ue.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:tn.getSIWXEventProperties()})}catch(c){throw console.error("SIWX:universalProviderAuth - failed to set sessions",c),Ue.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:tn.getSIWXEventProperties()}),await t.disconnect().catch(console.error),c}finally{Zt.hide()}}return!0},getSIWXEventProperties(){const t=b.state.activeChain;return{network:b.state.activeCaipNetwork?.caipNetworkId||"",isSmartAccount:V.state.preferredAccountTypes?.[t]===Gi.ACCOUNT_TYPES.SMART_ACCOUNT}},async clearSessions(){const t=this.getSIWX();t&&await t.setSessions([])}};var ME=Object.defineProperty,jE=(t,e,s)=>e in t?ME(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,yu=(t,e,s)=>jE(t,typeof e!="symbol"?e+"":e,s);let qE=class{constructor(e){this.opts=e,yu(this,"protocol","wc"),yu(this,"version",2)}},FE=class{constructor(e){this.client=e}};function un(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function bu(t){return un(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const Kd="2.23.2";let oa={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:s})=>e?`${t??"https://viem.sh"}${e}${s?`#${s}`:""}`:void 0,version:`viem@${Kd}`};class hr extends Error{constructor(e,s={}){const r=s.cause instanceof hr?s.cause.details:s.cause?.message?s.cause.message:s.details,i=s.cause instanceof hr&&s.cause.docsPath||s.docsPath,n=oa.getDocsUrl?.({...s,docsPath:i}),o=[e||"An error occurred.","",...s.metaMessages?[...s.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...r?[`Details: ${r}`]:[],...oa.version?[`Version: ${oa.version}`]:[]].join(`
`);super(o,s.cause?{cause:s.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=i,this.metaMessages=s.metaMessages,this.name=s.name??this.name,this.shortMessage=e,this.version=Kd}walk(e){return Gd(this,e)}}function Gd(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Gd(t.cause,e):e?null:t}class Jd extends hr{constructor({size:e,targetSize:s,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (${e}) exceeds padding size (${s}).`,{name:"SizeExceedsPaddingSizeError"})}}function Ai(t,{dir:e,size:s=32}={}){return typeof t=="string"?zE(t,{dir:e,size:s}):WE(t,{dir:e,size:s})}function zE(t,{dir:e,size:s=32}={}){if(s===null)return t;const r=t.replace("0x","");if(r.length>s*2)throw new Jd({size:Math.ceil(r.length/2),targetSize:s,type:"hex"});return`0x${r[e==="right"?"padEnd":"padStart"](s*2,"0")}`}function WE(t,{dir:e,size:s=32}={}){if(s===null)return t;if(t.length>s)throw new Jd({size:t.length,targetSize:s,type:"bytes"});const r=new Uint8Array(s);for(let i=0;i<s;i++){const n=e==="right";r[n?i:s-i-1]=t[n?i:t.length-i-1]}return r}class HE extends hr{constructor({max:e,min:s,signed:r,size:i,value:n}){super(`Number "${n}" is not in safe ${i?`${i*8}-bit ${r?"signed":"unsigned"} `:""}integer range ${e?`(${s} to ${e})`:`(above ${s})`}`,{name:"IntegerOutOfRangeError"})}}class VE extends hr{constructor({givenSize:e,maxSize:s}){super(`Size cannot exceed ${s} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Ni(t,{size:e}){if(bu(t)>e)throw new VE({givenSize:bu(t),maxSize:e})}function nc(t,e={}){const{signed:s}=e;e.size&&Ni(t,{size:e.size});const r=BigInt(t);if(!s)return r;const i=(t.length-2)/2,n=(1n<<BigInt(i)*8n-1n)-1n;return r<=n?r:r-BigInt(`0x${"f".padStart(i*2,"f")}`)-1n}function KE(t,e={}){return Number(nc(t,e))}const GE=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function oc(t,e={}){return typeof t=="number"||typeof t=="bigint"?Zd(t,e):typeof t=="string"?ZE(t,e):typeof t=="boolean"?JE(t,e):Yd(t,e)}function JE(t,e={}){const s=`0x${Number(t)}`;return typeof e.size=="number"?(Ni(s,{size:e.size}),Ai(s,{size:e.size})):s}function Yd(t,e={}){let s="";for(let i=0;i<t.length;i++)s+=GE[t[i]];const r=`0x${s}`;return typeof e.size=="number"?(Ni(r,{size:e.size}),Ai(r,{dir:"right",size:e.size})):r}function Zd(t,e={}){const{signed:s,size:r}=e,i=BigInt(t);let n;r?s?n=(1n<<BigInt(r)*8n-1n)-1n:n=2n**(BigInt(r)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&s?-n-1n:0;if(n&&i>n||i<o){const c=typeof t=="bigint"?"n":"";throw new HE({max:n?`${n}${c}`:void 0,min:`${o}${c}`,signed:s,size:r,value:`${t}${c}`})}const a=`0x${(s&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?Ai(a,{size:r}):a}const YE=new TextEncoder;function ZE(t,e={}){const s=YE.encode(t);return Yd(s,e)}const XE=new TextEncoder;function QE(t,e={}){return typeof t=="number"||typeof t=="bigint"?t1(t,e):typeof t=="boolean"?e1(t,e):un(t)?Xd(t,e):Qd(t,e)}function e1(t,e={}){const s=new Uint8Array(1);return s[0]=Number(t),typeof e.size=="number"?(Ni(s,{size:e.size}),Ai(s,{size:e.size})):s}const fs={zero:48,nine:57,A:65,F:70,a:97,f:102};function vu(t){if(t>=fs.zero&&t<=fs.nine)return t-fs.zero;if(t>=fs.A&&t<=fs.F)return t-(fs.A-10);if(t>=fs.a&&t<=fs.f)return t-(fs.a-10)}function Xd(t,e={}){let s=t;e.size&&(Ni(s,{size:e.size}),s=Ai(s,{dir:"right",size:e.size}));let r=s.slice(2);r.length%2&&(r=`0${r}`);const i=r.length/2,n=new Uint8Array(i);for(let o=0,a=0;o<i;o++){const c=vu(r.charCodeAt(a++)),l=vu(r.charCodeAt(a++));if(c===void 0||l===void 0)throw new hr(`Invalid byte sequence ("${r[a-2]}${r[a-1]}" in "${r}").`);n[o]=c*16+l}return n}function t1(t,e){const s=Zd(t,e);return Xd(s)}function Qd(t,e={}){const s=XE.encode(t);return typeof e.size=="number"?(Ni(s,{size:e.size}),Ai(s,{dir:"right",size:e.size})):s}function ep(t,e){const s=e||"hex",r=Sm(un(t,{strict:!1})?QE(t):t);return s==="bytes"?r:oc(r)}class s1 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const s=super.get(e);return super.has(e)&&s!==void 0&&(this.delete(e),super.set(e,s)),s}set(e,s){if(super.set(e,s),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const aa=new s1(8192);function r1(t,e){if(aa.has(`${t}.${e}`))return aa.get(`${t}.${e}`);const s=t.substring(2).toLowerCase(),r=ep(Qd(s),"bytes"),i=s.split("");for(let o=0;o<40;o+=2)r[o>>1]>>4>=8&&i[o]&&(i[o]=i[o].toUpperCase()),(r[o>>1]&15)>=8&&i[o+1]&&(i[o+1]=i[o+1].toUpperCase());const n=`0x${i.join("")}`;return aa.set(`${t}.${e}`,n),n}function i1(t){const e=ep(`0x${t.substring(4)}`).substring(26);return r1(`0x${e}`)}async function n1({hash:t,signature:e}){const s=un(t)?t:oc(t),{secp256k1:r}=await Oa(async()=>{const{secp256k1:o}=await import("./secp256k1-ZmbC0une.js");return{secp256k1:o}},__vite__mapDeps([0,1,2,3,4]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:l,s:u,v:h,yParity:d}=e,f=Number(d??h),m=Eu(f);return new r.Signature(nc(l),nc(u)).addRecoveryBit(m)}const o=un(e)?e:oc(e),a=KE(`0x${o.slice(130)}`),c=Eu(a);return r.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(s.substring(2)).toHex(!1)}`}function Eu(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function o1({hash:t,signature:e}){return i1(await n1({hash:t,signature:e}))}var a1={};const c1=":";function ei(t){const[e,s]=t.split(c1);return{namespace:e,reference:s}}function tp(t,e){return t.includes(":")?[t]:e.chains||[]}var l1=Object.defineProperty,u1=Object.defineProperties,h1=Object.getOwnPropertyDescriptors,Cu=Object.getOwnPropertySymbols,d1=Object.prototype.hasOwnProperty,p1=Object.prototype.propertyIsEnumerable,Iu=(t,e,s)=>e in t?l1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Au=(t,e)=>{for(var s in e||(e={}))d1.call(e,s)&&Iu(t,s,e[s]);if(Cu)for(var s of Cu(e))p1.call(e,s)&&Iu(t,s,e[s]);return t},f1=(t,e)=>u1(t,h1(e));const g1="ReactNative",Yr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function sp(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function rp(){return!Tt.getDocument()&&!!Tt.getNavigator()&&navigator.product===g1}function ip(){return!sp()&&!!Tt.getNavigator()&&!!Tt.getDocument()}function m1(){return rp()?Yr.reactNative:sp()?Yr.node:ip()?Yr.browser:Yr.unknown}function w1(t){var e,s;const r=y1();try{return t!=null&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),f1(Au(Au({},r),t),{url:t?.url||r.url,name:t?.name||r.name,description:t?.description||r.description,icons:(s=t?.icons)!=null&&s.length&&t.icons.length>0?t.icons:r.icons})}catch(i){return console.warn("Error populating app metadata",i),t||r}}function y1(){return Dh.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function sr(t,e){return t.filter(s=>e.includes(s)).length===t.length}function Sr(t=j.FIVE_MINUTES,e){const s=j.toMiliseconds(t||j.FIVE_MINUTES);let r,i,n,o;return{resolve:a=>{n&&r&&(clearTimeout(n),r(a),o=Promise.resolve(a))},reject:a=>{n&&i&&(clearTimeout(n),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},s),r=a,i=c})}}function b1(t){const[e,s]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof s=="string")r.topic=s;else if(e==="id"&&Number.isInteger(Number(s)))r.id=Number(s);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${s}`);return r}function mt(t,e){return j.fromMiliseconds(Date.now()+j.toMiliseconds(t))}function Pr(t){return Date.now()>=j.toMiliseconds(t)}function Ne(t,e){return`${t}${e?`:${e}`:""}`}function cs(t=[],e=[]){return[...new Set([...t,...e])]}async function v1({id:t,topic:e,wcDeepLink:s}){var r;try{if(!s)return;const i=typeof s=="string"?JSON.parse(s):s,n=i?.href;if(typeof n!="string")return;const o=E1(n,t,e),a=m1();if(a===Yr.browser){if(!((r=Tt.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}C1(o)}else a===Yr.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}function E1(t,e,s){const r=`requestId=${e}&sessionTopic=${s}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${n}${S1(r,!0)}`}else i=`${i}/wc?${r}`;return i}function C1(t){let e="_self";_1()?e="_top":(N1()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function I1(t,e){let s="";try{if(ip()&&(s=localStorage.getItem(e),s))return s;s=await t.getItem(e)}catch(r){console.error(r)}return s}function Nu(t,e){if(!t.includes(e))return null;const s=t.split(/([&,?,=])/),r=s.indexOf(e);return s[r+2]}function A1(){return typeof process<"u"&&a1.IS_VITEST==="true"}function N1(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function _1(){try{return window.self!==window.top}catch{return!1}}function S1(t,e=!1){const s=Buffer.from(t).toString("base64");return e?s.replace(/[=]/g,""):s}function ho(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function P1(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function _n(t,...e){if(!P1(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function O1(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ho(t.outputLen),ho(t.blockLen)}function hi(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function np(t,e){_n(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}const Mn=BigInt(2**32-1),_u=BigInt(32);function $1(t,e=!1){return e?{h:Number(t&Mn),l:Number(t>>_u&Mn)}:{h:Number(t>>_u&Mn)|0,l:Number(t&Mn)|0}}function T1(t,e=!1){let s=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:n,l:o}=$1(t[i],e);[s[i],r[i]]=[n,o]}return[s,r]}const k1=(t,e,s)=>t<<s|e>>>32-s,x1=(t,e,s)=>e<<s|t>>>32-s,R1=(t,e,s)=>e<<s-32|t>>>64-s,U1=(t,e,s)=>t<<s-32|e>>>64-s,Or=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function D1(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ca(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ss(t,e){return t<<32-e|t>>>e}const Su=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function L1(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Pu(t){for(let e=0;e<t.length;e++)t[e]=L1(t[e])}function B1(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Oo(t){return typeof t=="string"&&(t=B1(t)),_n(t),t}function M1(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];_n(i),e+=i.length}const s=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const n=t[r];s.set(n,i),i+=n.length}return s}let Rc=class{clone(){return this._cloneInto()}};function op(t){const e=r=>t().update(Oo(r)).digest(),s=t();return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=()=>t(),e}function ap(t=32){if(Or&&typeof Or.getRandomValues=="function")return Or.getRandomValues(new Uint8Array(t));if(Or&&typeof Or.randomBytes=="function")return Or.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const cp=[],lp=[],up=[],j1=BigInt(0),Di=BigInt(1),q1=BigInt(2),F1=BigInt(7),z1=BigInt(256),W1=BigInt(113);for(let t=0,e=Di,s=1,r=0;t<24;t++){[s,r]=[r,(2*s+3*r)%5],cp.push(2*(5*r+s)),lp.push((t+1)*(t+2)/2%64);let i=j1;for(let n=0;n<7;n++)e=(e<<Di^(e>>F1)*W1)%z1,e&q1&&(i^=Di<<(Di<<BigInt(n))-Di);up.push(i)}const[H1,V1]=T1(up,!0),Ou=(t,e,s)=>s>32?R1(t,e,s):k1(t,e,s),$u=(t,e,s)=>s>32?U1(t,e,s):x1(t,e,s);function K1(t,e=24){const s=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)s[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=s[c],u=s[c+1],h=Ou(l,u,1)^s[a],d=$u(l,u,1)^s[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let i=t[2],n=t[3];for(let o=0;o<24;o++){const a=lp[o],c=Ou(i,n,a),l=$u(i,n,a),u=cp[o];i=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)s[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~s[(a+2)%10]&s[(a+4)%10]}t[0]^=H1[r],t[1]^=V1[r]}s.fill(0)}class Uc extends Rc{constructor(e,s,r,i=!1,n=24){if(super(),this.blockLen=e,this.suffix=s,this.outputLen=r,this.enableXOF=i,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,ho(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=D1(this.state)}keccak(){Su||Pu(this.state32),K1(this.state32,this.rounds),Su||Pu(this.state32),this.posOut=0,this.pos=0}update(e){hi(this);const{blockLen:s,state:r}=this;e=Oo(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(s-this.pos,i-n);for(let a=0;a<o;a++)r[this.pos++]^=e[n++];this.pos===s&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:s,pos:r,blockLen:i}=this;e[r]^=s,(s&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){hi(this,!1),_n(e),this.finish();const s=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,n-i);e.set(s.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ho(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(np(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:s,suffix:r,outputLen:i,rounds:n,enableXOF:o}=this;return e||(e=new Uc(s,r,i,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const G1=(t,e,s)=>op(()=>new Uc(e,t,s)),J1=G1(1,136,256/8),Y1="https://rpc.walletconnect.org/v1";function hp(t){const e=`Ethereum Signed Message:
${t.length}`,s=new TextEncoder().encode(e+t);return"0x"+Buffer.from(J1(s)).toString("hex")}async function Z1(t,e,s,r,i,n){switch(s.t){case"eip191":return await X1(t,e,s.s);case"eip1271":return await Q1(t,e,s.s,r,i,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${s.t}`)}}async function X1(t,e,s){return(await o1({hash:hp(e),signature:s})).toLowerCase()===t.toLowerCase()}async function Q1(t,e,s,r,i,n){const o=ei(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l="0000000000000000000000000000000000000000000000000000000000000041",u=s.substring(2),h=hp(e).substring(2),d=a+h+c+l+u,f=await fetch(`${n||Y1}/?chainId=${r}&projectId=${i}`,{method:"POST",body:JSON.stringify({id:eC(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:m}=await f.json();return m?m.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function eC(){return Date.now()+Math.floor(Math.random()*1e3)}function tC(t){const e=atob(t),s=new Uint8Array(e.length);for(let o=0;o<e.length;o++)s[o]=e.charCodeAt(o);const r=s[0];if(r===0)throw new Error("No signatures found");const i=1+r*64;if(s.length<i)throw new Error("Transaction data too short for claimed signature count");if(s.length<100)throw new Error("Transaction too short");const n=Buffer.from(t,"base64").slice(1,65);return Mh.encode(n)}var sC=Object.defineProperty,rC=Object.defineProperties,iC=Object.getOwnPropertyDescriptors,Tu=Object.getOwnPropertySymbols,nC=Object.prototype.hasOwnProperty,oC=Object.prototype.propertyIsEnumerable,ku=(t,e,s)=>e in t?sC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,aC=(t,e)=>{for(var s in e||(e={}))nC.call(e,s)&&ku(t,s,e[s]);if(Tu)for(var s of Tu(e))oC.call(e,s)&&ku(t,s,e[s]);return t},cC=(t,e)=>rC(t,iC(e));const lC="did:pkh:",Dc=t=>t?.split(":"),uC=t=>{const e=t&&Dc(t);if(e)return t.includes(lC)?e[3]:e[1]},ac=t=>{const e=t&&Dc(t);if(e)return e[2]+":"+e[3]},po=t=>{const e=t&&Dc(t);if(e)return e.pop()};async function xu(t){const{cacao:e,projectId:s}=t,{s:r,p:i}=e,n=dp(i,i.iss),o=po(i.iss);return await Z1(o,n,r,ac(i.iss),s)}const dp=(t,e)=>{const s=`${t.domain} wants you to sign in with your Ethereum account:`,r=po(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0;const n=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${uC(e)}`,c=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,f=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,m=eo(t.resources);if(m){const g=hn(m);i=bC(i,g)}return[s,r,"",i,"",n,o,a,c,l,u,h,d,f].filter(g=>g!=null).join(`
`)};function hC(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function dC(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function dr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(s=>{const r=t.att[s];if(Array.isArray(r))throw new Error(`Resource must be an object: ${s}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${s}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${s}`);Object.keys(r).forEach(i=>{const n=r[i];if(!Array.isArray(n))throw new Error(`Ability limits ${i} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function pC(t,e,s,r={}){return s?.sort((i,n)=>i.localeCompare(n)),{att:{[t]:fC(e,s,r)}}}function fC(t,e,s={}){e=e?.sort((i,n)=>i.localeCompare(n));const r=e.map(i=>({[`${t}/${i}`]:[s]}));return Object.assign({},...r)}function pp(t){return dr(t),`urn:recap:${hC(t).replace(/=/g,"")}`}function hn(t){const e=dC(t.replace("urn:recap:",""));return dr(e),e}function gC(t,e,s){const r=pC(t,e,s);return pp(r)}function mC(t){return t&&t.includes("urn:recap:")}function wC(t,e){const s=hn(t),r=hn(e),i=yC(s,r);return pp(i)}function yC(t,e){dr(t),dr(e);const s=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,n)=>i.localeCompare(n)),r={att:{}};return s.forEach(i=>{var n,o;Object.keys(((n=t.att)==null?void 0:n[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;r.att[i]=cC(aC({},r.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((l=e.att[i])==null?void 0:l[a])})})}),r}function bC(t="",e){dr(e);const s="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(s))return t;const r=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(i++,`(${i}) '${h}': '${l[h].join("', '")}' for '${a}'.`));r.push(u.join(", ").replace(".,","."))});const n=r.join(" "),o=`${s}${n}`;return`${t?t+" ":""}${o}`}function Ru(t){var e;const s=hn(t);dr(s);const r=(e=s.att)==null?void 0:e.eip155;return r?Object.keys(r).map(i=>i.split("/")[1]):[]}function Uu(t){const e=hn(t);dr(e);const s=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(i=>{var n;(n=i?.[0])!=null&&n.chains&&s.push(i[0].chains)})}),[...new Set(s.flat())]}function eo(t){if(!t)return;const e=t?.[t.length-1];return mC(e)?e:void 0}function la(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function fp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function $t(t,...e){if(!fp(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Du(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function vC(t,e){$t(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}function Lu(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const Ms=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),EC=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),CC=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!CC)throw new Error("Non little-endian hardware is not supported");function IC(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function cc(t){if(typeof t=="string")t=IC(t);else if(fp(t))t=lc(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function AC(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function NC(t,e){if(t.length!==e.length)return!1;let s=0;for(let r=0;r<t.length;r++)s|=t[r]^e[r];return s===0}const _C=(t,e)=>{function s(r,...i){if($t(r),t.nonceLength!==void 0){const l=i[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?$t(l):$t(l,t.nonceLength)}const n=t.tagLength;n&&i[1]!==void 0&&$t(i[1]);const o=e(r,...i),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");$t(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,$t(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if($t(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(s,t),s};function Bu(t,e,s=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(s&&!SC(e))throw new Error("invalid output, must be aligned");return e}function Mu(t,e,s,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,r);const i=BigInt(32),n=BigInt(4294967295),o=Number(s>>i&n),a=Number(s&n);t.setUint32(e+4,o,r),t.setUint32(e+0,a,r)}function SC(t){return t.byteOffset%4===0}function lc(t){return Uint8Array.from(t)}function di(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const gp=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),PC=gp("expand 16-byte k"),OC=gp("expand 32-byte k"),$C=Ms(PC),TC=Ms(OC);function me(t,e){return t<<e|t>>>32-e}function uc(t){return t.byteOffset%4===0}const jn=64,kC=16,mp=2**32-1,ju=new Uint32Array;function xC(t,e,s,r,i,n,o,a){const c=i.length,l=new Uint8Array(jn),u=Ms(l),h=uc(i)&&uc(n),d=h?Ms(i):ju,f=h?Ms(n):ju;for(let m=0;m<c;o++){if(t(e,s,r,u,o,a),o>=mp)throw new Error("arx: counter overflow");const g=Math.min(jn,c-m);if(h&&g===jn){const p=m/4;if(m%4!==0)throw new Error("arx: invalid block position");for(let w=0,y;w<kC;w++)y=p+w,f[y]=d[y]^u[w];m+=jn;continue}for(let p=0,w;p<g;p++)w=m+p,n[w]=i[w]^l[p];m+=g}}function RC(t,e){const{allowShortKeys:s,extendNonceFn:r,counterLength:i,counterRight:n,rounds:o}=AC({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return la(i),la(o),Lu(n),Lu(s),(a,c,l,u,h=0)=>{$t(a),$t(c),$t(l);const d=l.length;if(u===void 0&&(u=new Uint8Array(d)),$t(u),la(h),h<0||h>=mp)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const f=[];let m=a.length,g,p;if(m===32)f.push(g=lc(a)),p=TC;else if(m===16&&s)g=new Uint8Array(32),g.set(a),g.set(a,16),p=$C,f.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${m}`);uc(c)||f.push(c=lc(c));const w=Ms(g);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(p,w,Ms(c.subarray(0,16)),w),c=c.subarray(16)}const y=16-i;if(y!==c.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){const O=new Uint8Array(12);O.set(c,n?0:12-c.length),c=O,f.push(c)}const C=Ms(c);return xC(t,p,w,C,l,u,h,o),di(...f),u}}const st=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class UC{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=cc(e),$t(e,32);const s=st(e,0),r=st(e,2),i=st(e,4),n=st(e,6),o=st(e,8),a=st(e,10),c=st(e,12),l=st(e,14);this.r[0]=s&8191,this.r[1]=(s>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=st(e,16+2*u)}process(e,s,r=!1){const i=r?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],f=o[6],m=o[7],g=o[8],p=o[9],w=st(e,s+0),y=st(e,s+2),C=st(e,s+4),O=st(e,s+6),T=st(e,s+8),P=st(e,s+10),N=st(e,s+12),$=st(e,s+14);let v=n[0]+(w&8191),k=n[1]+((w>>>13|y<<3)&8191),S=n[2]+((y>>>10|C<<6)&8191),R=n[3]+((C>>>7|O<<9)&8191),L=n[4]+((O>>>4|T<<12)&8191),E=n[5]+(T>>>1&8191),A=n[6]+((T>>>14|P<<2)&8191),I=n[7]+((P>>>11|N<<5)&8191),x=n[8]+((N>>>8|$<<8)&8191),U=n[9]+($>>>5|i),_=0,M=_+v*a+k*(5*p)+S*(5*g)+R*(5*m)+L*(5*f);_=M>>>13,M&=8191,M+=E*(5*d)+A*(5*h)+I*(5*u)+x*(5*l)+U*(5*c),_+=M>>>13,M&=8191;let q=_+v*c+k*a+S*(5*p)+R*(5*g)+L*(5*m);_=q>>>13,q&=8191,q+=E*(5*f)+A*(5*d)+I*(5*h)+x*(5*u)+U*(5*l),_+=q>>>13,q&=8191;let F=_+v*l+k*c+S*a+R*(5*p)+L*(5*g);_=F>>>13,F&=8191,F+=E*(5*m)+A*(5*f)+I*(5*d)+x*(5*h)+U*(5*u),_+=F>>>13,F&=8191;let X=_+v*u+k*l+S*c+R*a+L*(5*p);_=X>>>13,X&=8191,X+=E*(5*g)+A*(5*m)+I*(5*f)+x*(5*d)+U*(5*h),_+=X>>>13,X&=8191;let G=_+v*h+k*u+S*l+R*c+L*a;_=G>>>13,G&=8191,G+=E*(5*p)+A*(5*g)+I*(5*m)+x*(5*f)+U*(5*d),_+=G>>>13,G&=8191;let oe=_+v*d+k*h+S*u+R*l+L*c;_=oe>>>13,oe&=8191,oe+=E*a+A*(5*p)+I*(5*g)+x*(5*m)+U*(5*f),_+=oe>>>13,oe&=8191;let le=_+v*f+k*d+S*h+R*u+L*l;_=le>>>13,le&=8191,le+=E*c+A*a+I*(5*p)+x*(5*g)+U*(5*m),_+=le>>>13,le&=8191;let Ie=_+v*m+k*f+S*d+R*h+L*u;_=Ie>>>13,Ie&=8191,Ie+=E*l+A*c+I*a+x*(5*p)+U*(5*g),_+=Ie>>>13,Ie&=8191;let ue=_+v*g+k*m+S*f+R*d+L*h;_=ue>>>13,ue&=8191,ue+=E*u+A*l+I*c+x*a+U*(5*p),_+=ue>>>13,ue&=8191;let he=_+v*p+k*g+S*m+R*f+L*d;_=he>>>13,he&=8191,he+=E*h+A*u+I*l+x*c+U*a,_+=he>>>13,he&=8191,_=(_<<2)+_|0,_=_+M|0,M=_&8191,_=_>>>13,q+=_,n[0]=M,n[1]=q,n[2]=F,n[3]=X,n[4]=G,n[5]=oe,n[6]=le,n[7]=Ie,n[8]=ue,n[9]=he}finalize(){const{h:e,pad:s}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let n=(i^1)-1;for(let a=0;a<10;a++)r[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+s[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+s[a]|0)+(o>>>16)|0,e[a]=o&65535;di(r)}update(e){Du(this);const{buffer:s,blockLen:r}=this;e=cc(e);const i=e.length;for(let n=0;n<i;){const o=Math.min(r-this.pos,i-n);if(o===r){for(;r<=i-n;n+=r)this.process(e,n);continue}s.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===r&&(this.process(s,0,!1),this.pos=0)}return this}destroy(){di(this.h,this.r,this.buffer,this.pad)}digestInto(e){Du(this),vC(e,this),this.finished=!0;const{buffer:s,h:r}=this;let{pos:i}=this;if(i){for(s[i++]=1;i<16;i++)s[i]=0;this.process(s,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=r[o]>>>0,e[n++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const r=e.slice(0,s);return this.destroy(),r}}function DC(t){const e=(r,i)=>t(i).update(cc(r)).digest(),s=t(new Uint8Array(32));return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=r=>t(r),e}const LC=DC(t=>new UC(t));function BC(t,e,s,r,i,n=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],d=e[2],f=e[3],m=e[4],g=e[5],p=e[6],w=e[7],y=i,C=s[0],O=s[1],T=s[2],P=o,N=a,$=c,v=l,k=u,S=h,R=d,L=f,E=m,A=g,I=p,x=w,U=y,_=C,M=O,q=T;for(let X=0;X<n;X+=2)P=P+k|0,U=me(U^P,16),E=E+U|0,k=me(k^E,12),P=P+k|0,U=me(U^P,8),E=E+U|0,k=me(k^E,7),N=N+S|0,_=me(_^N,16),A=A+_|0,S=me(S^A,12),N=N+S|0,_=me(_^N,8),A=A+_|0,S=me(S^A,7),$=$+R|0,M=me(M^$,16),I=I+M|0,R=me(R^I,12),$=$+R|0,M=me(M^$,8),I=I+M|0,R=me(R^I,7),v=v+L|0,q=me(q^v,16),x=x+q|0,L=me(L^x,12),v=v+L|0,q=me(q^v,8),x=x+q|0,L=me(L^x,7),P=P+S|0,q=me(q^P,16),I=I+q|0,S=me(S^I,12),P=P+S|0,q=me(q^P,8),I=I+q|0,S=me(S^I,7),N=N+R|0,U=me(U^N,16),x=x+U|0,R=me(R^x,12),N=N+R|0,U=me(U^N,8),x=x+U|0,R=me(R^x,7),$=$+L|0,_=me(_^$,16),E=E+_|0,L=me(L^E,12),$=$+L|0,_=me(_^$,8),E=E+_|0,L=me(L^E,7),v=v+k|0,M=me(M^v,16),A=A+M|0,k=me(k^A,12),v=v+k|0,M=me(M^v,8),A=A+M|0,k=me(k^A,7);let F=0;r[F++]=o+P|0,r[F++]=a+N|0,r[F++]=c+$|0,r[F++]=l+v|0,r[F++]=u+k|0,r[F++]=h+S|0,r[F++]=d+R|0,r[F++]=f+L|0,r[F++]=m+E|0,r[F++]=g+A|0,r[F++]=p+I|0,r[F++]=w+x|0,r[F++]=y+U|0,r[F++]=C+_|0,r[F++]=O+M|0,r[F++]=T+q|0}const MC=RC(BC,{counterRight:!1,counterLength:4,allowShortKeys:!1}),jC=new Uint8Array(16),qu=(t,e)=>{t.update(e);const s=e.length%16;s&&t.update(jC.subarray(s))},qC=new Uint8Array(32);function Fu(t,e,s,r,i){const n=t(e,s,qC),o=LC.create(n);i&&qu(o,i),qu(o,r);const a=new Uint8Array(16),c=EC(a);Mu(c,0,BigInt(i?i.length:0),!0),Mu(c,8,BigInt(r.length),!0),o.update(a);const l=o.digest();return di(n,a),l}const FC=t=>(e,s,r)=>({encrypt(i,n){const o=i.length;n=Bu(o+16,n,!1),n.set(i);const a=n.subarray(0,-16);t(e,s,a,a,1);const c=Fu(t,e,s,a,r);return n.set(c,o),di(c),n},decrypt(i,n){n=Bu(i.length-16,n,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=Fu(t,e,s,o,r);if(!NC(a,c))throw new Error("invalid tag");return n.set(i.subarray(0,-16)),t(e,s,n,n,1),di(c),n}});_C({blockSize:64,nonceLength:12,tagLength:16},FC(MC));class wp extends Rc{constructor(e,s){super(),this.finished=!1,this.destroyed=!1,O1(e);const r=Oo(s);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,n=new Uint8Array(i);n.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return hi(this),this.iHash.update(e),this}digestInto(e){hi(this),_n(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:s,iHash:r,finished:i,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=s._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const yp=(t,e,s)=>new wp(t,e).update(s).digest();yp.create=(t,e)=>new wp(t,e);function zC(t,e,s,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,r);const i=BigInt(32),n=BigInt(4294967295),o=Number(s>>i&n),a=Number(s&n),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function WC(t,e,s){return t&e^~t&s}function HC(t,e,s){return t&e^t&s^e&s}let VC=class extends Rc{constructor(e,s,r,i){super(),this.blockLen=e,this.outputLen=s,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ca(this.buffer)}update(e){hi(this);const{view:s,buffer:r,blockLen:i}=this;e=Oo(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(i-this.pos,n-o);if(a===i){const c=ca(e);for(;i<=n-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(s,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){hi(this),np(e,this),this.finished=!0;const{buffer:s,view:r,blockLen:i,isLE:n}=this;let{pos:o}=this;s[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)s[h]=0;zC(r,i-8,BigInt(this.length*8),n),this.process(r,0);const a=ca(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const r=e.slice(0,s);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:s,buffer:r,length:i,finished:n,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=n,e.destroyed=o,i%s&&e.buffer.set(r),e}};const KC=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$s=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ts=new Uint32Array(64);class GC extends VC{constructor(){super(64,32,8,!1),this.A=$s[0]|0,this.B=$s[1]|0,this.C=$s[2]|0,this.D=$s[3]|0,this.E=$s[4]|0,this.F=$s[5]|0,this.G=$s[6]|0,this.H=$s[7]|0}get(){const{A:e,B:s,C:r,D:i,E:n,F:o,G:a,H:c}=this;return[e,s,r,i,n,o,a,c]}set(e,s,r,i,n,o,a,c){this.A=e|0,this.B=s|0,this.C=r|0,this.D=i|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,s){for(let h=0;h<16;h++,s+=4)Ts[h]=e.getUint32(s,!1);for(let h=16;h<64;h++){const d=Ts[h-15],f=Ts[h-2],m=ss(d,7)^ss(d,18)^d>>>3,g=ss(f,17)^ss(f,19)^f>>>10;Ts[h]=g+Ts[h-7]+m+Ts[h-16]|0}let{A:r,B:i,C:n,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=ss(a,6)^ss(a,11)^ss(a,25),f=u+d+WC(a,c,l)+KC[h]+Ts[h]|0,m=(ss(r,2)^ss(r,13)^ss(r,22))+HC(r,i,n)|0;u=l,l=c,c=a,a=o+f|0,o=n,n=i,i=r,r=f+m|0}r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,n,o,a,c,l,u)}roundClean(){Ts.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Lc=op(()=>new GC);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const $o=BigInt(0),To=BigInt(1),JC=BigInt(2);function pr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Sn(t){if(!pr(t))throw new Error("Uint8Array expected")}function pi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const YC=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function fi(t){Sn(t);let e="";for(let s=0;s<t.length;s++)e+=YC[t[s]];return e}function Zr(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Bc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?$o:BigInt("0x"+t)}const gs={_0:48,_9:57,A:65,F:70,a:97,f:102};function zu(t){if(t>=gs._0&&t<=gs._9)return t-gs._0;if(t>=gs.A&&t<=gs.F)return t-(gs.A-10);if(t>=gs.a&&t<=gs.f)return t-(gs.a-10)}function gi(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,s=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(s);for(let i=0,n=0;i<s;i++,n+=2){const o=zu(t.charCodeAt(n)),a=zu(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}r[i]=o*16+a}return r}function or(t){return Bc(fi(t))}function dn(t){return Sn(t),Bc(fi(Uint8Array.from(t).reverse()))}function mi(t,e){return gi(t.toString(16).padStart(e*2,"0"))}function ko(t,e){return mi(t,e).reverse()}function ZC(t){return gi(Zr(t))}function Pt(t,e,s){let r;if(typeof e=="string")try{r=gi(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(pr(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof s=="number"&&i!==s)throw new Error(t+" of length "+s+" expected, got "+i);return r}function pn(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Sn(i),e+=i.length}const s=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const n=t[r];s.set(n,i),i+=n.length}return s}function XC(t,e){if(t.length!==e.length)return!1;let s=0;for(let r=0;r<t.length;r++)s|=t[r]^e[r];return s===0}function QC(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const ua=t=>typeof t=="bigint"&&$o<=t;function xo(t,e,s){return ua(t)&&ua(e)&&ua(s)&&e<=t&&t<s}function Is(t,e,s,r){if(!xo(e,s,r))throw new Error("expected valid "+t+": "+s+" <= n < "+r+", got "+e)}function bp(t){let e;for(e=0;t>$o;t>>=To,e+=1);return e}function eI(t,e){return t>>BigInt(e)&To}function tI(t,e,s){return t|(s?To:$o)<<BigInt(e)}const Mc=t=>(JC<<BigInt(t-1))-To,ha=t=>new Uint8Array(t),Wu=t=>Uint8Array.from(t);function vp(t,e,s){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof s!="function")throw new Error("hmacFn must be a function");let r=ha(t),i=ha(t),n=0;const o=()=>{r.fill(1),i.fill(0),n=0},a=(...u)=>s(i,r,...u),c=(u=ha())=>{i=a(Wu([0]),u),r=a(),u.length!==0&&(i=a(Wu([1]),u),r=a())},l=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const h=[];for(;u<e;){r=a();const d=r.slice();h.push(d),u+=r.length}return pn(...h)};return(u,h)=>{o(),c(u);let d;for(;!(d=h(l()));)c();return o(),d}}const sI={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||pr(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function _i(t,e,s={}){const r=(i,n,o)=>{const a=sI[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+n+", got "+c)};for(const[i,n]of Object.entries(e))r(i,n,!1);for(const[i,n]of Object.entries(s))r(i,n,!0);return t}const rI=()=>{throw new Error("not implemented")};function hc(t){const e=new WeakMap;return(s,...r)=>{const i=e.get(s);if(i!==void 0)return i;const n=t(s,...r);return e.set(s,n),n}}var iI=Object.freeze({__proto__:null,isBytes:pr,abytes:Sn,abool:pi,bytesToHex:fi,numberToHexUnpadded:Zr,hexToNumber:Bc,hexToBytes:gi,bytesToNumberBE:or,bytesToNumberLE:dn,numberToBytesBE:mi,numberToBytesLE:ko,numberToVarBytesBE:ZC,ensureBytes:Pt,concatBytes:pn,equalBytes:XC,utf8ToBytes:QC,inRange:xo,aInRange:Is,bitLen:bp,bitGet:eI,bitSet:tI,bitMask:Mc,createHmacDrbg:vp,validateObject:_i,notImplemented:rI,memoized:hc});const Ze=BigInt(0),Le=BigInt(1),Qs=BigInt(2),nI=BigInt(3),dc=BigInt(4),Hu=BigInt(5),Vu=BigInt(8);function vt(t,e){const s=t%e;return s>=Ze?s:e+s}function Ep(t,e,s){if(e<Ze)throw new Error("invalid exponent, negatives unsupported");if(s<=Ze)throw new Error("invalid modulus");if(s===Le)return Ze;let r=Le;for(;e>Ze;)e&Le&&(r=r*t%s),t=t*t%s,e>>=Le;return r}function Jt(t,e,s){let r=t;for(;e-- >Ze;)r*=r,r%=s;return r}function pc(t,e){if(t===Ze)throw new Error("invert: expected non-zero number");if(e<=Ze)throw new Error("invert: expected positive modulus, got "+e);let s=vt(t,e),r=e,i=Ze,n=Le;for(;s!==Ze;){const o=r/s,a=r%s,c=i-n*o;r=s,s=a,i=n,n=c}if(r!==Le)throw new Error("invert: does not exist");return vt(i,e)}function oI(t){const e=(t-Le)/Qs;let s,r,i;for(s=t-Le,r=0;s%Qs===Ze;s/=Qs,r++);for(i=Qs;i<t&&Ep(i,e,t)!==t-Le;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(t+Le)/dc;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(s+Le)/Qs;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,l=o.pow(o.mul(o.ONE,i),s),u=o.pow(a,n),h=o.pow(a,s);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let m=o.sqr(h);d<c&&!o.eql(m,o.ONE);d++)m=o.sqr(m);const f=o.pow(l,Le<<BigInt(c-d-1));l=o.sqr(f),u=o.mul(u,f),h=o.mul(h,l),c=d}return u}}function aI(t){if(t%dc===nI){const e=(t+Le)/dc;return function(s,r){const i=s.pow(r,e);if(!s.eql(s.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%Vu===Hu){const e=(t-Hu)/Vu;return function(s,r){const i=s.mul(r,Qs),n=s.pow(i,e),o=s.mul(r,n),a=s.mul(s.mul(o,Qs),n),c=s.mul(o,s.sub(a,s.ONE));if(!s.eql(s.sqr(c),r))throw new Error("Cannot find square root");return c}}return oI(t)}const cI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function lI(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},s=cI.reduce((r,i)=>(r[i]="function",r),e);return _i(t,s)}function uI(t,e,s){if(s<Ze)throw new Error("invalid exponent, negatives unsupported");if(s===Ze)return t.ONE;if(s===Le)return e;let r=t.ONE,i=e;for(;s>Ze;)s&Le&&(r=t.mul(r,i)),i=t.sqr(i),s>>=Le;return r}function hI(t,e){const s=new Array(e.length),r=e.reduce((n,o,a)=>t.is0(o)?n:(s[a]=n,t.mul(n,o)),t.ONE),i=t.inv(r);return e.reduceRight((n,o,a)=>t.is0(o)?n:(s[a]=t.mul(n,s[a]),t.mul(n,o)),i),s}function Cp(t,e){const s=e!==void 0?e:t.toString(2).length,r=Math.ceil(s/8);return{nBitLength:s,nByteLength:r}}function Ip(t,e,s=!1,r={}){if(t<=Ze)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:n}=Cp(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:s,BITS:i,BYTES:n,MASK:Mc(i),ZERO:Ze,ONE:Le,create:c=>vt(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ze<=c&&c<t},is0:c=>c===Ze,isOdd:c=>(c&Le)===Le,neg:c=>vt(-c,t),eql:(c,l)=>c===l,sqr:c=>vt(c*c,t),add:(c,l)=>vt(c+l,t),sub:(c,l)=>vt(c-l,t),mul:(c,l)=>vt(c*l,t),pow:(c,l)=>uI(a,c,l),div:(c,l)=>vt(c*pc(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>pc(c,t),sqrt:r.sqrt||(c=>(o||(o=aI(t)),o(a,c))),invertBatch:c=>hI(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>s?ko(c,n):mi(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return s?dn(c):or(c)}});return Object.freeze(a)}function Ap(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Np(t){const e=Ap(t);return e+Math.ceil(e/2)}function dI(t,e,s=!1){const r=t.length,i=Ap(e),n=Np(e);if(r<16||r<n||r>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+r);const o=s?dn(t):or(t),a=vt(o,e-Le)+Le;return s?ko(a,i):mi(a,i)}const Ku=BigInt(0),qn=BigInt(1);function da(t,e){const s=e.negate();return t?s:e}function _p(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function pa(t,e){_p(t,e);const s=Math.ceil(e/t)+1,r=2**(t-1);return{windows:s,windowSize:r}}function pI(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((s,r)=>{if(!(s instanceof e))throw new Error("invalid point at index "+r)})}function fI(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((s,r)=>{if(!e.isValid(s))throw new Error("invalid scalar at index "+r)})}const fa=new WeakMap,Sp=new WeakMap;function ga(t){return Sp.get(t)||1}function gI(t,e){return{constTimeNegate:da,hasPrecomputes(s){return ga(s)!==1},unsafeLadder(s,r,i=t.ZERO){let n=s;for(;r>Ku;)r&qn&&(i=i.add(n)),n=n.double(),r>>=qn;return i},precomputeWindow(s,r){const{windows:i,windowSize:n}=pa(r,e),o=[];let a=s,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(s,r,i){const{windows:n,windowSize:o}=pa(s,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**s-1),u=2**s,h=BigInt(s);for(let d=0;d<n;d++){const f=d*o;let m=Number(i&l);i>>=h,m>o&&(m-=u,i+=qn);const g=f,p=f+Math.abs(m)-1,w=d%2!==0,y=m<0;m===0?c=c.add(da(w,r[g])):a=a.add(da(y,r[p]))}return{p:a,f:c}},wNAFUnsafe(s,r,i,n=t.ZERO){const{windows:o,windowSize:a}=pa(s,e),c=BigInt(2**s-1),l=2**s,u=BigInt(s);for(let h=0;h<o;h++){const d=h*a;if(i===Ku)break;let f=Number(i&c);if(i>>=u,f>a&&(f-=l,i+=qn),f===0)continue;let m=r[d+Math.abs(f)-1];f<0&&(m=m.negate()),n=n.add(m)}return n},getPrecomputes(s,r,i){let n=fa.get(r);return n||(n=this.precomputeWindow(r,s),s!==1&&fa.set(r,i(n))),n},wNAFCached(s,r,i){const n=ga(s);return this.wNAF(n,this.getPrecomputes(n,s,i),r)},wNAFCachedUnsafe(s,r,i,n){const o=ga(s);return o===1?this.unsafeLadder(s,r,n):this.wNAFUnsafe(o,this.getPrecomputes(o,s,i),r,n)},setWindowSize(s,r){_p(r,e),Sp.set(s,r),fa.delete(s)}}}function mI(t,e,s,r){if(pI(s,t),fI(r,e),s.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,n=bp(BigInt(s.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let u=i;for(let h=l;h>=0;h-=o){c.fill(i);for(let f=0;f<r.length;f++){const m=r[f],g=Number(m>>BigInt(h)&BigInt(a));c[g]=c[g].add(s[f])}let d=i;for(let f=c.length-1,m=i;f>0;f--)m=m.add(c[f]),d=d.add(m);if(u=u.add(d),h!==0)for(let f=0;f<o;f++)u=u.double()}return u}function Pp(t){return lI(t.Fp),_i(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Cp(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const $r=BigInt(0),ma=BigInt(1);function wI(t){return _i(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function yI(t){const e=wI(t),{P:s}=e,r=y=>vt(y,s),i=e.montgomeryBits,n=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(y=>y),c=e.powPminus2||(y=>Ep(y,s-BigInt(2),s));function l(y,C,O){const T=r(y*(C-O));return C=r(C-T),O=r(O+T),[C,O]}const u=(e.a-BigInt(2))/BigInt(4);function h(y,C){Is("u",y,$r,s),Is("scalar",C,$r,s);const O=C,T=y;let P=ma,N=$r,$=y,v=ma,k=$r,S;for(let L=BigInt(i-1);L>=$r;L--){const E=O>>L&ma;k^=E,S=l(k,P,$),P=S[0],$=S[1],S=l(k,N,v),N=S[0],v=S[1],k=E;const A=P+N,I=r(A*A),x=P-N,U=r(x*x),_=I-U,M=$+v,q=$-v,F=r(q*A),X=r(M*x),G=F+X,oe=F-X;$=r(G*G),v=r(T*r(oe*oe)),P=r(I*U),N=r(_*(I+r(u*_)))}S=l(k,P,$),P=S[0],$=S[1],S=l(k,N,v),N=S[0],v=S[1];const R=c(N);return r(P*R)}function d(y){return ko(r(y),n)}function f(y){const C=Pt("u coordinate",y,n);return o===32&&(C[31]&=127),dn(C)}function m(y){const C=Pt("scalar",y),O=C.length;if(O!==n&&O!==o){let T=""+n+" or "+o;throw new Error("invalid scalar, expected "+T+" bytes, got "+O)}return dn(a(C))}function g(y,C){const O=f(C),T=m(y),P=h(O,T);if(P===$r)throw new Error("invalid private or public key received");return d(P)}const p=d(e.Gu);function w(y){return g(y,p)}return{scalarMult:g,scalarMultBase:w,getSharedSecret:(y,C)=>g(y,C),getPublicKey:y=>w(y),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:p}}const fc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const bI=BigInt(1),Gu=BigInt(2),vI=BigInt(3),EI=BigInt(5);BigInt(8);function CI(t){const e=BigInt(10),s=BigInt(20),r=BigInt(40),i=BigInt(80),n=fc,o=t*t%n*t%n,a=Jt(o,Gu,n)*o%n,c=Jt(a,bI,n)*t%n,l=Jt(c,EI,n)*c%n,u=Jt(l,e,n)*l%n,h=Jt(u,s,n)*u%n,d=Jt(h,r,n)*h%n,f=Jt(d,i,n)*d%n,m=Jt(f,i,n)*d%n,g=Jt(m,e,n)*l%n;return{pow_p_5_8:Jt(g,Gu,n)*t%n,b2:o}}function II(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}yI({P:fc,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=fc,{pow_p_5_8:s,b2:r}=CI(t);return vt(Jt(s,vI,e)*r,e)},adjustScalarBytes:II,randomBytes:ap});function Ju(t){t.lowS!==void 0&&pi("lowS",t.lowS),t.prehash!==void 0&&pi("prehash",t.prehash)}function AI(t){const e=Pp(t);_i(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:s,Fp:r,a:i}=e;if(s){if(!r.eql(i,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof s!="object"||typeof s.beta!="bigint"||typeof s.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:NI,hexToBytes:_I}=iI;class SI extends Error{constructor(e=""){super(e)}}const bs={Err:SI,_tlv:{encode:(t,e)=>{const{Err:s}=bs;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length&1)throw new s("tlv.encode: unpadded data");const r=e.length/2,i=Zr(r);if(i.length/2&128)throw new s("tlv.encode: long form length too big");const n=r>127?Zr(i.length/2|128):"";return Zr(t)+n+i+e},decode(t,e){const{Err:s}=bs;let r=0;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new s("tlv.decode: wrong tlv");const i=e[r++],n=!!(i&128);let o=0;if(!n)o=i;else{const c=i&127;if(!c)throw new s("tlv.decode(long): indefinite length not supported");if(c>4)throw new s("tlv.decode(long): byte length is too big");const l=e.subarray(r,r+c);if(l.length!==c)throw new s("tlv.decode: length bytes not complete");if(l[0]===0)throw new s("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(r+=c,o<128)throw new s("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new s("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=bs;if(t<Es)throw new e("integer: negative integers are not allowed");let s=Zr(t);if(Number.parseInt(s[0],16)&8&&(s="00"+s),s.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return s},decode(t){const{Err:e}=bs;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return NI(t)}},toSig(t){const{Err:e,_int:s,_tlv:r}=bs,i=typeof t=="string"?_I(t):t;Sn(i);const{v:n,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,n),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:s.decode(a),s:s.decode(l)}},hexFromSig(t){const{_tlv:e,_int:s}=bs,r=e.encode(2,s.encode(t.r)),i=e.encode(2,s.encode(t.s)),n=r+i;return e.encode(48,n)}},Es=BigInt(0),He=BigInt(1);BigInt(2);const Yu=BigInt(3);BigInt(4);function PI(t){const e=AI(t),{Fp:s}=e,r=Ip(e.n,e.nBitLength),i=e.toBytes||((g,p,w)=>{const y=p.toAffine();return pn(Uint8Array.from([4]),s.toBytes(y.x),s.toBytes(y.y))}),n=e.fromBytes||(g=>{const p=g.subarray(1),w=s.fromBytes(p.subarray(0,s.BYTES)),y=s.fromBytes(p.subarray(s.BYTES,2*s.BYTES));return{x:w,y}});function o(g){const{a:p,b:w}=e,y=s.sqr(g),C=s.mul(y,g);return s.add(s.add(C,s.mul(g,p)),w)}if(!s.eql(s.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return xo(g,He,e.n)}function c(g){const{allowedPrivateKeyLengths:p,nByteLength:w,wrapPrivateKey:y,n:C}=e;if(p&&typeof g!="bigint"){if(pr(g)&&(g=fi(g)),typeof g!="string"||!p.includes(g.length))throw new Error("invalid private key");g=g.padStart(w*2,"0")}let O;try{O=typeof g=="bigint"?g:or(Pt("private key",g,w))}catch{throw new Error("invalid private key, expected hex or "+w+" bytes, got "+typeof g)}return y&&(O=vt(O,C)),Is("private key",O,He,C),O}function l(g){if(!(g instanceof d))throw new Error("ProjectivePoint expected")}const u=hc((g,p)=>{const{px:w,py:y,pz:C}=g;if(s.eql(C,s.ONE))return{x:w,y};const O=g.is0();p==null&&(p=O?s.ONE:s.inv(C));const T=s.mul(w,p),P=s.mul(y,p),N=s.mul(C,p);if(O)return{x:s.ZERO,y:s.ZERO};if(!s.eql(N,s.ONE))throw new Error("invZ was invalid");return{x:T,y:P}}),h=hc(g=>{if(g.is0()){if(e.allowInfinityPoint&&!s.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:p,y:w}=g.toAffine();if(!s.isValid(p)||!s.isValid(w))throw new Error("bad point: x or y not FE");const y=s.sqr(w),C=o(p);if(!s.eql(y,C))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(p,w,y){if(this.px=p,this.py=w,this.pz=y,p==null||!s.isValid(p))throw new Error("x required");if(w==null||!s.isValid(w))throw new Error("y required");if(y==null||!s.isValid(y))throw new Error("z required");Object.freeze(this)}static fromAffine(p){const{x:w,y}=p||{};if(!p||!s.isValid(w)||!s.isValid(y))throw new Error("invalid affine point");if(p instanceof d)throw new Error("projective point not allowed");const C=O=>s.eql(O,s.ZERO);return C(w)&&C(y)?d.ZERO:new d(w,y,s.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(p){const w=s.invertBatch(p.map(y=>y.pz));return p.map((y,C)=>y.toAffine(w[C])).map(d.fromAffine)}static fromHex(p){const w=d.fromAffine(n(Pt("pointHex",p)));return w.assertValidity(),w}static fromPrivateKey(p){return d.BASE.multiply(c(p))}static msm(p,w){return mI(d,r,p,w)}_setWindowSize(p){m.setWindowSize(this,p)}assertValidity(){h(this)}hasEvenY(){const{y:p}=this.toAffine();if(s.isOdd)return!s.isOdd(p);throw new Error("Field doesn't support isOdd")}equals(p){l(p);const{px:w,py:y,pz:C}=this,{px:O,py:T,pz:P}=p,N=s.eql(s.mul(w,P),s.mul(O,C)),$=s.eql(s.mul(y,P),s.mul(T,C));return N&&$}negate(){return new d(this.px,s.neg(this.py),this.pz)}double(){const{a:p,b:w}=e,y=s.mul(w,Yu),{px:C,py:O,pz:T}=this;let P=s.ZERO,N=s.ZERO,$=s.ZERO,v=s.mul(C,C),k=s.mul(O,O),S=s.mul(T,T),R=s.mul(C,O);return R=s.add(R,R),$=s.mul(C,T),$=s.add($,$),P=s.mul(p,$),N=s.mul(y,S),N=s.add(P,N),P=s.sub(k,N),N=s.add(k,N),N=s.mul(P,N),P=s.mul(R,P),$=s.mul(y,$),S=s.mul(p,S),R=s.sub(v,S),R=s.mul(p,R),R=s.add(R,$),$=s.add(v,v),v=s.add($,v),v=s.add(v,S),v=s.mul(v,R),N=s.add(N,v),S=s.mul(O,T),S=s.add(S,S),v=s.mul(S,R),P=s.sub(P,v),$=s.mul(S,k),$=s.add($,$),$=s.add($,$),new d(P,N,$)}add(p){l(p);const{px:w,py:y,pz:C}=this,{px:O,py:T,pz:P}=p;let N=s.ZERO,$=s.ZERO,v=s.ZERO;const k=e.a,S=s.mul(e.b,Yu);let R=s.mul(w,O),L=s.mul(y,T),E=s.mul(C,P),A=s.add(w,y),I=s.add(O,T);A=s.mul(A,I),I=s.add(R,L),A=s.sub(A,I),I=s.add(w,C);let x=s.add(O,P);return I=s.mul(I,x),x=s.add(R,E),I=s.sub(I,x),x=s.add(y,C),N=s.add(T,P),x=s.mul(x,N),N=s.add(L,E),x=s.sub(x,N),v=s.mul(k,I),N=s.mul(S,E),v=s.add(N,v),N=s.sub(L,v),v=s.add(L,v),$=s.mul(N,v),L=s.add(R,R),L=s.add(L,R),E=s.mul(k,E),I=s.mul(S,I),L=s.add(L,E),E=s.sub(R,E),E=s.mul(k,E),I=s.add(I,E),R=s.mul(L,I),$=s.add($,R),R=s.mul(x,I),N=s.mul(A,N),N=s.sub(N,R),R=s.mul(A,L),v=s.mul(x,v),v=s.add(v,R),new d(N,$,v)}subtract(p){return this.add(p.negate())}is0(){return this.equals(d.ZERO)}wNAF(p){return m.wNAFCached(this,p,d.normalizeZ)}multiplyUnsafe(p){const{endo:w,n:y}=e;Is("scalar",p,Es,y);const C=d.ZERO;if(p===Es)return C;if(this.is0()||p===He)return this;if(!w||m.hasPrecomputes(this))return m.wNAFCachedUnsafe(this,p,d.normalizeZ);let{k1neg:O,k1:T,k2neg:P,k2:N}=w.splitScalar(p),$=C,v=C,k=this;for(;T>Es||N>Es;)T&He&&($=$.add(k)),N&He&&(v=v.add(k)),k=k.double(),T>>=He,N>>=He;return O&&($=$.negate()),P&&(v=v.negate()),v=new d(s.mul(v.px,w.beta),v.py,v.pz),$.add(v)}multiply(p){const{endo:w,n:y}=e;Is("scalar",p,He,y);let C,O;if(w){const{k1neg:T,k1:P,k2neg:N,k2:$}=w.splitScalar(p);let{p:v,f:k}=this.wNAF(P),{p:S,f:R}=this.wNAF($);v=m.constTimeNegate(T,v),S=m.constTimeNegate(N,S),S=new d(s.mul(S.px,w.beta),S.py,S.pz),C=v.add(S),O=k.add(R)}else{const{p:T,f:P}=this.wNAF(p);C=T,O=P}return d.normalizeZ([C,O])[0]}multiplyAndAddUnsafe(p,w,y){const C=d.BASE,O=(P,N)=>N===Es||N===He||!P.equals(C)?P.multiplyUnsafe(N):P.multiply(N),T=O(this,w).add(O(p,y));return T.is0()?void 0:T}toAffine(p){return u(this,p)}isTorsionFree(){const{h:p,isTorsionFree:w}=e;if(p===He)return!0;if(w)return w(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:p,clearCofactor:w}=e;return p===He?this:w?w(d,this):this.multiplyUnsafe(e.h)}toRawBytes(p=!0){return pi("isCompressed",p),this.assertValidity(),i(d,this,p)}toHex(p=!0){return pi("isCompressed",p),fi(this.toRawBytes(p))}}d.BASE=new d(e.Gx,e.Gy,s.ONE),d.ZERO=new d(s.ZERO,s.ONE,s.ZERO);const f=e.nBitLength,m=gI(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function OI(t){const e=Pp(t);return _i(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function $I(t){const e=OI(t),{Fp:s,n:r}=e,i=s.BYTES+1,n=2*s.BYTES+1;function o(E){return vt(E,r)}function a(E){return pc(E,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:h}=PI({...e,toBytes(E,A,I){const x=A.toAffine(),U=s.toBytes(x.x),_=pn;return pi("isCompressed",I),I?_(Uint8Array.from([A.hasEvenY()?2:3]),U):_(Uint8Array.from([4]),U,s.toBytes(x.y))},fromBytes(E){const A=E.length,I=E[0],x=E.subarray(1);if(A===i&&(I===2||I===3)){const U=or(x);if(!xo(U,He,s.ORDER))throw new Error("Point is not on curve");const _=u(U);let M;try{M=s.sqrt(_)}catch(F){const X=F instanceof Error?": "+F.message:"";throw new Error("Point is not on curve"+X)}const q=(M&He)===He;return(I&1)===1!==q&&(M=s.neg(M)),{x:U,y:M}}else if(A===n&&I===4){const U=s.fromBytes(x.subarray(0,s.BYTES)),_=s.fromBytes(x.subarray(s.BYTES,2*s.BYTES));return{x:U,y:_}}else{const U=i,_=n;throw new Error("invalid Point, expected length of "+U+", or uncompressed "+_+", got "+A)}}}),d=E=>fi(mi(E,e.nByteLength));function f(E){const A=r>>He;return E>A}function m(E){return f(E)?o(-E):E}const g=(E,A,I)=>or(E.slice(A,I));class p{constructor(A,I,x){this.r=A,this.s=I,this.recovery=x,this.assertValidity()}static fromCompact(A){const I=e.nByteLength;return A=Pt("compactSignature",A,I*2),new p(g(A,0,I),g(A,I,2*I))}static fromDER(A){const{r:I,s:x}=bs.toSig(Pt("DER",A));return new p(I,x)}assertValidity(){Is("r",this.r,He,r),Is("s",this.s,He,r)}addRecoveryBit(A){return new p(this.r,this.s,A)}recoverPublicKey(A){const{r:I,s:x,recovery:U}=this,_=P(Pt("msgHash",A));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const M=U===2||U===3?I+e.n:I;if(M>=s.ORDER)throw new Error("recovery id 2 or 3 invalid");const q=(U&1)===0?"02":"03",F=c.fromHex(q+d(M)),X=a(M),G=o(-_*X),oe=o(x*X),le=c.BASE.multiplyAndAddUnsafe(F,G,oe);if(!le)throw new Error("point at infinify");return le.assertValidity(),le}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new p(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return gi(this.toDERHex())}toDERHex(){return bs.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return gi(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const w={isValidPrivateKey(E){try{return l(E),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const E=Np(e.n);return dI(e.randomBytes(E),e.n)},precompute(E=8,A=c.BASE){return A._setWindowSize(E),A.multiply(BigInt(3)),A}};function y(E,A=!0){return c.fromPrivateKey(E).toRawBytes(A)}function C(E){const A=pr(E),I=typeof E=="string",x=(A||I)&&E.length;return A?x===i||x===n:I?x===2*i||x===2*n:E instanceof c}function O(E,A,I=!0){if(C(E))throw new Error("first arg must be private key");if(!C(A))throw new Error("second arg must be public key");return c.fromHex(A).multiply(l(E)).toRawBytes(I)}const T=e.bits2int||function(E){if(E.length>8192)throw new Error("input is too large");const A=or(E),I=E.length*8-e.nBitLength;return I>0?A>>BigInt(I):A},P=e.bits2int_modN||function(E){return o(T(E))},N=Mc(e.nBitLength);function $(E){return Is("num < 2^"+e.nBitLength,E,Es,N),mi(E,e.nByteLength)}function v(E,A,I=k){if(["recovered","canonical"].some(ue=>ue in I))throw new Error("sign() legacy options not supported");const{hash:x,randomBytes:U}=e;let{lowS:_,prehash:M,extraEntropy:q}=I;_==null&&(_=!0),E=Pt("msgHash",E),Ju(I),M&&(E=Pt("prehashed msgHash",x(E)));const F=P(E),X=l(A),G=[$(X),$(F)];if(q!=null&&q!==!1){const ue=q===!0?U(s.BYTES):q;G.push(Pt("extraEntropy",ue))}const oe=pn(...G),le=F;function Ie(ue){const he=T(ue);if(!h(he))return;const zt=a(he),ct=c.BASE.multiply(he).toAffine(),je=o(ct.x);if(je===Es)return;const Xe=o(zt*o(le+je*X));if(Xe===Es)return;let us=(ct.x===je?0:2)|Number(ct.y&He),Ws=Xe;return _&&f(Xe)&&(Ws=m(Xe),us^=1),new p(je,Ws,us)}return{seed:oe,k2sig:Ie}}const k={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};function R(E,A,I=k){const{seed:x,k2sig:U}=v(E,A,I),_=e;return vp(_.hash.outputLen,_.nByteLength,_.hmac)(x,U)}c.BASE._setWindowSize(8);function L(E,A,I,x=S){const U=E;A=Pt("msgHash",A),I=Pt("publicKey",I);const{lowS:_,prehash:M,format:q}=x;if(Ju(x),"strict"in x)throw new Error("options.strict was renamed to lowS");if(q!==void 0&&q!=="compact"&&q!=="der")throw new Error("format must be compact or der");const F=typeof U=="string"||pr(U),X=!F&&!q&&typeof U=="object"&&U!==null&&typeof U.r=="bigint"&&typeof U.s=="bigint";if(!F&&!X)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let G,oe;try{if(X&&(G=new p(U.r,U.s)),F){try{q!=="compact"&&(G=p.fromDER(U))}catch(Xe){if(!(Xe instanceof bs.Err))throw Xe}!G&&q!=="der"&&(G=p.fromCompact(U))}oe=c.fromHex(I)}catch{return!1}if(!G||_&&G.hasHighS())return!1;M&&(A=e.hash(A));const{r:le,s:Ie}=G,ue=P(A),he=a(Ie),zt=o(ue*he),ct=o(le*he),je=c.BASE.multiplyAndAddUnsafe(oe,zt,ct)?.toAffine();return je?o(je.x)===le:!1}return{CURVE:e,getPublicKey:y,getSharedSecret:O,sign:R,verify:L,ProjectivePoint:c,Signature:p,utils:w}}function TI(t){return{hash:t,hmac:(e,...s)=>yp(t,e,M1(...s)),randomBytes:ap}}function kI(t,e){const s=r=>$I({...t,...TI(r)});return{...s(e),create:s}}const Op=Ip(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),xI=Op.create(BigInt("-3")),RI=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b");kI({a:xI,b:RI,Fp:Op,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Lc);const gc="base16",Fn="base64pad",Li="base64url",UI="utf8",wa=1,DI=2;function ya(t){const e=Lc(Ct(t,gc));return nt(e,gc)}function Tr(t){const e=Lc(Ct(t,UI));return nt(e,gc)}function zn(t,e,s){return`${t}?wc_ev=${s}&topic=${e}`}var LI=Object.defineProperty,BI=Object.defineProperties,MI=Object.getOwnPropertyDescriptors,Zu=Object.getOwnPropertySymbols,jI=Object.prototype.hasOwnProperty,qI=Object.prototype.propertyIsEnumerable,Xu=(t,e,s)=>e in t?LI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,FI=(t,e)=>{for(var s in e||(e={}))jI.call(e,s)&&Xu(t,s,e[s]);if(Zu)for(var s of Zu(e))qI.call(e,s)&&Xu(t,s,e[s]);return t},zI=(t,e)=>BI(t,MI(e));function Si(t){const e=[];return t.forEach(s=>{const[r,i]=s.split(":");e.push(`${r}:${i}`)}),e}function WI(t){const e=[];return Object.values(t).forEach(s=>{e.push(...Si(s.accounts))}),e}function HI(t,e){const s=[];return Object.values(t).forEach(r=>{Si(r.accounts).includes(e)&&s.push(...r.methods)}),s}function VI(t,e){const s=[];return Object.values(t).forEach(r=>{Si(r.accounts).includes(e)&&s.push(...r.events)}),s}function Ro(t){return t.includes(":")}function Xr(t){return Ro(t)?t.split(":")[0]:t}function Qu(t){var e,s,r;const i={};if(!qs(t))return i;for(const[n,o]of Object.entries(t)){const a=Ro(n)?[n]:o.chains,c=o.methods||[],l=o.events||[],u=Xr(n);i[u]=zI(FI({},i[u]),{chains:cs(a,(e=i[u])==null?void 0:e.chains),methods:cs(c,(s=i[u])==null?void 0:s.methods),events:cs(l,(r=i[u])==null?void 0:r.events)})}return i}function KI(t){const e={};return t?.forEach(s=>{var r;const[i,n]=s.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(s),(r=e[i].chains)==null||r.push(`${i}:${n}`)}),e}function eh(t,e){e=e.map(r=>r.replace("did:pkh:",""));const s=KI(e);for(const[r,i]of Object.entries(s))i.methods?i.methods=cs(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return s}function GI(t,e){var s,r,i,n,o,a;const c=Qu(t),l=Qu(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const d of h)u[d]={chains:cs((s=c[d])==null?void 0:s.chains,(r=l[d])==null?void 0:r.chains),methods:cs((i=c[d])==null?void 0:i.methods,(n=l[d])==null?void 0:n.methods),events:cs((o=c[d])==null?void 0:o.events,(a=l[d])==null?void 0:a.events)};return u}const JI={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},YI={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Z(t,e){const{message:s,code:r}=YI[t];return{message:e?`${s} ${e}`:s,code:r}}function Re(t,e){const{message:s,code:r}=JI[t];return{message:e?`${s} ${e}`:s,code:r}}function js(t,e){return!!Array.isArray(t)}function qs(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Et(t){return typeof t>"u"}function Ve(t,e){return e&&Et(t)?!0:typeof t=="string"&&!!t.trim().length}function jc(t,e){return e&&Et(t)?!0:typeof t=="number"&&!isNaN(t)}function ZI(t,e){const{requiredNamespaces:s}=e,r=Object.keys(t.namespaces),i=Object.keys(s);let n=!0;return sr(i,r)?(r.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=Si(a),h=s[o];(!sr(tp(o,h),u)||!sr(h.methods,c)||!sr(h.events,l))&&(n=!1)}),n):!1}function fo(t){return Ve(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function XI(t){if(Ve(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const s=e[0]+":"+e[1];return!!e[2]&&fo(s)}}return!1}function QI(t,e){let s=null;return Ve(t?.publicKey,!1)||(s=Z("MISSING_OR_INVALID",`${e} controller public key should be a string`)),s}function th(t){let e=!0;return js(t)?t.length&&(e=t.every(s=>Ve(s,!1))):e=!1,e}function eA(t,e,s){let r=null;return js(e)&&e.length?e.forEach(i=>{r||fo(i)||(r=Re("UNSUPPORTED_CHAINS",`${s}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):fo(t)||(r=Re("UNSUPPORTED_CHAINS",`${s}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function tA(t,e,s){let r=null;return Object.entries(t).forEach(([i,n])=>{if(r)return;const o=eA(i,tp(i,n),`${e} ${s}`);o&&(r=o)}),r}function sA(t,e){let s=null;return js(t)?t.forEach(r=>{s||XI(r)||(s=Re("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):s=Re("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),s}function rA(t,e){let s=null;return Object.values(t).forEach(r=>{if(s)return;const i=sA(r?.accounts,`${e} namespace`);i&&(s=i)}),s}function iA(t,e){let s=null;return th(t?.methods)?th(t?.events)||(s=Re("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):s=Re("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),s}function $p(t,e){let s=null;return Object.values(t).forEach(r=>{if(s)return;const i=iA(r,`${e}, namespace`);i&&(s=i)}),s}function nA(t,e,s){let r=null;if(t&&qs(t)){const i=$p(t,e);i&&(r=i);const n=tA(t,e,s);n&&(r=n)}else r=Z("MISSING_OR_INVALID",`${e}, ${s} should be an object with data`);return r}function ba(t,e){let s=null;if(t&&qs(t)){const r=$p(t,e);r&&(s=r);const i=rA(t,e);i&&(s=i)}else s=Z("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return s}function Tp(t){return Ve(t.protocol,!0)}function oA(t,e){let s=!1;return t?t&&js(t)&&t.length&&t.forEach(r=>{s=Tp(r)}):s=!0,s}function aA(t){return typeof t=="number"}function Kt(t){return typeof t<"u"&&typeof t!==null}function cA(t){return!(!t||typeof t!="object"||!t.code||!jc(t.code,!1)||!t.message||!Ve(t.message,!1))}function lA(t){return!(Et(t)||!Ve(t.method,!1))}function uA(t){return!(Et(t)||Et(t.result)&&Et(t.error)||!jc(t.id,!1)||!Ve(t.jsonrpc,!1))}function hA(t){return!(Et(t)||!Ve(t.name,!1))}function sh(t,e){return!(!fo(e)||!WI(t).includes(e))}function dA(t,e,s){return Ve(s,!1)?HI(t,e).includes(s):!1}function pA(t,e,s){return Ve(s,!1)?VI(t,e).includes(s):!1}function rh(t,e,s){let r=null;const i=fA(t),n=gA(e),o=Object.keys(i),a=Object.keys(n),c=ih(Object.keys(t)),l=ih(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(r=Z("NON_CONFORMING_NAMESPACES",`${s} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),sr(o,a)||(r=Z("NON_CONFORMING_NAMESPACES",`${s} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||r)return;const d=Si(e[h].accounts);d.includes(h)||(r=Z("NON_CONFORMING_NAMESPACES",`${s} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{r||(sr(i[h].methods,n[h].methods)?sr(i[h].events,n[h].events)||(r=Z("NON_CONFORMING_NAMESPACES",`${s} namespaces events don't satisfy namespace events for ${h}`)):r=Z("NON_CONFORMING_NAMESPACES",`${s} namespaces methods don't satisfy namespace methods for ${h}`))}),r}function fA(t){const e={};return Object.keys(t).forEach(s=>{var r;s.includes(":")?e[s]=t[s]:(r=t[s].chains)==null||r.forEach(i=>{e[i]={methods:t[s].methods,events:t[s].events}})}),e}function ih(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function gA(t){const e={};return Object.keys(t).forEach(s=>{s.includes(":")?e[s]=t[s]:Si(t[s].accounts)?.forEach(i=>{e[i]={accounts:t[s].accounts.filter(n=>n.includes(`${i}:`)),methods:t[s].methods,events:t[s].events}})}),e}function mA(t,e){return jc(t,!1)&&t<=e.max&&t>=e.min}const va={};class Bi{static get(e){return va[e]}static set(e,s){va[e]=s}static delete(e){delete va[e]}}const kp="wc",xp=2,Rp="client",qc=`${kp}@${xp}:${Rp}:`,Ea={name:Rp,logger:"error"},nh="WALLETCONNECT_DEEPLINK_CHOICE",wA="proposal",oh="Proposal expired",yA="session",kr=j.SEVEN_DAYS,bA="engine",Fe={wc_sessionPropose:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1104},res:{ttl:j.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1106},res:{ttl:j.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1112},res:{ttl:j.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1114},res:{ttl:j.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:j.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:j.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1119}}},Ca={min:j.FIVE_MINUTES,max:j.SEVEN_DAYS},rs={idle:"IDLE",active:"ACTIVE"},ah={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},vA="request",EA=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],CA="wc",IA="auth",AA="authKeys",NA="pairingTopics",_A="requests",Uo=`${CA}@${1.5}:${IA}:`,to=`${Uo}:PUB_KEY`;var SA=Object.defineProperty,PA=Object.defineProperties,OA=Object.getOwnPropertyDescriptors,ch=Object.getOwnPropertySymbols,$A=Object.prototype.hasOwnProperty,TA=Object.prototype.propertyIsEnumerable,mc=(t,e,s)=>e in t?SA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,_e=(t,e)=>{for(var s in e||(e={}))$A.call(e,s)&&mc(t,s,e[s]);if(ch)for(var s of ch(e))TA.call(e,s)&&mc(t,s,e[s]);return t},lt=(t,e)=>PA(t,OA(e)),D=(t,e,s)=>mc(t,typeof e!="symbol"?e+"":e,s);class kA extends FE{constructor(e){super(e),D(this,"name",bA),D(this,"events",new _c),D(this,"initialized",!1),D(this,"requestQueue",{state:rs.idle,queue:[]}),D(this,"sessionRequestQueue",{state:rs.idle,queue:[]}),D(this,"requestQueueDelay",j.ONE_SECOND),D(this,"expectedPairingMethodMap",new Map),D(this,"recentlyDeletedMap",new Map),D(this,"recentlyDeletedLimit",200),D(this,"relayMessageCache",[]),D(this,"pendingSessions",new Map),D(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Fe)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},j.toMiliseconds(this.requestQueueDelay)))}),D(this,"connect",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const r=lt(_e({},s),{requiredNamespaces:s.requiredNamespaces||{},optionalNamespaces:s.optionalNamespaces||{}});await this.isValidConnect(r),r.optionalNamespaces=GI(r.requiredNamespaces,r.optionalNamespaces),r.requiredNamespaces={};const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=r;let u=i,h,d=!1;try{if(u){const P=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=P.active}}catch(P){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),P}if(!u||!d){const{topic:P,uri:N}=await this.client.core.pairing.create();u=P,h=N}if(!u){const{message:P}=Z("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(P)}const f=await this.client.core.crypto.generateKeyPair(),m=Fe.wc_sessionPropose.req.ttl||j.FIVE_MINUTES,g=mt(m),p=lt(_e(_e({requiredNamespaces:n,optionalNamespaces:o,relays:l??[{protocol:xd}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:As()}),w=Ne("session_connect",p.id),{reject:y,resolve:C,done:O}=Sr(m,oh),T=({id:P})=>{P===p.id&&(this.client.events.off("proposal_expire",T),this.pendingSessions.delete(p.id),this.events.emit(w,{error:{message:oh,code:0}}))};return this.client.events.on("proposal_expire",T),this.events.once(w,({error:P,session:N})=>{this.client.events.off("proposal_expire",T),P?y(P):N&&C(N)}),await this.sendRequest({topic:u,method:"wc_sessionPropose",params:p,throwOnFailedPublish:!0,clientRpcId:p.id}),await this.setProposal(p.id,p),{uri:h,approval:O}}),D(this,"pair",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(s)}catch(r){throw this.client.logger.error("pair() failed"),r}}),D(this,"approve",async s=>{var r,i,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(r=s?.id)==null?void 0:r.toString(),trace:[Ht.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(v){throw o.setError(Vs.no_internet_connection),v}try{await this.isValidProposalId(s?.id)}catch(v){throw this.client.logger.error(`approve() -> proposal.get(${s?.id}) failed`),o.setError(Vs.proposal_not_found),v}try{await this.isValidApprove(s)}catch(v){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Vs.session_approve_namespace_validation_failure),v}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=s,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:m,proposer:g,requiredNamespaces:p,optionalNamespaces:w}=f;let y=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:m});y||(y=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:Ht.session_approve_started,properties:{topic:m,trace:[Ht.session_approve_started,Ht.session_namespaces_validation_success]}}));const C=await this.client.core.crypto.generateKeyPair(),O=g.publicKey,T=await this.client.core.crypto.generateSharedKey(C,O),P=_e(_e(_e({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:C,metadata:this.client.metadata},expiry:mt(kr)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),N=Te.relay;y.addTrace(Ht.subscribing_session_topic);try{await this.client.core.relayer.subscribe(T,{transportType:N})}catch(v){throw y.setError(Vs.subscribe_session_topic_failure),v}y.addTrace(Ht.subscribe_session_topic_success);const $=lt(_e({},P),{topic:T,requiredNamespaces:p,optionalNamespaces:w,pairingTopic:m,acknowledged:!1,self:P.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:C,transportType:Te.relay});await this.client.session.set(T,$),y.addTrace(Ht.store_session);try{y.addTrace(Ht.publishing_session_settle),await this.sendRequest({topic:T,method:"wc_sessionSettle",params:P,throwOnFailedPublish:!0}).catch(v=>{throw y?.setError(Vs.session_settle_publish_failure),v}),y.addTrace(Ht.session_settle_publish_success),y.addTrace(Ht.publishing_session_approve),await this.sendResult({id:a,topic:m,result:{relay:{protocol:c??"irn"},responderPublicKey:C},throwOnFailedPublish:!0}).catch(v=>{throw y?.setError(Vs.session_approve_publish_failure),v}),y.addTrace(Ht.session_approve_publish_success)}catch(v){throw this.client.logger.error(v),this.client.session.delete(T,Re("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(T),v}return this.client.core.eventClient.deleteEvent({eventId:y.eventId}),await this.client.core.pairing.updateMetadata({topic:m,metadata:g.metadata}),await this.client.proposal.delete(a,Re("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}),await this.setExpiry(T,mt(kr)),{topic:T,acknowledged:()=>Promise.resolve(this.client.session.get(T))}}),D(this,"reject",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(s)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:r,reason:i}=s;let n;try{n=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}n&&(await this.sendError({id:r,topic:n,error:i,rpcOpts:Fe.wc_sessionPropose.reject}),await this.client.proposal.delete(r,Re("USER_DISCONNECTED")))}),D(this,"update",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(s)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:r,namespaces:i}=s,{done:n,resolve:o,reject:a}=Sr(),c=As(),l=Gr().toString(),u=this.client.session.get(r).namespaces;return this.events.once(Ne("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(r,{namespaces:i}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(r,{namespaces:u}),a(h)}),{acknowledged:n}}),D(this,"extend",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(s)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:r}=s,i=As(),{done:n,resolve:o,reject:a}=Sr();return this.events.once(Ne("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,mt(kr)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),D(this,"request",async s=>{this.isInitialized();try{await this.isValidRequest(s)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}const{chainId:r,request:i,topic:n,expiry:o=Fe.wc_sessionRequest.req.ttl}=s,a=this.client.session.get(n);a?.transportType===Te.relay&&await this.confirmOnlineStateOrThrow();const c=As(),l=Gr().toString(),{done:u,resolve:h,reject:d}=Sr(o,"Request expired. Please try again.");this.events.once(Ne("session_request",c),({error:w,result:y})=>{w?d(w):h(y)});const f="wc_sessionRequest",m=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(m)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:f,params:{request:lt(_e({},i),{expiryTimestamp:mt(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:m}).catch(w=>d(w)),this.client.events.emit("session_request_sent",{topic:n,request:i,chainId:r,id:c}),await u();const g={request:lt(_e({},i),{expiryTimestamp:mt(o)}),chainId:r},p=this.shouldSetTVF(f,g);return await Promise.all([new Promise(async w=>{await this.sendRequest(_e({clientRpcId:c,relayRpcId:l,topic:n,method:f,params:g,expiry:o,throwOnFailedPublish:!0},p&&{tvf:this.getTVFParams(c,g)})).catch(y=>d(y)),this.client.events.emit("session_request_sent",{topic:n,request:i,chainId:r,id:c}),w()}),new Promise(async w=>{var y;if(!((y=a.sessionConfig)!=null&&y.disableDeepLink)){const C=await I1(this.client.core.storage,nh);await v1({id:c,topic:n,wcDeepLink:C})}w()}),u()]).then(w=>w[2])}),D(this,"respond",async s=>{this.isInitialized(),await this.isValidRespond(s);const{topic:r,response:i}=s,{id:n}=i,o=this.client.session.get(r);o.transportType===Te.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);ms(i)?await this.sendResult({id:n,topic:r,result:i.result,throwOnFailedPublish:!0,appLink:a}):ns(i)&&await this.sendError({id:n,topic:r,error:i.error,appLink:a}),this.cleanupAfterResponse(s)}),D(this,"ping",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(s)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:r}=s;if(this.client.session.keys.includes(r)){const i=As(),n=Gr().toString(),{done:o,resolve:a,reject:c}=Sr();this.events.once(Ne("session_ping",i),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),D(this,"emit",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(s);const{topic:r,event:i,chainId:n}=s,o=Gr().toString(),a=As();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:i,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),D(this,"disconnect",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(s);const{topic:r}=s;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:Re("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{const{message:i}=Z("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(i)}}),D(this,"find",s=>(this.isInitialized(),this.client.session.getAll().filter(r=>ZI(r,s)))),D(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),D(this,"authenticate",async(s,r)=>{var i;this.isInitialized(),this.isValidAuthenticate(s);const n=r&&this.client.core.linkModeSupportedApps.includes(r)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=n?Te.link_mode:Te.relay;o===Te.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:d,exp:f,nbf:m,methods:g=[],expiry:p}=s,w=[...s.resources||[]],{topic:y,uri:C}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:y,uri:C}});const O=await this.client.core.crypto.generateKeyPair(),T=ya(O);if(await Promise.all([this.client.auth.authKeys.set(to,{responseTopic:T,publicKey:O}),this.client.auth.pairingTopics.set(T,{topic:T,pairingTopic:y})]),await this.client.core.relayer.subscribe(T,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${y}`),g.length>0){const{namespace:_}=ei(a[0]);let M=gC(_,"request",g);eo(w)&&(M=wC(M,w.pop())),w.push(M)}const P=p&&p>Fe.wc_sessionAuthenticate.req.ttl?p:Fe.wc_sessionAuthenticate.req.ttl,N={authPayload:{type:d??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:f,nbf:m,resources:w},requester:{publicKey:O,metadata:this.client.metadata},expiryTimestamp:mt(P)},$={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},v={requiredNamespaces:{},optionalNamespaces:$,relays:[{protocol:"irn"}],pairingTopic:y,proposer:{publicKey:O,metadata:this.client.metadata},expiryTimestamp:mt(Fe.wc_sessionPropose.req.ttl),id:As()},{done:k,resolve:S,reject:R}=Sr(P,"Request expired"),L=As(),E=Ne("session_connect",v.id),A=Ne("session_request",L),I=async({error:_,session:M})=>{this.events.off(A,x),_?R(_):M&&S({session:M})},x=async _=>{var M,q,F;if(await this.deletePendingAuthRequest(L,{message:"fulfilled",code:0}),_.error){const he=Re("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return _.error.code===he.code?void 0:(this.events.off(E,I),R(_.error.message))}await this.deleteProposal(v.id),this.events.off(E,I);const{cacaos:X,responder:G}=_.result,oe=[],le=[];for(const he of X){await xu({cacao:he,projectId:this.client.core.projectId})||(this.client.logger.error(he,"Signature verification failed"),R(Re("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:zt}=he,ct=eo(zt.resources),je=[ac(zt.iss)],Xe=po(zt.iss);if(ct){const us=Ru(ct),Ws=Uu(ct);oe.push(...us),je.push(...Ws)}for(const us of je)le.push(`${us}:${Xe}`)}const Ie=await this.client.core.crypto.generateSharedKey(O,G.publicKey);let ue;oe.length>0&&(ue={topic:Ie,acknowledged:!0,self:{publicKey:O,metadata:this.client.metadata},peer:G,controller:G.publicKey,expiry:mt(kr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:y,namespaces:eh([...new Set(oe)],[...new Set(le)]),transportType:o},await this.client.core.relayer.subscribe(Ie,{transportType:o}),await this.client.session.set(Ie,ue),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:G.metadata}),ue=this.client.session.get(Ie)),(M=this.client.metadata.redirect)!=null&&M.linkMode&&(q=G.metadata.redirect)!=null&&q.linkMode&&(F=G.metadata.redirect)!=null&&F.universal&&r&&(this.client.core.addLinkModeSupportedApp(G.metadata.redirect.universal),this.client.session.update(Ie,{transportType:Te.link_mode})),S({auths:X,session:ue})};this.events.once(E,I),this.events.once(A,x);let U;try{if(n){const _=tr("wc_sessionAuthenticate",N,L);this.client.core.history.set(y,_);const M=await this.client.core.crypto.encode("",_,{type:DI,encoding:Li});U=zn(r,y,M)}else await Promise.all([this.sendRequest({topic:y,method:"wc_sessionAuthenticate",params:N,expiry:s.expiry,throwOnFailedPublish:!0,clientRpcId:L}),this.sendRequest({topic:y,method:"wc_sessionPropose",params:v,expiry:Fe.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:v.id})])}catch(_){throw this.events.off(E,I),this.events.off(A,x),_}return await this.setProposal(v.id,v),await this.setAuthRequest(L,{request:lt(_e({},N),{verifyContext:{}}),pairingTopic:y,transportType:o}),{uri:U??C,response:k}}),D(this,"approveSessionAuthenticate",async s=>{const{id:r,auths:i}=s,n=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[Ks.authenticated_session_approve_started]}});try{this.isInitialized()}catch(p){throw n.setError(xi.no_internet_connection),p}const o=this.getPendingAuthRequest(r);if(!o)throw n.setError(xi.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);const a=o.transportType||Te.relay;a===Te.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=ya(c),h={type:wa,receiverPublicKey:c,senderPublicKey:l},d=[],f=[];for(const p of i){if(!await xu({cacao:p,projectId:this.client.core.projectId})){n.setError(xi.invalid_cacao);const T=Re("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:u,error:T,encodeOpts:h}),new Error(T.message)}n.addTrace(Ks.cacaos_verified);const{p:w}=p,y=eo(w.resources),C=[ac(w.iss)],O=po(w.iss);if(y){const T=Ru(y),P=Uu(y);d.push(...T),C.push(...P)}for(const T of C)f.push(`${T}:${O}`)}const m=await this.client.core.crypto.generateSharedKey(l,c);n.addTrace(Ks.create_authenticated_session_topic);let g;if(d?.length>0){g={topic:m,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:mt(kr),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:eh([...new Set(d)],[...new Set(f)]),transportType:a},n.addTrace(Ks.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(m,{transportType:a})}catch(p){throw n.setError(xi.subscribe_authenticated_session_topic_failure),p}n.addTrace(Ks.subscribe_authenticated_session_topic_success),await this.client.session.set(m,g),n.addTrace(Ks.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Ks.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:r,result:{cacaos:i,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(p){throw n.setError(xi.authenticated_session_approve_publish_failure),p}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:g}}),D(this,"rejectSessionAuthenticate",async s=>{this.isInitialized();const{id:r,reason:i}=s,n=this.getPendingAuthRequest(r);if(!n)throw new Error(`Could not find pending auth request with id ${r}`);n.transportType===Te.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=ya(o),l={type:wa,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:i,encodeOpts:l,rpcOpts:Fe.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.client.proposal.delete(r,Re("USER_DISCONNECTED"))}),D(this,"formatAuthMessage",s=>{this.isInitialized();const{request:r,iss:i}=s;return dp(r,i)}),D(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const s=this.relayMessageCache.shift();s&&await this.onRelayMessage(s)}catch(s){this.client.logger.error(s)}},50)}),D(this,"cleanupDuplicatePairings",async s=>{if(s.pairingTopic)try{const r=this.client.core.pairing.pairings.get(s.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===s.peer.metadata.url&&n.topic&&n.topic!==r.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),D(this,"deleteSession",async s=>{var r;const{topic:i,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=s,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,Re("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(nh).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===i&&this.deletePendingSessionRequest(l.id,Re("USER_DISCONNECTED"))}),i===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=rs.idle),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),D(this,"deleteProposal",async(s,r)=>{if(r)try{const i=this.client.proposal.get(s);this.client.core.eventClient.getEvent({topic:i.pairingTopic})?.setError(Vs.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(s,Re("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"proposal")}),D(this,"deletePendingSessionRequest",async(s,r,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(s,r),i?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==s),i&&(this.sessionRequestQueue.state=rs.idle,this.client.events.emit("session_request_expire",{id:s}))}),D(this,"deletePendingAuthRequest",async(s,r,i=!1)=>{await Promise.all([this.client.auth.requests.delete(s,r),i?Promise.resolve():this.client.core.expirer.del(s)])}),D(this,"setExpiry",async(s,r)=>{this.client.session.keys.includes(s)&&(this.client.core.expirer.set(s,r),await this.client.session.update(s,{expiry:r}))}),D(this,"setProposal",async(s,r)=>{this.client.core.expirer.set(s,mt(Fe.wc_sessionPropose.req.ttl)),await this.client.proposal.set(s,r)}),D(this,"setAuthRequest",async(s,r)=>{const{request:i,pairingTopic:n,transportType:o=Te.relay}=r;this.client.core.expirer.set(s,i.expiryTimestamp),await this.client.auth.requests.set(s,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:s,pairingTopic:n,verifyContext:i.verifyContext,transportType:o})}),D(this,"setPendingSessionRequest",async s=>{const{id:r,topic:i,params:n,verifyContext:o}=s,a=n.request.expiryTimestamp||mt(Fe.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:i,params:n,verifyContext:o})}),D(this,"sendRequest",async s=>{const{topic:r,method:i,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h}=s,d=tr(i,n,c);let f;const m=!!u;try{const w=m?Li:Fn;f=await this.client.core.crypto.encode(r,d,{encoding:w})}catch(w){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),w}let g;if(EA.includes(i)){const w=Tr(JSON.stringify(d)),y=Tr(f);g=await this.client.core.verify.register({id:y,decryptedId:w})}const p=Fe[i].req;if(p.attestation=g,o&&(p.ttl=o),a&&(p.id=a),this.client.core.history.set(r,d),m){const w=zn(u,r,f);await global.Linking.openURL(w,this.client.name)}else{const w=Fe[i].req;o&&(w.ttl=o),a&&(w.id=a),w.tvf=lt(_e({},h),{correlationId:d.id}),l?(w.internal=lt(_e({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,f,w)):this.client.core.relayer.publish(r,f,w).catch(y=>this.client.logger.error(y))}return d.id}),D(this,"sendResult",async s=>{const{id:r,topic:i,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=s,l=yo(r,n);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const m=h?Li:Fn;u=await this.client.core.crypto.encode(i,l,lt(_e({},a||{}),{encoding:m}))}catch(m){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),m}let d,f;try{d=await this.client.core.history.get(i,r);const m=d.request;try{this.shouldSetTVF(m.method,m.params)&&(f=this.getTVFParams(r,m.params,n))}catch(g){this.client.logger.warn("sendResult() -> getTVFParams() failed",g)}}catch(m){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${r}) failed`),m}if(h){const m=zn(c,i,u);await global.Linking.openURL(m,this.client.name)}else{const m=d.request.method,g=Fe[m].res;g.tvf=lt(_e({},f),{correlationId:r}),o?(g.internal=lt(_e({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,u,g)):this.client.core.relayer.publish(i,u,g).catch(p=>this.client.logger.error(p))}await this.client.core.history.resolve(l)}),D(this,"sendError",async s=>{const{id:r,topic:i,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=s,l=Bh(r,n);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const f=h?Li:Fn;u=await this.client.core.crypto.encode(i,l,lt(_e({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),f}let d;try{d=await this.client.core.history.get(i,r)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${i}, ${r}) failed`),f}if(h){const f=zn(c,i,u);await global.Linking.openURL(f,this.client.name)}else{const f=d.request.method,m=a||Fe[f].res;this.client.core.relayer.publish(i,u,m)}await this.client.core.history.resolve(l)}),D(this,"cleanup",async()=>{const s=[],r=[];this.client.session.getAll().forEach(i=>{let n=!1;Pr(i.expiry)&&(n=!0),this.client.core.crypto.keychain.has(i.topic)||(n=!0),n&&s.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{Pr(i.expiryTimestamp)&&r.push(i.id)}),await Promise.all([...s.map(i=>this.deleteSession({topic:i})),...r.map(i=>this.deleteProposal(i))])}),D(this,"onProviderMessageEvent",async s=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(s):await this.onRelayMessage(s)}),D(this,"onRelayEventRequest",async s=>{this.requestQueue.queue.push(s),await this.processRequestsQueue()}),D(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===rs.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=rs.active;const s=this.requestQueue.queue.shift();if(s)try{await this.processRequest(s)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=rs.idle}),D(this,"processRequest",async s=>{const{topic:r,payload:i,attestation:n,transportType:o,encryptedId:a}=s,c=i.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:i,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,i);case"wc_sessionPing":return await this.onSessionPingRequest(r,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:i,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:i,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),D(this,"onRelayEventResponse",async s=>{const{topic:r,payload:i,transportType:n}=s,o=(await this.client.core.history.get(r,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(r,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,i);case"wc_sessionExtend":return this.onSessionExtendResponse(r,i);case"wc_sessionPing":return this.onSessionPingResponse(r,i);case"wc_sessionRequest":return this.onSessionRequestResponse(r,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),D(this,"onRelayEventUnknownPayload",s=>{const{topic:r}=s,{message:i}=Z("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),D(this,"shouldIgnorePairingRequest",s=>{const{topic:r,requestMethod:i}=s,n=this.expectedPairingMethodMap.get(r);return!n||n.includes(i)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),D(this,"onSessionProposeRequest",async s=>{const{topic:r,payload:i,attestation:n,encryptedId:o}=s,{params:a,id:c}=i;try{const l=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(ws.proposal_listener_not_found)),this.isValidConnect(_e({},i.params));const u=a.expiryTimestamp||mt(Fe.wc_sessionPropose.req.ttl),h=_e({id:c,pairingTopic:r,expiryTimestamp:u},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:n,hash:Tr(JSON.stringify(i)),encryptedId:o,metadata:h.proposer.metadata});l?.addTrace(is.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(l){await this.sendError({id:c,topic:r,error:l,rpcOpts:Fe.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),D(this,"onSessionProposeResponse",async(s,r,i)=>{const{id:n}=r;if(ms(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(n,{sessionTopic:u,pairingTopic:s,proposalId:n,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:s})}else if(ns(r)){await this.client.proposal.delete(n,Re("USER_DISCONNECTED"));const o=Ne("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),D(this,"onSessionSettleRequest",async(s,r)=>{const{id:i,params:n}=r;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=r.params,f=[...this.pendingSessions.values()].find(p=>p.sessionTopic===s);if(!f)return this.client.logger.error(`Pending session not found for topic ${s}`);const m=this.client.proposal.get(f.proposalId),g=lt(_e(_e(_e({topic:s,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:m.requiredNamespaces,optionalNamespaces:m.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:Te.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(Ne("session_connect",f.proposalId),{session:g}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:r.id,topic:s,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:i,topic:s,error:o}),this.client.logger.error(o)}}),D(this,"onSessionSettleResponse",async(s,r)=>{const{id:i}=r;ms(r)?(await this.client.session.update(s,{acknowledged:!0}),this.events.emit(Ne("session_approve",i),{})):ns(r)&&(await this.client.session.delete(s,Re("USER_DISCONNECTED")),this.events.emit(Ne("session_approve",i),{error:r.error}))}),D(this,"onSessionUpdateRequest",async(s,r)=>{const{params:i,id:n}=r;try{const o=`${s}_session_update`,a=Bi.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:s,error:Re("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(_e({topic:s},i));try{Bi.set(o,n),await this.client.session.update(s,{namespaces:i.namespaces}),await this.sendResult({id:n,topic:s,result:!0,throwOnFailedPublish:!0})}catch(c){throw Bi.delete(o),c}this.client.events.emit("session_update",{id:n,topic:s,params:i})}catch(o){await this.sendError({id:n,topic:s,error:o}),this.client.logger.error(o)}}),D(this,"isRequestOutOfSync",(s,r)=>r.toString().slice(0,-3)<s.toString().slice(0,-3)),D(this,"onSessionUpdateResponse",(s,r)=>{const{id:i}=r,n=Ne("session_update",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);ms(r)?this.events.emit(Ne("session_update",i),{}):ns(r)&&this.events.emit(Ne("session_update",i),{error:r.error})}),D(this,"onSessionExtendRequest",async(s,r)=>{const{id:i}=r;try{this.isValidExtend({topic:s}),await this.setExpiry(s,mt(kr)),await this.sendResult({id:i,topic:s,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:i,topic:s})}catch(n){await this.sendError({id:i,topic:s,error:n}),this.client.logger.error(n)}}),D(this,"onSessionExtendResponse",(s,r)=>{const{id:i}=r,n=Ne("session_extend",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);ms(r)?this.events.emit(Ne("session_extend",i),{}):ns(r)&&this.events.emit(Ne("session_extend",i),{error:r.error})}),D(this,"onSessionPingRequest",async(s,r)=>{const{id:i}=r;try{this.isValidPing({topic:s}),await this.sendResult({id:i,topic:s,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:s})}catch(n){await this.sendError({id:i,topic:s,error:n}),this.client.logger.error(n)}}),D(this,"onSessionPingResponse",(s,r)=>{const{id:i}=r,n=Ne("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);ms(r)?this.events.emit(Ne("session_ping",i),{}):ns(r)&&this.events.emit(Ne("session_ping",i),{error:r.error})},500)}),D(this,"onSessionDeleteRequest",async(s,r)=>{const{id:i}=r;try{this.isValidDisconnect({topic:s,reason:r.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(Ke.publish,async()=>{n(await this.deleteSession({topic:s,id:i}))})}),this.sendResult({id:i,topic:s,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:s,error:Re("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),D(this,"onSessionRequest",async s=>{var r,i,n;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=s,{id:h,params:d}=a;try{await this.isValidRequest(_e({topic:o},d));const f=this.client.session.get(o),m=await this.getVerifyContext({attestationId:c,hash:Tr(JSON.stringify(tr("wc_sessionRequest",d,h))),encryptedId:l,metadata:f.peer.metadata,transportType:u}),g={id:h,topic:o,params:d,verifyContext:m};await this.setPendingSessionRequest(g),u===Te.link_mode&&(r=f.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((i=f.peer.metadata.redirect)==null?void 0:i.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(f){await this.sendError({id:h,topic:o,error:f}),this.client.logger.error(f)}}),D(this,"onSessionRequestResponse",(s,r)=>{const{id:i}=r,n=Ne("session_request",i);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);ms(r)?this.events.emit(Ne("session_request",i),{result:r.result}):ns(r)&&this.events.emit(Ne("session_request",i),{error:r.error})}),D(this,"onSessionEventRequest",async(s,r)=>{const{id:i,params:n}=r;try{const o=`${s}_session_event_${n.event.name}`,a=Bi.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(_e({topic:s},n)),this.client.events.emit("session_event",{id:i,topic:s,params:n}),Bi.set(o,i)}catch(o){await this.sendError({id:i,topic:s,error:o}),this.client.logger.error(o)}}),D(this,"onSessionAuthenticateResponse",(s,r)=>{const{id:i}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:s,payload:r}),ms(r)?this.events.emit(Ne("session_request",i),{result:r.result}):ns(r)&&this.events.emit(Ne("session_request",i),{error:r.error})}),D(this,"onSessionAuthenticateRequest",async s=>{var r;const{topic:i,payload:n,attestation:o,encryptedId:a,transportType:c}=s;try{const{requester:l,authPayload:u,expiryTimestamp:h}=n.params,d=await this.getVerifyContext({attestationId:o,hash:Tr(JSON.stringify(n)),encryptedId:a,metadata:l.metadata,transportType:c}),f={requester:l,pairingTopic:i,id:n.id,authPayload:u,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(n.id,{request:f,pairingTopic:i,transportType:c}),c===Te.link_mode&&(r=l.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:n.params,id:n.id,verifyContext:d})}catch(l){this.client.logger.error(l);const u=n.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(n.params.requester.metadata,c),f={type:wa,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:n.id,topic:i,error:l,encodeOpts:f,rpcOpts:Fe.wc_sessionAuthenticate.autoReject,appLink:d})}}),D(this,"addSessionRequestToSessionRequestQueue",s=>{this.sessionRequestQueue.queue.push(s)}),D(this,"cleanupAfterResponse",s=>{this.deletePendingSessionRequest(s.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=rs.idle,this.processSessionRequestQueue()},j.toMiliseconds(this.requestQueueDelay))}),D(this,"cleanupPendingSentRequestsForTopic",({topic:s,error:r})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(n=>n.topic===s&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=Ne("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(Ne("session_request",n.request.id),{error:r})})}),D(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===rs.active){this.client.logger.info("session request queue is already active.");return}const s=this.sessionRequestQueue.queue[0];if(!s){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=rs.active,this.emitSessionRequest(s)}catch(r){this.client.logger.error(r)}}),D(this,"emitSessionRequest",s=>{this.client.events.emit("session_request",s)}),D(this,"onPairingCreated",s=>{if(s.methods&&this.expectedPairingMethodMap.set(s.topic,s.methods),s.active)return;const r=this.client.proposal.getAll().find(i=>i.pairingTopic===s.topic);r&&this.onSessionProposeRequest({topic:s.topic,payload:tr("wc_sessionPropose",lt(_e({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id)})}),D(this,"isValidConnect",async s=>{if(!Kt(s)){const{message:l}=Z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(s)}`);throw new Error(l)}const{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=s;if(Et(r)||await this.isValidPairingTopic(r),!oA(c)){const{message:l}=Z("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!Et(i)&&qs(i)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(i,"requiredNamespaces")}if(!Et(n)&&qs(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),Et(o)||this.validateSessionProps(o,"sessionProperties"),!Et(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(i||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(u=>l.includes(u)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),D(this,"validateNamespaces",(s,r)=>{const i=nA(s,"connect()",r);if(i)throw new Error(i.message)}),D(this,"isValidApprove",async s=>{if(!Kt(s))throw new Error(Z("MISSING_OR_INVALID",`approve() params: ${s}`).message);const{id:r,namespaces:i,relayProtocol:n,sessionProperties:o,scopedProperties:a}=s;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);const c=this.client.proposal.get(r),l=ba(i,"approve()");if(l)throw new Error(l.message);const u=rh(c.requiredNamespaces,i,"approve()");if(u)throw new Error(u.message);if(!Ve(n,!0)){const{message:h}=Z("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(h)}if(Et(o)||this.validateSessionProps(o,"sessionProperties"),!Et(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(i));if(!Object.keys(a).every(d=>h.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),D(this,"isValidReject",async s=>{if(!Kt(s)){const{message:n}=Z("MISSING_OR_INVALID",`reject() params: ${s}`);throw new Error(n)}const{id:r,reason:i}=s;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!cA(i)){const{message:n}=Z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(n)}}),D(this,"isValidSessionSettleRequest",s=>{if(!Kt(s)){const{message:l}=Z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${s}`);throw new Error(l)}const{relay:r,controller:i,namespaces:n,expiry:o}=s;if(!Tp(r)){const{message:l}=Z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=QI(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=ba(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Pr(o)){const{message:l}=Z("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),D(this,"isValidUpdate",async s=>{if(!Kt(s)){const{message:c}=Z("MISSING_OR_INVALID",`update() params: ${s}`);throw new Error(c)}const{topic:r,namespaces:i}=s;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const n=this.client.session.get(r),o=ba(i,"update()");if(o)throw new Error(o.message);const a=rh(n.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),D(this,"isValidExtend",async s=>{if(!Kt(s)){const{message:i}=Z("MISSING_OR_INVALID",`extend() params: ${s}`);throw new Error(i)}const{topic:r}=s;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),D(this,"isValidRequest",async s=>{if(!Kt(s)){const{message:c}=Z("MISSING_OR_INVALID",`request() params: ${s}`);throw new Error(c)}const{topic:r,request:i,chainId:n,expiry:o}=s;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!sh(a,n)){const{message:c}=Z("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!lA(i)){const{message:c}=Z("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!dA(a,n,i.method)){const{message:c}=Z("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}if(o&&!mA(o,Ca)){const{message:c}=Z("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Ca.min} and ${Ca.max}`);throw new Error(c)}}),D(this,"isValidRespond",async s=>{var r;if(!Kt(s)){const{message:o}=Z("MISSING_OR_INVALID",`respond() params: ${s}`);throw new Error(o)}const{topic:i,response:n}=s;try{await this.isValidSessionTopic(i)}catch(o){throw(r=s?.response)!=null&&r.id&&this.cleanupAfterResponse(s),o}if(!uA(n)){const{message:o}=Z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),D(this,"isValidPing",async s=>{if(!Kt(s)){const{message:i}=Z("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(i)}const{topic:r}=s;await this.isValidSessionOrPairingTopic(r)}),D(this,"isValidEmit",async s=>{if(!Kt(s)){const{message:a}=Z("MISSING_OR_INVALID",`emit() params: ${s}`);throw new Error(a)}const{topic:r,event:i,chainId:n}=s;await this.isValidSessionTopic(r);const{namespaces:o}=this.client.session.get(r);if(!sh(o,n)){const{message:a}=Z("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!hA(i)){const{message:a}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!pA(o,n,i.name)){const{message:a}=Z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),D(this,"isValidDisconnect",async s=>{if(!Kt(s)){const{message:i}=Z("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(i)}const{topic:r}=s;await this.isValidSessionOrPairingTopic(r)}),D(this,"isValidAuthenticate",s=>{const{chains:r,uri:i,domain:n,nonce:o}=s;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!Ve(i,!1))throw new Error("uri is required parameter");if(!Ve(n,!1))throw new Error("domain is required parameter");if(!Ve(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>ei(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=ei(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),D(this,"getVerifyContext",async s=>{const{attestationId:r,hash:i,encryptedId:n,metadata:o,transportType:a}=s,c={verified:{verifyUrl:o.verifyUrl||Qi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===Te.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:r,hash:i,encryptedId:n,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),D(this,"validateSessionProps",(s,r)=>{Object.values(s).forEach((i,n)=>{if(i==null){const{message:o}=Z("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${i} for key ${Object.keys(s)[n]}`);throw new Error(o)}})}),D(this,"getPendingAuthRequest",s=>{const r=this.client.auth.requests.get(s);return typeof r=="object"?r:void 0}),D(this,"addToRecentlyDeleted",(s,r)=>{if(this.recentlyDeletedMap.set(s,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=n)break;this.recentlyDeletedMap.delete(o)}}}),D(this,"checkRecentlyDeleted",s=>{const r=this.recentlyDeletedMap.get(s);if(r){const{message:i}=Z("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${s}`);throw new Error(i)}}),D(this,"isLinkModeEnabled",(s,r)=>{var i,n,o,a,c,l,u,h,d;return!s||r!==Te.link_mode?!1:((n=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=s?.redirect)==null?void 0:u.universal)!==void 0&&((h=s?.redirect)==null?void 0:h.universal)!==""&&((d=s?.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(s.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),D(this,"getAppLinkIfEnabled",(s,r)=>{var i;return this.isLinkModeEnabled(s,r)?(i=s?.redirect)==null?void 0:i.universal:void 0}),D(this,"handleLinkModeMessage",({url:s})=>{if(!s||!s.includes("wc_ev")||!s.includes("topic"))return;const r=Nu(s,"topic")||"",i=decodeURIComponent(Nu(s,"wc_ev")||""),n=this.client.session.keys.includes(r);n&&this.client.session.update(r,{transportType:Te.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:i,sessionExists:n})}),D(this,"registerLinkModeListeners",async()=>{var s;if(A1()||rp()&&(s=this.client.metadata.redirect)!=null&&s.linkMode){const r=global==null?void 0:global.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await r.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),D(this,"shouldSetTVF",(s,r)=>{if(!r||s!=="wc_sessionRequest")return!1;const{request:i}=r;return Object.keys(ah).includes(i.method)}),D(this,"getTVFParams",(s,r,i)=>{var n,o;try{const a=r.request.method,c=this.extractTxHashesFromResult(a,i);return lt(_e({correlationId:s,rpcMethods:[a],chainId:r.chainId},this.isValidContractData(r.request.params)&&{contractAddresses:[(o=(n=r.request.params)==null?void 0:n[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),D(this,"isValidContractData",s=>{var r;if(!s)return!1;try{const i=s?.data||((r=s?.[0])==null?void 0:r.data);if(!i.startsWith("0x"))return!1;const n=i.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),D(this,"extractTxHashesFromResult",(s,r)=>{try{const i=ah[s];if(typeof r=="string")return[r];const n=r[i.key];if(js(n))return s==="solana_signAllTransactions"?n.map(o=>tC(o)):n;if(typeof n=="string")return[n]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,s=this.client.core.relayer.messages.getWithoutAck(e);for(const[r,i]of Object.entries(s))for(const n of i)try{await this.onProviderMessageEvent({topic:r,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=Z("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ke.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:s,message:r,attestation:i,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(to)?this.client.auth.authKeys.get(to):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(s,r,{receiverPublicKey:o,encoding:n===Te.link_mode?Li:Fn});Ac(a)?(this.client.core.history.set(s,a),await this.onRelayEventRequest({topic:s,payload:a,attestation:i,transportType:n,encryptedId:Tr(r)})):Nc(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:s,payload:a,transportType:n}),this.client.core.history.delete(s,a.id)):await this.onRelayEventUnknownPayload({topic:s,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(s,r)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(jt.expired,async e=>{const{topic:s,id:r}=b1(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,Z("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,Z("EXPIRED"),!0);s?this.client.session.keys.includes(s)&&(await this.deleteSession({topic:s,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:s})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(Xs.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Xs.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Ve(e,!1)){const{message:s}=Z("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(s)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:s}=Z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(s)}if(Pr(this.client.core.pairing.pairings.get(e).expiry)){const{message:s}=Z("EXPIRED",`pairing topic: ${e}`);throw new Error(s)}}async isValidSessionTopic(e){if(!Ve(e,!1)){const{message:s}=Z("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(s)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:s}=Z("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(s)}if(Pr(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:s}=Z("EXPIRED",`session topic: ${e}`);throw new Error(s)}if(!this.client.core.crypto.keychain.has(e)){const{message:s}=Z("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(s)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ve(e,!1)){const{message:s}=Z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(s)}else{const{message:s}=Z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(s)}}async isValidProposalId(e){if(!aA(e)){const{message:s}=Z("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(s)}if(!this.client.proposal.keys.includes(e)){const{message:s}=Z("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(s)}if(Pr(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:s}=Z("EXPIRED",`proposal id: ${e}`);throw new Error(s)}}}class xA extends vr{constructor(e,s){super(e,s,wA,qc),this.core=e,this.logger=s}}let RA=class extends vr{constructor(e,s){super(e,s,yA,qc),this.core=e,this.logger=s}};class UA extends vr{constructor(e,s){super(e,s,vA,qc,r=>r.id),this.core=e,this.logger=s}}class DA extends vr{constructor(e,s){super(e,s,AA,Uo,()=>to),this.core=e,this.logger=s}}class LA extends vr{constructor(e,s){super(e,s,NA,Uo),this.core=e,this.logger=s}}class BA extends vr{constructor(e,s){super(e,s,_A,Uo,r=>r.id),this.core=e,this.logger=s}}var MA=Object.defineProperty,jA=(t,e,s)=>e in t?MA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ia=(t,e,s)=>jA(t,typeof e!="symbol"?e+"":e,s);class qA{constructor(e,s){this.core=e,this.logger=s,Ia(this,"authKeys"),Ia(this,"pairingTopics"),Ia(this,"requests"),this.authKeys=new DA(this.core,this.logger),this.pairingTopics=new LA(this.core,this.logger),this.requests=new BA(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var FA=Object.defineProperty,zA=(t,e,s)=>e in t?FA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ce=(t,e,s)=>zA(t,typeof e!="symbol"?e+"":e,s);let WA=class Up extends qE{constructor(e){super(e),ce(this,"protocol",kp),ce(this,"version",xp),ce(this,"name",Ea.name),ce(this,"metadata"),ce(this,"core"),ce(this,"logger"),ce(this,"events",new gr.EventEmitter),ce(this,"engine"),ce(this,"session"),ce(this,"proposal"),ce(this,"pendingRequest"),ce(this,"auth"),ce(this,"signConfig"),ce(this,"on",(r,i)=>this.events.on(r,i)),ce(this,"once",(r,i)=>this.events.once(r,i)),ce(this,"off",(r,i)=>this.events.off(r,i)),ce(this,"removeListener",(r,i)=>this.events.removeListener(r,i)),ce(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),ce(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"update",async r=>{try{return await this.engine.update(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"request",async r=>{try{return await this.engine.request(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"find",r=>{try{return this.engine.find(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),ce(this,"authenticate",async(r,i)=>{try{return await this.engine.authenticate(r,i)}catch(n){throw this.logger.error(n.message),n}}),ce(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),ce(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),this.name=e?.name||Ea.name,this.metadata=w1(e?.metadata),this.signConfig=e?.signConfig;const s=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Ic(wn({level:e?.logger||Ea.logger}));this.core=e?.core||new BE(e),this.logger=ht(s,this.name),this.session=new RA(this.core,this.logger),this.proposal=new xA(this.core,this.logger),this.pendingRequest=new UA(this.core,this.logger),this.engine=new kA(this),this.auth=new qA(this.core,this.logger)}static async init(e){const s=new Up(e);return await s.initialize(),s}get context(){return xt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},j.toMiliseconds(j.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const lh="error",HA="wss://relay.walletconnect.org",VA="wc",KA="universal_provider",Wn=`${VA}@2:${KA}:`,Dp="https://rpc.walletconnect.org/v1/",Hr="generic",GA=`${Dp}bundler`,Ft={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function JA(){}function Fc(t){return t==null||typeof t!="object"&&typeof t!="function"}function zc(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function YA(t){if(Fc(t))return t;if(Array.isArray(t)||zc(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),s=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new s(t);if(t instanceof RegExp){const r=new s(t);return r.lastIndex=t.lastIndex,r}if(t instanceof DataView)return new s(t.buffer.slice(0));if(t instanceof Error){const r=new s(t.message);return r.stack=t.stack,r.name=t.name,r.cause=t.cause,r}if(typeof File<"u"&&t instanceof File)return new s([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const r=Object.create(e);return Object.assign(r,t)}return t}function uh(t){return typeof t=="object"&&t!==null}function Lp(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Bp(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const ZA="[object RegExp]",Mp="[object String]",jp="[object Number]",qp="[object Boolean]",Fp="[object Arguments]",XA="[object Symbol]",QA="[object Date]",eN="[object Map]",tN="[object Set]",sN="[object Array]",rN="[object ArrayBuffer]",iN="[object Object]",nN="[object DataView]",oN="[object Uint8Array]",aN="[object Uint8ClampedArray]",cN="[object Uint16Array]",lN="[object Uint32Array]",uN="[object Int8Array]",hN="[object Int16Array]",dN="[object Int32Array]",pN="[object Float32Array]",fN="[object Float64Array]";function gN(t,e){return Qr(t,void 0,t,new Map,e)}function Qr(t,e,s,r=new Map,i=void 0){const n=i?.(t,e,s,r);if(n!=null)return n;if(Fc(t))return t;if(r.has(t))return r.get(t);if(Array.isArray(t)){const o=new Array(t.length);r.set(t,o);for(let a=0;a<t.length;a++)o[a]=Qr(t[a],a,s,r,i);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;r.set(t,o);for(const[a,c]of t)o.set(a,Qr(c,a,s,r,i));return o}if(t instanceof Set){const o=new Set;r.set(t,o);for(const a of t)o.add(Qr(a,void 0,s,r,i));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(zc(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);r.set(t,o);for(let a=0;a<t.length;a++)o[a]=Qr(t[a],a,s,r,i);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return r.set(t,o),er(o,t,s,r,i),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return r.set(t,o),er(o,t,s,r,i),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return r.set(t,o),er(o,t,s,r,i),o}if(t instanceof Error){const o=new t.constructor;return r.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,er(o,t,s,r,i),o}if(typeof t=="object"&&mN(t)){const o=Object.create(Object.getPrototypeOf(t));return r.set(t,o),er(o,t,s,r,i),o}return t}function er(t,e,s=t,r,i){const n=[...Object.keys(e),...Lp(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=Qr(e[a],a,s,r,i))}}function mN(t){switch(Bp(t)){case Fp:case sN:case rN:case nN:case qp:case QA:case pN:case fN:case uN:case hN:case dN:case eN:case jp:case iN:case ZA:case tN:case Mp:case XA:case oN:case aN:case cN:case lN:return!0;default:return!1}}function wN(t,e){return gN(t,(s,r,i,n)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case jp:case Mp:case qp:{const o=new t.constructor(t?.valueOf());return er(o,t),o}case Fp:{const o={};return er(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function hh(t){return wN(t)}function dh(t){return t!==null&&typeof t=="object"&&Bp(t)==="[object Arguments]"}function yN(t){return zc(t)}function bN(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const s=t[Symbol.toStringTag];return s==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${s}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function vN(t,...e){const s=e.slice(0,-1),r=e[e.length-1];let i=t;for(let n=0;n<s.length;n++){const o=s[n];i=wc(i,o,r,new Map)}return i}function wc(t,e,s,r){if(Fc(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(r.has(e))return YA(r.get(e));if(r.set(e,t),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const i=[...Object.keys(e),...Lp(e)];for(let n=0;n<i.length;n++){const o=i[n];let a=e[o],c=t[o];if(dh(a)&&(a={...a}),dh(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=hh(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],h=Reflect.ownKeys(c);for(let d=0;d<h.length;d++){const f=h[d];u[f]=c[f]}c=u}else c=[];const l=s(c,a,o,t,e,r);l!=null?t[o]=l:Array.isArray(a)||uh(c)&&uh(a)?t[o]=wc(c,a,s,r):c==null&&bN(a)?t[o]=wc({},a,s,r):c==null&&yN(a)?t[o]=hh(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function EN(t,...e){return vN(t,...e,JA)}var CN=Object.defineProperty,IN=Object.defineProperties,AN=Object.getOwnPropertyDescriptors,ph=Object.getOwnPropertySymbols,NN=Object.prototype.hasOwnProperty,_N=Object.prototype.propertyIsEnumerable,fh=(t,e,s)=>e in t?CN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Hn=(t,e)=>{for(var s in e||(e={}))NN.call(e,s)&&fh(t,s,e[s]);if(ph)for(var s of ph(e))_N.call(e,s)&&fh(t,s,e[s]);return t},SN=(t,e)=>IN(t,AN(e));function kt(t,e,s){var r;const i=ei(t);return((r=e.rpcMap)==null?void 0:r[i.reference])||`${Dp}?chainId=${i.namespace}:${i.reference}&projectId=${s}`}function Er(t){return t.includes(":")?t.split(":")[1]:t}function zp(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function PN(t,e){const s=Object.keys(e.namespaces).filter(i=>i.includes(t));if(!s.length)return[];const r=[];return s.forEach(i=>{const n=e.namespaces[i].accounts;r.push(...n)}),r}function Vn(t={},e={}){const s=gh(t),r=gh(e);return EN(s,r)}function gh(t){var e,s,r,i,n;const o={};if(!qs(t))return o;for(const[a,c]of Object.entries(t)){const l=Ro(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],d=c.rpcMap||{},f=Xr(a);o[f]=SN(Hn(Hn({},o[f]),c),{chains:cs(l,(e=o[f])==null?void 0:e.chains),methods:cs(u,(s=o[f])==null?void 0:s.methods),events:cs(h,(r=o[f])==null?void 0:r.events)}),(qs(d)||qs(((i=o[f])==null?void 0:i.rpcMap)||{}))&&(o[f].rpcMap=Hn(Hn({},d),(n=o[f])==null?void 0:n.rpcMap))}return o}function mh(t){return t.includes(":")?t.split(":")[2]:t}function wh(t){const e={};for(const[s,r]of Object.entries(t)){const i=r.methods||[],n=r.events||[],o=r.accounts||[],a=Ro(s)?[s]:r.chains?r.chains:zp(r.accounts);e[s]={chains:a,methods:i,events:n,accounts:o}}return e}function Aa(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}const Wp={},we=t=>Wp[t],Na=(t,e)=>{Wp[t]=e};var ON=Object.defineProperty,$N=(t,e,s)=>e in t?ON(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,xr=(t,e,s)=>$N(t,typeof e!="symbol"?e+"":e,s);class TN{constructor(e){xr(this,"name","polkadot"),xr(this,"client"),xr(this,"httpProviders"),xr(this,"events"),xr(this,"namespace"),xr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(Ft.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=Er(s);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new qt(new Qt(r,we("disableProviderPing")))}}var kN=Object.defineProperty,xN=Object.defineProperties,RN=Object.getOwnPropertyDescriptors,yh=Object.getOwnPropertySymbols,UN=Object.prototype.hasOwnProperty,DN=Object.prototype.propertyIsEnumerable,yc=(t,e,s)=>e in t?kN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,bh=(t,e)=>{for(var s in e||(e={}))UN.call(e,s)&&yc(t,s,e[s]);if(yh)for(var s of yh(e))DN.call(e,s)&&yc(t,s,e[s]);return t},vh=(t,e)=>xN(t,RN(e)),Rr=(t,e,s)=>yc(t,typeof e!="symbol"?e+"":e,s);class LN{constructor(e){Rr(this,"name","eip155"),Rr(this,"client"),Rr(this,"chainId"),Rr(this,"namespace"),Rr(this,"httpProviders"),Rr(this,"events"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(parseInt(e),s),this.chainId=parseInt(e),this.events.emit(Ft.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,s){const r=s||kt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new qt(new Qt(r,we("disableProviderPing")))}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=parseInt(Er(s));e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}async handleSwitchChain(e){var s,r;let i=e.request.params?(s=e.request.params[0])==null?void 0:s.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;const n=parseInt(i,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:(r=this.namespace.chains)==null?void 0:r[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var s,r,i,n,o;const a=(r=(s=e.request)==null?void 0:s.params)==null?void 0:r[0],c=((n=(i=e.request)==null?void 0:i.params)==null?void 0:n[1])||[],l=`${a}${c.join(",")}`;if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const u=this.client.session.get(e.topic),h=((o=u?.sessionProperties)==null?void 0:o.capabilities)||{};if(h!=null&&h[l])return h?.[l];const d=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:vh(bh({},u.sessionProperties||{}),{capabilities:vh(bh({},h||{}),{[l]:d})})})}catch(f){console.warn("Failed to update session with capabilities",f)}return d}async getCallStatus(e){var s,r;const i=this.client.session.get(e.topic),n=(s=i.sessionProperties)==null?void 0:s.bundler_name;if(n){const a=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}const o=(r=i.sessionProperties)==null?void 0:r.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,s){var r;const i=new URL(e),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(tr("eth_getUserOperationReceipt",[(r=s.request.params)==null?void 0:r[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,s){return`${GA}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${s}`}}var BN=Object.defineProperty,MN=(t,e,s)=>e in t?BN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ur=(t,e,s)=>MN(t,typeof e!="symbol"?e+"":e,s);class jN{constructor(e){Ur(this,"name","solana"),Ur(this,"client"),Ur(this,"httpProviders"),Ur(this,"events"),Ur(this,"namespace"),Ur(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(Ft.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=Er(s);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new qt(new Qt(r,we("disableProviderPing")))}}var qN=Object.defineProperty,FN=(t,e,s)=>e in t?qN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Dr=(t,e,s)=>FN(t,typeof e!="symbol"?e+"":e,s);class zN{constructor(e){Dr(this,"name","cosmos"),Dr(this,"client"),Dr(this,"httpProviders"),Dr(this,"events"),Dr(this,"namespace"),Dr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(Ft.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=Er(s);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new qt(new Qt(r,we("disableProviderPing")))}}var WN=Object.defineProperty,HN=(t,e,s)=>e in t?WN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Lr=(t,e,s)=>HN(t,typeof e!="symbol"?e+"":e,s);class VN{constructor(e){Lr(this,"name","algorand"),Lr(this,"client"),Lr(this,"httpProviders"),Lr(this,"events"),Lr(this,"namespace"),Lr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){if(!this.httpProviders[e]){const r=s||kt(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.chainId=e,this.events.emit(Ft.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;e[s]=this.createHttpProvider(s,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);return typeof r>"u"?void 0:new qt(new Qt(r,we("disableProviderPing")))}}var KN=Object.defineProperty,GN=(t,e,s)=>e in t?KN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Br=(t,e,s)=>GN(t,typeof e!="symbol"?e+"":e,s);class JN{constructor(e){Br(this,"name","cip34"),Br(this,"client"),Br(this,"httpProviders"),Br(this,"events"),Br(this,"namespace"),Br(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(Ft.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{const r=this.getCardanoRPCUrl(s),i=Er(s);e[i]=this.createHttpProvider(i,r)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}getCardanoRPCUrl(e){const s=this.namespace.rpcMap;if(s)return s[e]}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||this.getCardanoRPCUrl(e);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new qt(new Qt(r,we("disableProviderPing")))}}var YN=Object.defineProperty,ZN=(t,e,s)=>e in t?YN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Mr=(t,e,s)=>ZN(t,typeof e!="symbol"?e+"":e,s);class XN{constructor(e){Mr(this,"name","elrond"),Mr(this,"client"),Mr(this,"httpProviders"),Mr(this,"events"),Mr(this,"namespace"),Mr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(Ft.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=Er(s);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new qt(new Qt(r,we("disableProviderPing")))}}var QN=Object.defineProperty,e_=(t,e,s)=>e in t?QN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,jr=(t,e,s)=>e_(t,typeof e!="symbol"?e+"":e,s);class t_{constructor(e){jr(this,"name","multiversx"),jr(this,"client"),jr(this,"httpProviders"),jr(this,"events"),jr(this,"namespace"),jr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(Ft.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;const i=Er(s);e[i]=this.createHttpProvider(i,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new qt(new Qt(r,we("disableProviderPing")))}}var s_=Object.defineProperty,r_=(t,e,s)=>e in t?s_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,qr=(t,e,s)=>r_(t,typeof e!="symbol"?e+"":e,s);class i_{constructor(e){qr(this,"name","near"),qr(this,"client"),qr(this,"httpProviders"),qr(this,"events"),qr(this,"namespace"),qr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){if(this.chainId=e,!this.httpProviders[e]){const r=s||kt(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(Ft.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var r;e[s]=this.createHttpProvider(s,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace);return typeof r>"u"?void 0:new qt(new Qt(r,we("disableProviderPing")))}}var n_=Object.defineProperty,o_=(t,e,s)=>e in t?n_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Fr=(t,e,s)=>o_(t,typeof e!="symbol"?e+"":e,s);class a_{constructor(e){Fr(this,"name","tezos"),Fr(this,"client"),Fr(this,"httpProviders"),Fr(this,"events"),Fr(this,"namespace"),Fr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,s){if(this.chainId=e,!this.httpProviders[e]){const r=s||kt(`${this.name}:${e}`,this.namespace);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,r)}this.events.emit(Ft.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{e[s]=this.createHttpProvider(s)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace);return typeof r>"u"?void 0:new qt(new Qt(r))}}var c_=Object.defineProperty,l_=(t,e,s)=>e in t?c_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,zr=(t,e,s)=>l_(t,typeof e!="symbol"?e+"":e,s);class u_{constructor(e){zr(this,"name",Hr),zr(this,"client"),zr(this,"httpProviders"),zr(this,"events"),zr(this,"namespace"),zr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s),this.chainId=e,this.events.emit(Ft.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){var e,s;const r={};return(s=(e=this.namespace)==null?void 0:e.accounts)==null||s.forEach(i=>{const n=ei(i);r[`${n.namespace}:${n.reference}`]=this.createHttpProvider(i)}),r}getHttpProvider(e){const s=this.httpProviders[e];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return s}setHttpProvider(e,s){const r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){const r=s||kt(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new qt(new Qt(r,we("disableProviderPing")))}}var h_=Object.defineProperty,d_=Object.defineProperties,p_=Object.getOwnPropertyDescriptors,Eh=Object.getOwnPropertySymbols,f_=Object.prototype.hasOwnProperty,g_=Object.prototype.propertyIsEnumerable,bc=(t,e,s)=>e in t?h_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Kn=(t,e)=>{for(var s in e||(e={}))f_.call(e,s)&&bc(t,s,e[s]);if(Eh)for(var s of Eh(e))g_.call(e,s)&&bc(t,s,e[s]);return t},_a=(t,e)=>d_(t,p_(e)),Bt=(t,e,s)=>bc(t,typeof e!="symbol"?e+"":e,s);let m_=class Hp{constructor(e){Bt(this,"client"),Bt(this,"namespaces"),Bt(this,"optionalNamespaces"),Bt(this,"sessionProperties"),Bt(this,"scopedProperties"),Bt(this,"events",new _c),Bt(this,"rpcProviders",{}),Bt(this,"session"),Bt(this,"providerOpts"),Bt(this,"logger"),Bt(this,"uri"),Bt(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Ic(wn({level:e?.logger||lh})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const s=new Hp(e);return await s.initialize(),s}async request(e,s,r){const[i,n]=this.validateChain(s);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Kn({},e),chainId:`${i}:${n}`,topic:this.session.topic,expiry:r})}sendAsync(e,s,r,i){const n=new Date().getTime();this.request(e,r,i).then(o=>s(null,yo(n,o))).catch(o=>s(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Re("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,s){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:r,response:i}=await this.client.authenticate(e,s);r&&(this.uri=r,this.events.emit("display_uri",r));const n=await i();if(this.session=n.session,this.session){const o=wh(this.session.namespaces);this.namespaces=Vn(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}removeListener(e,s){this.events.removeListener(e,s)}off(e,s){this.events.off(e,s)}get isWalletConnect(){return!0}async pair(e){const{uri:s,approval:r}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});s&&(this.uri=s,this.events.emit("display_uri",s));const i=await r();this.session=i;const n=wh(i.namespaces);return this.namespaces=Vn(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,s){try{if(!this.session)return;const[r,i]=this.validateChain(e),n=this.getProvider(r);n.name===Hr?n.setDefaultChain(`${r}:${i}`,s):n.setDefaultChain(i,s)}catch(r){if(!/Please call connect/.test(r.message))throw r}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const s=this.client.pairing.getAll();if(js(s)){for(const r of s)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${s.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,s;if(this.client=this.providerOpts.client||await WA.init({core:this.providerOpts.core,logger:this.providerOpts.logger||lh,relayUrl:this.providerOpts.relayUrl||HA,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(r){throw this.logger.error("Failed to get session",r),new Error(`The provided session: ${(s=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:s.topic} doesn't exist in the Sign client`)}else{const r=this.client.session.getAll();this.session=r[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(s=>Xr(s)))];Na("client",this.client),Na("events",this.events),Na("disableProviderPing",this.disableProviderPing),e.forEach(s=>{if(!this.session)return;const r=PN(s,this.session),i=zp(r),n=Vn(this.namespaces,this.optionalNamespaces),o=_a(Kn({},n[s]),{accounts:r,chains:i});switch(s){case"eip155":this.rpcProviders[s]=new LN({namespace:o});break;case"algorand":this.rpcProviders[s]=new VN({namespace:o});break;case"solana":this.rpcProviders[s]=new jN({namespace:o});break;case"cosmos":this.rpcProviders[s]=new zN({namespace:o});break;case"polkadot":this.rpcProviders[s]=new TN({namespace:o});break;case"cip34":this.rpcProviders[s]=new JN({namespace:o});break;case"elrond":this.rpcProviders[s]=new XN({namespace:o});break;case"multiversx":this.rpcProviders[s]=new t_({namespace:o});break;case"near":this.rpcProviders[s]=new i_({namespace:o});break;case"tezos":this.rpcProviders[s]=new a_({namespace:o});break;default:this.rpcProviders[Hr]?this.rpcProviders[Hr].updateNamespace(o):this.rpcProviders[Hr]=new u_({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var s;const{topic:r}=e;r===((s=this.session)==null?void 0:s.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var s;const{params:r,topic:i}=e;if(i!==((s=this.session)==null?void 0:s.topic))return;const{event:n}=r;if(n.name==="accountsChanged"){const o=n.data;o&&js(o)&&this.events.emit("accountsChanged",o.map(mh))}else if(n.name==="chainChanged"){const o=r.chainId,a=r.event.data,c=Xr(o),l=Aa(o)!==Aa(a)?`${c}:${Aa(a)}`:o;this.onChainChanged(l)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:s})=>{var r,i;if(e!==((r=this.session)==null?void 0:r.topic))return;const{namespaces:n}=s,o=(i=this.client)==null?void 0:i.session.get(e);this.session=_a(Kn({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:s})}),this.client.on("session_delete",async e=>{var s;e.topic===((s=this.session)==null?void 0:s.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",_a(Kn({},Re("USER_DISCONNECTED")),{data:e.topic})))}),this.on(Ft.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Hr]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var s;this.getProvider(e).updateNamespace((s=this.session)==null?void 0:s.namespaces[e])})}setNamespaces(e){const{namespaces:s={},optionalNamespaces:r={},sessionProperties:i,scopedProperties:n}=e;this.optionalNamespaces=Vn(s,r),this.sessionProperties=i,this.scopedProperties=n}validateChain(e){const[s,r]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[s,r];if(s&&!Object.keys(this.namespaces||{}).map(o=>Xr(o)).includes(s))throw new Error(`Namespace '${s}' is not configured. Please call connect() first with namespace config.`);if(s&&r)return[s,r];const i=Xr(Object.keys(this.namespaces)[0]),n=this.rpcProviders[i].getDefaultChain();return[i,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,s=!1){if(!this.namespaces)return;const[r,i]=this.validateChain(e);if(!i)return;this.updateNamespaceChain(r,i),this.events.emit("chainChanged",i);const n=this.getProvider(r).getDefaultChain();s||this.getProvider(r).setDefaultChain(i),this.emitAccountsChangedOnChainChange({namespace:r,previousChainId:n,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:s,newChainId:r}){var i,n;try{if(s===r)return;const o=(n=(i=this.session)==null?void 0:i.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(mh);if(!js(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,s){if(!this.namespaces)return;const r=this.namespaces[e]?e:`${e}:${s}`,i={chains:[],methods:[],events:[],defaultChain:s};this.namespaces[r]?this.namespaces[r]&&(this.namespaces[r].defaultChain=s):this.namespaces[r]=i}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,s){var r;const i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.setItem(`${Wn}/${e}${i}`,s)}async getFromStore(e){var s;const r=((s=this.session)==null?void 0:s.topic)||"";return await this.client.core.storage.getItem(`${Wn}/${e}${r}`)}async deleteFromStore(e){var s;const r=((s=this.session)==null?void 0:s.topic)||"";await this.client.core.storage.removeItem(`${Wn}/${e}${r}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const s=await this.client.core.storage.getKeys();for(const r of s)r.startsWith(Wn)&&await this.client.core.storage.removeItem(r)}catch(s){this.logger.warn("Failed to cleanup storage",s)}}};function Gn(t,e){return W.getConnectorId(t)===e}function w_(t){const e=Array.from(b.state.chains.keys());let s=[];return t?(s.push([t,b.state.chains.get(t)]),Gn(t,K.CONNECTOR_ID.WALLET_CONNECT)?e.forEach(r=>{r!==t&&Gn(r,K.CONNECTOR_ID.WALLET_CONNECT)&&s.push([r,b.state.chains.get(r)])}):Gn(t,K.CONNECTOR_ID.AUTH)&&e.forEach(r=>{r!==t&&Gn(r,K.CONNECTOR_ID.AUTH)&&s.push([r,b.state.chains.get(r)])})):s=Array.from(b.state.chains.entries()),s}const ks={EIP155:"eip155",CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED"},go={NetworkImageIds:{1:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",42161:"3bff954d-5cb0-47a0-9a23-d20192e74600",43114:"30c46e53-e989-45fb-4549-be3bd4eb3b00",56:"93564157-2e8e-4ce7-81df-b264dbee9b00",250:"06b26297-fe0c-4733-5d6b-ffa5498aac00",10:"ab9c186a-c52f-464b-2906-ca59d760a400",137:"41d04d42-da3b-4453-8506-668cc0727900",5e3:"e86fae9b-b770-4eea-e520-150e12c81100",295:"6a97d510-cac8-4e58-c7ce-e8681b044c00",11155111:"e909ea0a-f92a-4512-c8fc-748044ea6800",84532:"a18a7ecd-e307-4360-4746-283182228e00",1301:"4eeea7ef-0014-4649-5d1d-07271a80f600",130:"2257980a-3463-48c6-cbac-a42d2a956e00",10143:"0a728e83-bacb-46db-7844-948f05434900",100:"02b53f6a-e3d4-479e-1cb4-21178987d100",9001:"f926ff41-260d-4028-635e-91913fc28e00",324:"b310f07f-4ef7-49f3-7073-2a0a39685800",314:"5a73b3dd-af74-424e-cae0-0de859ee9400",4689:"34e68754-e536-40da-c153-6ef2e7188a00",1088:"3897a66d-40b9-4833-162f-a2c90531c900",1284:"161038da-44ae-4ec7-1208-0ea569454b00",1285:"f1d73bb6-5450-4e18-38f7-fb6484264a00",7777777:"845c60df-d429-4991-e687-91ae45791600",42220:"ab781bbc-ccc6-418d-d32d-789b15da1f00",8453:"7289c336-3981-4081-c5f4-efc26ac64a00",1313161554:"3ff73439-a619-4894-9262-4470c773a100",2020:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",2021:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",80094:"e329c2c9-59b0-4a02-83e4-212ff3779900",2741:"fc2427d1-5af9-4a9c-8da5-6f94627cd900","5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700",EtWTRABZaYq6iMfeYKouRu166VU2xqa1:"a1b58899-f671-4276-6a5e-56ca5bd59700","000000000019d6689c085ae165831e93":"0b4838db-0161-4ffe-022d-532bf03dba00","000000000933ea01ad0ee984209779ba":"39354064-d79b-420b-065d-f980c4b78200"},ConnectorImageIds:{[K.CONNECTOR_ID.COINBASE]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[K.CONNECTOR_ID.COINBASE_SDK]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[K.CONNECTOR_ID.SAFE]:"461db637-8616-43ce-035a-d89b8a1d5800",[K.CONNECTOR_ID.LEDGER]:"54a1aa77-d202-4f8d-0fb2-5d2bb6db0300",[K.CONNECTOR_ID.WALLET_CONNECT]:"ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",[K.CONNECTOR_ID.INJECTED]:"07ba87ed-43aa-4adf-4540-9e6a2b9cae00"},ConnectorNamesMap:{[K.CONNECTOR_ID.INJECTED]:"Browser Wallet",[K.CONNECTOR_ID.WALLET_CONNECT]:"WalletConnect",[K.CONNECTOR_ID.COINBASE]:"Coinbase",[K.CONNECTOR_ID.COINBASE_SDK]:"Coinbase",[K.CONNECTOR_ID.LEDGER]:"Ledger",[K.CONNECTOR_ID.SAFE]:"Safe"}},Wc={getCaipTokens(t){if(!t)return;const e={};return Object.entries(t).forEach(([s,r])=>{e[`${ks.EIP155}:${s}`]=r}),e},isLowerCaseMatch(t,e){return t?.toLowerCase()===e?.toLowerCase()}};new AbortController;const Wr={UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:"Unauthorized: origin not allowed",alertErrorKey:"INVALID_APP_CONFIGURATION"},JWT_VALIDATION_ERROR:{message:"JWT validation error: JWT Token is not yet valid",alertErrorKey:"JWT_TOKEN_NOT_VALID"},INVALID_KEY:{message:"Unauthorized: invalid key",alertErrorKey:"INVALID_PROJECT_ID"}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{shortMessage:"Network Not Found",longMessage:"Network not found - please make sure it is included in 'networks' array in createAppKit function"},INVALID_APP_CONFIGURATION:{shortMessage:"Invalid App Configuration",longMessage:()=>`Origin ${y_()?window.origin:"unknown"} not found on Allowlist - update configuration on cloud.reown.com`},IFRAME_LOAD_FAILED:{shortMessage:"Network Error - Could not load embedded wallet",longMessage:()=>"There was an issue loading the embedded wallet. Please try again later."},IFRAME_REQUEST_TIMEOUT:{shortMessage:"Embedded Wallet Request Timed Out",longMessage:()=>"There was an issue doing the request to the embedded wallet. Please try again later."},UNVERIFIED_DOMAIN:{shortMessage:"Invalid App Configuration",longMessage:()=>"There was an issue loading the embedded wallet. Please verify that your domain is allowed at cloud.reown.com"},JWT_TOKEN_NOT_VALID:{shortMessage:"Session Expired",longMessage:"Invalid session found on UniversalProvider - please check your time settings and connect again"},INVALID_PROJECT_ID:{shortMessage:"Invalid App Configuration",longMessage:"Invalid Project ID - update configuration"},PROJECT_ID_NOT_CONFIGURED:{shortMessage:"Project ID Not Configured",longMessage:"Project ID Not Configured - update configuration on cloud.reown.com"}}};function y_(){return typeof window<"u"}const b_={createLogger(t,e="error"){const s=wn({level:e}),{logger:r}=Lh({opts:s});return r.error=(...i)=>{for(const n of i)if(n instanceof Error){t(n,...i);return}t(void 0,...i)},r}},v_="rpc.walletconnect.org";function Ch(t,e){const s=new URL("https://rpc.walletconnect.org/v1/");return s.searchParams.set("chainId",t),s.searchParams.set("projectId",e),s.toString()}const Sa=["near:mainnet","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","eip155:1101","eip155:56","eip155:42161","eip155:7777777","eip155:59144","eip155:324","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","eip155:5000","solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz","eip155:80084","eip155:5003","eip155:100","eip155:8453","eip155:42220","eip155:1313161555","eip155:17000","eip155:1","eip155:300","eip155:1313161554","eip155:1329","eip155:84532","eip155:421614","eip155:11155111","eip155:8217","eip155:43114","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","eip155:999999999","eip155:11155420","eip155:80002","eip155:97","eip155:43113","eip155:137","eip155:10","eip155:1301","bip122:000000000019d6689c085ae165831e93","bip122:000000000933ea01ad0ee984209779ba"],Vr={extendRpcUrlWithProjectId(t,e){let s=!1;try{s=new URL(t).host===v_}catch{s=!1}if(s){const r=new URL(t);return r.searchParams.has("projectId")||r.searchParams.set("projectId",e),r.toString()}return t},isCaipNetwork(t){return"chainNamespace"in t&&"caipNetworkId"in t},getChainNamespace(t){return this.isCaipNetwork(t)?t.chainNamespace:K.CHAIN.EVM},getCaipNetworkId(t){return this.isCaipNetwork(t)?t.caipNetworkId:`${K.CHAIN.EVM}:${t.id}`},getDefaultRpcUrl(t,e,s){const r=t.rpcUrls?.default?.http?.[0];return Sa.includes(e)?Ch(e,s):r||""},extendCaipNetwork(t,{customNetworkImageUrls:e,projectId:s,customRpcUrls:r}){const i=this.getChainNamespace(t),n=this.getCaipNetworkId(t),o=t.rpcUrls.default.http?.[0],a=this.getDefaultRpcUrl(t,n,s),c=t?.rpcUrls?.chainDefault?.http?.[0]||o,l=r?.[n]?.map(d=>d.url)||[],u=[...l,a],h=[...l];return c&&!h.includes(c)&&h.push(c),{...t,chainNamespace:i,caipNetworkId:n,assets:{imageId:go.NetworkImageIds[t.id],imageUrl:e?.[t.id]},rpcUrls:{...t.rpcUrls,default:{http:u},chainDefault:{http:h}}}},extendCaipNetworks(t,{customNetworkImageUrls:e,projectId:s,customRpcUrls:r}){return t.map(i=>Vr.extendCaipNetwork(i,{customNetworkImageUrls:e,customRpcUrls:r,projectId:s}))},getViemTransport(t,e,s){const r=[];return s?.forEach(i=>{r.push($n(i.url,i.config))}),Sa.includes(t.caipNetworkId)&&r.push($n(Ch(t.caipNetworkId,e),{fetchOptions:{headers:{"Content-Type":"text/plain"}}})),t?.rpcUrls?.default?.http?.forEach(i=>{r.push($n(i))}),Qc(r)},extendWagmiTransports(t,e,s){if(Sa.includes(t.caipNetworkId)){const r=this.getDefaultRpcUrl(t,t.caipNetworkId,e);return Qc([s,$n(r)])}return s},getUnsupportedNetwork(t){return{id:t.split(":")[1],caipNetworkId:t,name:K.UNSUPPORTED_NETWORK_NAME,chainNamespace:t.split(":")[0],nativeCurrency:{name:"",decimals:0,symbol:""},rpcUrls:{default:{http:[]}}}},getCaipNetworkFromStorage(t){const e=H.getActiveCaipNetworkId(),s=b.getAllRequestedCaipNetworks(),r=Array.from(b.state.chains?.keys()||[]),i=e?.split(":")[0],n=i?r.includes(i):!1,o=s?.find(c=>c.caipNetworkId===e);return n&&!o&&e?this.getUnsupportedNetwork(e):o||t||s?.[0]}},mo={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0},wt=ke({providers:{...mo},providerIds:{...mo}}),xe={state:wt,subscribeKey(t,e){return at(wt,t,e)},subscribe(t){return ot(wt,()=>{t(wt)})},subscribeProviders(t){return ot(wt.providers,()=>t(wt.providers))},setProvider(t,e){e&&(wt.providers[t]=cr(e))},getProvider(t){return wt.providers[t]},setProviderId(t,e){e&&(wt.providerIds[t]=e)},getProviderId(t){if(t)return wt.providerIds[t]},reset(){wt.providers={...mo},wt.providerIds={...mo}},resetChain(t){wt.providers[t]=void 0,wt.providerIds[t]=void 0}},E_={VIEW_DIRECTION:{Next:"next",Prev:"prev"},DEFAULT_CONNECT_METHOD_ORDER:["email","social","wallet"],ANIMATION_DURATIONS:{HeaderText:120,ModalHeight:150,ViewTransition:150}},vc={filterOutDuplicatesByRDNS(t){const e=B.state.enableEIP6963?W.state.connectors:[],s=H.getRecentWallets(),r=e.map(a=>a.info?.rdns).filter(Boolean),i=s.map(a=>a.rdns).filter(Boolean),n=r.concat(i);if(n.includes("io.metamask.mobile")&&te.isMobile()){const a=n.indexOf("io.metamask.mobile");n[a]="io.metamask"}return t.filter(a=>!n.includes(String(a?.rdns)))},filterOutDuplicatesByIds(t){const e=W.state.connectors.filter(a=>a.type==="ANNOUNCED"||a.type==="INJECTED"),s=H.getRecentWallets(),r=e.map(a=>a.explorerId),i=s.map(a=>a.id),n=r.concat(i);return t.filter(a=>!n.includes(a?.id))},filterOutDuplicateWallets(t){const e=this.filterOutDuplicatesByRDNS(t);return this.filterOutDuplicatesByIds(e)},markWalletsAsInstalled(t){const{connectors:e}=W.state,{featuredWalletIds:s}=B.state,r=e.filter(o=>o.type==="ANNOUNCED").reduce((o,a)=>(a.info?.rdns&&(o[a.info.rdns]=!0),o),{});return t.map(o=>({...o,installed:!!o.rdns&&!!r[o.rdns??""]})).sort((o,a)=>{const c=Number(a.installed)-Number(o.installed);if(c!==0)return c;if(s?.length){const l=s.indexOf(o.id),u=s.indexOf(a.id);if(l!==-1&&u!==-1)return l-u;if(l!==-1)return-1;if(u!==-1)return 1}return 0})},getConnectOrderMethod(t,e){const s=t?.connectMethodsOrder||B.state.features?.connectMethodsOrder,r=e||W.state.connectors;if(s)return s;const{injected:i,announced:n}=so.getConnectorsByType(r,J.state.recommended,J.state.featured),o=i.filter(so.showConnector),a=n.filter(so.showConnector);return o.length||a.length?["wallet","email","social"]:E_.DEFAULT_CONNECT_METHOD_ORDER},isExcluded(t){const e=!!t.rdns&&J.state.excludedWallets.some(r=>r.rdns===t.rdns),s=!!t.name&&J.state.excludedWallets.some(r=>Wc.isLowerCaseMatch(r.name,t.name));return e||s}},so={getConnectorsByType(t,e,s){const{customWallets:r}=B.state,i=H.getRecentWallets(),n=vc.filterOutDuplicateWallets(e),o=vc.filterOutDuplicateWallets(s),a=t.filter(h=>h.type==="MULTI_CHAIN"),c=t.filter(h=>h.type==="ANNOUNCED"),l=t.filter(h=>h.type==="INJECTED"),u=t.filter(h=>h.type==="EXTERNAL");return{custom:r,recent:i,external:u,multiChain:a,announced:c,injected:l,recommended:n,featured:o}},showConnector(t){const e=t.info?.rdns,s=!!e&&J.state.excludedWallets.some(i=>!!i.rdns&&i.rdns===e),r=!!t.name&&J.state.excludedWallets.some(i=>Wc.isLowerCaseMatch(i.name,t.name));return!(t.type==="INJECTED"&&(t.name==="Browser Wallet"&&(!te.isMobile()||te.isMobile()&&!e&&!ee.checkInstalled())||s||r)||(t.type==="ANNOUNCED"||t.type==="EXTERNAL")&&(s||r))},getIsConnectedWithWC(){return Array.from(b.state.chains.values()).some(s=>W.getConnectorId(s.namespace)===K.CONNECTOR_ID.WALLET_CONNECT)},getConnectorTypeOrder({recommended:t,featured:e,custom:s,recent:r,announced:i,injected:n,multiChain:o,external:a,overriddenConnectors:c=B.state.features?.connectorTypeOrder??[]}){const l=so.getIsConnectedWithWC(),d=[{type:"walletConnect",isEnabled:B.state.enableWalletConnect&&!l},{type:"recent",isEnabled:r.length>0},{type:"injected",isEnabled:[...n,...i,...o].length>0},{type:"featured",isEnabled:e.length>0},{type:"custom",isEnabled:s&&s.length>0},{type:"external",isEnabled:a.length>0},{type:"recommended",isEnabled:t.length>0}].filter(p=>p.isEnabled),f=new Set(d.map(p=>p.type)),m=c.filter(p=>f.has(p)).map(p=>({type:p,isEnabled:!0})),g=d.filter(({type:p})=>!m.some(({type:y})=>y===p));return Array.from(new Set([...m,...g].map(({type:p})=>p)))}};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ro=globalThis,Hc=ro.ShadowRoot&&(ro.ShadyCSS===void 0||ro.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Vc=Symbol(),Ih=new WeakMap;let Vp=class{constructor(e,s,r){if(this._$cssResult$=!0,r!==Vc)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=s}get styleSheet(){let e=this.o;const s=this.t;if(Hc&&e===void 0){const r=s!==void 0&&s.length===1;r&&(e=Ih.get(s)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),r&&Ih.set(s,e))}return e}toString(){return this.cssText}};const Mt=t=>new Vp(typeof t=="string"?t:t+"",void 0,Vc),ti=(t,...e)=>{const s=t.length===1?t[0]:e.reduce((r,i,n)=>r+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+t[n+1],t[0]);return new Vp(s,t,Vc)},C_=(t,e)=>{if(Hc)t.adoptedStyleSheets=e.map(s=>s instanceof CSSStyleSheet?s:s.styleSheet);else for(const s of e){const r=document.createElement("style"),i=ro.litNonce;i!==void 0&&r.setAttribute("nonce",i),r.textContent=s.cssText,t.appendChild(r)}},Ah=Hc?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let s="";for(const r of e.cssRules)s+=r.cssText;return Mt(s)})(t):t;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:I_,defineProperty:A_,getOwnPropertyDescriptor:N_,getOwnPropertyNames:__,getOwnPropertySymbols:S_,getPrototypeOf:P_}=Object,Do=globalThis,Nh=Do.trustedTypes,O_=Nh?Nh.emptyScript:"",$_=Do.reactiveElementPolyfillSupport,sn=(t,e)=>t,Ec={toAttribute(t,e){switch(e){case Boolean:t=t?O_:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let s=t;switch(e){case Boolean:s=t!==null;break;case Number:s=t===null?null:Number(t);break;case Object:case Array:try{s=JSON.parse(t)}catch{s=null}}return s}},Kp=(t,e)=>!I_(t,e),_h={attribute:!0,type:String,converter:Ec,reflect:!1,useDefault:!1,hasChanged:Kp};Symbol.metadata??=Symbol("metadata"),Do.litPropertyMetadata??=new WeakMap;let Kr=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,s=_h){if(s.state&&(s.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((s=Object.create(s)).wrapped=!0),this.elementProperties.set(e,s),!s.noAccessor){const r=Symbol(),i=this.getPropertyDescriptor(e,r,s);i!==void 0&&A_(this.prototype,e,i)}}static getPropertyDescriptor(e,s,r){const{get:i,set:n}=N_(this.prototype,e)??{get(){return this[s]},set(o){this[s]=o}};return{get:i,set(o){const a=i?.call(this);n?.call(this,o),this.requestUpdate(e,a,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??_h}static _$Ei(){if(this.hasOwnProperty(sn("elementProperties")))return;const e=P_(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(sn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(sn("properties"))){const s=this.properties,r=[...__(s),...S_(s)];for(const i of r)this.createProperty(i,s[i])}const e=this[Symbol.metadata];if(e!==null){const s=litPropertyMetadata.get(e);if(s!==void 0)for(const[r,i]of s)this.elementProperties.set(r,i)}this._$Eh=new Map;for(const[s,r]of this.elementProperties){const i=this._$Eu(s,r);i!==void 0&&this._$Eh.set(i,s)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const s=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const i of r)s.unshift(Ah(i))}else e!==void 0&&s.push(Ah(e));return s}static _$Eu(e,s){const r=s.attribute;return r===!1?void 0:typeof r=="string"?r:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),this.renderRoot!==void 0&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,s=this.constructor.elementProperties;for(const r of s.keys())this.hasOwnProperty(r)&&(e.set(r,this[r]),delete this[r]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return C_(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,s,r){this._$AK(e,r)}_$ET(e,s){const r=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,r);if(i!==void 0&&r.reflect===!0){const n=(r.converter?.toAttribute!==void 0?r.converter:Ec).toAttribute(s,r.type);this._$Em=e,n==null?this.removeAttribute(i):this.setAttribute(i,n),this._$Em=null}}_$AK(e,s){const r=this.constructor,i=r._$Eh.get(e);if(i!==void 0&&this._$Em!==i){const n=r.getPropertyOptions(i),o=typeof n.converter=="function"?{fromAttribute:n.converter}:n.converter?.fromAttribute!==void 0?n.converter:Ec;this._$Em=i,this[i]=o.fromAttribute(s,n.type)??this._$Ej?.get(i)??null,this._$Em=null}}requestUpdate(e,s,r){if(e!==void 0){const i=this.constructor,n=this[e];if(r??=i.getPropertyOptions(e),!((r.hasChanged??Kp)(n,s)||r.useDefault&&r.reflect&&n===this._$Ej?.get(e)&&!this.hasAttribute(i._$Eu(e,r))))return;this.C(e,s,r)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,s,{useDefault:r,reflect:i,wrapped:n},o){r&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,o??s??this[e]),n!==!0||o!==void 0)||(this._$AL.has(e)||(this.hasUpdated||r||(s=void 0),this._$AL.set(e,s)),i===!0&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(s){Promise.reject(s)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[i,n]of this._$Ep)this[i]=n;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[i,n]of r){const{wrapped:o}=n,a=this[i];o!==!0||this._$AL.has(i)||a===void 0||this.C(i,void 0,n,a)}}let e=!1;const s=this._$AL;try{e=this.shouldUpdate(s),e?(this.willUpdate(s),this._$EO?.forEach(r=>r.hostUpdate?.()),this.update(s)):this._$EM()}catch(r){throw e=!1,this._$EM(),r}e&&this._$AE(s)}willUpdate(e){}_$AE(e){this._$EO?.forEach(s=>s.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(s=>this._$ET(s,this[s])),this._$EM()}updated(e){}firstUpdated(e){}};Kr.elementStyles=[],Kr.shadowRootOptions={mode:"open"},Kr[sn("elementProperties")]=new Map,Kr[sn("finalized")]=new Map,$_?.({ReactiveElement:Kr}),(Do.reactiveElementVersions??=[]).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Kc=globalThis,wo=Kc.trustedTypes,Sh=wo?wo.createPolicy("lit-html",{createHTML:t=>t}):void 0,Gp="$lit$",Rs=`lit$${Math.random().toFixed(9).slice(2)}$`,Jp="?"+Rs,T_=`<${Jp}>`,fr=document,fn=()=>fr.createComment(""),gn=t=>t===null||typeof t!="object"&&typeof t!="function",Gc=Array.isArray,k_=t=>Gc(t)||typeof t?.[Symbol.iterator]=="function",Pa=`[ 	
\f\r]`,Mi=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Ph=/-->/g,Oh=/>/g,Gs=RegExp(`>|${Pa}(?:([^\\s"'>=/]+)(${Pa}*=${Pa}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),$h=/'/g,Th=/"/g,Yp=/^(?:script|style|textarea|title)$/i,Zp=t=>(e,...s)=>({_$litType$:t,strings:e,values:s}),GS=Zp(1),JS=Zp(2),wi=Symbol.for("lit-noChange"),Ge=Symbol.for("lit-nothing"),kh=new WeakMap,rr=fr.createTreeWalker(fr,129);function Xp(t,e){if(!Gc(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return Sh!==void 0?Sh.createHTML(e):e}const x_=(t,e)=>{const s=t.length-1,r=[];let i,n=e===2?"<svg>":e===3?"<math>":"",o=Mi;for(let a=0;a<s;a++){const c=t[a];let l,u,h=-1,d=0;for(;d<c.length&&(o.lastIndex=d,u=o.exec(c),u!==null);)d=o.lastIndex,o===Mi?u[1]==="!--"?o=Ph:u[1]!==void 0?o=Oh:u[2]!==void 0?(Yp.test(u[2])&&(i=RegExp("</"+u[2],"g")),o=Gs):u[3]!==void 0&&(o=Gs):o===Gs?u[0]===">"?(o=i??Mi,h=-1):u[1]===void 0?h=-2:(h=o.lastIndex-u[2].length,l=u[1],o=u[3]===void 0?Gs:u[3]==='"'?Th:$h):o===Th||o===$h?o=Gs:o===Ph||o===Oh?o=Mi:(o=Gs,i=void 0);const f=o===Gs&&t[a+1].startsWith("/>")?" ":"";n+=o===Mi?c+T_:h>=0?(r.push(l),c.slice(0,h)+Gp+c.slice(h)+Rs+f):c+Rs+(h===-2?a:f)}return[Xp(t,n+(t[s]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),r]};class mn{constructor({strings:e,_$litType$:s},r){let i;this.parts=[];let n=0,o=0;const a=e.length-1,c=this.parts,[l,u]=x_(e,s);if(this.el=mn.createElement(l,r),rr.currentNode=this.el.content,s===2||s===3){const h=this.el.content.firstChild;h.replaceWith(...h.childNodes)}for(;(i=rr.nextNode())!==null&&c.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const h of i.getAttributeNames())if(h.endsWith(Gp)){const d=u[o++],f=i.getAttribute(h).split(Rs),m=/([.?@])?(.*)/.exec(d);c.push({type:1,index:n,name:m[2],strings:f,ctor:m[1]==="."?U_:m[1]==="?"?D_:m[1]==="@"?L_:Lo}),i.removeAttribute(h)}else h.startsWith(Rs)&&(c.push({type:6,index:n}),i.removeAttribute(h));if(Yp.test(i.tagName)){const h=i.textContent.split(Rs),d=h.length-1;if(d>0){i.textContent=wo?wo.emptyScript:"";for(let f=0;f<d;f++)i.append(h[f],fn()),rr.nextNode(),c.push({type:2,index:++n});i.append(h[d],fn())}}}else if(i.nodeType===8)if(i.data===Jp)c.push({type:2,index:n});else{let h=-1;for(;(h=i.data.indexOf(Rs,h+1))!==-1;)c.push({type:7,index:n}),h+=Rs.length-1}n++}}static createElement(e,s){const r=fr.createElement("template");return r.innerHTML=e,r}}function yi(t,e,s=t,r){if(e===wi)return e;let i=r!==void 0?s._$Co?.[r]:s._$Cl;const n=gn(e)?void 0:e._$litDirective$;return i?.constructor!==n&&(i?._$AO?.(!1),n===void 0?i=void 0:(i=new n(t),i._$AT(t,s,r)),r!==void 0?(s._$Co??=[])[r]=i:s._$Cl=i),i!==void 0&&(e=yi(t,i._$AS(t,e.values),i,r)),e}class R_{constructor(e,s){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=s}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:s},parts:r}=this._$AD,i=(e?.creationScope??fr).importNode(s,!0);rr.currentNode=i;let n=rr.nextNode(),o=0,a=0,c=r[0];for(;c!==void 0;){if(o===c.index){let l;c.type===2?l=new Pn(n,n.nextSibling,this,e):c.type===1?l=new c.ctor(n,c.name,c.strings,this,e):c.type===6&&(l=new B_(n,this,e)),this._$AV.push(l),c=r[++a]}o!==c?.index&&(n=rr.nextNode(),o++)}return rr.currentNode=fr,i}p(e){let s=0;for(const r of this._$AV)r!==void 0&&(r.strings!==void 0?(r._$AI(e,r,s),s+=r.strings.length-2):r._$AI(e[s])),s++}}class Pn{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,s,r,i){this.type=2,this._$AH=Ge,this._$AN=void 0,this._$AA=e,this._$AB=s,this._$AM=r,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const s=this._$AM;return s!==void 0&&e?.nodeType===11&&(e=s.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,s=this){e=yi(this,e,s),gn(e)?e===Ge||e==null||e===""?(this._$AH!==Ge&&this._$AR(),this._$AH=Ge):e!==this._$AH&&e!==wi&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):k_(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Ge&&gn(this._$AH)?this._$AA.nextSibling.data=e:this.T(fr.createTextNode(e)),this._$AH=e}$(e){const{values:s,_$litType$:r}=e,i=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=mn.createElement(Xp(r.h,r.h[0]),this.options)),r);if(this._$AH?._$AD===i)this._$AH.p(s);else{const n=new R_(i,this),o=n.u(this.options);n.p(s),this.T(o),this._$AH=n}}_$AC(e){let s=kh.get(e.strings);return s===void 0&&kh.set(e.strings,s=new mn(e)),s}k(e){Gc(this._$AH)||(this._$AH=[],this._$AR());const s=this._$AH;let r,i=0;for(const n of e)i===s.length?s.push(r=new Pn(this.O(fn()),this.O(fn()),this,this.options)):r=s[i],r._$AI(n),i++;i<s.length&&(this._$AR(r&&r._$AB.nextSibling,i),s.length=i)}_$AR(e=this._$AA.nextSibling,s){for(this._$AP?.(!1,!0,s);e&&e!==this._$AB;){const r=e.nextSibling;e.remove(),e=r}}setConnected(e){this._$AM===void 0&&(this._$Cv=e,this._$AP?.(e))}}class Lo{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,s,r,i,n){this.type=1,this._$AH=Ge,this._$AN=void 0,this.element=e,this.name=s,this._$AM=i,this.options=n,r.length>2||r[0]!==""||r[1]!==""?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=Ge}_$AI(e,s=this,r,i){const n=this.strings;let o=!1;if(n===void 0)e=yi(this,e,s,0),o=!gn(e)||e!==this._$AH&&e!==wi,o&&(this._$AH=e);else{const a=e;let c,l;for(e=n[0],c=0;c<n.length-1;c++)l=yi(this,a[r+c],s,c),l===wi&&(l=this._$AH[c]),o||=!gn(l)||l!==this._$AH[c],l===Ge?e=Ge:e!==Ge&&(e+=(l??"")+n[c+1]),this._$AH[c]=l}o&&!i&&this.j(e)}j(e){e===Ge?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class U_ extends Lo{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ge?void 0:e}}class D_ extends Lo{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Ge)}}class L_ extends Lo{constructor(e,s,r,i,n){super(e,s,r,i,n),this.type=5}_$AI(e,s=this){if((e=yi(this,e,s,0)??Ge)===wi)return;const r=this._$AH,i=e===Ge&&r!==Ge||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,n=e!==Ge&&(r===Ge||i);i&&this.element.removeEventListener(this.name,this,r),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){typeof this._$AH=="function"?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class B_{constructor(e,s,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=s,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){yi(this,e)}}const M_=Kc.litHtmlPolyfillSupport;M_?.(mn,Pn),(Kc.litHtmlVersions??=[]).push("3.3.0");const j_=(t,e,s)=>{const r=s?.renderBefore??e;let i=r._$litPart$;if(i===void 0){const n=s?.renderBefore??null;r._$litPart$=i=new Pn(e.insertBefore(fn(),n),n,void 0,s??{})}return i._$AI(t),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Jc=globalThis;class io extends Kr{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const s=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=j_(s,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return wi}}io._$litElement$=!0,io.finalized=!0,Jc.litElementHydrateSupport?.({LitElement:io});const q_=Jc.litElementPolyfillSupport;q_?.({LitElement:io});(Jc.litElementVersions??=[]).push("4.2.0");let rn,Fs,zs;function YS(t,e){rn=document.createElement("style"),Fs=document.createElement("style"),zs=document.createElement("style"),rn.textContent=si(t).core.cssText,Fs.textContent=si(t).dark.cssText,zs.textContent=si(t).light.cssText,document.head.appendChild(rn),document.head.appendChild(Fs),document.head.appendChild(zs),Qp(e)}function Qp(t){Fs&&zs&&(t==="light"?(Fs.removeAttribute("media"),zs.media="enabled"):(zs.removeAttribute("media"),Fs.media="enabled"))}function F_(t){rn&&Fs&&zs&&(rn.textContent=si(t).core.cssText,Fs.textContent=si(t).dark.cssText,zs.textContent=si(t).light.cssText)}function si(t){return{core:ti`
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      @keyframes w3m-shake {
        0% {
          transform: scale(1) rotate(0deg);
        }
        20% {
          transform: scale(1) rotate(-1deg);
        }
        40% {
          transform: scale(1) rotate(1.5deg);
        }
        60% {
          transform: scale(1) rotate(-1.5deg);
        }
        80% {
          transform: scale(1) rotate(1deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      @keyframes w3m-iframe-fade-out {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes w3m-iframe-zoom-in {
        0% {
          transform: translateY(50px);
          opacity: 0;
        }
        100% {
          transform: translateY(0px);
          opacity: 1;
        }
      }
      @keyframes w3m-iframe-zoom-in-mobile {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      :root {
        --w3m-modal-width: 360px;
        --w3m-color-mix-strength: ${Mt(t?.["--w3m-color-mix-strength"]?`${t["--w3m-color-mix-strength"]}%`:"0%")};
        --w3m-font-family: ${Mt(t?.["--w3m-font-family"]||"Inter, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;")};
        --w3m-font-size-master: ${Mt(t?.["--w3m-font-size-master"]||"10px")};
        --w3m-border-radius-master: ${Mt(t?.["--w3m-border-radius-master"]||"4px")};
        --w3m-z-index: ${Mt(t?.["--w3m-z-index"]||999)};

        --wui-font-family: var(--w3m-font-family);

        --wui-font-size-mini: calc(var(--w3m-font-size-master) * 0.8);
        --wui-font-size-micro: var(--w3m-font-size-master);
        --wui-font-size-tiny: calc(var(--w3m-font-size-master) * 1.2);
        --wui-font-size-small: calc(var(--w3m-font-size-master) * 1.4);
        --wui-font-size-paragraph: calc(var(--w3m-font-size-master) * 1.6);
        --wui-font-size-medium: calc(var(--w3m-font-size-master) * 1.8);
        --wui-font-size-large: calc(var(--w3m-font-size-master) * 2);
        --wui-font-size-title-6: calc(var(--w3m-font-size-master) * 2.2);
        --wui-font-size-medium-title: calc(var(--w3m-font-size-master) * 2.4);
        --wui-font-size-2xl: calc(var(--w3m-font-size-master) * 4);

        --wui-border-radius-5xs: var(--w3m-border-radius-master);
        --wui-border-radius-4xs: calc(var(--w3m-border-radius-master) * 1.5);
        --wui-border-radius-3xs: calc(var(--w3m-border-radius-master) * 2);
        --wui-border-radius-xxs: calc(var(--w3m-border-radius-master) * 3);
        --wui-border-radius-xs: calc(var(--w3m-border-radius-master) * 4);
        --wui-border-radius-s: calc(var(--w3m-border-radius-master) * 5);
        --wui-border-radius-m: calc(var(--w3m-border-radius-master) * 7);
        --wui-border-radius-l: calc(var(--w3m-border-radius-master) * 9);
        --wui-border-radius-3xl: calc(var(--w3m-border-radius-master) * 20);

        --wui-font-weight-light: 400;
        --wui-font-weight-regular: 500;
        --wui-font-weight-medium: 600;
        --wui-font-weight-bold: 700;

        --wui-letter-spacing-2xl: -1.6px;
        --wui-letter-spacing-medium-title: -0.96px;
        --wui-letter-spacing-title-6: -0.88px;
        --wui-letter-spacing-large: -0.8px;
        --wui-letter-spacing-medium: -0.72px;
        --wui-letter-spacing-paragraph: -0.64px;
        --wui-letter-spacing-small: -0.56px;
        --wui-letter-spacing-tiny: -0.48px;
        --wui-letter-spacing-micro: -0.2px;
        --wui-letter-spacing-mini: -0.16px;

        --wui-spacing-0: 0px;
        --wui-spacing-4xs: 2px;
        --wui-spacing-3xs: 4px;
        --wui-spacing-xxs: 6px;
        --wui-spacing-2xs: 7px;
        --wui-spacing-xs: 8px;
        --wui-spacing-1xs: 10px;
        --wui-spacing-s: 12px;
        --wui-spacing-m: 14px;
        --wui-spacing-l: 16px;
        --wui-spacing-2l: 18px;
        --wui-spacing-xl: 20px;
        --wui-spacing-xxl: 24px;
        --wui-spacing-2xl: 32px;
        --wui-spacing-3xl: 40px;
        --wui-spacing-4xl: 90px;
        --wui-spacing-5xl: 95px;

        --wui-icon-box-size-xxs: 14px;
        --wui-icon-box-size-xs: 20px;
        --wui-icon-box-size-sm: 24px;
        --wui-icon-box-size-md: 32px;
        --wui-icon-box-size-mdl: 36px;
        --wui-icon-box-size-lg: 40px;
        --wui-icon-box-size-2lg: 48px;
        --wui-icon-box-size-xl: 64px;

        --wui-icon-size-inherit: inherit;
        --wui-icon-size-xxs: 10px;
        --wui-icon-size-xs: 12px;
        --wui-icon-size-sm: 14px;
        --wui-icon-size-md: 16px;
        --wui-icon-size-mdl: 18px;
        --wui-icon-size-lg: 20px;
        --wui-icon-size-xl: 24px;
        --wui-icon-size-xxl: 28px;

        --wui-wallet-image-size-inherit: inherit;
        --wui-wallet-image-size-sm: 40px;
        --wui-wallet-image-size-md: 56px;
        --wui-wallet-image-size-lg: 80px;

        --wui-visual-size-size-inherit: inherit;
        --wui-visual-size-sm: 40px;
        --wui-visual-size-md: 55px;
        --wui-visual-size-lg: 80px;

        --wui-box-size-md: 100px;
        --wui-box-size-lg: 120px;

        --wui-ease-out-power-2: cubic-bezier(0, 0, 0.22, 1);
        --wui-ease-out-power-1: cubic-bezier(0, 0, 0.55, 1);

        --wui-ease-in-power-3: cubic-bezier(0.66, 0, 1, 1);
        --wui-ease-in-power-2: cubic-bezier(0.45, 0, 1, 1);
        --wui-ease-in-power-1: cubic-bezier(0.3, 0, 1, 1);

        --wui-ease-inout-power-1: cubic-bezier(0.45, 0, 0.55, 1);

        --wui-duration-lg: 200ms;
        --wui-duration-md: 125ms;
        --wui-duration-sm: 75ms;

        --wui-path-network-sm: path(
          'M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z'
        );

        --wui-path-network-md: path(
          'M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z'
        );

        --wui-path-network-lg: path(
          'M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z'
        );

        --wui-width-network-sm: 36px;
        --wui-width-network-md: 48px;
        --wui-width-network-lg: 86px;

        --wui-height-network-sm: 40px;
        --wui-height-network-md: 54px;
        --wui-height-network-lg: 96px;

        --wui-icon-size-network-xs: 12px;
        --wui-icon-size-network-sm: 16px;
        --wui-icon-size-network-md: 24px;
        --wui-icon-size-network-lg: 42px;

        --wui-color-inherit: inherit;

        --wui-color-inverse-100: #fff;
        --wui-color-inverse-000: #000;

        --wui-cover: rgba(20, 20, 20, 0.8);

        --wui-color-modal-bg: var(--wui-color-modal-bg-base);

        --wui-color-accent-100: var(--wui-color-accent-base-100);
        --wui-color-accent-090: var(--wui-color-accent-base-090);
        --wui-color-accent-080: var(--wui-color-accent-base-080);

        --wui-color-success-100: var(--wui-color-success-base-100);
        --wui-color-success-125: var(--wui-color-success-base-125);

        --wui-color-warning-100: var(--wui-color-warning-base-100);

        --wui-color-error-100: var(--wui-color-error-base-100);
        --wui-color-error-125: var(--wui-color-error-base-125);

        --wui-color-blue-100: var(--wui-color-blue-base-100);
        --wui-color-blue-90: var(--wui-color-blue-base-90);

        --wui-icon-box-bg-error-100: var(--wui-icon-box-bg-error-base-100);
        --wui-icon-box-bg-blue-100: var(--wui-icon-box-bg-blue-base-100);
        --wui-icon-box-bg-success-100: var(--wui-icon-box-bg-success-base-100);
        --wui-icon-box-bg-inverse-100: var(--wui-icon-box-bg-inverse-base-100);

        --wui-all-wallets-bg-100: var(--wui-all-wallets-bg-100);

        --wui-avatar-border: var(--wui-avatar-border-base);

        --wui-thumbnail-border: var(--wui-thumbnail-border-base);

        --wui-wallet-button-bg: var(--wui-wallet-button-bg-base);

        --wui-box-shadow-blue: var(--wui-color-accent-glass-020);
      }

      @supports (background: color-mix(in srgb, white 50%, black)) {
        :root {
          --wui-color-modal-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-modal-bg-base)
          );

          --wui-box-shadow-blue: color-mix(in srgb, var(--wui-color-accent-100) 20%, transparent);

          --wui-color-accent-100: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 100%,
            transparent
          );
          --wui-color-accent-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-glass-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-020: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 20%,
            transparent
          );
          --wui-color-accent-glass-015: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 15%,
            transparent
          );
          --wui-color-accent-glass-010: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 10%,
            transparent
          );
          --wui-color-accent-glass-005: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 5%,
            transparent
          );
          --wui-color-accent-002: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 2%,
            transparent
          );

          --wui-color-fg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-100)
          );
          --wui-color-fg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-125)
          );
          --wui-color-fg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-150)
          );
          --wui-color-fg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-175)
          );
          --wui-color-fg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-200)
          );
          --wui-color-fg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-225)
          );
          --wui-color-fg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-250)
          );
          --wui-color-fg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-275)
          );
          --wui-color-fg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-300)
          );
          --wui-color-fg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-325)
          );
          --wui-color-fg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-350)
          );

          --wui-color-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-100)
          );
          --wui-color-bg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-125)
          );
          --wui-color-bg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-150)
          );
          --wui-color-bg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-175)
          );
          --wui-color-bg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-200)
          );
          --wui-color-bg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-225)
          );
          --wui-color-bg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-250)
          );
          --wui-color-bg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-275)
          );
          --wui-color-bg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-300)
          );
          --wui-color-bg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-325)
          );
          --wui-color-bg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-350)
          );

          --wui-color-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-100)
          );
          --wui-color-success-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-125)
          );

          --wui-color-warning-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-warning-base-100)
          );

          --wui-color-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-100)
          );
          --wui-color-blue-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-100)
          );
          --wui-color-blue-90: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-90)
          );
          --wui-color-error-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-125)
          );

          --wui-icon-box-bg-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-error-base-100)
          );
          --wui-icon-box-bg-accent-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-blue-base-100)
          );
          --wui-icon-box-bg-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-success-base-100)
          );
          --wui-icon-box-bg-inverse-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-inverse-base-100)
          );

          --wui-all-wallets-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-all-wallets-bg-100)
          );

          --wui-avatar-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-avatar-border-base)
          );

          --wui-thumbnail-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-thumbnail-border-base)
          );

          --wui-wallet-button-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-wallet-button-bg-base)
          );
        }
      }
    `,light:ti`
      :root {
        --w3m-color-mix: ${Mt(t?.["--w3m-color-mix"]||"#fff")};
        --w3m-accent: ${Mt(Us(t,"dark")["--w3m-accent"])};
        --w3m-default: #fff;

        --wui-color-modal-bg-base: ${Mt(Us(t,"dark")["--w3m-background"])};
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(230, 100%, 67%, 1);
        --wui-color-blueberry-090: hsla(231, 76%, 61%, 1);
        --wui-color-blueberry-080: hsla(230, 59%, 55%, 1);
        --wui-color-blueberry-050: hsla(231, 100%, 70%, 0.1);

        --wui-color-fg-100: #e4e7e7;
        --wui-color-fg-125: #d0d5d5;
        --wui-color-fg-150: #a8b1b1;
        --wui-color-fg-175: #a8b0b0;
        --wui-color-fg-200: #949e9e;
        --wui-color-fg-225: #868f8f;
        --wui-color-fg-250: #788080;
        --wui-color-fg-275: #788181;
        --wui-color-fg-300: #6e7777;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #363636;

        --wui-color-bg-100: #141414;
        --wui-color-bg-125: #191a1a;
        --wui-color-bg-150: #1e1f1f;
        --wui-color-bg-175: #222525;
        --wui-color-bg-200: #272a2a;
        --wui-color-bg-225: #2c3030;
        --wui-color-bg-250: #313535;
        --wui-color-bg-275: #363b3b;
        --wui-color-bg-300: #3b4040;
        --wui-color-bg-325: #252525;
        --wui-color-bg-350: #ffffff;

        --wui-color-success-base-100: #26d962;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f25a67;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 217, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 217, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 217, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 217, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 217, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 217, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 217, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 217, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 217, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 217, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(242, 90, 103, 0.01);
        --wui-color-error-glass-002: rgba(242, 90, 103, 0.02);
        --wui-color-error-glass-005: rgba(242, 90, 103, 0.05);
        --wui-color-error-glass-010: rgba(242, 90, 103, 0.1);
        --wui-color-error-glass-015: rgba(242, 90, 103, 0.15);
        --wui-color-error-glass-020: rgba(242, 90, 103, 0.2);
        --wui-color-error-glass-025: rgba(242, 90, 103, 0.25);
        --wui-color-error-glass-030: rgba(242, 90, 103, 0.3);
        --wui-color-error-glass-060: rgba(242, 90, 103, 0.6);
        --wui-color-error-glass-080: rgba(242, 90, 103, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-color-gray-glass-001: rgba(255, 255, 255, 0.01);
        --wui-color-gray-glass-002: rgba(255, 255, 255, 0.02);
        --wui-color-gray-glass-005: rgba(255, 255, 255, 0.05);
        --wui-color-gray-glass-010: rgba(255, 255, 255, 0.1);
        --wui-color-gray-glass-015: rgba(255, 255, 255, 0.15);
        --wui-color-gray-glass-020: rgba(255, 255, 255, 0.2);
        --wui-color-gray-glass-025: rgba(255, 255, 255, 0.25);
        --wui-color-gray-glass-030: rgba(255, 255, 255, 0.3);
        --wui-color-gray-glass-060: rgba(255, 255, 255, 0.6);
        --wui-color-gray-glass-080: rgba(255, 255, 255, 0.8);
        --wui-color-gray-glass-090: rgba(255, 255, 255, 0.9);

        --wui-color-dark-glass-100: rgba(42, 42, 42, 1);

        --wui-icon-box-bg-error-base-100: #3c2426;
        --wui-icon-box-bg-blue-base-100: #20303f;
        --wui-icon-box-bg-success-base-100: #1f3a28;
        --wui-icon-box-bg-inverse-base-100: #243240;

        --wui-all-wallets-bg-100: #222b35;

        --wui-avatar-border-base: #252525;

        --wui-thumbnail-border-base: #252525;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --w3m-card-embedded-shadow-color: rgb(17 17 18 / 25%);
      }
    `,dark:ti`
      :root {
        --w3m-color-mix: ${Mt(t?.["--w3m-color-mix"]||"#000")};
        --w3m-accent: ${Mt(Us(t,"light")["--w3m-accent"])};
        --w3m-default: #000;

        --wui-color-modal-bg-base: ${Mt(Us(t,"light")["--w3m-background"])};
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(231, 100%, 70%, 1);
        --wui-color-blueberry-090: hsla(231, 97%, 72%, 1);
        --wui-color-blueberry-080: hsla(231, 92%, 74%, 1);

        --wui-color-fg-100: #141414;
        --wui-color-fg-125: #2d3131;
        --wui-color-fg-150: #474d4d;
        --wui-color-fg-175: #636d6d;
        --wui-color-fg-200: #798686;
        --wui-color-fg-225: #828f8f;
        --wui-color-fg-250: #8b9797;
        --wui-color-fg-275: #95a0a0;
        --wui-color-fg-300: #9ea9a9;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #d0d0d0;

        --wui-color-bg-100: #ffffff;
        --wui-color-bg-125: #f5fafa;
        --wui-color-bg-150: #f3f8f8;
        --wui-color-bg-175: #eef4f4;
        --wui-color-bg-200: #eaf1f1;
        --wui-color-bg-225: #e5eded;
        --wui-color-bg-250: #e1e9e9;
        --wui-color-bg-275: #dce7e7;
        --wui-color-bg-300: #d8e3e3;
        --wui-color-bg-325: #f3f3f3;
        --wui-color-bg-350: #202020;

        --wui-color-success-base-100: #26b562;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f05142;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 181, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 181, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 181, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 181, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 181, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 181, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 181, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 181, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 181, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 181, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(240, 81, 66, 0.01);
        --wui-color-error-glass-002: rgba(240, 81, 66, 0.02);
        --wui-color-error-glass-005: rgba(240, 81, 66, 0.05);
        --wui-color-error-glass-010: rgba(240, 81, 66, 0.1);
        --wui-color-error-glass-015: rgba(240, 81, 66, 0.15);
        --wui-color-error-glass-020: rgba(240, 81, 66, 0.2);
        --wui-color-error-glass-025: rgba(240, 81, 66, 0.25);
        --wui-color-error-glass-030: rgba(240, 81, 66, 0.3);
        --wui-color-error-glass-060: rgba(240, 81, 66, 0.6);
        --wui-color-error-glass-080: rgba(240, 81, 66, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-icon-box-bg-error-base-100: #f4dfdd;
        --wui-icon-box-bg-blue-base-100: #d9ecfb;
        --wui-icon-box-bg-success-base-100: #daf0e4;
        --wui-icon-box-bg-inverse-base-100: #dcecfc;

        --wui-all-wallets-bg-100: #e8f1fa;

        --wui-avatar-border-base: #f3f4f4;

        --wui-thumbnail-border-base: #eaefef;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --wui-color-gray-glass-001: rgba(0, 0, 0, 0.01);
        --wui-color-gray-glass-002: rgba(0, 0, 0, 0.02);
        --wui-color-gray-glass-005: rgba(0, 0, 0, 0.05);
        --wui-color-gray-glass-010: rgba(0, 0, 0, 0.1);
        --wui-color-gray-glass-015: rgba(0, 0, 0, 0.15);
        --wui-color-gray-glass-020: rgba(0, 0, 0, 0.2);
        --wui-color-gray-glass-025: rgba(0, 0, 0, 0.25);
        --wui-color-gray-glass-030: rgba(0, 0, 0, 0.3);
        --wui-color-gray-glass-060: rgba(0, 0, 0, 0.6);
        --wui-color-gray-glass-080: rgba(0, 0, 0, 0.8);
        --wui-color-gray-glass-090: rgba(0, 0, 0, 0.9);

        --wui-color-dark-glass-100: rgba(233, 233, 233, 1);

        --w3m-card-embedded-shadow-color: rgb(224 225 233 / 25%);
      }
    `}}const ZS=ti`
  *,
  *::after,
  *::before,
  :host {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-style: normal;
    text-rendering: optimizeSpeed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-tap-highlight-color: transparent;
    font-family: var(--wui-font-family);
    backface-visibility: hidden;
  }
`,XS=ti`
  button,
  a {
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    transition:
      color var(--wui-duration-lg) var(--wui-ease-out-power-1),
      background-color var(--wui-duration-lg) var(--wui-ease-out-power-1),
      border var(--wui-duration-lg) var(--wui-ease-out-power-1),
      border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1),
      box-shadow var(--wui-duration-lg) var(--wui-ease-out-power-1);
    will-change: background-color, color, border, box-shadow, border-radius;
    outline: none;
    border: none;
    column-gap: var(--wui-spacing-3xs);
    background-color: transparent;
    text-decoration: none;
  }

  wui-flex {
    transition: border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1);
    will-change: border-radius;
  }

  button:disabled > wui-wallet-image,
  button:disabled > wui-all-wallets-image,
  button:disabled > wui-network-image,
  button:disabled > wui-image,
  button:disabled > wui-transaction-visual,
  button:disabled > wui-logo {
    filter: grayscale(1);
  }

  @media (hover: hover) and (pointer: fine) {
    button:hover:enabled {
      background-color: var(--wui-color-gray-glass-005);
    }

    button:active:enabled {
      background-color: var(--wui-color-gray-glass-010);
    }
  }

  button:disabled > wui-icon-box {
    opacity: 0.5;
  }

  input {
    border: none;
    outline: none;
    appearance: none;
  }
`,QS=ti`
  .wui-color-inherit {
    color: var(--wui-color-inherit);
  }

  .wui-color-accent-100 {
    color: var(--wui-color-accent-100);
  }

  .wui-color-error-100 {
    color: var(--wui-color-error-100);
  }

  .wui-color-blue-100 {
    color: var(--wui-color-blue-100);
  }

  .wui-color-blue-90 {
    color: var(--wui-color-blue-90);
  }

  .wui-color-error-125 {
    color: var(--wui-color-error-125);
  }

  .wui-color-success-100 {
    color: var(--wui-color-success-100);
  }

  .wui-color-success-125 {
    color: var(--wui-color-success-125);
  }

  .wui-color-inverse-100 {
    color: var(--wui-color-inverse-100);
  }

  .wui-color-inverse-000 {
    color: var(--wui-color-inverse-000);
  }

  .wui-color-fg-100 {
    color: var(--wui-color-fg-100);
  }

  .wui-color-fg-200 {
    color: var(--wui-color-fg-200);
  }

  .wui-color-fg-300 {
    color: var(--wui-color-fg-300);
  }

  .wui-color-fg-325 {
    color: var(--wui-color-fg-325);
  }

  .wui-color-fg-350 {
    color: var(--wui-color-fg-350);
  }

  .wui-bg-color-inherit {
    background-color: var(--wui-color-inherit);
  }

  .wui-bg-color-blue-100 {
    background-color: var(--wui-color-accent-100);
  }

  .wui-bg-color-error-100 {
    background-color: var(--wui-color-error-100);
  }

  .wui-bg-color-error-125 {
    background-color: var(--wui-color-error-125);
  }

  .wui-bg-color-success-100 {
    background-color: var(--wui-color-success-100);
  }

  .wui-bg-color-success-125 {
    background-color: var(--wui-color-success-100);
  }

  .wui-bg-color-inverse-100 {
    background-color: var(--wui-color-inverse-100);
  }

  .wui-bg-color-inverse-000 {
    background-color: var(--wui-color-inverse-000);
  }

  .wui-bg-color-fg-100 {
    background-color: var(--wui-color-fg-100);
  }

  .wui-bg-color-fg-200 {
    background-color: var(--wui-color-fg-200);
  }

  .wui-bg-color-fg-300 {
    background-color: var(--wui-color-fg-300);
  }

  .wui-color-fg-325 {
    background-color: var(--wui-color-fg-325);
  }

  .wui-color-fg-350 {
    background-color: var(--wui-color-fg-350);
  }
`,Vi={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603,DEFAULT_ALLOWED_ANCESTORS:["http://localhost:*","https://*.pages.dev","https://*.vercel.app","https://*.ngrok-free.app","https://secure-mobile.walletconnect.com","https://secure-mobile.walletconnect.org"]};function On(t){return{formatters:void 0,fees:void 0,serializers:void 0,...t}}const xh=On({id:"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",name:"Solana",network:"solana-mainnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!1,chainNamespace:"solana",caipNetworkId:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",deprecatedCaipNetworkId:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ"}),Rh=On({id:"EtWTRABZaYq6iMfeYKouRu166VU2xqa1",name:"Solana Devnet",network:"solana-devnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",deprecatedCaipNetworkId:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"});On({id:"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",name:"Solana Testnet",network:"solana-testnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"});On({id:"000000000019d6689c085ae165831e93",caipNetworkId:"bip122:000000000019d6689c085ae165831e93",chainNamespace:"bip122",name:"Bitcoin",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}});On({id:"000000000933ea01ad0ee984209779ba",caipNetworkId:"bip122:000000000933ea01ad0ee984209779ba",chainNamespace:"bip122",name:"Bitcoin Testnet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});const z_={solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},no={getMethodsByChainNamespace(t){return z_[t]||[]},createDefaultNamespace(t){return{methods:this.getMethodsByChainNamespace(t),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(t,e){if(!e)return{...t};const s={...t},r=new Set;if(e.methods&&Object.keys(e.methods).forEach(i=>r.add(i)),e.chains&&Object.keys(e.chains).forEach(i=>r.add(i)),e.events&&Object.keys(e.events).forEach(i=>r.add(i)),e.rpcMap&&Object.keys(e.rpcMap).forEach(i=>{const[n]=i.split(":");n&&r.add(n)}),r.forEach(i=>{s[i]||(s[i]=this.createDefaultNamespace(i))}),e.methods&&Object.entries(e.methods).forEach(([i,n])=>{s[i]&&(s[i].methods=n)}),e.chains&&Object.entries(e.chains).forEach(([i,n])=>{s[i]&&(s[i].chains=n)}),e.events&&Object.entries(e.events).forEach(([i,n])=>{s[i]&&(s[i].events=n)}),e.rpcMap){const i=new Set;Object.entries(e.rpcMap).forEach(([n,o])=>{const[a,c]=n.split(":");!a||!c||!s[a]||(s[a].rpcMap||(s[a].rpcMap={}),i.has(a)||(s[a].rpcMap={},i.add(a)),s[a].rpcMap[c]=o)})}return s},createNamespaces(t,e){const s=t.reduce((r,i)=>{const{id:n,chainNamespace:o,rpcUrls:a}=i,c=a.default.http[0];r[o]||(r[o]=this.createDefaultNamespace(o));const l=`${o}:${n}`,u=r[o];switch(u.chains.push(l),l){case xh.caipNetworkId:u.chains.push(xh.deprecatedCaipNetworkId);break;case Rh.caipNetworkId:u.chains.push(Rh.deprecatedCaipNetworkId);break}return u?.rpcMap&&c&&(u.rpcMap[n]=c),r},{});return this.applyNamespaceOverrides(s,e)},resolveReownName:async t=>{const e=await Yi.resolveName(t);return(Object.values(e?.addresses)||[])[0]?.address||!1},getChainsFromNamespaces(t={}){return Object.values(t).flatMap(e=>{const s=e.chains||[],r=e.accounts.map(i=>{const[n,o]=i.split(":");return`${n}:${o}`});return Array.from(new Set([...s,...r]))})},isSessionEventData(t){return typeof t=="object"&&t!==null&&"id"in t&&"topic"in t&&"params"in t&&typeof t.params=="object"&&t.params!==null&&"chainId"in t.params&&"event"in t.params&&typeof t.params.event=="object"&&t.params.event!==null},isOriginAllowed(t,e,s){for(const r of[...e,...s])if(r.includes("*")){const n=`^${r.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&").replace(/\\\*/gu,".*")}$`;if(new RegExp(n,"u").test(t))return!0}else try{if(new URL(r).origin===t)return!0}catch{if(r===t)return!0}return!1}};class ef{constructor({provider:e,namespace:s}){this.id=K.CONNECTOR_ID.WALLET_CONNECT,this.name=go.ConnectorNamesMap[K.CONNECTOR_ID.WALLET_CONNECT],this.type="WALLET_CONNECT",this.imageId=go.ConnectorImageIds[K.CONNECTOR_ID.WALLET_CONNECT],this.getCaipNetworks=b.getCaipNetworks.bind(b),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=s}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){const s=this.getCaipNetworks(),r=B.state.universalProviderConfigOverride,i=no.createNamespaces(s,r);await this.provider.connect({optionalNamespaces:i})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){const e=this.chains.map(s=>s.caipNetworkId);return tn.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:W_})}}const W_=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"];class H_{constructor(e){this.availableConnectors=[],this.eventListeners=new Map,this.getCaipNetworks=s=>b.getCaipNetworks(s),e&&this.construct(e)}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get networks(){return this.getCaipNetworks(this.namespace)}setAuthProvider(e){this.addConnector({id:K.CONNECTOR_ID.AUTH,type:"AUTH",name:K.CONNECTOR_NAMES.AUTH,provider:e,imageId:go.ConnectorImageIds[K.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}addConnector(...e){const s=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(r=>s.has(r.id)?!1:(s.add(r.id),!0)),this.emit("connectors",this.availableConnectors)}setStatus(e,s){V.setStatus(e,s)}on(e,s){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e)?.add(s)}off(e,s){const r=this.eventListeners.get(e);r&&r.delete(s)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,s){const r=this.eventListeners.get(e);r&&r.forEach(i=>i(s))}async connectWalletConnect(e){return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}async switchNetwork(e){const{caipNetwork:s,providerType:r}=e;if(!e.provider)return;const i="provider"in e.provider?e.provider.provider:e.provider;if(r==="WALLET_CONNECT"){i.setDefaultChain(s.caipNetworkId);return}if(i&&r==="AUTH"){const n=i,o=V.state.preferredAccountTypes?.[s.chainNamespace];await n.switchNetwork(s.caipNetworkId);const a=await n.getUser({chainId:s.caipNetworkId,preferredAccountType:o});this.emit("switchNetwork",a)}}getWalletConnectConnector(){const e=this.connectors.find(s=>s instanceof ef);if(!e)throw new Error("WalletConnectConnector not found");return e}}class V_ extends H_{setUniversalProvider(e){this.addConnector(new ef({provider:e,caipNetworks:this.getCaipNetworks(),namespace:this.namespace}))}async connect(e){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})}async disconnect(){try{await this.getWalletConnectConnector().disconnect()}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}}async getAccounts({namespace:e}){const r=this.provider?.session?.namespaces?.[e]?.accounts?.map(i=>{const[,,n]=i.split(":");return n}).filter((i,n,o)=>o.indexOf(i)===n)||[];return Promise.resolve({accounts:r.map(i=>te.createAccount(e,i,e==="bip122"?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){if(!(e.caipNetwork&&Se.BALANCE_SUPPORTED_CHAINS.includes(e.caipNetwork?.chainNamespace))||e.caipNetwork?.testnet)return{balance:"0.00",symbol:e.caipNetwork?.nativeCurrency.symbol||""};if(V.state.balanceLoading&&e.chainId===b.state.activeCaipNetwork?.id)return{balance:V.state.balance||"0.00",symbol:V.state.balanceSymbol||""};const i=(await V.fetchTokenBalance()).find(n=>n.chainId===`${e.caipNetwork?.chainNamespace}:${e.chainId}`&&n.symbol===e.caipNetwork?.nativeCurrency.symbol);return{balance:i?.quantity.numeric||"0.00",symbol:i?.symbol||e.caipNetwork?.nativeCurrency.symbol||""}}async signMessage(e){const{provider:s,message:r,address:i}=e;if(!s)throw new Error("UniversalAdapter:signMessage - provider is undefined");let n="";return b.state.activeCaipNetwork?.chainNamespace===K.CHAIN.SOLANA?n=(await s.request({method:"solana_signMessage",params:{message:Mh.encode(new TextEncoder().encode(r)),pubkey:i}},b.state.activeCaipNetwork?.caipNetworkId)).signature:n=await s.request({method:"personal_sign",params:[r,i]},b.state.activeCaipNetwork?.caipNetworkId),{signature:n}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(e){const{caipNetwork:s}=e,r=this.getWalletConnectConnector();if(s.chainNamespace===K.CHAIN.EVM)try{await r.provider?.request({method:"wallet_switchEthereumChain",params:[{chainId:Yc(s.id)}]})}catch(i){if(i.code===Vi.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||i.code===Vi.ERROR_INVALID_CHAIN_ID||i.code===Vi.ERROR_CODE_DEFAULT||i?.data?.originalError?.code===Vi.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await r.provider?.request({method:"wallet_addEthereumChain",params:[{chainId:Yc(s.id),rpcUrls:[s?.rpcUrls.chainDefault?.http],chainName:s.name,nativeCurrency:s.nativeCurrency,blockExplorerUrls:[s.blockExplorers?.default.url]}]})}catch{throw new Error("Chain is not supported")}}r.provider.setDefaultChain(s.caipNetworkId)}getWalletConnectProvider(){return this.connectors.find(r=>r.type==="WALLET_CONNECT")?.provider}}const K_=["email","socials","swaps","onramp","activity","reownBranding"],Jn={email:{apiFeatureName:"social_login",localFeatureName:"email",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;const e=t.config;return!!t.isEnabled&&e.includes("email")},processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.email:!!t},socials:{apiFeatureName:"social_login",localFeatureName:"socials",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;const e=t.config;return t.isEnabled&&e.length>0?e.filter(s=>s!=="email"):!1},processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.socials:typeof t=="boolean"?t?Se.DEFAULT_REMOTE_FEATURES.socials:!1:t},swaps:{apiFeatureName:"swap",localFeatureName:"swaps",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.swaps:typeof t=="boolean"?t?Se.DEFAULT_REMOTE_FEATURES.swaps:!1:t},onramp:{apiFeatureName:"onramp",localFeatureName:"onramp",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!t?.config)return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.onramp:typeof t=="boolean"?t?Se.DEFAULT_REMOTE_FEATURES.onramp:!1:t},activity:{apiFeatureName:"activity",localFeatureName:"history",returnType:!1,isLegacy:!0,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.activity:!!t},reownBranding:{apiFeatureName:"reown_branding",localFeatureName:"reownBranding",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?Se.DEFAULT_REMOTE_FEATURES.reownBranding:!!t}},G_={localSettingsOverridden:new Set,getApiConfig(t,e){return e?.find(s=>s.id===t)},addWarning(t,e){if(t!==void 0){const s=Jn[e],r=s.isLegacy?`"features.${s.localFeatureName}" (now "${e}")`:`"features.${e}"`;this.localSettingsOverridden.add(r)}},processFeature(t,e,s,r,i){const n=Jn[t],o=e[n.localFeatureName];if(i&&!n.isAvailableOnBasic)return!1;if(r){const a=this.getApiConfig(n.apiFeatureName,s);return a?.config===null?this.processFallbackFeature(t,o):a?.config?(o!==void 0&&this.addWarning(o,t),this.processApiFeature(t,a)):!1}return this.processFallbackFeature(t,o)},processApiFeature(t,e){return Jn[t].processApi(e)},processFallbackFeature(t,e){return Jn[t].processFallback(e)},async fetchRemoteFeatures(t){const e=t.basic??!1,s=t.features||{};this.localSettingsOverridden.clear();let r=null,i=!1;try{r=await J.fetchProjectConfig(),i=r!=null}catch(o){console.warn("[Reown Config] Failed to fetch remote project configuration. Using local/default values.",o)}const n=i&&!e?Se.DEFAULT_REMOTE_FEATURES:Se.DEFAULT_REMOTE_FEATURES_DISABLED;try{for(const o of K_){const a=this.processFeature(o,s,r,i,e);Object.assign(n,{[o]:a})}}catch(o){return console.warn("[Reown Config] Failed to process the configuration from Cloud. Using default values.",o),Se.DEFAULT_REMOTE_FEATURES}if(i&&this.localSettingsOverridden.size>0){const o=`Your local configuration for ${Array.from(this.localSettingsOverridden).join(", ")} was ignored because a remote configuration was successfully fetched. Please manage these features via your project dashboard on dashboard.reown.com.`;Ys.open({shortMessage:"Local configuration ignored",longMessage:`[Reown Config Notice] ${o}`},"warning")}return n}};class J_{constructor(e){this.chainNamespaces=[],this.remoteFeatures={},this.reportedAlertErrors={},this.getCaipNetwork=(s,r)=>{if(s){const i=b.getNetworkData(s)?.requestedCaipNetworks?.find(a=>a.id===r);if(i)return i;const n=b.getNetworkData(s)?.caipNetwork;return n||b.getRequestedCaipNetworks(s).filter(a=>a.chainNamespace===s)?.[0]}return b.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{const s=this.getCaipNetwork();if(s)return s.id},this.getCaipNetworks=s=>b.getCaipNetworks(s),this.getActiveChainNamespace=()=>b.state.activeChain,this.setRequestedCaipNetworks=(s,r)=>{b.setRequestedCaipNetworks(s,r)},this.getApprovedCaipNetworkIds=()=>b.getAllApprovedCaipNetworkIds(),this.getCaipAddress=s=>b.state.activeChain===s||!s?b.state.activeCaipAddress:b.getAccountProp("caipAddress",s),this.setClientId=s=>{Q.setClientId(s)},this.getProvider=s=>xe.getProvider(s),this.getProviderType=s=>xe.getProviderId(s),this.getPreferredAccountType=s=>V.state.preferredAccountTypes?.[s],this.setCaipAddress=(s,r)=>{V.setCaipAddress(s,r),s&&B.state.enableEmbedded&&this.close()},this.setBalance=(s,r,i)=>{V.setBalance(s,r,i)},this.setProfileName=(s,r)=>{V.setProfileName(s,r)},this.setProfileImage=(s,r)=>{V.setProfileImage(s,r)},this.setUser=(s,r)=>{V.setUser(s,r)},this.resetAccount=s=>{V.resetAccount(s)},this.setCaipNetwork=s=>{b.setActiveCaipNetwork(s)},this.setCaipNetworkOfNamespace=(s,r)=>{b.setChainNetworkData(r,{caipNetwork:s})},this.setAllAccounts=(s,r)=>{V.setAllAccounts(s,r),B.setHasMultipleAddresses(s?.length>1)},this.setStatus=(s,r)=>{V.setStatus(s,r),W.isConnected()?H.setConnectionStatus("connected"):H.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=s=>b.getAccountProp("address",s),this.setConnectors=s=>{const r=[...W.state.allConnectors,...s];W.setConnectors(r)},this.setConnections=(s,r)=>{ee.setConnections(s,r)},this.fetchIdentity=s=>Q.fetchIdentity(s),this.getReownName=s=>Yi.getNamesForAddress(s),this.getConnectors=()=>W.getConnectors(),this.getConnectorImage=s=>Wh.getConnectorImage(s),this.setConnectedWalletInfo=(s,r)=>{const i=xe.getProviderId(r),n=s?{...s,type:i}:void 0;V.setConnectedWalletInfo(n,r)},this.getIsConnectedState=()=>!!b.state.activeCaipAddress,this.addAddressLabel=(s,r,i)=>{V.addAddressLabel(s,r,i)},this.removeAddressLabel=(s,r)=>{V.removeAddressLabel(s,r)},this.getAddress=s=>b.state.activeChain===s||!s?V.state.address:b.getAccountProp("address",s),this.setApprovedCaipNetworksData=s=>b.setApprovedCaipNetworksData(s),this.resetNetwork=s=>{b.resetNetwork(s)},this.addConnector=s=>{W.addConnector(s)},this.resetWcConnection=()=>{ee.resetWcConnection()},this.setAddressExplorerUrl=(s,r)=>{V.setAddressExplorerUrl(s,r)},this.setSmartAccountDeployed=(s,r)=>{V.setSmartAccountDeployed(s,r)},this.setSmartAccountEnabledNetworks=(s,r)=>{b.setSmartAccountEnabledNetworks(s,r)},this.setPreferredAccountType=(s,r)=>{V.setPreferredAccountType(s,r)},this.setEIP6963Enabled=s=>{B.setEIP6963Enabled(s)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=this.getChainNamespacesSet(e.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.readyPromise=this.initialize(e)}getChainNamespacesSet(e,s){const r=e?.map(n=>n.namespace).filter(n=>!!n);if(r?.length)return[...new Set(r)];const i=s?.map(n=>n.chainNamespace);return[...new Set(i)]}async initialize(e){this.initializeProjectSettings(e),this.initControllers(e),await this.initChainAdapters(),this.sendInitializeEvent(e),await this.syncExistingConnection(),this.remoteFeatures=await G_.fetchRemoteFeatures(e),B.setRemoteFeatures(this.remoteFeatures),this.remoteFeatures.onramp&&Ra.setOnrampProviders(this.remoteFeatures.onramp),(B.state.remoteFeatures?.email||Array.isArray(B.state.remoteFeatures?.socials)&&B.state.remoteFeatures?.socials.length>0)&&await this.checkAllowedOrigins()}async checkAllowedOrigins(){const e=await J.fetchAllowedOrigins();if(e&&te.isClient()){const s=window.location.origin;no.isOriginAllowed(s,e,Vi.DEFAULT_ALLOWED_ANCESTORS)||Ys.open(Wr.ALERT_ERRORS.INVALID_APP_CONFIGURATION,"error")}else Ys.open(Wr.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error")}sendInitializeEvent(e){const{...s}=e;delete s.adapters,delete s.universalProvider,Ue.sendEvent({type:"track",event:"INITIALIZE",properties:{...s,networks:e.networks.map(r=>r.id),siweConfig:{options:e.siweConfig?.options||{}}}})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initializeThemeController(e){e.themeMode&&_t.setThemeMode(e.themeMode),e.themeVariables&&_t.setThemeVariables(e.themeVariables)}initializeChainController(e){if(!this.connectionControllerClient||!this.networkControllerClient)throw new Error("ConnectionControllerClient and NetworkControllerClient must be set");b.initialize(e.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient,networkControllerClient:this.networkControllerClient});const s=this.getDefaultNetwork();s&&b.setActiveCaipNetwork(s)}initializeConnectionController(e){ee.setWcBasic(e.basic??!1)}initializeConnectorController(){W.initialize(this.chainNamespaces)}initializeProjectSettings(e){B.setProjectId(e.projectId),B.setSdkVersion(e.sdkVersion)}initializeOptionsController(e){B.setDebug(e.debug!==!1),B.setEnableWalletConnect(e.enableWalletConnect!==!1),B.setEnableWalletGuide(e.enableWalletGuide!==!1),B.setEnableWallets(e.enableWallets!==!1),B.setEIP6963Enabled(e.enableEIP6963!==!1),B.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),B.setEnableAuthLogger(e.enableAuthLogger!==!1),B.setCustomRpcUrls(e.customRpcUrls),B.setEnableEmbedded(e.enableEmbedded),B.setAllWallets(e.allWallets),B.setIncludeWalletIds(e.includeWalletIds),B.setExcludeWalletIds(e.excludeWalletIds),B.setFeaturedWalletIds(e.featuredWalletIds),B.setTokens(e.tokens),B.setTermsConditionsUrl(e.termsConditionsUrl),B.setPrivacyPolicyUrl(e.privacyPolicyUrl),B.setCustomWallets(e.customWallets),B.setFeatures(e.features),B.setAllowUnsupportedChain(e.allowUnsupportedChain),B.setUniversalProviderConfigOverride(e.universalProviderConfigOverride),B.setPreferUniversalLinks(e.experimental_preferUniversalLinks),B.setDefaultAccountTypes(e.defaultAccountTypes);const s=H.getPreferredAccountTypes()||{},r={...B.state.defaultAccountTypes,...s};V.setPreferredAccountTypes(r);const i=this.getDefaultMetaData();if(!e.metadata&&i&&(e.metadata=i),B.setMetadata(e.metadata),B.setDisableAppend(e.disableAppend),B.setEnableEmbedded(e.enableEmbedded),B.setSIWX(e.siwx),!e.projectId){Ys.open(Wr.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}if(e.adapters?.find(o=>o.namespace===K.CHAIN.EVM)&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");B.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){return te.isClient()?{name:document.getElementsByTagName("title")?.[0]?.textContent||"",description:document.querySelector('meta[property="og:description"]')?.content||"",url:window.location.origin,icons:[document.querySelector('link[rel~="icon"]')?.href||""]}:null}setUnsupportedNetwork(e){const s=this.getActiveChainNamespace();if(s){const r=Vr.getUnsupportedNetwork(`${s}:${e}`);b.setActiveCaipNetwork(r)}}getDefaultNetwork(){return Vr.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,s){return Vr.extendCaipNetwork(e,{customNetworkImageUrls:s.chainImages,projectId:s.projectId})}extendCaipNetworks(e){return Vr.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){const s=e.networks.find(i=>i.id===e.defaultNetwork?.id);return s?Vr.extendCaipNetwork(s,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}async disconnectNamespace(e){try{const s=this.getAdapter(e),r=xe.getProvider(e),i=xe.getProviderId(e),{caipAddress:n}=b.getAccountData(e)||{};this.setLoading(!0,e),n&&s?.disconnect&&await s.disconnect({provider:r,providerType:i}),H.removeConnectedNamespace(e),xe.resetChain(e),this.setUser(void 0,e),this.setStatus("disconnected",e),this.setConnectedWalletInfo(void 0,e),W.removeConnectorId(e),b.resetAccount(e),b.resetNetwork(e),this.setLoading(!1,e)}catch(s){throw this.setLoading(!1,e),new Error(`Failed to disconnect chain ${e}: ${s.message}`)}}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{const e=b.state.activeChain,s=this.getAdapter(e),r=this.getCaipNetwork(e)?.id;if(!s)throw new Error("Adapter not found");const i=await s.connectWalletConnect(r);this.close(),this.setClientId(i?.clientId||null),H.setConnectedNamespaces([...b.state.chains.keys()]),this.chainNamespaces.forEach(n=>{W.setConnectorId(ks.CONNECTOR_TYPE_WALLET_CONNECT,n)}),await this.syncWalletConnectAccount()},connectExternal:async({id:e,info:s,type:r,provider:i,chain:n,caipNetwork:o,socialUri:a})=>{const c=b.state.activeChain,l=n||c,u=this.getAdapter(l);if(n&&n!==c&&!o){const g=this.getCaipNetworks().find(p=>p.chainNamespace===n);g&&this.setCaipNetwork(g)}if(!u)throw new Error("Adapter not found");const h=this.getCaipNetwork(l),d=await u.connect({id:e,info:s,type:r,provider:i,socialUri:a,chainId:o?.id||h?.id,rpcUrl:o?.rpcUrls?.default?.http?.[0]||h?.rpcUrls?.default?.http?.[0]});if(!d)return;H.addConnectedNamespace(l),this.syncProvider({...d,chainNamespace:l});const f=V.state.allAccounts,{accounts:m}=f?.length>0?{accounts:[...f]}:await u.getAccounts({namespace:l,id:e});this.setAllAccounts(m,l),this.setStatus("connected",l),this.syncConnectedWalletInfo(l)},reconnectExternal:async({id:e,info:s,type:r,provider:i})=>{const n=b.state.activeChain,o=this.getAdapter(n);o?.reconnect&&(await o?.reconnect({id:e,info:s,type:r,provider:i,chainId:this.getCaipNetwork()?.id}),H.addConnectedNamespace(n),this.syncConnectedWalletInfo(n))},disconnect:async e=>{const s=w_(e);try{const r=await Promise.allSettled(s.map(async([n])=>this.disconnectNamespace(n)));ye.resetSend(),ee.resetWcConnection(),await tn.clearSessions(),W.setFilterByNamespace(void 0);const i=r.filter(n=>n.status==="rejected");if(i.length>0)throw new Error(i.map(n=>n.reason.message).join(", "));H.deleteConnectedSocialProvider(),Ue.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:e||"all"}})}catch(r){throw new Error(`Failed to disconnect chains: ${r.message}`)}},checkInstalled:e=>e?e.some(s=>!!window.ethereum?.[String(s)]):!!window.ethereum,signMessage:async e=>(await this.getAdapter(b.state.activeChain)?.signMessage({message:e,address:V.state.address,provider:xe.getProvider(b.state.activeChain)}))?.signature||"",sendTransaction:async e=>{const s=e.chainNamespace;if(Se.SEND_SUPPORTED_NAMESPACES.includes(s)){const r=this.getAdapter(b.state.activeChain),i=xe.getProvider(s);return(await r?.sendTransaction({...e,caipNetwork:this.getCaipNetwork(),provider:i}))?.hash||""}return""},estimateGas:async e=>{if(e.chainNamespace===K.CHAIN.EVM){const s=this.getAdapter(b.state.activeChain),r=xe.getProvider(b.state.activeChain),i=this.getCaipNetwork();if(!i)throw new Error("CaipNetwork is undefined");return(await s?.estimateGas({...e,provider:r,caipNetwork:i}))?.gas||0n}return 0n},getEnsAvatar:async()=>(await this.syncIdentity({address:V.state.address,chainId:Number(this.getCaipNetwork()?.id),chainNamespace:b.state.activeChain}),V.state.profileImage||!1),getEnsAddress:async e=>await no.resolveReownName(e),writeContract:async e=>{const s=this.getAdapter(b.state.activeChain),r=this.getCaipNetwork(),i=this.getCaipAddress(),n=xe.getProvider(b.state.activeChain);if(!r||!i)throw new Error("CaipNetwork or CaipAddress is undefined");return(await s?.writeContract({...e,caipNetwork:r,provider:n,caipAddress:i}))?.hash},parseUnits:(e,s)=>this.getAdapter(b.state.activeChain)?.parseUnits({value:e,decimals:s})??0n,formatUnits:(e,s)=>this.getAdapter(b.state.activeChain)?.formatUnits({value:e,decimals:s})??"0",getCapabilities:async e=>await this.getAdapter(b.state.activeChain)?.getCapabilities(e),grantPermissions:async e=>await this.getAdapter(b.state.activeChain)?.grantPermissions(e),revokePermissions:async e=>{const s=this.getAdapter(b.state.activeChain);return s?.revokePermissions?await s.revokePermissions(e):"0x"},walletGetAssets:async e=>await this.getAdapter(b.state.activeChain)?.walletGetAssets(e)??{},updateBalance:e=>{const s=this.getCaipNetwork(e);!s||!V.state.address||this.updateNativeBalance(V.state.address,s?.id,e)}},this.networkControllerClient={switchCaipNetwork:async e=>await this.switchCaipNetwork(e),getApprovedCaipNetworksData:async()=>this.getApprovedCaipNetworksData()},ee.setClient(this.connectionControllerClient)}getApprovedCaipNetworksData(){if(xe.getProviderId(b.state.activeChain)===ks.CONNECTOR_TYPE_WALLET_CONNECT){const s=this.universalProvider?.session?.namespaces;return{supportsAllNetworks:this.universalProvider?.session?.peer?.metadata.name==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(s)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){if(!e)return;const s=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){const i=xe.getProvider(s),n=xe.getProviderId(s);if(e.chainNamespace===b.state.activeChain)await this.getAdapter(s)?.switchNetwork({caipNetwork:e,provider:i,providerType:n});else if(this.setCaipNetwork(e),n===ks.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{const o=this.getAddressByChainNamespace(s);o&&this.syncAccount({address:o,chainId:e.id,chainNamespace:s})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(s=>{const r=s.chains||[],i=s.accounts.map(n=>{const{chainId:o,chainNamespace:a}=Ns.parseCaipAddress(n);return`${a}:${o}`});return Array.from(new Set([...r,...i]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((s,r)=>{const i=e?.find(n=>n.namespace===r);return i?(i.construct({namespace:r,projectId:this.options?.projectId,networks:this.getCaipNetworks()}),s[r]=i):s[r]=new V_({namespace:r,networks:this.getCaipNetworks()}),s},{})}async initChainAdapter(e){this.onConnectors(e),this.listenAdapter(e),await this.chainAdapters?.[e].syncConnectors(this.options,this),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)}))}onConnectors(e){this.getAdapter(e)?.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){const s=this.getAdapter(e);if(!s)return;const r=H.getConnectionStatus();r==="connected"?this.setStatus("connecting",e):r==="disconnected"?(H.clearAddressCache(),this.setStatus(r,e)):this.setStatus(r,e),s.on("switchNetwork",({address:i,chainId:n})=>{const o=this.getCaipNetworks().find(l=>l.id===n||l.caipNetworkId===n),a=b.state.activeChain===e,c=b.getAccountProp("address",e);if(o){const l=a&&i?i:c;l&&this.syncAccount({address:l,chainId:o.id,chainNamespace:e})}else this.setUnsupportedNetwork(n)}),s.on("disconnect",this.disconnect.bind(this,e)),s.on("connections",i=>{this.setConnections(i,e)}),s.on("pendingTransactions",()=>{const i=V.state.address,n=b.state.activeCaipNetwork;!i||!n?.id||this.updateNativeBalance(i,n.id,n.chainNamespace)}),s.on("accountChanged",({address:i,chainId:n})=>{const o=b.state.activeChain===e;o&&n?this.syncAccount({address:i,chainId:n,chainNamespace:e}):o&&b.state.activeCaipNetwork?.id?this.syncAccount({address:i,chainId:b.state.activeCaipNetwork?.id,chainNamespace:e}):this.syncAccountInfo(i,n,e),this.syncAllAccounts(e)})}async createUniversalProviderForAdapter(e){await this.getUniversalProvider(),this.universalProvider&&this.chainAdapters?.[e]?.setUniversalProvider?.(this.universalProvider)}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async syncNamespaceConnection(e){try{e===K.CHAIN.EVM&&te.isSafeApp()&&W.setConnectorId(K.CONNECTOR_ID.SAFE,e);const s=W.getConnectorId(e);switch(this.setStatus("connecting",e),s){case K.CONNECTOR_ID.WALLET_CONNECT:await this.syncWalletConnectAccount();break;case K.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(s){console.warn("AppKit couldn't sync existing connection",s),this.setStatus("disconnected",e)}}async syncAdapterConnection(e){const s=this.getAdapter(e),r=W.getConnectorId(e),i=this.getCaipNetwork(e),o=W.getConnectors(e).find(a=>a.id===r);try{if(!s||!o)throw new Error(`Adapter or connector not found for namespace ${e}`);if(!i?.id)throw new Error("CaipNetwork not found");const a=await s?.syncConnection({namespace:e,id:o.id,chainId:i.id,rpcUrl:i?.rpcUrls?.default?.http?.[0]});if(a){const c=await s?.getAccounts({namespace:e,id:o.id});c&&c.accounts.length>0?this.setAllAccounts(c.accounts,e):this.setAllAccounts([te.createAccount(e,a.address,"eoa")],e),this.syncProvider({...a,chainNamespace:e}),await this.syncAccount({...a,chainNamespace:e}),this.setStatus("connected",e)}else this.setStatus("disconnected",e)}catch{this.setStatus("disconnected",e)}}async syncWalletConnectAccount(){const e=this.chainNamespaces.map(async s=>{const r=this.getAdapter(s),i=this.universalProvider?.session?.namespaces?.[s]?.accounts||[],n=b.state.activeCaipNetwork?.id,o=i.find(a=>{const{chainId:c}=Ns.parseCaipAddress(a);return c===n?.toString()})||i[0];if(o){const a=Ns.validateCaipAddress(o),{chainId:c,address:l}=Ns.parseCaipAddress(a);if(xe.setProviderId(s,ks.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&b.state.activeCaipNetwork&&r?.namespace!==K.CHAIN.EVM){const u=r?.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:b.state.activeCaipNetwork});xe.setProvider(s,u)}else xe.setProvider(s,this.universalProvider);W.setConnectorId(K.CONNECTOR_ID.WALLET_CONNECT,s),H.addConnectedNamespace(s),this.syncWalletConnectAccounts(s),await this.syncAccount({address:l,chainId:c,chainNamespace:s})}else this.setStatus("disconnected",s);this.syncConnectedWalletInfo(s),await b.setApprovedCaipNetworksData(s)});await Promise.all(e)}syncWalletConnectAccounts(e){const s=this.universalProvider?.session?.namespaces?.[e]?.accounts?.map(r=>{const{address:i}=Ns.parseCaipAddress(r);return i}).filter((r,i,n)=>n.indexOf(r)===i);s&&this.setAllAccounts(s.map(r=>te.createAccount(e,r,e==="bip122"?"payment":"eoa")),e)}syncProvider({type:e,provider:s,id:r,chainNamespace:i}){xe.setProviderId(i,e),xe.setProvider(i,s),W.setConnectorId(r,i)}async syncAllAccounts(e){const s=W.getConnectorId(e);if(!s)return;const i=await this.getAdapter(e)?.getAccounts({namespace:e,id:s});i&&i.accounts.length>0&&this.setAllAccounts(i.accounts,e)}async syncAccount(e){const s=e.chainNamespace===b.state.activeChain,r=b.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:i,chainId:n,chainNamespace:o}=e,{chainId:a}=H.getActiveNetworkProps(),c=n||a,l=b.state.activeCaipNetwork?.name===K.UNSUPPORTED_NETWORK_NAME,u=b.getNetworkProp("supportsAllNetworks",o);if(this.setStatus("connected",o),!(l&&!u)&&c){let h=this.getCaipNetworks().find(m=>m.id.toString()===c.toString()),d=this.getCaipNetworks().find(m=>m.chainNamespace===o);if(!u&&!h&&!d){const m=this.getApprovedCaipNetworkIds()||[],g=m.find(w=>Ns.parseCaipNetworkId(w)?.chainId===c.toString()),p=m.find(w=>Ns.parseCaipNetworkId(w)?.chainNamespace===o);h=this.getCaipNetworks().find(w=>w.caipNetworkId===g),d=this.getCaipNetworks().find(w=>w.caipNetworkId===p||"deprecatedCaipNetworkId"in w&&w.deprecatedCaipNetworkId===p)}const f=h||d;f?.chainNamespace===b.state.activeChain?B.state.enableNetworkSwitch&&!B.state.allowUnsupportedChain&&b.state.activeCaipNetwork?.name===K.UNSUPPORTED_NETWORK_NAME?b.showUnsupportedChainUI():this.setCaipNetwork(f):s||r&&this.setCaipNetworkOfNamespace(r,o),this.syncConnectedWalletInfo(o),Wc.isLowerCaseMatch(i,V.state.address)||this.syncAccountInfo(i,f?.id,o),s?await this.syncBalance({address:i,chainId:f?.id,chainNamespace:o}):await this.syncBalance({address:i,chainId:r?.id,chainNamespace:o})}}async syncAccountInfo(e,s,r){const i=this.getCaipAddress(r),n=s||i?.split(":")[1];if(!n)return;const o=`${r}:${n}:${e}`;this.setCaipAddress(o,r),await this.syncIdentity({address:e,chainId:n,chainNamespace:r})}async syncReownName(e,s){try{const r=await this.getReownName(e);if(r[0]){const i=r[0];this.setProfileName(i.name,s)}else this.setProfileName(null,s)}catch{this.setProfileName(null,s)}}syncConnectedWalletInfo(e){const s=W.getConnectorId(e),r=xe.getProviderId(e);if(r===ks.CONNECTOR_TYPE_ANNOUNCED||r===ks.CONNECTOR_TYPE_INJECTED){if(s){const i=this.getConnectors().find(n=>n.id===s);if(i){const{info:n,name:o,imageUrl:a}=i,c=a||this.getConnectorImage(i);this.setConnectedWalletInfo({name:o,icon:c,...n},e)}}}else if(r===ks.CONNECTOR_TYPE_WALLET_CONNECT){const i=xe.getProvider(e);i?.session&&this.setConnectedWalletInfo({...i.session.peer.metadata,name:i.session.peer.metadata.name,icon:i.session.peer.metadata.icons?.[0]},e)}else if(s&&s===K.CONNECTOR_ID.COINBASE){const i=this.getConnectors().find(n=>n.id===K.CONNECTOR_ID.COINBASE);this.setConnectedWalletInfo({name:"Coinbase Wallet",icon:this.getConnectorImage(i)},e)}}async syncBalance(e){!jh.getNetworksByNamespace(this.getCaipNetworks(),e.chainNamespace).find(r=>r.id.toString()===e.chainId?.toString())||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async ready(){await this.readyPromise}async updateNativeBalance(e,s,r){const i=this.getAdapter(r),n=b.getCaipNetworkByNamespace(r,s);if(i){const o=await i.getBalance({address:e,chainId:s,caipNetwork:n,tokens:this.options.tokens});return this.setBalance(o.balance,o.symbol,r),o}}async initializeUniversalAdapter(){const e=b_.createLogger((r,...i)=>{r&&this.handleAlertError(r),console.error(...i)}),s={projectId:this.options?.projectId,metadata:{name:this.options?.metadata?this.options?.metadata.name:"",description:this.options?.metadata?this.options?.metadata.description:"",url:this.options?.metadata?this.options?.metadata.url:"",icons:this.options?.metadata?this.options?.metadata.icons:[""]},logger:e};B.setManualWCControl(!!this.options?.manualWCControl),this.universalProvider=this.options.universalProvider??await m_.init(s),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&(this.universalProvider.on("display_uri",e=>{ee.setUri(e)}),this.universalProvider.on("connect",ee.finalizeWcConnection),this.universalProvider.on("disconnect",()=>{this.chainNamespaces.forEach(e=>{this.resetAccount(e)}),ee.resetWcConnection()}),this.universalProvider.on("chainChanged",e=>{const s=this.getCaipNetworks().find(i=>i.id==e),r=this.getCaipNetwork();if(!s){this.setUnsupportedNetwork(e);return}r?.id!==s?.id&&this.setCaipNetwork(s)}),this.universalProvider.on("session_event",e=>{if(no.isSessionEventData(e)){const{name:s,data:r}=e.params.event;s==="accountsChanged"&&Array.isArray(r)&&te.isCaipAddress(r[0])&&this.syncAccount(Ns.parseCaipAddress(r[0]))}}))}createUniversalProvider(){return!this.universalProviderInitPromise&&te.isClient()&&this.options?.projectId&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){Ue.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider}handleAlertError(e){const s=Object.entries(Wr.UniversalProviderErrors).find(([,{message:a}])=>e.message.includes(a)),[r,i]=s??[],{message:n,alertErrorKey:o}=i??{};if(r&&n&&!this.reportedAlertErrors[r]){const a=Wr.ALERT_ERRORS[o];a&&(Ys.open(a,"error"),this.reportedAlertErrors[r]=!0)}}getAdapter(e){if(e)return this.chainAdapters?.[e]}createAdapter(e){if(!e)return;const s=e.namespace;if(!s)return;this.createClients();const r=e;r.namespace=s,r.construct({namespace:s,projectId:this.options?.projectId,networks:this.getCaipNetworks()}),this.chainNamespaces.includes(s)||this.chainNamespaces.push(s),this.chainAdapters&&(this.chainAdapters[s]=r)}async open(e){if(await this.injectModalUi(),e?.uri&&ee.setUri(e.uri),e?.arguments)switch(e?.view){case"Swap":return Je.open({...e,data:{swap:e.arguments}})}return Je.open(e)}async close(){await this.injectModalUi(),Je.close()}setLoading(e,s){Je.setLoading(e,s)}async disconnect(e){await ee.disconnect(e)}getSIWX(){return B.state.siwx}getError(){return""}getChainId(){return b.state.activeCaipNetwork?.id}async switchNetwork(e){const s=this.getCaipNetworks().find(r=>r.id===e.id);if(!s){Ys.open(Wr.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");return}await b.switchActiveNetwork(s)}getWalletProvider(){return b.state.activeChain?xe.state.providers[b.state.activeChain]:null}getWalletProviderType(){return xe.getProviderId(b.state.activeChain)}subscribeProviders(e){return xe.subscribeProviders(e)}getThemeMode(){return _t.state.themeMode}getThemeVariables(){return _t.state.themeVariables}setThemeMode(e){_t.setThemeMode(e),Qp(_t.state.themeMode)}setTermsConditionsUrl(e){B.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){B.setPrivacyPolicyUrl(e)}setThemeVariables(e){_t.setThemeVariables(e),F_(_t.state.themeVariables)}subscribeTheme(e){return _t.subscribe(e)}getWalletInfo(){return V.state.connectedWalletInfo}getAccount(e){const s=W.getAuthConnector(e),r=b.getAccountData(e),i=b.state.activeChain,n=H.getConnectedConnectorId(e||i);if(r)return{allAccounts:r.allAccounts,caipAddress:r.caipAddress,address:te.getPlainAddress(r.caipAddress),isConnected:!!r.caipAddress,status:r.status,embeddedWalletInfo:s&&n===K.CONNECTOR_ID.AUTH?{user:r.user?{...r.user,username:H.getConnectedSocialUsername()}:void 0,authProvider:r.socialProvider||"email",accountType:r.preferredAccountTypes?.[e||i],isSmartAccountDeployed:!!r.smartAccountDeployed}:void 0}}subscribeAccount(e,s){const r=()=>{const i=this.getAccount(s);i&&e(i)};s?b.subscribeChainProp("accountState",r,s):b.subscribe(r),W.subscribe(r)}subscribeNetwork(e){return b.subscribe(({activeCaipNetwork:s})=>{e({caipNetwork:s,chainId:s?.id,caipNetworkId:s?.caipNetworkId})})}subscribeWalletInfo(e){return V.subscribeKey("connectedWalletInfo",e)}subscribeShouldUpdateToAddress(e){V.subscribeKey("shouldUpdateToAddress",e)}subscribeCaipNetworkChange(e){b.subscribeKey("activeCaipNetwork",e)}getState(){return Ls.state}subscribeState(e){return Ls.subscribe(e)}showErrorMessage(e){Zt.showError(e)}showSuccessMessage(e){Zt.showSuccess(e)}getEvent(){return{...Ue.state}}subscribeEvents(e){return Ue.subscribe(e)}replace(e){ne.replace(e)}redirect(e){ne.push(e)}popTransactionStack(e){ne.popTransactionStack(e)}isOpen(){return Je.state.open}isTransactionStackEmpty(){return ne.state.transactionStack.length===0}static getInstance(){return this.instance}updateFeatures(e){B.setFeatures(e)}updateRemoteFeatures(e){B.setRemoteFeatures(e)}updateOptions(e){const r={...B.state||{},...e};B.setOptions(r)}setConnectMethodsOrder(e){B.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){B.setWalletFeaturesOrder(e)}setCollapseWallets(e){B.setCollapseWallets(e)}setSocialsOrder(e){B.setSocialsOrder(e)}getConnectMethodsOrder(){return vc.getConnectOrderMethod(B.state.features,W.getConnectors())}addNetwork(e,s){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);const r=this.extendCaipNetwork(s,this.options);this.getCaipNetworks().find(i=>i.id===r.id)||b.addNetwork(r)}removeNetwork(e,s){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);this.getCaipNetworks().find(i=>i.id===s)&&b.removeNetwork(e,s)}}let Uh=!1;class tf extends J_{async open(e){W.isConnected()||await super.open(e)}async close(){await super.close(),this.options.manualWCControl&&ee.finalizeWcConnection()}async syncIdentity(e){return Promise.resolve()}async syncBalance(e){return Promise.resolve()}async injectModalUi(){if(!Uh&&te.isClient()){if(await Oa(()=>import("./basic-JQqsByr6.js"),__vite__mapDeps([5,6,1,2,3,4])),await Oa(()=>import("./w3m-modal-CcxKND6S.js"),__vite__mapDeps([7,6,1,2,3,4])),!document.querySelector("w3m-modal")){const s=document.createElement("w3m-modal");!B.state.disableAppend&&!B.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",s)}Uh=!0}}}const Y_="1.7.8";function Z_(t){return new tf({...t,basic:!0,sdkVersion:`html-core-${Y_}`})}const e2=Object.freeze(Object.defineProperty({__proto__:null,AppKit:tf,createAppKit:Z_},Symbol.toStringTag,{value:"Module"}));export{Ys as A,Zt as B,b as C,J as D,Ue as E,YS as F,te as G,mm as H,K as I,Kp as J,Ec as K,Ge as L,Je as M,wi as N,B as O,so as P,ee as Q,ne as R,tn as S,_t as T,H as U,Se as V,vc as W,e2 as X,dl as a,JS as b,gS as c,om as d,fS as e,vo as f,yS as g,wS as h,Rt as i,ot as j,ti as k,ZS as l,io as m,XS as n,QS as o,ke as p,Wh as q,mS as r,at as s,Kh as t,Yt as u,E_ as v,wm as w,GS as x,W as y,V as z};
